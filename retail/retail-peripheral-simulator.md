---
title: "零售外设模拟器"
description: "此主题介绍 Microsoft Dynamics 365 for Operations - Retail 随附的外设模拟器工具。"
author: josaw1
manager: AnnBe
ms.date: 04/04/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
audience: Application User
ms.search.scope: AX 7.0.0, Operations, Core, Retail
ms.custom: 266544
ms.assetid: 16f31e70-15fc-441e-9727-e6a31c3a48f5
ms.search.region: global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2016-05-31
ms.dyn365.ops.version: AX 7.0.1
ms.translationtype: Human Translation
ms.sourcegitcommit: d421b161216d700f7819f1da8c0ca8ad089b5670
ms.openlocfilehash: 894aaaaa844447030dae73826d326f99366aa068
ms.contentlocale: zh-cn
ms.lasthandoff: 05/25/2017


---

# <a name="retail-peripheral-simulator"></a>零售外设模拟器

[!include[banner](includes/banner.md)]


此主题介绍 Microsoft Dynamics 365 for Operations - Retail 随附的外设模拟器工具。

<a name="overview"></a>概览
--------

Microsoft Dynamics 365 for Operations - Retail 外设模拟器是一款工具，可帮助您设置和测试零售环境中使用的外设，以及对其执行故障排除。 可使用外设模拟器简化零售外设的测试，以及隔离错误设置或问题设备驱动程序导致的问题。 外设模拟器中包含一个桌面程序，该程序中带有 Dynamics 365 for Operations - Retail 支持的设备的虚拟版本。 每种虚拟设备的一个部分显示该设备与零售销售点 (POS) 之间的交互。 也可以将其用于提供对各种 POS 方案有效的输入。 外设模拟器支持 POS 与以下虚拟设备之间的交互：

-   **打印机** – 外设模拟器可显示针对 POS 打印机配置的收据。
-   **行显示器** – 可配置虚拟行显示器以在行显示器实物上显示活动。
-   **磁条阅读器 (MSR)** – 可将模拟的磁条事件从外设模拟器发送到 POS。
-   **银箱** – 可以模拟银箱实物。
-   **银箱 2** – 通过在外设模拟器中设置第二银箱，可以模拟一台 POS 收银机有两个有效班次的方案。
-   **扫描仪** – 外设模拟器支持的虚拟条码扫描仪可能发出条码扫描事件。
-   **秤** – 可通过虚拟秤模拟所称重物料与 POS 之间的交互。
-   **个人标识号 (PIN) 小键盘** – 可以模拟 PIN 小键盘操作。 **注释：**必须实施通过付款连接器对物理 PIN 小键盘的支持。
-   **签名捕获** – 外设模拟器中包含一个虚拟签名捕获设备，可设置来提示为某些收款（如客户帐户付款）索取签名。

也可以使用外设模拟器模拟来自条码扫描仪和 MSR 的键盘 wedge 事件。 虚拟外设模拟器特意支持 Retail POS (OPOS) 设备的对象链接和嵌入。

## <a name="key-scenarios"></a>关键方案
### <a name="troubleshooting"></a>疑难解答

您可以使用外设模拟器对设备设置执行疑难解答。 如果没有外设模拟器或相同类的第二台设备，可能很难确定问题的来源。 但是，如果有外设模拟器，则可以设置虚拟设备，然后运行用于物理设备的相同代码路径和业务逻辑。 从外设模拟器的角度来看，虚拟设备和物理设备之间的主要区别是服务对象，即设备驱动程序。 对于物理设备，服务对象通常由设备制造商提供。 相比之下，对于外设模拟器，服务对象作为外设模拟器的一部分提供。 当外设模拟器正常运行时，如果硬件配置文件中的设备名称更改为实际设备的名称之后设备无法正常运行，则可以认为制造商提供的服务对象有问题。

### <a name="training"></a>培训

物理硬件设置不可用时，可使用外设模拟器向收银员培训添加实际层。 培训方案中包含外设模拟器时，收银员可以更有效地与 POS 交互，方法是提供产品条码扫描和刷礼品卡之类输入，以及查看为特定交易记录打印哪些收据。

### <a name="testing"></a>正在测试

可以使用外设模拟器测试产品条码、收据格式等，同时无需在虚拟环境中部署物理硬件。 由于不需要物理硬件，并且不必在硬件工作站或物理计算机上部署 POS 客户端，所以可以更快地测试后端办公系统中执行的更改。

## <a name="set-up-the-peripheral-simulator"></a>设置外设模拟器
### <a name="set-up-a-hardware-profile"></a>设置硬件配置文件

1.  若要设置外设模拟器，请转至**零售和商业** &gt; **渠道设置** &gt; **POS 设置** &gt; **POS 配置文件** &gt; **硬件配置文件**。
2.  若要创建新的配置文件，请单击**新建**。
3.  在**配置文件编号**和**描述**字段中输入值。
4.  使用下表设置必须测试的虚拟设备。 下面是表中各列的说明：
    -   **设备** – 此列提供展开以设置设备的快速选项卡的名称。
    -   **设备类型** – 此列提供在带有设备名称标签的字段中选择的值。
    -   **设备名称** – 此列提供为设备名称输入的确切值。 **重要信息：**此处提供的设备名称为必需信息，因为硬件工作站使用这些特定名称为设备寻址。 如果不使用这些特定名称，设备将不可用。

    | 设备            | 设备类型 | 设备名称              |
    |-------------------|-------------|--------------------------|
    | 打印机           | OPOS        | MockOPOSPrinter          |
    | 行显示内容      | OPOS        | MockOPOSLineDisplay      |
    | MSR               | OPOS        | MockOPOSMSR              |
    | 开票人            | OPOS        | MockOPOSDrawer1          |
    | Drawer2           | OPOS        | MockOPOSDrawers          |
    | 扫描仪           | OPOS        | MockOPOSScanner          |
    | 比例             | OPOS        | MockOPOSScale            |
    | PIN 小键盘           | OPOS        | MockOPOSPinPad           |
    | 签名捕获 | OPOS        | MockOPOSSignatureCapture |

**注释：**无需在硬件配置文件中执行任何特定设置即可模拟来自条码扫描仪和 MSR 的键盘 wedge 事件。

### <a name="assign-the-hardware-profile-to-a-register"></a>将硬件配置文件分配给收银机

1.  创建硬件配置文件之后，请转至**零售和商业** &gt; **渠道设置** &gt; **POS 设置** &gt; **收银机**。
2.  在 **POS 收银机**列表中，单击应使用外设模拟器的收银机的**收银机编号**字段中的链接。
3.  单击**“编辑”**。
4.  在**配置文件**部分中**硬件配置文件**字段内，选择为虚拟外设创建的硬件配置文件。
5.  单击**保存**。

### <a name="synchronize-changes-to-the-channel-database"></a>将更改同步到渠道数据库

1.  转到**零售和商务** &gt; **零售 IT** &gt; **分配计划**。
2.  选择 **1090** 分配计划。
3.  单击**立即运行**将更改同步到 POS。

在同步数据之后，收银机上的新硬件配置文件和更改将在渠道数据库中可用。

## <a name="install-the-peripheral-simulator"></a>安装外设模拟器
1.  转至**零售和商业** &gt; **渠道设置** &gt; **POS 设置** &gt; **POS 配置文件** &gt; **硬件配置文件**。
2.  单击**下载**，然后单击 **PeripheralSimulator**。 **注释：**必须先关闭弹出窗口阻止程序，才能下载外设模拟器。
3.  下载完成后，打开**下载**文件夹，然后双击 **VirtualPeripherals.msi** 启动安装程序。
4.  通过使用默认设置安装外设模拟器。

除了外设模拟器，还必须从 Monroe Consulting Services 安装公共控件对象。 否则，外围模拟程序无法正常工作。 若要下载公共控件对象，请转至 <http://monroecs.com/oposccos_current.htm>。

## <a name="using-the-peripheral-simulator"></a>使用外设模拟器
若要启动外设模拟器，请在计算机上单击**开始**，键入**售外围设备模拟器**，然后在该应用程序在搜索结果中显示时将其选中。 启动外设模拟器之后，单击设备名称查看支持的设备。 这些设备将在窗口左侧以选项卡的形式列出。 若要显示特定设备，请单击该设备的选项卡。

### <a name="line-display-capabilities"></a>行显示器功能

行显示器是外设模拟器中列出的第一台设备。 如果配置了虚拟行显示器，将在 POS 交易中扫描行项时显示行项。 除了行项，该显示器还在 POS 中选择了收款时显示到期的总计。 如果在输入了付款但是交易的余额仍然到期，还将显示到期的余额。 未在使用 POS 时，可能显示消息，说明钱盒已关闭。 必须在硬件配置文件中的**行显示器**快速选项卡上确认消息。

### <a name="cash-drawer-capabilities"></a>银箱功能

银箱是外设模拟器中列出的第二台设备。 配置硬件配置文件以使用虚拟银箱时，POS 将为活动班次打开银箱以响应钱币清点之类银箱操作，并且以便收银员可以在标准现金结转交易期间执行更改或存现。 虚拟银箱有标签**主银箱**和**附属银箱**。 这些标签在硬件配置文件中分别表示“银箱”和“银箱 2”。 关闭银箱后，将显示已关闭银箱的图像，并且为已关闭银箱上的按钮标记**开银箱**。 如果单击此按钮，将把该图像替换为已开银箱的图像，以便指示银箱现在已打开。 已开银箱上的按钮带有标记**关银箱**。 POS 中的几项操作可能导致银箱打开。 大多数操作在银箱打开后不能继续。 除了一些日结程序。 如果 POS 用户收到错误消息说明银箱打开时无法执行某项操作，该用户必须关闭虚拟银箱或物理银箱才能继续操作。 如果银箱在硬件配置文件中标记为**共享**，则系统在执行操作之前不验证该银箱是否已关闭。 操作将按照执行，即使银箱已打开也不例外。 此行为支持以下方案：销售员之间共享银箱，以及一位销售员使用银箱时，另一位销售员在自己的 POS 设备上执行无关任务。 当前班次已关闭，并打开了新班次之前，对银箱所做更改不生效。

### <a name="msr-capabilities"></a>MSR 功能

外设模拟器通过以 OPOS 模式或键盘 wedge 模式运行，提供对虚拟 MSR 操作的强大支持。 OPOS 模式要求 MSR 在硬件配置文件中配置为作为 OPOS 设备运行。 键盘 wedge 模式仅将键盘 wedge 数据事件发送给 Microsoft Windows。 除了设置方面的差异，OPOS 和键盘 wedge 模式还有以下方面的差异：

-   POS 客户端在特定方案下支持 OPOS MSR 设备，如允许在输入积分或礼品卡时使用磁条数据的方案。
-   在键盘 wedge 模式下，外设模拟器将键盘 wedge 数据发送到发送数据时的活动字段。 此行为类似使用键盘输入数据时发生的行为。 若要将 MSR 用作键盘 wedge，用户必须切换到 Retail Modern POS (MPOS)，以确保在正确字段中接收数据。 因此，可以配置延迟，这样用户就有时间确保将数据发送到正确字段。

#### <a name="testing-gift-and-payment-card-swipes"></a>测试礼品卡和付款卡刷卡

外设模拟器提供的虚拟 MSR 也允许您配置特定 MSR 数据，以便测试礼品卡和付款卡刷卡的方案。 若要创建卡，请单击加号 (**+**) 按钮，然后选择卡类型。 然后指定应发送到 POS 的卡号或跟踪数据，以及定义的卡的到期月份和年份。 在**卡类型**字段中选择的值就是可映射到卡的标签。 通过外设模拟器刷卡时，可通过此标签更轻松地识别卡。 可以通过使用卡图像上方的向左箭头 (**&lt;**) 和向右箭头 (**&gt;**) 按钮，选择外设模拟器中已配置的卡。 可以通过使用加号 (**+**) 按钮旁边的**编辑**和**删除**按钮，编辑和删除卡。

### <a name="pin-pad"></a>PIN 小键盘

可以配置 PIN 小键盘模拟器以模拟 OPOS PIN 小键盘。 当电子资金转帐 (EFT) 交易在 POS 中执行且需要输入 PIN 时，硬件工作站将调用 PIN 设备以提示需要输入 PIN。 若要工作，外设模拟器中的 PIN 小键盘需要 EFT 付款连接器支持。

### <a name="printer"></a>打印机

仅当收据是从 POS 打印时，虚拟外设打印机才显示收据。 如果打印操作生成多张收据，可以滚动浏览收据。

#### <a name="configure-receipt-printing"></a>配置收据打印

1.  转至**零售和商业** &gt; **渠道设置** &gt; **POS 设置** &gt; **POS 配置文件** &gt; **硬件配置文件**。
2.  选择为虚拟外设创建的硬件配置文件。
3.  在**打印机**快速选项卡上，单击**编辑**。
4.  在**收据配置文件 ID** 字段中，选择收据配置文件。
5.  单击**保存**。

### <a name="scale"></a>比例

将产品测量添加到 POS 交易记录并且配置了秤时，POS 将从秤检索重量。 对于虚拟秤和物理秤，均应在将产品添加到交易记录之前指定产品或重量。 将产品测量添加到交易记录之前，请转至外设模拟器中的秤，然后使用加号 (**+**) 和减号 (**–**) 按钮调整秤应报告的重量。 还可以直接在**当前值**字段中输入所需重量。 可通过使用加号 (**+**)、**编辑**和**删除**按钮，调整秤的重量单位。 可以通过这种方式，基于所称重产品或所用秤的区域设置指定单位。

#### <a name="configure-a-scale-product"></a>配置产品测量

1.  转至**零售和****商业** &gt; **产品和类别** &gt; **已发布的产品(按类别)**。
2.  打开产品记录。
3.  选择要称重的产品。
4.  在**零售**快速选项卡中，将**产品测量**选项从**否**设置为**是**。

#### <a name="synchronize-changes-to-the-channel-database"></a>将更改同步到渠道数据库

1.  转到**零售和商务** &gt; **零售 IT** &gt; **分配计划**。
2.  选择 **1040** 分配计划。
3.  单击**立即运行**将更改同步到 POS。

同步数据后，将产品测量添加到 POS 交易记录时，POS 将检查重量的秤。

### <a name="signature-capture"></a>签名捕获

所用支付需要签名时，虚拟签名捕获设备提示用户在虚拟签名捕获小键盘上提供签名。 用户可接受签名以在 POS 上显示。 然后，收银员可接受签名。 然后，签名与支付一起保存，并随其他交易记录数据一起同步到后台办公系统。

#### <a name="set-up-a-tender-to-require-a-signature"></a>将支付设置为需要签名

1.  转至**零售和商业** &gt; **渠道** &gt; **零售商店** &gt; **所有零售商店**。
2.  选择零售商店。
3.  单击**“编辑”**。
4.  单击**设置**，然后在**设置**部分单击**付款方式**。
5.  单击**“编辑”**。
6.  选择需要签名的付款方式。
7.  在**常规**部分中的**签名捕获**下，将**使用签名捕获设备**选项设置为**是**。
8.  在**签名捕获最小金额**字段中，输入应触发签名捕获的最小金额。

#### <a name="synchronize-changes-to-the-channel-database"></a>将更改同步到渠道数据库

1.  转到**零售和商务** &gt; **零售 IT** &gt; **分配计划**。
2.  选择 **1070** 分配计划。
3.  单击**立即运行**将更改同步到 POS。

同步数据之后，使用需要签名的支付，并且金额满足签名阈值时，POS 将提示需要在虚拟签名捕获设备上提供签名。

## <a name="additional-configuration"></a>其他配置
可编辑外设模拟器的配置文件，以便更好地解决要测试的方案。 可以在 C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\VirtualPeripherals\\Microsoft.Dynamics.Commerce.VirtualPeripherals.Client.exe.config 中找到配置文件。 此配置文件定义可用于测试秤的单位、可供测试的卡类型和条码类型。 例如，通过修改配置文件中的文本值，可以添加可在运行时选择的新卡类型或度量单位。 将在重新启动应用程序之后显示新值。

## <a name="troubleshooting"></a>疑难解答
外设模拟器的活动记录在外设模拟器内。 可以在 C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\VirtualPeripherals\\Microsoft.Dynamics.Commerce.VirtualPeripherals.Client.exe.config 中找到日志。 外设模拟器还将问题报告到 Windows 事件日志，您可以通过**应用程序和服务日志** &gt; **Microsoft** &gt; **DynamicsAX** 访问该日志。 如果在使用 MPOS 或外设模拟器时对硬件配置文件或其他区域所做更改不生效，请检查用于将数据同步到渠道数据库的分配调度程序作业。 如果更改已同步，但是在 POS 中未生效，请重新启动 POS 客户端。 创建新班次之前，对所配置银箱的更改将不生效。 因此，如果更改银箱，请确保始终关闭现有班次以测试新银箱设置。 有时，如果制造商的驱动程序是在 Monroe Consulting Services 的公共控件对象之后安装的，则该驱动程序可导致公共控件对象停止正常工作。 在这种情况下，应重新安装该公共控件对象。

<a name="see-also"></a>请参阅
--------

[零售外设概览](retail-peripherals-overview.md)




