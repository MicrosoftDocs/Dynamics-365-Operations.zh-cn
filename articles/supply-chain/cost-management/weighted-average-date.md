---
title: 具有“包括实际成本和标记”的加权平均日期
description: 加权平均日期是基于加权平均原则的库存模型，其中，来自库存的发货按照物料的平均价值进行估价，这些物料是在库存结转期间中的每一天接收到库存中的物料。
author: AndersGirke
ms.date: 03/04/2022
ms.topic: article
ms.search.form: InventJournalLossProfit, InventMarking, InventModelGroup, SalesTable
audience: Application User
ms.reviewer: kamaybac
ms.custom: 28991
ms.search.region: Global
ms.author: aevengir
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 3cf2206863d891eceb9c65ff879da3f9f72032b1
ms.sourcegitcommit: fcded93fc6c27768a24a3d3dc5cc35e1b4eff22b
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/07/2022
ms.locfileid: "8391993"
---
# <a name="weighted-average-date-with-include-physical-value-and-marking"></a>具有“包括实际成本和标记”的加权平均日期

[!include [banner](../includes/banner.md)]

*加权平均日期* 是一种基于平均值的库存模型，该平均值是将每个组件（物料交易记录）乘以在该期间内每天反映其重要性（数量）的系数（成本价）得出的结果。 换言之，此库存模型根据每天收到的所有库存的平均值以及上一天的任何现有库存量来分配发货交易记录的成本。

当您使用加权平均日期库存模型运行库存结转时，可以使用两种方法来创建结算。 通常，将根据虚拟发货结算所有收货，这将保留收货总数量和值。 此虚拟发货具有将从其结算发货的相应虚拟收货。 通过这种方法，所有发货每天都具有相同的平均成本。 虚拟发货和虚拟收货可视为虚拟转移。 此虚拟转移称为 *加权平均库存结转转移*。 因此，此结算方法称为 *加权平均汇总结算*。 如果只存在一个收货，则可以根据该收货结算所有发货，并且将不创建虚拟转移。 此结算方法称为 *直接结算*。 执行库存结转后的任何现有库存均按上一期间最后一天的加权平均值估值，包括在下一期间的加权平均日期计算中。

您可以通过标记库存交易记录来替代加权平均日期原则，以针对特定发货结算特定物料收货。 当您使用加权平均日期库存模型根据加权平均日期原则创建结算和调整发货值时，需要进行定期库存结转。 在运行库存结转之前，当发生实际和财务更新时，发货交易记录将按移动平均值进行评估。 除非您正在使用标记，否则在执行实际更新或财务更新时将计算移动平均值。

每天使用以下公式计算加权平均日期库存结转法：

*成本* = \[(*Q*<sub>*b*</sub> × *P*<sub>*b*</sub>) + &#x2211;<sub>*n*</sub>(*Q*<sub>*n*</sub> × *P*<sub>*n*</sub>)\] ÷ (*Q*<sub>*b*</sub> + &#x2211;<sub>*n*</sub>*Q*<sub>*n*</sub>)

- *Q* = 交易记录的数量
- *P* = 交易记录的价格

换言之，加权平均成本等于起始数量乘以起始价格，加上每个收货数量总和乘以其收货价格，再除以起始数量加上收货数量总和。

在库存结转过程中，将在结转期间每天执行计算。

> [!NOTE]
> 有关结算的详细信息，请参阅[库存结转](inventory-close.md)。

以下示例通过五个配置显示使用加权平均日期的影响：

- 不使用 **包括实际成本** 选项时的加权平均日期直接结算
- 不使用 **包括实际成本** 选项时的加权平均日期汇总结算
- 使用 **包括实际成本** 选项时的加权平均日期直接结算
- 使用 **包括实际成本** 选项时的加权平均日期汇总结算
- 使用标记时的加权平均日期

## <a name="weighted-average-date-direct-settlement-when-the-include-physical-value-option-isnt-used"></a>不使用包括实际成本选项时的加权平均日期直接结算

直接结算原则直接在收货和发货之间创建结算，而不创建额外的库存交易记录。 此系统在以下情况下会使用这一直接结算原则：

- 已在期间中过帐一个收货以及一个或多个发货。
- 在该期间中只过帐了发货，并且库存包含来自以前结转的现有物料。

在此示例中，清除了已发布产品的 **物料模型组** 页面上的 **包括实际值** 复选框。 随后的图表说明了这些交易记录：

**第 1 天：**

- 1a. 数量 10（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 10（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 10（单件成本为 USD 20.00）的库存实际收货。
- 3a. 数量 1（单件成本价为 USD 10.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 10.00）的库存财务发货（财务过帐的交易记录的移动平均）。

**第 2 天：**

- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本为 USD 20.00）的库存财务发货（财务过帐的交易记录的移动平均）。

**第 3 天：**

- 7\. 执行库存结转。 基于加权平均日期法，系统对 12 月 30 日 (12/30) 使用直接结算方法，因为在 12/30 仅对一个收货进行财务更新。 在此示例中，在交易 1b 和 3b 之间创建了一个结算。 进行 10.00 美元的调整以使交易 3b 的值达到 20.00。 12 月 31 日 (12/31) 没有进行任何调整或结算，因为 12 月 31 日没有财务更新的发货。

下图显示此系列的交易记录，以及使用加权平均库存模型和直接结算原则（没有 **包括实际值** 选项）的影响。

![没有“包括实际值”选项的加权平均日期直接结算。](media/weighted-average-date-direct-settlement-without-include-physical-value.png)

**图形要点：**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 日期由细黑色垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-date-summarized-settlement-when-the-include-physical-value-option-isnt-used"></a>不使用包括实际成本选项时的加权平均日期汇总结算

当一个期间内有多个收货时，加权平均日期使用将一天内的所有收货汇总到名为 *加权平均库存结转* 的交易记录中的汇总结算原则。 这天的所有收货都将根据新创建的库存交易记录的发货进行结算。 这天的所有发货都将根据新的库存交易记录的收货进行结算。 如果在库存结转后，还有剩余现有库存量值，现有库存量值将包含在加权平均库存结转交易记录的收货交易记录中。

随后的图表说明了这些交易记录：

**第 1 天：**

- 1a. 数量 1（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 1（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 1（单件成本为 USD 20.00）的库存实际收货。
- 2b. 数量 1（单件成本为 USD 22.00）的库存财务收货。
- 3a. 数量 1（单件成本价为 USD 16.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 16.00）的库存财务发货（财务过帐的交易记录的移动平均）。

**第 2 天：**

- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本价为 USD 23.00）的库存实际发货（财务过帐的交易记录的移动平均）。

**第 3 天：**

- 7\. 执行库存结转。
- 7a. 创建“加权平均库存结转交易记录”财务发货，以便计算所有库存财务收货结算之和。

    - 交易记录 1b 的结算数量为 1，结算金额为 10.00 美元。
    - 交易记录 2b 的结算数量为 1，结算金额为 22.00 美元。
    - 创建的交易记录 7a 的数量为 2，结算金额为 32.00 美元。 此交易记录抵消了期间内财务更新的两个收货交易记录的总和。

- 7b. 创建加权平均库存结转交易记录财务收货，作为对财务过帐发货的抵消。

    - 交易记录 3b 的结算数量为 1，结算金额为 16.00 美元。 此交易未经过调整，因为它是 12 月 1 日 (12/1) 财务过帐交易的加权平均值。
    - 创建的交易记录 7b 的数量为 2，其财务金额为 32.00 美元，对方交易 3b 的结算金额为 16.00 美元。 此交易记录抵消了期间内财务更新的一个发货交易记录的总和。 此交易仍然未结，因为仍有一个现有交易。

下图显示了此系列的交易记录，以及使用加权平均库存模型和汇总结算原则（但没有使用 **包括实际成本** 选项）的影响。

![没有“包括实际值”选项的加权平均日期汇总结算。](media/weighted-average-date-summarized-settlement-without-include-physical-value.png)

**图形要点：**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 日期由细黑色垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-date-direct-settlement-when-the-include-physical-value-option-is-used"></a>使用包括实际成本选项时的加权平均日期直接结算

在当前版本的产品中，**包括实际值** 选项使用加权平均库存模型的方式不同于它在先前版本中的使用方式。 如果为 **物料模型组** 页面上的物料选中 **包括实际成本** 复选框，此系统将在计算估计的发货成本价或移动平均值时使用实际更新的收货。 将在期间中基于此估计的成本价过帐发货。 在库存结转期间，在加权平均计算时将只考虑财务更新的收货。

随后的图表说明了这些交易记录：

**第 1 天：**

- 1a. 数量 10（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 10（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 10（单件成本为 USD 20.00）的库存实际收货。
- 3a. 数量 1（单件成本价为 USD 15.00）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 15.00）的库存财务发货（实际和财务过帐的交易记录的移动平均）。

**第 2 天：**

- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本为 USD 21.25）的库存实际发货（实际和财务过帐的交易记录的移动平均）。

**第 3 天：**

- 7\. 执行库存结转。 基于加权平均日期法，系统对 12 月 30 日 (12/30) 使用直接结算方法，因为在 12/30 仅对一个收货进行财务更新。 在此示例中，在交易 1b 和 3b 之间创建了一个结算。 12 月 30 日没有对发货进行调整。 此外，12 月 31 日 (12/31) 没有进行任何调整或结算，因为 12 月 31 日没有财务更新的发货。

下图显示此系列的交易记录，以及使用加权平均库存模型和直接结算原则（具有 **包括实际值** 选项）的影响。

![包括实际值的加权平均直接结算。](media/weighted-average-date-direct-settlement-with-include-physical-value.png)

**图形要点：**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 日期由细黑色垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-date-summarized-settlement-when-the-include-physical-value-option-is-used"></a>使用包括实际成本选项时的加权平均日期汇总结算

在当前版本的产品中，**包括实际值** 选项使用加权平均值的方式不同于它在先前版本中的使用方式。 如果为 **物料模型组** 页面上的物料选中 **包括实际值** 复选框，此系统将在计算估计的成本价或移动平均时使用实际更新的收货。 将在期间中基于此估计的成本价过帐发货。 在库存结转期间，在加权平均计算时将只考虑财务更新的收货。 我们建议您在您使用加权平均库存模型时执行每月库存结转。 在此加权平均日期汇总结算示例中，将标记库存模型以包括实际值。

随后的图表说明了这些交易记录：

**第 1 天：**

- 1a. 数量 1（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 1（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 1（单件成本为 USD 20.00）的库存实际收货。
- 2b. 数量 1（单件成本为 USD 22.00）的库存财务收货。
- 3a. 数量 1（单件成本价为 USD 16.00）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 16.00）的库存财务发货（实际和财务过帐的交易记录的移动平均）。

**第 2 天：**

- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本价为 USD 23.67）的库存实际发货（实际和财务过帐的交易记录的移动平均）。

**第 3 天：**

- 7\. 执行库存结转。
- 7a. 创建“加权平均库存结转交易记录”财务发货，以便计算所有库存财务收货结算之和。

    - 交易记录 1b 的结算数量为 1，结算金额为 10.00 美元。
    - 交易记录 2b 的结算数量为 1，结算金额为 22.00 美元。
    - 创建的交易记录 7a 的数量为 2，结算金额为 32.00 美元。 此交易记录抵消了期间内财务更新的两个收货交易记录的总和。

- 7b. 创建加权平均库存结转交易记录财务收货，作为对财务过帐发货的抵消。

    - 交易记录 3b 的结算数量为 1，结算金额为 16.00 美元。 此交易未经过调整，因为它是 12 月 1 日 (12/1) 财务过帐交易的加权平均值。
    - 创建的交易记录 7b 的数量为 2，其财务金额为 32.00 美元，对方交易 3b 的结算金额为 16.00 美元。 此交易记录抵消了期间内财务更新的一个发货交易记录的总和。 此交易仍然未结，因为仍有一个现有交易。

下图显示此系列的交易记录，以及使用加权平均库存模型和汇总结算原则（没有 **包括实际值** 选项）的影响。

![具有“包括实际值”的加权平均汇总结算。](media/weighted-average-date-summarized-settlement-with-include-physical-value.png)

**图形要点：**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 日期由细黑色垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-date-when-marking-is-used"></a>使用标记时的加权平均日期

标记是一个过程，您可以将某一发货交易记录链接到（或标记到）某一收货交易记录。 标记可以在过帐交易记录之前或之后发生。 如果您想要在过帐交易时或执行库存结转时确保库存的准确成本，则可以使用标记。

例如，您的客户服务部接受了来自重要客户的一个紧急订单。 因为这是紧急订单，所以，您将需要为此物料支付更多成本以服务您的客户的请求。 您必须确保此库存物料的成本反映在此销售订单发票的毛利中或所售货物成本 (COGS) 中。

在过帐采购订单时，按 USD 120.00 的成本入库。 如果在过帐装箱单或发票前此销售订单单据被标记为采购订单，则 COGS 将是 120.00 美元，而不是该物料的当前移动平均成本。 如果在过帐销售订单装箱单或发票后发生标记，则将按移动平均成本价过帐 COGS。

在执行库存结转前，仍可以彼此标记这两个交易记录。

在将某一收货交易记录标记为发货交易记录时，将不考虑为此物料的物料模型组选择的求值方法，并且此系统将彼此结算这些交易记录。

在过账交易记录前，您可以将某一发货交易记录标记到某一收货交易记录。 您可以从 **销售订单详细信息** 页上的销售订单行执行此标记。 未结收货交易记录在 **标记** 页上显示。

在过帐交易记录后，您还可以将某一发货交易记录标记到某一收货交易记录。 您可以匹配或标记已过帐库存调整日记帐的清查过物料的未结收货交易记录的发货交易记录。

随后的图表说明了这些交易记录：

**第 1 天：**

- 1a. 数量 1（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 1（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 1（单件成本为 USD 20.00）的库存实际收货。
- 2b. 数量 1（单件成本为 USD 22.00）的库存财务收货。
- 3a. 数量 1（单件成本价为 USD 16.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 16.00）的库存财务发货（财务过帐的交易记录的移动平均）。
- 3c. 交易 3b 的库存财务发货将被标记为交易 2b 的库存财务发货。

**第 2 天：**

- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本价为 USD 23.00）的库存实际发货（财务过帐的交易记录的移动平均）。

**第 3 天：**

- 7\. 执行库存结转。 基于使用加权平均方法的标记原则，标记的交易记录将相互结算。 在此示例中，交易 3b 针对交易 2b 进行结算，将 6.00 美元的调整过帐到交易 3b 以使值达到 22.00 美元。 在此示例中，没有进行其他结算，因为结转仅为财务更新的交易记录创建结算。

下图显示此系列的交易记录，以及使用加权平均日期库存模型和标记的影响。

![具有标记的加权平均。](media/weighted-average-date-with-marking.png)

**图形要点：**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 日期由细黑色垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
