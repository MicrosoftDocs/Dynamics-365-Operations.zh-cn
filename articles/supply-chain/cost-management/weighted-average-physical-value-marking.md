---
title: 具有实际成本和标记的加权平均
description: 加权平均是基于加权平均原则的一种库存模型，其中，按照在库存结转期间入库物料的平均值加上前一期间的所有现有库存量，计算库存发货量。
author: AndersGirke
ms.date: 02/21/2022
ms.topic: article
ms.search.form: InventJournalLossProfit, InventMarking, InventModelGroup, SalesTable
audience: Application User
ms.reviewer: kamaybac
ms.custom: 65501
ms.search.region: Global
ms.author: aevengir
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 6c124716b70be837573506a738ef2034397f2bda
ms.sourcegitcommit: addae271ddfc5a8b0721c23337f69916153db4cd
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/21/2022
ms.locfileid: "8330218"
---
# <a name="weighted-average-with-physical-value-and-marking"></a>具有实际成本和标记的加权平均

[!include [banner](../includes/banner.md)]

加权平均是一种基于平均值的库存模型，该平均值是将每个组件（物料交易记录）乘以反映其重要性（数量）的系数（成本价）得出的结果。 另一种描述方式是，加权平均是一种库存模型，它根据期间内收到的所有库存的平均值以及上一期间的任何现有库存量来分配发货交易记录的成本。

当您使用加权平均库存模型运行库存结转时，可以通过两种方式创建结算。 通常，将根据虚拟发货结算所有收货，这将保留收货总数量和值。 此虚拟发货具有将从其结算发货的相应虚拟收货。 通过这种方法，所有发货都具有相同的平均成本。 虚拟发货和收货可以视为虚拟转移，称为 *加权平均库存结转转移*。 此结算方法称为 *加权平均汇总结算*。 如果只存在一个收货，则可以根据该收货结算所有发货，并且将不创建虚拟转移。 此结算方法称为 *直接结算*。 执行库存结转后的任何现有库存均按上一期间的加权平均值估值，包括在下一期间的加权平均计算中。

您可以通过标记库存交易记录来替代加权平均原则，以针对特定发货结算特定物料收货。 当您使用加权平均库存模型根据加权平均原则创建结算和调整发货值时，需要进行定期库存结转。 在运行库存结转流程之前，当发生实际和财务更新时，发货交易记录将按移动平均值进行评估。 除非您正在使用标记，否则在执行实际更新或财务更新时将计算移动平均值。

按以下公式计算加权平均库存结转法：

- 加权平均 = (\[Q1 × P1\] + \[Q2 × P2\] + \[Q *n* × P *n*\]) ÷ (Q1 + Q2 + Q *n*)

Q = 交易记录的数量  
P = 交易记录的价格

结算是在结转日期时将发货调整为正确的加权平均的库存结转过帐。 以下示例通过五个不同的配置阐释对使用加权平均的影响：

- 不具有 **包括实际成本** 选项的加权平均直接结算
- 没有 **包括实际成本** 选项的加权平均汇总结算
- 具有 **包括实际成本** 选项的加权平均直接结算
- 具有 **包括实际成本** 选项的加权平均汇总结算
- 具有标记的加权平均

## <a name="weighted-average-direct-settlement-without-include-physical-value"></a>不包括实际成本的加权平均直接结算

直接结算原则直接在收货和发货之间创建结算，而不创建额外的库存交易记录。 此系统在以下情况下会使用这一直接结算原则：

- 已在期间中过帐一个收货以及一个或多个发货。
- 在该期间中只过帐了发货，并且库存包含来自以前结转的现有物料。

在此示例中，清除了已发布产品的 **物料模型组** 上的 **包括实际成本** 复选框。 随后的插图说明了这些交易记录：

- 1a. 数量 10（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 10（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 10（单件成本为 USD 20.00）的库存实际收货。
- 3a. 数量 1（单件成本价为 USD 10.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 10.00）的库存财务发货（财务过帐的交易记录的移动平均）。
- 4a. 数量 1（单件成本为 USD 10.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 4b. 数量 1（单件成本为 USD 10.00）的库存财务发货（财务过帐的交易记录的移动平均）。
- 5a. 数量 1（单件成本为 USD 10.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 6\. 执行库存结转。 基于加权平均法，系统使用直接结算方法，因为在期间内仅对一个收货进行财务更新。 在此示例中，在 1b 和 3b 之间创建了一个结算，在 1b 和 4b 之间创建了另一个结算。 没有进行调整，因为移动平均值与加权平均值相同。

下图说明在选择了加权平均库存模型和直接结算原则（没有 **包括实际成本** 选项）的情况下此系列的交易记录。

![不具有“包括实际值”的加权平均直接结算。](media/weighted-average-direct-settlement-without-include-physical-value.png)

**图形要点**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 图表中的每个日期由一条细黑垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-summarized-settlement-without-the-include-physical-value-option"></a>没有“包括实际成本”选项的加权平均汇总结算

当一个期间内有多个收货时，加权平均使用将结转期间内的所有收货汇总到称为 *加权平均库存结转* 的交易记录中的汇总结算原则。 该期间的所有收货都将根据新创建的库存交易记录的发货进行结算。 该期间的所有发货都将根据新的库存交易记录的收货进行结算。 如果在库存结转后，还有剩余现有库存量值，现有库存量值将包含在加权平均库存结转交易记录的收货交易记录中。

下图阐释了以下交易记录：

- 1a. 数量 1（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 1（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 1（单件成本为 USD 20.00）的库存实际收货。
- 2b. 数量 1（单件成本为 USD 22.00）的库存财务收货。
- 3a. 数量 1（单件成本价为 USD 16.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 16.00）的库存财务发货（财务过帐的交易记录的移动平均）。
- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本价为 USD 23.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 7\. 执行库存结转。
- 7a. 创建“加权平均库存结转交易记录”财务发货，以便计算所有库存财务收货结算之和。
  - 交易记录 1b 的结算数量为 1，结算金额为 USD 10.00。
  - 交易记录 2b 的结算数量为 1，结算金额为 USD 22.00。
  - 交易记录 5b 的结算数量为 1，结算金额为 USD 30.00。
  - 交易记录 7a 的数量为 3，结算金额为 USD 62.00。 此交易记录抵消了期间内财务更新的三个收货交易记录的总和。
- 7b. 创建加权平均库存结转交易记录财务收货，作为对财务过帐发货的抵消。
  - 交易记录 3b 的结算数量为 1，结算金额为 USD 20.67。 将此交易记录调整 USD 4.67，将 USD 16.00 的原始值调整为 20.67，这是期间内财务过帐交易记录的加权平均值。
  - 交易记录 7b 的数量为 1，结算金额为 USD 20.67，抵消 3b。 此交易记录抵消了期间内财务更新的一个发货交易记录的总和。

下图说明在选择了加权平均库存模型和汇总结算原则（没有 **包括实际成本** 选项）的情况下此系列的交易记录。

![不具有“包括实际值”的加权平均汇总结算。](media/weighted-average-summarized-settlement-without-include-physical-value.png)

**图形要点**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 图表中的每个日期由一条细黑垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-direct-settlement-with-the-include-physical-value-option"></a>具有“包括实际成本”选项的加权平均直接结算

参数 **包括实际成本** 在工作方式上不同于该产品先前版本中的加权平均库存模型。 当为 **物料模型组** 窗体上的物料选择 **包括实际成本** 选项时，系统将在计算估计的发货成本价或移动平均值时使用实际更新的收货。 将在期间中基于此估计的成本价过帐发货。 在库存结转期间，在加权平均计算时将只考虑财务更新的收货。

下图阐释了以下交易记录：

- 1a. 数量 10（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 10（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 10（单件成本为 USD 20.00）的库存实际收货。
- 3a. 数量 1（单件成本价为 USD 15.00）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 15.00）的库存财务发货（实际和财务过帐的交易记录的移动平均）。
- 4a. 数量 1（单件成本为 USD 15.00）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 4b. 数量 1（单件成本为 USD 15.00）的库存财务发货（实际和财务过帐的交易记录的移动平均）。
- 5a. 数量 1（单件成本为 USD 15.00）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 6\. 执行库存结转。 基于加权平均法，系统使用直接结算方法，因为在期间内仅对一个收货进行财务更新。 在此示例中，在 1b 和 3b 之间创建了一个结算，在 1b 和 4b 之间创建了另一个结算。 交易记录 3b 和 4b 分别调整 USD -5.00，将值调整为 USD 10.00。

下图说明在选择了加权平均库存模型和直接结算原则（有 **包括实际成本** 选项）的情况下此系列的交易记录。

![具有“包括实际成本”的加权平均直接结算。](media/weighted-average-direct-settlement-with-include-physical-value.png)

**图形要点**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 图表中的每个日期由一条细黑垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-summarized-settlement-with-the-include-physical-value-option"></a>具有“包括实际成本”选项的加权平均汇总结算

**包括实际成本** 参数在工作方式上不同于先前版本中的加权平均。 为 **物料模型组** 页中的某一物料选中 **包括实际成本** 复选框。 然后，此系统将使用实际更新的收货（当计算估计成本价或移动平均时）。 将在期间中基于此估计的成本价过帐发货。 在库存结转期间，在加权平均计算时将只考虑财务更新的收货。 我们建议在您使用加权平均库存模型时使用每月库存结转。 在此加权平均汇总结算示例中，将标记库存模型以包括实际值。

下图阐释了以下交易记录：

- 1a. 数量 1（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 1（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 1（单件成本为 USD 20.00）的库存实际收货。
- 2b. 数量 1（单件成本为 USD 22.00）的库存财务收货。
- 3a. 数量 1（单件成本价为 USD 16.00）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 16.00）的库存财务发货（实际和财务过帐的交易记录的移动平均）。
- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本价为 USD 23.67）的库存实际发货（实际和财务过帐的交易记录的移动平均）。
- 7\. 执行库存结转。
- 7a. 创建“加权平均库存结转交易记录”财务发货，以便计算所有库存财务收货结算之和。
  - 交易记录 1b 的结算数量为 1，结算金额为 USD 10.00。
  - 交易记录 2b 的结算数量为 1，结算金额为 USD 22.00。
  - 交易记录 5b 的结算数量为 1，结算金额为 USD 30.00。
  - 交易记录 7a 的数量为 3，结算金额为 USD 62.00。  
- 7b. 创建加权平均库存结转交易记录财务收货，作为对财务结算发货交易记录的抵消。
  - 交易记录 3b 的结算数量为 1，结算金额为 USD 20.67。 将此交易记录调整 USD 4.67，将 USD 16.00 的原始值调整为 20.67，这是期间内财务过帐交易记录的加权平均值。
  - 交易记录 7b 的数量为 1，结算金额为 USD 20.67，抵消 3b。

下图说明在选择了加权平均库存模型和汇总结算原则（没有 **包括实际成本** 选项）的情况下此系列的交易记录。

![具有“包括实际成本”的加权平均汇总结算。](media/weighted-average-summarized-settlement-with-include-physical-value.png)

**图形要点**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 图表中的每个日期由一条细黑垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

## <a name="weighted-average-with-marking"></a>具有标记的加权平均

标记是一个过程，您可以将某一发货交易记录链接到（或标记到）某一收货交易记录。 标记可以在过帐交易记录之前或之后发生。 如果您想要在过帐交易记录时或执行库存结转时确保库存的准确成本，则可以使用标记。

例如，您的客户服务部接受了来自重要客户的一个紧急订单。 因为这是紧急订单，所以，您将需要为此物料支付更多成本以服务您的客户的请求。 您必须确保此库存物料的成本反映在此销售订单发票的毛利中或所售货物成本 (COGS) 中。

在过帐采购订单时，按 USD 120.00 的成本入库。 例如，如果在装箱单或发票过帐之前，此销售订单单据标记到采购订单。 然后，COGS 将是 USD 120.00 代替物料的当前移动平均成本。 如果在发生标记前过帐销售订单装箱单或发票，则将按移动平均成本价过帐 COGS。

在执行库存结转前，仍可以彼此标记这两个交易记录。

将收货交易记录标记到某一发货交易记录。 然后，将不考虑为物料模型组中选择的求值方法，并且此系统将彼此结算这些交易记录。

在过账交易记录前，您可以将某一发货交易记录标记到某一收货交易记录。 您可以从 **销售订单详细信息** 页上的销售订单行执行此操作。 未结收货交易记录在 **标记** 页上显示。

在过账交易记录只看，您可以将某一发货交易记录标记到某一收货交易记录。 您可以匹配或标记已过帐库存调整日记帐的清查过物料的未结收货交易记录的发货交易记录。

下图阐释了以下交易记录：

- 1a. 数量 1（单件成本为 USD 10.00）的库存实际收货。
- 1b. 数量 1（单件成本为 USD 10.00）的库存财务收货。
- 2a. 数量 1（单件成本为 USD 20.00）的库存实际收货。
- 2b. 数量 1（单件成本为 USD 22.00）的库存财务收货。
- 3a. 数量 1（单件成本价为 USD 16.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 3b. 数量 1（单件成本价为 USD 16.00）的库存财务发货（财务过帐的交易记录的移动平均）。
- 3c. 3b 的库存财务发货将被标记为 2b 的库存财务发货。
- 4a. 数量 1（单件成本为 USD 25.00）的库存实际收货。
- 5a. 数量 1（单件成本为 USD 30.00）的库存实际收货。
- 5b. 数量 1（单件成本为 USD 30.00）的库存财务收货。
- 6a. 数量 1（单件成本价为 USD 23.00）的库存实际发货（财务过帐的交易记录的移动平均）。
- 7\. 执行库存结转。 基于使用加权平均方法的标记原则，标记的交易记录将相互结算。 在此示例中，3b 针对 2b 进行结算，将 USD 6.00 的调整过帐到 3b 以使值达到 USD 22.00。 在此示例中，没有进行其他结算，因为结转仅为财务更新的交易记录创建结算。

下图说明在选择具有标记的加权平均库存模型的情况下此系列的交易记录。

![具有标记的加权平均。](media/weighted-average-with-marking.png)

**图形要点**

- 库存交易记录用垂直箭头表示。
- 实际交易记录由较短的浅灰色箭头表示。
- 财务交易记录由较长的黑色箭头表示。
- 入库用坐标轴上的垂直箭头表示。
- 出库用坐标轴下的垂直箭头表示。
- 每个新的收货或发货交易记录都用一个新标签标明。
- 每个垂直箭头用连续标识符标记，例如 *1a*。 这些标识符指示时间线中库存交易记录过帐的顺序。
- 图表中的每个日期由一条细黑垂直线分隔。 日期在图表底部注明。
- 库存结转用红色的垂直虚线表示。
- 由库存结转执行的结算用红色对角箭头（从收货指向发货）表示。

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
