---
title: 通过仓库应用创建转移单
description: 本主题介绍了如何通过仓库管理移动应用创建和处理转移单
author: perlynne
ms.date: 09/02/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: WHSMobileDeviceQueueEvent
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: perlynne
ms.search.validFrom: 2020-10-09
ms.dyn365.ops.version: 10.0.15
ms.openlocfilehash: d8bab58727a7031f122864cb7465d9bc5983b467
ms.sourcegitcommit: 1f2394be857afaefa8749f607cda62dfa00ba2c5
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/02/2021
ms.locfileid: "6164838"
---
# <a name="create-transfer-orders-from-the-warehouse-app"></a>通过仓库应用创建转移单

[!include [banner](../includes/banner.md)]

此功能允许仓库工作人员直接通过仓库管理移动应用创建和处理转移单。 工作人员首先选择目标仓库，然后他们可以使用应用扫描一个或多个牌照来将牌照添加到转移单。 当仓库工作人员选择 **完成订单** 时，批处理作业将根据为这些牌照登记的现有库存创建所需的转移单和订单行。

## <a name="enable-the-create-transfer-orders-from-the-warehouse-app-feature"></a><a name="enable-create-transfer-order-from-warehouse-app"></a>启用通过仓库应用创建转移单功能

只有在系统上启用了此功能及其先决条件后才能使用它。 管理员可以使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)页面检查功能状态，并在需要时启用。

1. 首先启用[处理仓库应用事件](warehouse-app-events.md)功能，该功能在[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)中列出为：
    - **模块** - 仓库管理
    - **功能名称** - 处理仓库应用事件
1. 然后，启用 *通过仓库应用创建转移单* 功能，该功能列出为：
    - **模块** - 仓库管理
    - **功能名称** - 通过仓库应用创建和处理转移单
1. 若要自动化出站装运的过程，您还必须启用[从批处理作业确认出站装运](confirm-outbound-shipments-from-batch-jobs.md)功能。 此功能列出为：
    - **模块** - 仓库管理
    - **功能名称** - 从批处理作业确认出站装运

## <a name="set-up-a-mobile-device-menu-item-to-create-transfer-orders"></a><a name="setup-warehouse-app-menu"></a>设置用于创建转移单的移动设备菜单项

这是设置用于创建转移单的移动设备菜单项的一般准则。 根据要在用户从车间创建转移单时设置的自动化级别的业务需求，将启用不同的配置。 本文档中的方案将描述一种这样的配置。

1. 转到 **仓库管理 \> 设置 \> 移动设备 \> 移动设备菜单项**。
1. 选择 **新建** 以添加新的菜单项。 然后，进行以下设置以开始使用：

    - **菜单项名称** - 分配一个名称，因为它应该显示在 Supply Chain Management 中。
    - **标题** - 分配菜单名称，因为它应该在仓库管理移动应用中显示给工作人员。
    - **模式** - 设置为 *间接*（此菜单项不会创建工作）。
    - **活动代码** - 设置 *通过牌照创建转移单*，以使仓库工人能够基于一个或多个扫描的牌照创建转移单。

1. 使用 **转移单行创建策略** 设置，以控制此菜单项将如何创建转移单行。 将根据针对扫描的牌照登记的现有库存创建/更新这些行。 选择以下值之一：

    - **没有预留** - 转移单行将不会预留。
    - **牌照引导与行预留** – 转移单行将预留，并使用牌照引导策略选项，该选项存储与订单行关联的相关牌照 ID。 因此，可以在转移单行的工作创建过程中使用定位的牌照 ID 值。

1. 使用 **出站装运策略** 设置以根据需要向出站转移单装运过程添加更多自动化功能。 当工作人员选择 **完成订单** 按钮时，该应用将创建 *完成订单* 仓库应用事件，该事件将对当前转移单中的每个行保存您在 **出站装运策略** 字段中选择的值。 稍后，当批处理作业处理事件队列以创建转移单时，批处理作业可以读取此字段中存储的值，从而可以控制该作业如何处理每一行。 选择以下各项之一：

    - **无** - 没有自动处理。
    - **发放到仓库** - 自动化发放到仓库的过程。
    - **装运确认** - 自动化装运确认的过程。
    - **发放和装运确认** - 自动化发放到仓库和装运确认的过程。

## <a name="add-the-mobile-device-menu-item-to-a-menu"></a>将移动设备菜单项添加到一个菜单

1. 转到 **仓库管理 \> 设置 \> 移动设备 \> 移动设备菜单**
1. 选择 **编辑**。
1. 选择现有菜单，然后在 **可用菜单和菜单项** 下选择新菜单项。 通过选择向右键按钮添加菜单项。

## <a name="create-a-transfer-order-based-on-license-plates"></a>根据牌照创建转移单

仓库管理移动应用具有根据牌照创建转移单的简单流程。 为此，工作人员将使用仓库管理移动应用执行以下操作：

1. 创建转移单并确定目标仓库。
1. 确定要装运的每个牌照。
1. 选择 **完成订单**。

>[!NOTE]
> 多个工作人员可以通过使用 **选择转移单** 按钮从仓库应用事件队列中选择未处理的现有转移单号，为同一转移单分配牌照。 有关如何查找转移单号的值的信息，请参见[查询仓库应用事件](#inquire-the-warehouse-app-events)。

## <a name="example-scenario"></a>示例场景

此方案概述了获取根据已登记所选牌照的现有库存创建和自动处理的转移单的过程。

若要使用建议的值完成此方案，必须在安装了演示数据的系统上工作，然后选择 *USMF* 法人，然后再开始。

此方案假设您已经启用了[通过仓库应用创建和处理转移单功能](#enable-create-transfer-order-from-warehouse-app)和[仓库应用事件处理](warehouse-app-events.md)功能。

除了在移动设备菜单项中设置创建转移单外，还必须设置并启用其他模板、位置指令和批处理作业。

### <a name="example-scenario-blueprint"></a>示例方案蓝图

您是零售商，拥有多个牌照，每个牌照包含物料组合，这些物料放在您的一个仓库（*仓库 51*）中的特定位置。 您想要启用允许工作人员创建到另一个仓库（*仓库 61*）的转移单以收集扫描的牌照的过程。 一旦确定了该订单的最后一个牌照，您将自动装运/更新转移单。

![自动化转移单过程示例](media/create-transfer-order-from-app-example.png "自动化转移单过程示例")

### <a name="create-a-mobile-device-menu-item-for-creating-transfer-orders"></a>创建用于创建转移单的移动设备菜单项

此部分说明了如何创建用于创建转移单的新移动设备菜单项。 将 **模式** 设置为 *间接*，并将 **活动代码** 设置为 *通过牌照创建转移单*。

1. 转到 **仓库管理 \> 设置 \> 移动设备 \> 移动设备菜单项**。
1. 选择 **新建**。
1. 在 **菜单项名称** 字段中，输入名称 *创建到*。
1. 在 **标题** 字段中，输入说明 *创建到*。
1. 在 **模式** 字段中，选择 *间接*。
1. 在 **活动代码** 中，选择 *通过牌照创建转移单*
1. 在 **订单行创建策略** 中，选择 *牌照引导与行预留*。
1. 在 **出站装运策略** 中，选择 *发放和装运确认*。
1. 转到 **仓库管理 \> 设置 \> 移动设备 \> 移动设备菜单**。
1. 选择 **编辑**。
1. 选择现有 **库存** 菜单，然后在 **可用菜单和菜单项** 下选择新菜单项。 通过选择向右键按钮将菜单项添加到 **库存** 菜单。

### <a name="set-up-work-templates-to-auto-process-and-break-work-by-located-license-plate"></a>设置工作模板以按定位的牌照自动处理和分解工作

此部分说明了如何在发放波次时使工作模板自动处理由模板创建的工作。

1. 转到 **仓库管理 \> 设置 \> 工作 \> 工作模板**。
1. 在 **工作订单类型** 字段中，选择 *转移发放*。
1. 选择 **新建** 创建新的工作模板。
1. 在 **工作模板** 字段中，输入 *51 自动处理 LP*。
1. 在 **工作模板说明** 字段中，输入 *51 自动处理 LP*。
1. 选择 **自动处理** 复选框。 必须选择此项才能处理任何自动化步骤。
1. 在演示数据中，已经存在一个工作模板 *51 转移*，编辑 **序列号** 字段，以便新工作模板的序列号比现有工作模板 *51 转移* 的序列号低。
1. 在工具栏中选择 **保存** 以启用 **工作模板详细信息** 快速选项卡。
1. 在 **工作模板详细信息** 快速选项卡中，在工具栏中选择 **新建**。 您将添加两行。
1. 在 **工作类型** 字段中，选择 *领料*。
1. 在 **工作类 ID** 字段中，选择 *TransfOut*。
1. 在 **工作模板详细信息** 工具栏中选择 **新建**。
1. 在 **工作类型** 字段中，选择 *放置*。
1. 在 **工作类 ID** 字段中，选择 *TransfOut*。
1. 选择 **保存** 以启用 **指令代码** 字段。
1. 在 **工作类型** 和 *放置* 行上，依次选择 **指令代码** 和 *货架门*。 确保此新的工作模板获取最低的 **序列号**。
1. 在工具栏中，选择 **编辑查询** 以打开查询编辑器。
1. 在 **范围** 选项卡中，选择 **添加**。
1. 在添加的行上，在 **字段** 中选择 *仓库*。
1. 在 **条件** 字段中，选择 *51*。
1. 选择 **排序** 选项卡。
1. 选择 **添加**，并将 **字段** 设置为 *定位的牌照 ID*。 选择此字段将启用工具栏按钮 **工作标题分解**。
1. 依次选择 **确定** 和 **是** 以重置分组，然后返回到 **工作模板** 页面。
1. 选择 **工作标题分解** 并为 **定位的牌照 ID** 启用 **按此字段分组**，然后关闭。

> [!NOTE]
> 并非所有设置都可以自动处理，例如，实际称重物料和使用混合的跟踪维度。

### <a name="set-up-location-directives-for-the-license-plate-guided-strategy"></a>为牌照引导策略设置位置指令

此部分说明了如何设置位置指令领料过程以使用 **牌照引导** 策略。

1. 转到 **库存管理 \> 设置 \> 位置指令**。
1. 选择 **编辑**。
1. 在导航列表标题中，依次选择 **工作订单类型** 和 *转移发放*。
1. 在导航列表中，选择现有的位置指令 **51 领料**。
1. 在 **行** 快速选项卡中，选择 **允许拆分** 复选框。
1. 在 **位置指令操作** 快速选项卡中，选择 **新建** 以添加新操作行。
1. 在 **名称** 字段中，输入 *LP 引导*。
1. 在 **战略** 字段中，选择 *牌照引导*。 此操作需要最低的序列号。
1. 在工具栏中选择 **保存**。
1. 从工具栏中选择 **刷新** 页面图标。
1. 在 **位置指令操作** 快速选项卡中，选择行 *领料*。
1. 在 **位置指令操作** 工具栏中，选择 **下移** 以将序列号更改为大于刚创建的 *LP 引导* 操作的序列号。

> [!NOTE]
> 牌照引导策略将尝试在具有与转移单行关联的所请求牌照的位置上预留和创建领料工作。 但是，如果这不可行，并且您仍想创建领料工作，则应回退到另一种位置指令操作策略，可能还要根据业务流程的需要在仓库的另一个区域中搜索库存。

### <a name="set-up-a-batch-job-to-process-warehouse-app-events"></a>设置批处理作业以处理仓库应用事件

此部分说明了如何设置计划的批处理作业以处理仓库应用事件。

1. 转到 **仓库管理 \> 定期任务 \> 处理仓库应用事件**。
2. 在对话框中，启用 **在后台运行** 部分下的 **批处理**。
3. 选择 **定期** 并根据您的业务所需的时间间隔设置要处理的批处理作业。
4. 选择 **确定** 以返回到主对话框。
5. 在主对话框中选择 **确定** 以将作业添加到批处理队列。

### <a name="set-up-a-batch-job-to-release-transfer-orders-automatically"></a>设置批处理作业以自动发放转移单

此部分说明了如何设置计划的批处理作业以发放已标记为“准备发放”的转移单。

1. 转到 **仓库管理 \> 发放到仓库 \> 自动发放转移单**。
1. 在对话框中，展开 **要包括的记录** 部分。
1. 在 **要包括的记录** 部分下，选择 **筛选器**。
1. 在 **WHSTransferAutoRTWQuery** 查询页面中，在 **范围** 选项卡中，选择 **添加** 以向查询添加一个新行。
1. 在新行 **表** 字段中，选择下拉菜单并选择表 **转移行发放到仓库**。
1. 在 **字段** 下拉菜单中，选择 **出站装运策略**。
1. 在 **条件** 字段中，选择 **发放和装运确认**。
1. 在 **字段** 设置为 *从仓库* 的行中，在 **条件** 字段中，选择 *51*。
1. 选择 **确定** 以返回到主对话框。
1. 展开 **在后台运行** 部分以设置批处理。
1. 启用 **在后台运行** 部分下的 **批处理**。
1. 选择 **定期** 并根据您的业务所需的时间间隔设置要处理的批处理作业。
1. 选择 **确定** 以返回到主对话框。
1. 在主对话框中选择 **确定** 以将批处理作业添加到批处理队列。

### <a name="set-up-the-process-outbound-shipment-batch-job"></a>设置“处理出站装运”批处理作业

此部分说明了如何设置计划的批处理作业，以为与“准备装运”的转移单相关的准备装运的负载运行出站装运确认。

1. 转到 **仓库管理 \> 定期任务 \> 处理出站装运**。
1. 扩展 **要包括的记录** 部分。
1. 选择 **筛选器**。
1. 在 **WHSLoadShipConfirm** 查询中，选择 **联接** 选项卡。
1. 展开表层次结构，以便已展开 **负载** 和 **负载详细信息**。
1. 选择 **负载详细信息** 表。
1. 选择 **添加表联接** 按钮。
1. 在表关系的列表中，筛选或搜索 *转移单行（引用）* 的 **关系** 列。
1. 关注列表中的表关系，然后按 **选择** 按钮。
1. 选择 **转移单行** 表。
1. 选择 **添加表联接** 按钮。
1. 在表关系的列表中，筛选或搜索 *库存转移附加字段（记录 ID）* 的 **关系** 列。
1. 关注列表中的表关系，然后按 **选择** 按钮。
1. 选择 **范围** 选项卡。
1. 在 **范围** 查询表中，您将设置三个查询条件范围。 选择 **添加** 按钮添加一行。
1. 为表 **负载** 添加范围。 将 **字段** 设置为 *负载状态* 并将 **条件** 设置为 *已负载*。
1. 为表 **库存转移附加字段** 添加另一个范围。 将 **字段** 设置为 *出站装运策略* 并将 **条件** 设置为 *发放和装运确认*。
1. 为表 **负载详细信息** 添加另一个范围。 将 **字段** 设置为 *引用* 并将 **条件** 设置为 *转移单装运*。
1. 选择 **确定** 以返回到主对话框。
1. 展开 **后台运行** 部分。
1. 启用 **批处理**。
1. 选择 **定期** 并根据您的业务所需的时间间隔设置要处理的批处理作业。
1. 选择 **确定** 以返回到主对话框。
1. 在主对话框中选择 **确定** 以将批处理作业添加到批处理队列。

> [!NOTE]
> 有关详细信息，请参阅[从批处理作业确认出站装运](confirm-outbound-shipments-from-batch-jobs.md)。

## <a name="processing-the-example-for-create-transfer-order-from-the-warehouse-app"></a>处理“通过仓库应用创建转移单”的示例

### <a name="add-on-hand-on-a-license-plate"></a>在牌照上添加现有库存

在此方案中，首先您将需要具有包含实际可用的现有库存的牌照。

| 物料 | 存放地点 | 库存状态 | 库位 | 牌照 | 数量 |
| --- | --- | --- | --- | --- | --- |
| A0001 | 51 | 可用值 | LP-010 | LP10 | 1 |
| A0002 | 51 | 可用值 | LP-010 | LP10 | 2 |

使用以下值添加实际的现有库存数量：

> [!NOTE]
> 您将需要创建牌照并使用允许您具有混合物料的位置，例如 LP-010。

### <a name="create-and-process-transfer-orders-from-the-warehouse-app"></a>通过仓库应用创建和处理转移单

1. 打开应用并以用户 *51* 身份登录。 当前用户仓库将为 51。
1. 从您在设置过程中将其添加到的菜单位置选择菜单项 **创建到**。
1. 通过在 **仓库** 字段中输入目标仓库（至仓库）开始创建转移单，输入 *61*。 新的转移单将从当前仓库 51（从仓库）转到目标仓库 *61*。
1. 选择 **确定**。
1. 在 **牌照** 字段中扫描牌照 ID。 输入在上一步骤中添加的库存的牌照 *LP10*。
1. 选择 **确定**。
1. 选择菜单按钮，然后选择 **完成订单** 完成仓库应用转移单创建。

对于上述示例，使用两个 **仓库应用事件**（*创建转移单* 和 *完成转移单*）。

### <a name="inquire-the-warehouse-app-events"></a><a name="#inquire-the-warehouse-app-events"></a>查询仓库应用事件

您可以通过转到 **仓库管理 \> 查询和报表 \> 移动设备日志 \> 仓库应用事件** 查看仓库管理移动应用生成的事件队列和事件消息。

*创建转移单* 事件消息将收到状态 *等待*，这意味着 **处理仓库应用事件** 批处理作业将不会接收并处理事件消息。 一旦事件消息更新为状态 *已排队*，批处理作业将处理事件。 这将与创建 *完成转移单* 事件（当工作人员在仓库管理移动应用上选择 **完成订单** 按钮时）同时发生。 当 *创建转移单* 事件消息已处理时，状态将更新为 *已完成* 或 *失败*。 当 *完成转移单* 状态更新为 *已完成* 时，所有相关事件将从队列中删除。

因为在消息更新为状态 *已排队* 之前，批处理作业将不会处理创建转移单数据 **仓库应用事件**，因此您将需要查找请求的转移单号作为 **标识符** 字段的一部分。 **标识符** 字段位于 **仓库应用事件** 页面的顶部。

作为仓库事件处理的一部分，创建转移单行可能会失败。 在这种情况下，事件消息的状态将更新为 *失败*，您可以使用 **批处理日志** 信息了解原因并采取措施纠正任何问题。

典型的问题可能与缺少过程设置有关，例如缺少 *创建转移单* 事件的中转仓库。 在这样的示例中，您可以将中转仓库添加到装运仓库，并使用 **重置** 选项将所有仓库应用事件消息从 *失败* 更改为 *已排队*，这意味着批处理作业将在更正设置数据后再次处理事件消息。

在生产环境中，异常与过程的相关性更高，例如拥有请求的牌照，该牌照在批处理作业处理时为空，因此不会创建转移单行。 可以使用 **删除** 选项删除此失败的事件消息，或者您可以在牌照上添加所需的实际现有库存并针对所有相关的事件消息使用 **重置** 选项。

有关详细信息，请参阅[仓库应用事件处理](warehouse-app-events.md)。

### <a name="follow-up-on-the-example-scenario-processing"></a>跟进示例方案处理

在此方案中，将发生以下事件：

1. 您使用仓库管理移动应用选择了一个使用活动代码 **通过牌照创建转移单** 的菜单项。
1. 该应用提示您选择转移单的目标仓库。 源仓库始终是您当前以工作人员身份登录的仓库。
1. 在选择目标仓库时，系统将为即将生成的转移单预留一个 ID 号（基于在您的系统上定义的转移单号顺序），但尚未创建转移单。
1. 当您扫描包含应移至新仓库的现有库存的牌照 *LP10* 时，**仓库应用事件** 已添加到事件队列中，以便稍后处理。 仓库事件包含有关扫描的消息详细信息，包括预期的转移单号。
1. 在仓库管理移动应用上，当选择 **完成订单** 按钮时，将创建一个新的仓库应用事件 **完成转移单**，并将相关现有事件 **创建转移单** 的状态更改为 **已排队**。
1. 在后端，**处理仓库应用事件批处理作业** 接收 **已排队** 事件，并收集与扫描的牌照相关的现有库存。 根据现有库存创建实际转移单记录和关联的行。 在配置 *发放和装运确认* 并针对 **牌照引导** 战略的行链接牌照后，该作业还使用值填充了转移单的 **出站装运策略** 字段。
1. 根据转移单行 **出站装运策略** 字段值，**自动发放转移单批处理作业** 查询现在将转移单发放到装运仓库。 由于使用的 **波次模板**、**工作模板** 和 **位置指令** 设置，工作会自动处理，**负载状态** 会更新为 *已负载*。
1. 将针对负载执行 **处理出站装运批处理作业**，从而装运转移单并生成装运前通知 (ASN)。
1. 所有这些事件的发生时间取决于创建的批处理作业的 **定期** 设置。

## <a name="frequently-asked-questions"></a>常见问题

### <a name="mobile-device-menu-item-setup"></a>移动设备菜单项设置

#### <a name="why-cant-i-see-create-transfer-order-from-license-plate-in-the-menu-item-work-activity-drop-down-list"></a>为什么在菜单项工作活动下拉列表中看不到“通过牌照创建转移单”？

必须启用功能 *通过仓库应用创建和处理转移单*。 有关详细信息，请参阅[启用通过仓库应用创建转移单](#enable-create-transfer-order-from-warehouse-app)。

### <a name="warehouse-management-mobile-app-processes"></a>仓库管理移动应用流程

#### <a name="why-cant-i-see-the-menu-button-complete-order"></a>为什么看不到菜单按钮“完成订单”？

您必须为转移单分配至少一个牌照。

#### <a name="can-several-warehouse-management-mobile-app-users-add-license-plates-to-the-same-transfer-order-at-the-same-time"></a>多个仓库管理移动应用用户是否可以同时向同一转移单添加牌照？

是，多个仓库工作人员可以将牌照扫描到同一转移单中。

#### <a name="can-the-same-license-plate-be-added-to-different-transfer-orders"></a>同一牌照是否可以添加到不同的转移单？

否，一次只能向一个转移单添加一个牌照。

#### <a name="after-having-selected-the-complete-order-button-can-i-then-add-more-license-plates-for-that-transfer-order"></a>选择“完成订单”按钮后，是否可以为该转移单添加更多牌照？

否，您不能向具有 **完成转移单** 仓库应用事件的转移单添加更多牌照。

#### <a name="how-can-i-find-existing-transfer-orders-to-be-used-via-the-select-transfer-order-button-in-the-warehouse-management-mobile-app-if-the-order-has-not-yet-been-created-in-the-backend-system"></a>如果尚未在后端系统中创建订单，如何通过仓库管理移动应用中的“选择转移单”按钮找到要使用的现有转移单？

目前，您无法在应用中查找转移单，但可以在 **仓库应用事件** 页面上找到转移单号。 有关详细信息，请参阅[查询仓库应用事件](#inquire-the-warehouse-app-events)。

#### <a name="can-i-manually-select-the-transfer-order-number-to-be-used-from-the-warehouse-management-mobile-app"></a>我是否可以从仓库管理移动应用中手动选择要使用的转移单号？

仅支持通过编号规则自动生成的转移单号。

### <a name="background-processing"></a>后台处理

#### <a name="how-should-i-clean-up-records-in-my-warehouse-app-events-queue-message-tables"></a>我应该如何清理仓库应用事件队列消息表中的记录？

您可以在 **仓库应用事件** 页面上查看和维护记录。 有关详细信息，请参阅[查询仓库应用事件](#inquire-the-warehouse-app-events)。

#### <a name="why-is-the-transfer-order-receipt-date-not-updated-according-to-my-delivery-date-control-setup"></a>为什么未根据我的“交货日期控制”设置更新转移单“收货日期”？

转移单不是使用 **交货日期控制** 功能创建的。

#### <a name="can-i-use-a-license-plate-having-physical-negative-inventory-on-hand"></a>我是否可以使用实际的现有库存为负的牌照？

该功能在牌照级别仅支持数量为正的实际现有库存，但在将牌照分配给转移订单时，您可以在更高的仓库和库存状态级别拥有数量为负的实际现有库存。

[!INCLUDE[footer-include](../../includes/footer-banner.md)]