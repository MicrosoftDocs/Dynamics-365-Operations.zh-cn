---
title: 配置装运合并策略
description: 此主题说明如何设置默认装运合并策略和自定义装运合并策略。
author: GarmMSFT
manager: tfehr
ms.date: 05/12/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: WHSShipConsolidationPolicy, WHSShipConsolidationWorkbench
audience: Application User
ms.reviewer: kamaybac
ms.search.scope: Core, Operations
ms.search.region: Global
ms.author: kamaybac
ms.search.validFrom: 2020-05-01
ms.dyn365.ops.version: 10.0.3
ms.openlocfilehash: 4df62d7b2c8b0463ca6e9564e167f9060e811a24
ms.sourcegitcommit: 708ca25687a4e48271cdcd6d2d22d99fb94cf140
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/10/2020
ms.locfileid: "3975408"
---
# <a name="configure-shipment-consolidation-policies"></a>配置装运合并策略

[!include [banner](../includes/banner.md)]

在自动和手动发放到仓库期间，可通过使用装运合并策略的装运合并流程自动合并装运。 开启此功能后，必须配置初始策略。 如果不配置任何策略，每个销售行将生成有一个装载行的单独装运。

此主题中的方案显示如何设置默认装运合并策略和自定义装运合并策略。

## <a name="turn-on-the-shipment-consolidation-policies-feature"></a>开启装运合并策略功能

> [!IMPORTANT]
> 在此主题中介绍的[第一个方案](#scenario-1)中，首先设置仓库，使其使用之前的装运合并功能。 然后启用装运合并策略。 这样就可以体验升级方案如何工作。 如果计划使用演示数据环境完成第一个方案，请勿在使用进行此方案之前开启该功能。

*装运合并策略*功能必须先在系统中开启，才能使用。 管理员可以使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)设置检查功能状态和开启功能。 在**功能管理**工作区中，此功能按照下面的方式列出：

- **模块**：*仓库管理*
- **功能名称**：*合并装运*

## <a name="make-demo-data-available"></a>提供演示数据

此主题中的每个方案都引用为 Microsoft Dynamics 365 Supply Chain Management 提供的标准演示数据中包含的值和记录。 如果要在进行此练习时使用此处提供的值，请务必在安装了演示数据的环境中操作，并且在开始前将法人设置为 **USMF**。

## <a name="scenario-1-configure-default-shipment-consolidation-policies"></a><a name="scenario-1"></a>方案 1：配置默认装运合并策略

有两种情况必须在开启*装运合并策略*功能之后配置最小默认策略数量：

- 升级已包含数据的环境。
- 设置全新环境。

### <a name="upgrade-an-environment-where-warehouses-are-already-configured-for-cross-order-consolidation"></a>升级已经为跨订单合并配置了仓库的环境

开始此过程时，应该关闭*装运合并策略*功能，以模拟已使用了基本跨订单合并功能的环境。 然后使用功能管理开启此功能，从而可以了解如何在升级后设置装运合并策略。

请执行以下步骤在已经为跨订单合并配置了仓库的环境中设置默认装运合并策略。

1. 转到**仓库管理 \> 设置 \> 仓库 \> 仓库**。
1. 在列表中，找到并打开所需仓库记录（例如，**USMF** 演示数据中的仓库 *24*）。
1. 在操作窗格上，选择**编辑**。
1. 在**仓库**快速选项卡上，将**在发放到仓库时合并装运**选项设置为*是*。
1. 对需要进行合并的其他所有仓库重复步骤 2 到 4。
1. 关闭该页面。
1. 使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)开启*装运合并策略*功能。 在**功能管理**工作区中，此功能的名称为*合并装运*。
1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。 开启此功能之后，可能必须刷新浏览器才能查看新的**装运合并策略**菜单项。
1. 在操作窗格上，选择**创建默认设置**创建以下策略：

    - 适用于*销售订单*策略类型的 **CrossOrder** 策略（前提是您有至少一个仓库设置为使用前面的合并功能）
    - 适用于*销售订单*策略类型的**默认**策略
    - 适用于*转移问题*策略类型的**默认**策略
    - 适用于*转移问题*策略类型的 **CrossOrder** 策略（前提是您有至少一个仓库设置为使用前面的合并功能）

    > [!NOTE]
    > - 两种 **CrossOrder** 策略都将同一组字段视为之前的逻辑，但订单编号的字段除外。 （此字段用于根据仓库、交装运输方式和地址等元素将行合并为装运。）
    > - 两种**默认**策略都将同一组字段视为之前的逻辑，包括订单编号的字段。 （此字段用于根据订单编号、仓库、交货的运输方式和地址等元素将行合并为装运。）

1. 为*销售订单*策略类型选择 **CrossOrder**，然后在操作窗格上选择**编辑查询**。
1. 请注意，查询编辑器对话框中列出了其**在发放到仓库时合并装运**选项设置为*是*的仓库。 因此，查询中包含它们。

### <a name="create-default-policies-for-a-new-environment"></a>为新环境创建默认策略

请执行以下步骤在全新环境中设置默认装运合并策略。

1. 如果尚未开启*装运合并策略*功能，请使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)开启此功能。 在**功能管理**工作区中，此功能的名称为*合并装运*。
1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 在操作窗格上，选择**创建默认设置**创建以下策略：

    - 适用于*销售订单*策略类型的**默认**策略
    - 适用于*转移问题*策略类型的**默认**策略

    > [!NOTE]
    > 两种**默认**策略都将同一组字段视为之前的逻辑，包括订单编号的字段。 （此字段用于根据订单编号、仓库、交货的运输方式和地址等元素将行合并为装运。）

## <a name="scenario-2-configure-custom-shipment-consolidation-policies"></a>方案 2：配置自定义装运合并策略

此业务情景显示了如何设置自定义装运合并策略。 自定义策略可以支持装运合并取决于多个条件的复杂业务要求。 此方案中后面的每个示例策略中包含业务案例的简短说明。 应该按照可确保金字塔式评估查询的顺序设置这些示例策略。 （换句话说，应该将条件最多的策略作为优先级最高进行评估。）

### <a name="turn-on-the-feature-and-prepare-master-data-for-this-scenario"></a>为此方案开启此功能和准备主数据

必须先按照下面的小节中的说明开启此功能并准备执行筛选所需主数据，然后才能完成此方案中的练习。 （这些先决条件也适用于[有关如何使用装运合并策略的示例方案](#example-scenarios)中列出的方案。）

#### <a name="turn-on-the-feature-and-create-the-default-policies"></a>开启功能和创建默认策略

如果尚未开启此功能，请使用功能管理开启，然后创建[方案 1](#scenario-1) 中介绍的默认合并策略。

#### <a name="create-two-new-product-filter-codes"></a>创建两个新产品筛选器代码

1. 转到**仓库管理 \> 设置 \> 产品筛选器 \> 产品筛选器**，然后添加两个产品筛选器：

    - 产品筛选器 1：

        - **过滤器代码**：*易燃*
        - **过滤器标题**：*代码 4*

    - 产品筛选器 2：

        - **过滤器代码**：*易爆*
        - **过滤器标题**：*代码 4*

1. 转到**产品信息管理 \> 产品 \> 已发布产品**。
1. 打开物料编号为 *M9200* 的产品。 （必须为高级仓库 \[WMS\] 流程启用所选产品，而 **USMF** 演示数据中则已为 WMS 流程预先启用了此产品。）
1. 在**仓库**快速选项卡上，将**代码 4** 字段设置为*易燃*。
1. 关闭该页面。
1. 打开物料编号为 *M9201* 的产品。 （已在 **USMF** 演示数据中为 WMS 流程预先启用了此产品。）
1. 在**仓库**快速选项卡上，将**代码 4** 字段设置为*易爆*。
1. 关闭该页面。

#### <a name="create-a-new-transportation-mode-of-delivery"></a>创建新交装运输方式

1. 转到**运输管理 \> 设置 \> 承运人 \> 方式**。
1. 创建合并查询中将使用的运输方式，然后将其命名为*航空公司*。
1. 转到**运输管理 \> 设置 \> 承运人 \> 装运承运人**。
1. 创建具有以下设置的承运人：

    - **装运承运人**：*航空公司*
    - **名称**：*航空公司*
    - **模式**：*航空公司*

1. 在新承运人的**服务**快速选项卡上，添加一个具有以下设置的行：

    - **承运人服务**：*航运*
    - **运输方式**：*航运*

1. 在操作窗格上，选择**保存**。

    > [!NOTE]
    > 保存新承运人时，**服务**网格中新行的**交货方式**字段将自动设置为*航空公司-航运*。 为销售订单使用*航空公司-航运*交货方式时，将为相关装运使用*航空公司*运输方式。

#### <a name="create-an-order-pool"></a>创建订单池

1. 转到**销售和营销 \> 设置 \> 销售订单 \> 订单池**。
1. 创建将用于合并查询的订单池。 此订单池将具有以下设置：

    - **池：** 输入其他任何池尚未使用的整数。
    - **名称**：*ShipCons*

1. 转到**销售和市场营销 \> 客户 \> 所有客户**。
1. 打开客户编号为 *US-003* 的客户。
1. 在**销售订单默认值**快速选项卡上，将**销售订单池**字段设置为刚才创建的订单池。
1. 关闭页面，然后为帐户编号为 *US-004* 的客户重复步骤 4 和 5。

### <a name="create-example-policy-1"></a>创建示例策略 1

在此示例中，将创建可用于以下业务案例的*客户 + 方式*策略。

- 此策略将查询特定客户帐户 (*US-001*) 和特定交货方式（*航空公司-航运*）。
- 已关闭与未结装运合并。
- 合并按订单 ID 进行。 （换句话说，每个订单、仓库等都将有单独的装运。）

执行以下步骤为此业务案例创建装运合并策略。

1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 将**策略类型**字段设置为*销售订单*。
1. 在操作窗格上，选择**新建**创建具有以下设置的策略：

    - **策略名称**：*CustomerMode*
    - **策略说明**：*客户帐户和交货方式*

1. 让**与未结装运合并**选项继续设置为*否*。
1. 在操作窗格上，选择**保存**。
1. 在**合并字段**快速选项卡上**其余字段**列表中，选择其中的**字段名称**字段设置为*交货方式*的行。
1. 选择**添加**按钮 ![向右箭头](media/forward-button.png) 将字段移到**所选字段**列表中。
1. 在操作窗格上，选择**编辑查询**。
1. 在查询编辑器对话框中**范围**选项卡上网格内，找到其中的**字段**字段设置为*客户帐户*的行，然后将该行的**条件**字段设置为 *US-001*。
1. 选择**添加**向网格添加具有以下设置的行：

    - **表**：*订单行*
    - **派生表**：*订单行*
    - **字段**：*交货方式*
    - **条件**：*航空公司-航运*

1. 选择**确定**关闭对话框。

> [!NOTE]
> 对于此业务案例，将不合并多个订单的使用*航空公司-航运*交货方式的客户 *US-001* 的订单行。 如果为此客户合并其他所有交货方式的装运，应该首先在序列中使用此策略。

### <a name="create-example-policy-2"></a>创建示例策略 2

在此示例中，将创建可用于以下业务案例的*危险货物*策略。

- 此策略将查询特定筛选器代码（*危险*）和特定交货方式（*航空公司-航运*）。
- 已开启与未结装运合并。
- 将跨订单进行合并。 （换句话说，每个帐户、仓库等有单独的装运，但是只在查询中指定的物料组内。）

执行以下步骤为此业务案例创建装运合并策略。

1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 将**策略类型**字段设置为*销售订单*。
1. 在操作窗格上，选择**新建**创建具有以下设置的策略：

    - **策略名称**：*物料类型*
    - **策略说明**：*跨订单合并类型相同的物料*

1. 将**与未结装运合并**选项设置为*是*。
1. 在操作窗格上，选择**保存**。
1. 在**合并字段**快速选项卡上**其余字段**列表中，选择其中的**字段名称**字段设置为*交货方式*的行。
1. 选择**添加**按钮 ![向右箭头](media/forward-button.png) 将字段移到**所选字段**列表中。
1. 在操作窗格上，选择**编辑查询**。
1. 在查询编辑器对话框中**联接**选项卡上，展开并选择树中的**表 \> 负荷详细信息**。
1. 选择**添加表联接**。
1. 在显示的关系网格中，找到并选择其中的**关系**字段设置为*仓库物料包含（物料编号）* 的行，然后选择**选择**。 
1. 在**范围**选项卡上，选择**添加**向网格添加具有以下设置的行：

    - **表**：*仓库物料编号*
    - **派生表**：*仓库物料编号*
    - **字段**：*代码 4*
    - **条件**：*易燃*

1. 选择**确定**关闭对话框。

> [!NOTE]
> 对于此业务案例，其中的物料具有特定筛选器代码（即其中的**代码 4** 字段设置为*易燃*的筛选器代码）的所有订单行将跨订单与同一种类型的其他物料合并。 如果同一个帐户、仓库和物料组有未结装运，将为其附加新行。

### <a name="create-example-policy-3"></a>创建示例策略 3

在此示例中，将创建可用于以下业务案例的*客户要求*策略。

- 此策略将查询特定客户帐户。
- 已开启与未结装运合并。
- 将跨订单但基于客户申请进行合并。 （换句话说，将根据相同客户申请编号和仓库把多个订单组合为装运。）

执行以下步骤为此业务案例创建装运合并策略。

1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 将**策略类型**字段设置为*销售订单*。
1. 在操作窗格上，选择**新建**创建具有以下设置的策略：

    - **策略名称**：*CustomerOrderNo*
    - **策略说明**：*根据客户 PO 合并行*

1. 将**与未结装运合并**选项设置为*是*。
1. 在操作窗格上，选择**保存**。
1. 在**合并字段**快速选项卡上**其余字段**列表中，选择其中的**字段名称**字段设置为*客户申请*的行。
1. 选择**添加**按钮 ![向右箭头](media/forward-button.png) 将字段移到**所选字段**列表中。
1. 在**其余字段**列表中，选择其中的**字段名称**字段设置为*交货方式*的行。
1. 选择**添加**按钮 ![向右箭头](media/forward-button.png) 将字段移到**所选字段**列表中。
1. 在操作窗格上，选择**编辑查询**。
1. 在查询编辑器对话框中**范围**选项卡上，找到其中的**字段**字段设置为*客户帐户*的行，然后将该行的**条件**字段设置为 *US-001*。
1. 选择**确定**关闭对话框。

> [!NOTE]
> 对于此业务案例，无论销售订单编号是什么，都将把其中的销售订单的客户申请编号相同的所有订单行合并为一个装运。 （客户申请编号用作客户的采购订单 \[PO\] 编号。）如果同一个帐户、仓库和客户申请有未结装运，将为其附加新行。 如果一天内客户多次添加具有相同 PO 编号的更多订单行，并且希望将所有行合并为一个装运，可使用此策略。 （换句话说，将有一份提货单和一份装箱单。）

### <a name="create-example-policy-4"></a>创建示例策略 4

在此示例中，将创建可用于以下业务案例的*客户允许合并*策略。

- 此策略将查询特定订单池以识别接受合并的装运的客户。
- 已关闭与未结装运合并。
- 将使用默认 CrossOrder 策略选择的字段跨订单进行合并（以复制之前的**在发放到仓库时合并装运**复选框）。

- 可以通过选择其他订单池覆盖销售订单中的规则。

执行以下步骤为此业务案例创建装运合并策略。

1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 将**策略类型**字段设置为*销售订单*。
1. 在操作窗格上，选择**新建**创建具有以下设置的策略：

    - **策略名称**：*订单池*
    - **策略说明**：*根据订单池跨订单合并*

1. 让**与未结装运合并**选项继续设置为*否*。
1. 在操作窗格上，选择**保存**。
1. 在**合并字段**快速选项卡上**其余字段**列表中，选择其中的**字段名称**字段设置为*交货方式*的行。
1. 选择**添加**按钮 ![向右箭头](media/forward-button.png) 将字段移到**所选字段**列表中。
1. 在操作窗格上，选择**编辑查询**。
1. 在查询编辑器对话框中**范围**选项卡上，选择**添加**向网格添加具有以下设置的行：

    - **表**：*销售订单*
    - **派生表**：*销售订单*
    - **字段**：*池*
    - **条件**：*ShipCons*

1. 选择**确定**关闭对话框。

> [!NOTE]
> 对于此业务案例，其中的销售订单属于同一个订单池的所有订单行将跨同一个帐户、仓库和交装运输方式的销售订单合并为一个装运。 可以使用其他任何字段而不是订单池区分一组客户，并默认使用销售订单标题。 如果客户而不是仓库推动了对合并的需要，可使用这种方法。 （在之前的合并策略中，推动合并需要的是仓库。）

### <a name="create-example-policy-5"></a>创建示例策略 5

在此示例中，将创建可用于以下业务案例的*仓库允许合并*策略。

- 此策略将查询特定订单池以识别可合并装运的仓库。
- 已关闭与未结装运合并。
- 将使用默认 CrossOrder 策略选择的字段跨订单进行合并（以复制之前的**在发放到仓库时合并装运**复选框）。

通常可使用在[方案 1](#scenario-1) 中创建的默认策略解决此业务案例。 但是，也可以执行以下步骤手动创建类似策略。

1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 将**策略类型**字段设置为*销售订单*。
1. 在操作窗格上，选择**新建**创建具有以下设置的策略：

    - **策略名称**：*Cross-order*
    - **策略说明**：*跨订单合并特定仓库*

1. 让**与未结装运合并**选项继续设置为*否*。
1. 在操作窗格上，选择**保存**。
1. 在**合并字段**快速选项卡上**其余字段**字段中，选择其中的**字段名称**字段设置为*交货方式*的行。
1. 选择**添加**按钮 ![向右箭头](media/forward-button.png) 将字段移到**所选字段**列表中。
1. 在操作窗格上，选择**编辑查询**。
1. 在查询编辑器对话框中**范围**选项卡上，找到其中的**字段**字段设置为*仓库*的行，然后将该行的**条件**字段设置为 *61, 63*。
1. 选择**确定**关闭对话框。

### <a name="set-the-order"></a>设置顺序

鉴于已经创建了所有策略，现在必须建立这些策略将采用的顺序。 若要使用金字塔式方法（其中条件最多的策略评估为优先级最高），请执行以下步骤。

1. 转到**仓库管理 \> 设置 \> 发放到仓库 \> 装运合并策略**。
1. 将**策略类型**字段设置为*销售订单*。
1. 选择左列中列出的每个策略，然后使用操作窗格中的**上移**和**下移**按钮按照以下顺序排列策略：

    1. CustomerMode
    1. 物料类型
    1. CustomerOrderNo
    1. 订单池
    1. Cross-order
    1. 默认值

## <a name="example-scenarios-of-how-to-use-shipment-consolidation-policies"></a><a name="example-scenarios"></a> 有关如何使用装运合并策略的示例方案

以下方案说明如何在阅读本主题的同时使用创建的装运合并策略。 每个方案将引导您完成装运合并流程，此流程在自动或手动发放到仓库期间使用装运合并策略：

- 方案 1：[使用自动发放销售订单发放到仓库时使用合并](../warehousing/consolidate-shipments-automatic.md)
- 方案 2：[覆盖了装运合并策略时从“发放到仓库”页合并装运](../warehousing/consolidate-shipments-release-to-warehouse-override.md)
- 方案 3：[使用装载计划工作台中的“发放到仓库”合并装运](../warehousing/consolidate-shipments-load-planning-workbench.md)
- 方案 4：[使用装运合并工作台合并装运](../warehousing/consolidate-shipments-manual-workbench.md)
- 方案 5：[使用合并装运页面手动合并装运](../warehousing/consolidate-shipments-manual-form.md)


## <a name="additional-resources"></a>其他资源

- [装运合并政策](about-shipment-consolidation-policies.md)
