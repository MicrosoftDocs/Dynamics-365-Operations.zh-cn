---
title: 灵活的仓库级维度预留策略
description: 本主题介绍一种库存预留策略，其允许销售批量跟踪产品并且以启用 WMS 的操作运行物流的企业为客户销售订单预留特定批次，即使与产品相关联的预留层次结构不允许预留特定批次。
author: perlynne
manager: tfehr
ms.date: 07/31/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: WHSReservationHierarchy
audience: Application User
ms.reviewer: kamaybac
ms.search.scope: Core, Operations
ms.search.region: Global
ms.author: perlynne
ms.search.validFrom: 2020-01-15
ms.dyn365.ops.version: 10.0.13
ms.openlocfilehash: 65304216b579b8def493d1e4218174cb9617013d
ms.sourcegitcommit: 27233e0fda61dac541c5210ca8d94ab4ba74966f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/03/2020
ms.locfileid: "3652171"
---
# <a name="flexible-warehouse-level-dimension-reservation-policy"></a>灵活的仓库级维度预留策略

[!include [banner](../includes/banner.md)]

当产品与“Batch-below\[location\]”类型的库存预留层次结构关联时，销售批次跟踪产品并以启用 Microsoft Dynamics 365 仓库管理系统 (WMS) 的操作运行物流的企业，不能为客户销售订单保留这些产品的特定批次。

以类似的方式，当销售订单上的产品与默认预留层次结构关联时，不能为这些产品预留特定牌照。

本主题介绍一种库存预留策略，能够让这些企业预留特定批次或牌照，即使产品与“Batch-below\[location\]”预留层次结构关联。

## <a name="inventory-reservation-hierarchy"></a>库存预留层次结构

本节总结了现有的库存预留层次结构。

库存预留层次结构指示，就存储维度而言，需求订单包含站点、仓库和库存状态的必需维度，而仓库逻辑负责为请求的数量分配货位并预留货位。 换句话说，在需求订单和仓库操作之间的交互中，需求订单应指示必须从何处装运（即哪个站点和仓库）。 然后，仓库依靠其逻辑在仓库货位查找所需的数量。

但是，为了反映业务的运营模型，跟踪维度（批号和序列号）需要具有更大的灵活性。 库存预留层次结构可以应对适用以下条件的场景：

- 企业依靠其仓库操作来管理在仓储存储空间中找到具有批号或序列号的数量后，领取这些数量。 此模型通常称为 *Batch-below\[location\]*。 它通常在产品的批号或序列号标识对向销售公司提出需求的客户不重要时使用。
- 如果批号或序列号是客户订单说明的一部分，并且记录在需求订单中，则在仓库中查找数量的仓库操作将受特定的请求的编号约束，不允许对其进行更改。 此模型称为 *Batch-above\[location\]*。

在这些场景中，挑战在于，只能为每个已发布的产品分配一个库存预留层次结构。 因此，为使 WMS 处理跟踪物料，在层次结构分配确定应预留批号或序列号的时间之后（在接到需求订单时或在仓库领料工作期间），此时间不能作为特例更改。

## <a name="flexible-reservation-for-batch-tracked-items"></a>灵活地预留批次跟踪物料

### <a name="business-scenario"></a>业务方案

在此场景中，公司使用按批号跟踪成品的库存策略。 该公司还使用 WMS 工作负载。 因为此工作负载具有用于计划和运行已启用批次的物料的仓库领料和装运操作的设备完善的逻辑，所以大多数成品物料都与“Batch-below\[location\]”库存预留层次结构相关联。 这种类型的运营设置的优点在于，关于领取哪些批次以及将其放入仓库中哪个位置的决定（即有效的预留决定）被推迟到仓库领料操作开始时。 而不会在客户下订单时作出。

虽然“Batch-below\[location\]”预留层次结构很好地满足了公司的业务目标，但公司的许多老客户在重新订购产品时需要的都是以前购买的相同批次。 因此，该公司正在寻求一种灵活的方式来处理批次预留规则，以便能够根据客户对同一物料的需求，执行以下行为：

- 当销售管理员接收订单时，可以记录并保留批号，并且批号在仓库操作期间不能更改和/或被其他需求获取。 此行为有助于确保将订购的批号运送到客户。
- 如果批号对客户不重要，则在完成销售订单登记和预留后，仓库操作可以在领料工作期间确定批号。

### <a name="allowing-reservation-of-a-specific-batch-on-the-sales-order"></a>允许在销售订单上保留特定批次

为了适应与“Batch-below\[location\]”库存预留层次结构相关联的物料的批次预留行为的灵活性，库存管理员必须在**库存预留层次结构**页上为**批号**级别选择**允许在需求订单上预留**复选框。

![使库存预留层次结构更灵活](media/Flexible-inventory-reservation-hierarchy.png)

当在层次结构中选择了**批号**级别时，从该级别开始直至**货位**级别的所有维度都将被自动选择。 （默认情况下，会预先选择**货位**级别以上的所有维度。）此行为反映了这样的逻辑：在订单行上预留特定批号后，批号和货位之间的范围内的所有维度也会自动预留。

> [!NOTE]
> **允许在需求订单上预留**复选框仅适用于仓库货位维度以下的预留层次结构级别。
>
> **批号**和**牌照**是层次结构中唯一为灵活预留策略开放的级别。 换言之，您无法为**位置**或**序列号**级别选择**允许在需求订单上预留**复选框。
>
> 如果您的预留层次结构包含序列号维度（必须始终在**批号**级别以下），并且您已为批号打开了特定于批次的预留，系统将根据应用于“Serial-below\[location\]”预留策略的规则，继续处理序列号预留和领料操作。

任何时候，您都可以允许为部署中现有的“Batch-below\[location\]”预留层次结构进行批次特定预留。 此更改不会影响更改发生之前创建的任何预留和开放仓库工作。 但是，如果与该预留层次结构关联的一个或多个物料存在问题类型为**订购预留**、**实际预留**或**已订购**的库存交易记录，则不能清除**允许在需求订单上预留**复选框。

> [!NOTE]
> 如果物料的现有预留层次结构不允许订单上有批次说明，您可以将其重新分配到允许批次说明的预留层次结构，前提是两个层次结构的层次结构级别结构均相同。 使用**更改物料的预留层次结构**功能来进行重新分配。 当您要阻止为批次跟踪物料的其中一部分进行灵活的批次预留，但允许对其余的产品组合执行时，此更改可能很有用。

无论您是否选择了**允许在需求订单上预留**复选框，如果您不想为订单行上的物料预留特定的批号，仍会应用对“Batch-below\[location\]”预留层次结构有效的默认仓库操作逻辑。

### <a name="reserve-a-specific-batch-number-for-a-customer-order"></a>为客户订单预留特定批号

在批次跟踪物料的“Batch-below\[location\]”库存预留层次结构设置为允许在销售订单上预留特定批号后，销售订单管理员可以根据客户的请求，通过以下其中一种方式获取同一物料的客户订单：

- **输入订单详细信息但不指定批号** – 当产品的批次说明对客户不重要时，应使用此方法。 与处理系统中这种类型的订单相关联的所有现有流程均保持不变。 不需要对这部分用户作任何其他考虑。
- **输入订单详细信息并保留特定批号** – 当客户请求特定批次时，应使用此方法。 通常，客户在重新订购之前购买的产品时会请求特定批次。 这种类型的批次特定预留称为*订单承诺预留*。

当数量被处理并将批号提交到特定订单时，以下这组规则有效：

- 为了允许根据“Batch-below\[location\]”预留策略为物料预留特定批号，系统必须预留整个货位的所有维度。 这个范围通常包括牌照维度。
- 在为使用订单承诺批次预留的销售订单行创建领料工作时，不使用货位指令。
- 在订单承诺批次的仓库处理工作期间，用户和系统都不允许更改批号。 （此处理包括异常处理。）

以下示例显示了端到端流。

## <a name="example-scenario-batch-number-allocation"></a>示例方案：批号分配

必须为此示例安装演示数据，并且必须使用 **USMF** 演示数据公司。

### <a name="set-up-an-inventory-reservation-hierarchy-to-allow-batch-specific-reservation"></a><a name="Example-batch-allocation"></a>设置库存预留层次结构以允许批次特定预留

1. 转到**仓库管理** \> **设置** \> **库存 \> 预留层次结构**。
2. 选择**新建**。
3. 在**名称**字段中，输入名称（例如，**BatchFlex**）。
4. 在**描述**字段中，输入描述（例如，**批次以下灵活预留**）。
5. 在**已选**字段中，选择**序列号**和**所有者**，然后选择左箭头按钮将其移至**可用**字段。
6. 选择**确定**。
7. 在**批号**维度级别行中，选择**允许在需求订单上预留**复选框。 **牌照**和**货位**级别将自动选择，您不能清除它们的复选框。
8. 选择**保存**。

### <a name="create-a-new-released-product"></a>创建新的已发布产品

1. 使用以下值设置产品的三个主数据参数：

    - 在**存储维度组**字段中，选择 **Ware**。
    - 在**跟踪维度组**字段中，选择 **Batch-Phy**。
    - 在**预留层次结构**字段中，选择 **BatchFlex**。

2. 创建两个批号，例如 **B11** 和 **B22**。
3. 使用以下值将物料数量添加到现有库存中。

    | 存放地点 | 批号 | 货位 | 牌照 | 数量 |
    |-----------|--------------|----------|---------------|----------|
    | 24        | B11          | BULK-001 | 否          | 10       |
    | 24        | B11          | FL-001   | LP11          | 10       |
    | 24        | B22          | FL-002   | LP22          | 10       |

### <a name="enter-sales-order-details"></a><a name="sales-order-details"></a>输入销售订单详细信息

1. 转到**销售和营销** \> **销售订单** \> **所有销售订单**。
2. 选择**新建**。
3. 在销售订单抬头上，在**客户帐户**字段中，输入 **US-003**。
4. 为新物料添加一行，然后输入 **10** 作为数量。 请确保**仓库**字段设置为 **24**。
5. 在**销售订单行**快速选项卡上，选择**库存**，然后在**维护**组中，选择**批次预留**。 **批次预留**页面将显示可为订单行预留的批次的列表。 在此示例中，此页面显示批号 **B11** 的数量为 **20**，批号 **B22** 的数量为 **10**。 请注意，如果某行的物料与“Batch-below\[location\]”预留层次结构关联，则无法从该行访问**批次预留**页面，除非已将其设置为允许批次特定预留。

    > [!NOTE]
    > 要为销售订单预留特定批次，您必须使用**批次预留**页。
    >
    > 如果您直接在销售订单行上输入批号，系统行为将与您为遵守“Batch-below\[location\]”预留策略的物料输入特定批次值时一样。 保存行时，您将收到一条警告消息。 如果您确认应直接在订单行上指定批号，该行将不会由常规仓库管理逻辑处理。
    >
    > 如果您从**预留**页预留数量，将不预留特定批次，并且该行的仓库操作的执行将遵循按照“Batch-below\[location\]”预留策略适用的规则。

    通常，此页面的工作和交互方式与用于具有“Batch-above\[location\]”类型的关联预留层次结构的物料时相同。 但是，以下例外适用：

    - **提交到源行的批号**快速选项卡显示为订单行预留的批号。 网格中的批次值将在订单行的整个履行周期内显示，包括仓库处理阶段。 相比之下，在**概览**快速选项卡上，常规的订单行预留（即针对**货位**级别以上的维度进行的预留）显示在网格中，直到仓库工作创建为止。 然后，工作实体接管行预留，行预留不再出现在页面上。 **提交到源行的批号**快速选项卡帮助确保销售订单管理员可以查看，在客户订单生命周期的任何时间直到开票提交到该订单的批号。
    - 除了预留特定批次外，用户还可以手动选择批次的特定货位和牌照，而不是让系统自动选择。 此功能与订单承诺批次预留机制的设计有关。 如前所述，当根据“Batch-below\[location\]”预留策略为物料预留批号时，系统必须预留整个货位的所有维度。 因此，仓库工作将包含与处理订单的用户预留的相同的存储维度，可能并不总是代表着对领料操作方便甚至可能的物料存储位置。 如果订单管理员知道仓库约束，他们可能希望在预留批次时手动选择特定货位和牌照。 在这种情况下，用户必须使用页标题上的**显示维度**功能，并且必须在**概览**快速选项卡上的网格中添加货位和牌照。

6. 在**批次预留**页面上，选择 **B11** 这一行，然后选择**预留行**。 在自动预留期间，没有用于分配货位和牌照的指定逻辑。 您可以在**预留**字段中手动输入数量。 请注意，在**提交到源行的批号**快速选项卡上，批次 **B11** 将显示为**已提交**。

    ![在“批次预留”页面上向销售订单行提交特定批号](media/Batch-reservation-form-with-order-committed-reservation.png)

    > [!NOTE]
    > 可以跨多个批次在销售订单行上预留数量。 同样，可以针对多个货位和牌照进行同一批次的预留（如果已为货位启用了牌照）。
    >
    > 在销售订单行上为数量预留特定批次也可以部分进行。 例如，可以预留 100 个单位的总数量，以向 20 个单位提交特定批次，而在站点和仓库级别为任何可用批次预留 80 个单位。 在这种情况下，WMS 将使用两个单独的工作行来处理领料操作。

7. 转到**产品信息管理** \> **产品** \> **已发布产品**。 选择您的物料，然后选择**管理库存** \> **查看**\>**交易记录**。

    ![将订单承诺预留作为库存交易记录类型](media/Inventory-transactions-for-order-committed-reservation.png)

8. 查看与销售订单行预留相关的物料库存交易记录。

    - **参考**字段设置为**销售订单**且**发货**字段设置为**实际预留**的交易记录，表示**货位**级别以上的库存维度的订单行预留。 根据物料的库存预留层次结构，这些维度是站点、仓库和库存状态。
    - **参考**字段设置为**订单承诺预留**且**发货**字段设置为**实际预留**的交易记录，表示特定批次以及其以上所有库存维度的订单行预留。 根据物料的库存预留层次结构，这些维度是批号和货位。 在此示例中，货位是 **Bulk-001**。

9. 在销售订单抬头上，选择**仓库** \> **操作** \> **发放到仓库**。 订单行现在已分波次，负荷和工作已创建。

### <a name="review-and-process-warehouse-work-that-has-order-committed-batch-numbers"></a>审查和处理具有订单承诺批号的仓库工作

1. 在**销售订单行**快速选项卡上，选择**仓库** \> **工作详细信息**。

    处理提交给销售订单行的批次数量的领料操作的工作具有以下特征：

    - 为了创建工作，系统使用工作模板，而不是货位指令。 为工作模板定义的所有标准设置（例如，最大领料行数或特定度量单位）将应用来确定何时应创建新工作。 但是，不考虑与用于识别领料货位的货位指令相关联的规则，因为订单承诺预留已经指定了所有库存维度。 这些库存维度包括仓库存储级别的维度。 因此，作品将继承这些维度，而不必参考货位指令。
    - 批号不显示在领料行上（对于为具有关联的“Batch-above\[location\]”预留层次结构的物料创建的工作行就是这种情况。）而“源”批号和所有其他存储维度将显示在工作行的工作库存交易记录中，该交易记录是从关联的库存交易记录引用的。

        ![源自订单承诺预留的工作的仓库库存交易记录](media/Work-inventory-transactions-for-order-committed-reservation.png)

    - 创建工作后，**参考**字段设置为**订单承诺预留**的物料的库存交易记录将删除。 **参考**字段设置为**工作**的库存交易记录现在在所有数量的库存维度中保留实际预留。

        仓库操作可以以通常的方式继续处理工作的执行。 但是，移动设备上的指令将指示工作人员领取特定的批号。 在货位由牌照控制的仓库环境中，当工作人员到达将同一批次存储在多个牌照中的货位后，他或她可以从尚未预留的任何牌照领料（例如，通过另一个订单承诺预留或源自该类型预留的工作。）

        如果发现从工作行上指定的货位领料不切实际，仓库操作员可以使用以下操作之一重定向来从更方便的货位领取特定批次：

        - 移动设备上的标准**覆盖货位**操作（前提是仓库工作人员的**允许领料货位覆盖**设置已启用）
        - **工作列表详细信息**页的**更改货位**操作。 

2. 在移动设备上，完成领料并放入工作。

    批号 **B11** 的数量 **10** 现在已为销售订单行领取，并放入 **Baydoor** 货位。 此时，可以将其装载到卡车上并发往客户地址了。

## <a name="flexible-license-plate-reservation"></a>灵活牌照预留

### <a name="business-scenario"></a>业务方案

在此方案中，某公司使用仓库管理和工作处理，在创建工作之前在 Supply Chain Management 外部的单个托盘/容器级别处理装载计划。 这些容器由库存维度中的牌照表示。 因此，对于这种方法，必须在完成领料工作之前将特定牌照预先分配给销售订单行。 该公司正在寻求一种灵活的方式来处理牌照预留规则，以执行以下行为：

- 当销售管理员接收订单时，可以记录并预留牌照，并且牌照不能被其他需求获取。 此行为有助于确保将计划的牌照运送到客户。
- 如果尚未将牌照分配给销售订单行，仓库人员可以在销售订单登记和预留完成后在领料工作中选择牌照。

### <a name="turn-on-flexible-license-plate-reservation"></a>开启“灵活牌照预留”

必须在系统中开启两项功能，才能够使用灵活牌照预留。 管理员可以使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)设置检查这些功能的状态，并在需要这些功能时将其开启。 您必须按以下顺序开启功能：

1. **功能名称**：*灵活的仓库级维度预留*
1. **功能名称**：*灵活的订单承诺牌照预留*

### <a name="reserve-a-specific-license-plate-on-the-sales-order"></a>在销售订单上预留特定牌照

要在订单上启用牌照预留，您必须在与相关物料关联的层次结构的**库存预留层次结构**页，选中**牌照**级别的**允许在需求订单上预留**复选框。

![灵活牌照预留层次结构的“库存预留层次结构”页面](media/Flexible-LP-reservation-hierarchy.png)

您可以在部署中的任何时候在订单上启用牌照预留。 此更改不会影响更改发生之前创建的任何预留或开放仓库工作。 但是，如果与该预订层次结构关联的一个或多个物料存在状态为*在单*、*订购预留*或*实际预留*的未结出站库存交易记录，则无法清除**允许在需求订单上预留**复选框。

即使为**牌照**级别选中了**允许在需求订单上预留**复选框，仍然可以*不*在订单上预留特定牌照。 在这种情况下，应用对预留层次结构有效的默认仓库操作逻辑。

要预留特定牌照，必须使用 [Open Data Protocol (OData)](../../fin-ops-core/dev-itpro/data-entities/odata.md) 流程。在应用程序中，您可以使用**在 Excel 中打开**命令中的**每个牌照的订单承诺预留**选项直接从销售订单进行此预留。 在 Excel 加载项中打开的实体数据中，您必须输入以下与预留相关的数据，然后选择**发布**将数据发送回 Supply Chain Management：

- 引用（仅支持*销售订单*值。）
- 订单编号（此值可以从批次派生。）
- 批次 ID
- 牌照
- 数量

如果必须为批量跟踪物料预留特定牌照，请使用**批次预留**页面，如[输入销售订单详细信息](#sales-order-details)一节所述。

当使用订单承诺牌照预留的销售订单行由仓库操作处理时，将不使用位置指令。

如果仓库工作项由等同于一个完整托盘的行组成，并且具有牌照承诺数量，您可以使用移动设备菜单项（**按牌照处理**选项设置为*是*）来优化领料流程。 然后，仓库工作人员可以扫描牌照来完成领料，而不必在工作中逐个扫描物料。

![“按牌照处理”选项设置为“是”的移动设备菜单项](media/Handle-by-LP-menu-item.png)

由于**按牌照处理**功能不支持包含多个托盘的工作，因此最好为不同的牌照使用单独的工作项。 要使用此方法，请在**工作模板**页面上添加**订单承诺牌照 ID** 字段作为工作标题分行符。

## <a name="example-scenario-set-up-and-process-an-order-committed-license-plate-reservation"></a>示例方案：设置和处理订单承诺牌照预留

此方案演示如何设置和处理订单承诺牌照预留。

### <a name="make-demo-data-available"></a>提供演示数据

此方案引用为 Supply Chain Management 提供的标准演示数据中包含的值和记录。 如果要使用此处提供的值来演练此方案，请确保在安装了演示数据的环境中工作。 此外，在开始前，将法人设置为 **USMF**。

### <a name="create-an-inventory-reservation-hierarchy-that-allows-for-license-plate-reservation"></a>创建允许牌照预留的库存预留层次结构

1. 转到**仓库管理 \> 设置 \> 库存 \> 预留层次结构**。
1. 选择**新建**。
1. 在**名称**字段中，输入值（例如，*FlexibleLP*）。
1. 在**描述**字段中，输入值（例如，*灵活牌照预留*）。
1. 在**选定**列表中，选择**批号**、**序列号**和**所有者**。
1. 选择**删除**按钮 ![向后箭头](media/backward-button.png) 将选定记录移到**可用**列表中。
1. 选择**确定**。
1. 在**牌照**维度级别行中，选择**允许在需求订单上预留**复选框。 **位置**级别将自动选择，您不能清除它的复选框。
1. 选择**保存**。

### <a name="create-two-released-products"></a>创建两个已发布产品

1. 转到**产品信息管理 \> 产品 \> 已发布产品**。
1. 在操作窗格上，选择**新建**。
1. 在**新建已发布产品**对话框中，设置以下值：

    - **产品编号**：*Item1*
    - **物料编号**：*Item1*
    - **物料模型组**：*先进先出*
    - **物料组**：*音频*
    - **存储维度组**：*仓库*
    - **跟踪维度组**：*无*
    - **预留层次结构**：*FlexibleLP*

1. 选择**确定**创建产品，然后关闭对话框。
1. 新产品将打开。 在**仓库**快速选项卡上，将**单位序列组 ID** 字段设置为 *ea*。
1. 重复上述步骤，创建具有相同设置的第二个产品，但是将**产品编号**和**物料编号**字段设置为 *Item2*。
1. 在操作窗格上的**管理库存**选项卡上，在**视图**组中，选择**现有库存量**。 然后选择**数量调整**。
1. 调整下表中指定的新物料的现有库存量。

    | 物料  | 存放地点 | 库位 | 牌照 | 数量 |
    |-------|-----------|----------|---------------|----------|
    | Item1 | 24        | FL-010   | LP01          | 10       |
    | Item1 | 24        | FL-011   | LP02          | 10       |
    | Item2 | 24        | FL-010   | LP01          | 5        |
    | Item2 | 24        | FL-011   | LP02          | 5        |

    > [!NOTE]
    > 您必须创建两个牌照并使用允许混合物料的位置，如 *FL-010* 和 *FL-011*。

### <a name="create-a-sales-order-and-reserve-a-specific-license-plate"></a>创建销售订单并预留特定牌照

1. 转到**销售和营销 \> 销售订单 \> 所有销售订单**。
1. 选择**新建**。
1. 在**创建销售订单**对话框中，设置以下值：

    - **客户帐户**：*US-001*
    - **仓库**：*24*

1. 选择**确定**关闭**创建销售订单**对话框并打开新销售订单。
1. 在**销售订单行**快速选项卡上，添加具有以下设置的行：

    - **物料编号**：*Item1*
    - **数量：** *10*

1. 添加第二个具有以下设置的销售订单行：

    - **物料编号**：*Item2*
    - **数量：** *5*

1. 选择**保存**。
1. 在**行详细信息**快速选项卡上，在**设置**选项卡上，记下每行的**批次 ID** 值。 在预留特定牌照期间将需要这些值。

    > [!NOTE]
    > 要预留特定牌照，您必须使用**每个牌照的订单承诺预留**数据实体。 要在特定牌照上预留批量跟踪物料，您还可以使用**批次预留**页面，如[输入销售订单详细信息](#sales-order-details)一节所述。
    >
    > 如果直接在销售订单行上输入牌照并向系统确认，该行将不使用仓库管理处理。

1. 选择**在 Microsoft Office 中打开**，选择**每个牌照的订单承诺预留**，然后下载文件。
1. 在 Excel 中打开下载的文件，选择**启用编辑**启用要运行的 Excel 加载项。
1. 如果首次运行此 Excel 加载项，则选择**信任此加载项**。
1. 如果系统提示您登录，选择**登录**，然后使用用于登录 Supply Chain Management 的相同凭据登录。
1. 要在特定牌照上预留物料，在 Excel 加载项中，选择**新建**添加预留行，然后设置以下值：

    - **批次 ID：** 输入您找到的 *Item1* 的销售订单行的**批次 ID** 值。
    - **牌照**：*LP02*
    - **预留库存数量**：*10*

1. 选择**新建**再添加一个预留行，然后设置以下值：

    - **批次 ID：** 输入您找到的 *Item2* 的销售订单行的**批次 ID** 值。
    - **牌照**：*LP02*
    - **预留库存数量**：*5*

1. 在 Excel 加载项中，选择**发布**将数据发送回 Supply Chain Management。

    > [!NOTE]
    > 仅当发布完成且没有错误时，预留行才会出现在系统中。

1. 返回 Supply Chain Management。 
1. 要查看物料的预留，在**销售订单行**快速选项卡上，在**库存**菜单上，选择**维护 \> 预留**。 请注意，在 *Item1* 的销售订单行上，预留了 *10* 库存，在 *Item2* 的销售订单行上，预留了 *5* 库存。
1. 要查看与销售订单行预留相关的库存交易记录，在**销售订单行**快速选项卡上，在**库存**菜单上，选择**视图 \> 交易记录**。 请注意，有两条与预留相关的交易记录：一条的**引用**字段设置为*销售订单*，另一条的**引用**字段设置为*订单承诺预留*。

    > [!NOTE]
    > **引用**字段设置为*销售订单*的交易记录，表示**位置**级别以上（站点、仓库和库存状态）的库存维度的订单行预留。 **引用**字段设置为*订单承诺预留*的交易记录表示特定牌照和位置的订单行预留。

1. 要发放销售订单，在操作窗格上，在**仓库**选项卡上的**操作**组中，选择**发放到仓库**。

### <a name="review-and-process-warehouse-work-with-order-committed-license-plates-assigned"></a>查看和处理分配了订单承诺牌照的仓库工作

1. 在**销售订单行**快速选项卡上的**仓库**菜单中，选择**工作详细信息**。

    与为特定批次完成预留时一样，系统在为使用牌照预留的销售订单创建工作时不使用位置指令。 由于订单承诺预留指定所有库存维度，包括位置，因此不必使用位置指令，因为这些库存维度仅在工作中输入。 它们将显示在**工作库存交易记录**页面的**来自库存维度**部分。

    > [!NOTE]
    > 创建工作后，**引用**字段设置为*订单承诺预留*的物料的库存交易记录将删除。 **引用**字段设置为*工作*的库存交易记录现在保留所有数量的库存维度的实际预留。

1. 在移动设备上，使用已选中**按牌照处理**复选框的菜单项完成领料和放置工作。

    > [!NOTE]
    > **按牌照处理**功能可帮助您处理整个牌照。 如果必须处理牌照的一部分，则无法使用此功能。
    >
    > 我们建议您为每个牌照生成单独的工作。 要达到此目的，使用**工作模板**页上的**工作标题分行符**功能。

    牌照 *LP02* 现在已为销售订单行领取，并放到*货架门*位置。 此时，可以将其装载并发往客户。

## <a name="exception-handling-of-warehouse-work-that-has-order-committed-batch-numbers"></a>具有订单承诺批号的仓库工作的异常处理

领取订单承诺批号的仓库工作与常规工作一样，都要接受相同的标准仓库异常处理和操作。 通常，未结工作或工作行可以被取消，可以因为用户货位已满而中断，可以存在领料短缺，并可以由于移动而更新。 同样，已领取的已完成工作的数量可以减少，或工作可以冲销。

以下关键规则应用于所有这些异常处理操作：为客户预留的批号永远不能替换为其他批号，但是可以通过用户手动更新或系统自动更新来更改其存储维度（货位和牌照）。 自动更新基于对存储维度的随机分配，其与在自动预留特定批次但未指定存储维度时应用的方法相同。

### <a name="example-scenario"></a>示例场景

这种情形的一个示例是：之前完成的工作未通过使用**减少领料数量**功能领取。 本示例假定您已经完成[示例方案：批号分配](#Example-batch-allocation)中所述的步骤。 与该示例具有连续性。

1. 转到**仓库管理** \> **负荷** \> **有效负荷**。
2. 选择创建的与销售订单的装运相关的负荷。
3. 从**负荷订单行**快速选项卡，选择**减少领料数量**。
4. 在**减少领料数量**页面，在**移到货位**字段中，选择 **FL-001**。
5. 在**移到牌照**字段中，选择 **LP33**。
6. 在网格中，在**要取消领料的库存数量**字段中，输入 **10**。
7. 选择**确定**。

这是取消领料操作的结果：

- 先前结束的工作的状态设置为**已取消**。
- 为批号 **B11** 的取消领料的数量 **10** 创建了**库存变动**类型的新工作。 此工作代表从 **Baydoor** 货位到 **FL-001** 货位中的牌照 **LP33** 的移动。 状态设置为**已结束**。
- 系统将重新预留最初订购的批号，并分配货位和牌照 ID。 （此流程等效于为给定批号的订单行运行**预留行**功能）。 结果是，批次 **B11** 在**批次预留**页的**提交到源行的批号**快速选项卡上显示为已提交，**预留**字段包含批号 **B11** 的数量 **10**。 此外，**货位**字段设置为 **FL-001**，**牌照**字段设置为 **LP11**。 （如果这些字段不可见，您可以将它们添加到网格中。）

下表提供了显示系统如何处理特定仓库操作的订单承诺批次预留的概览。 为了解释表中的内容，假定每个仓库操作都在源于订单承诺批次预留的现有仓库工作的上下文中运行，或者每个仓库操作的执行都会影响该类型的工作。

> [!NOTE]
> 在这些表中，“批次数量可用”列指示，除为当前的订单承诺预留已预留的数量，或由源于该类型预留的仓库工作已预留的数量之外，批次数量是否可用。

#### <a name="override-the-pick-location-on-the-open-work"></a>覆盖未结工作上的领料货位

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan='2'><strong>允许领料货位覆盖</strong>在工作人员上已启用。</td>
<td>是</td>
<td>
<ol>
<li>开始领料工作时，在仓库应用中选择<strong>替代货位</strong>菜单项。</li>
<li>选择<strong>建议</strong>。</li>
<li>根据批次数量的可用性确认建议的新货位。</li>
</ol>
</td>
<td>在当前工作上，将发生以下操作：
<ul>
<li>领料行上的货位已更新为新货位。 （如果货位是由牌照控制的，将为工作库存交易记录分配一个随机牌照，工作人员可以从任何具有可用数量的牌照领料。）</li>
<li>如果在新货位的一个以上牌照中找到数量，原始领料行将拆分成多行以匹配每个牌照。</li>
</ul>
</td>
<td>不适用</td>
</tr>
<tr>
<td>无</td>
<td>
<ol>
<li>开始领料工作时，在仓库应用中选择<strong>替代货位</strong>菜单项。</li>
<li>手动输入货位。</li>
</ol>
</td>
<td><strong>覆盖货位</strong>操作无法执行。 操作失败，并引发错误。</td>
<td>不适用</td>
</tr>
</tbody>
</table>

#### <a name="full-button--split-a-work-line-because-of-overflow-on-the-user-location"></a>“全部”按钮 – 工作行由于用户货位存在溢出被拆分

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>允许拆分工作</strong>选项在移动设备菜单项上启用。</td>
<td>不适用</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>完全</strong>菜单项。</li>
<li>在<strong>领料数量</strong>字段中，输入需要领料的部分数量来指示全部产能。</li>
</ol>
</td>
<td>
<ul>
<li>在当前工作上，数量更新为必须领料的剩余数量。</li>
<li>领料数量的新工作已创建并结束。</li>
</ul></td>
<td>不适用</td>
</tr>
</tbody>
</table>

#### <a name="reduce-the-picked-quantity-of-completed-work-from-a-load"></a>减少已完成工作的领料数量（从负荷）

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan='2'>不适用</td>
<td>是</td>
<td>
<ol>
<li>从负荷行打开<strong>减少领料数量</strong>页面。</li>
<li>输入要取消领料的全部数量。</li>
<li>选择“移至”货位/牌照。</li>
</ol>
</td>
<td>
<ul> 
<li>与负荷行关联的工作被取消。</li>
<li>库存变动的新工作已创建并结束。</li>
</ul>
</td>
<td>为同一批次重新预留了数量。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>查看上一行。</td>
<td>已为同一批次，以及取消领料期间输入的同一货位和牌照（如果货位是由牌照控制的）重新预留了数量。</td>
</tr>
</tbody>
</table>

#### <a name="move-an-item-within-a-warehouse"></a>在仓库内移动物料

> [!NOTE]
> 此仓库操作仅适用于**工作创建流程**类型的移动，不适用于模板移动。

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan='2'><strong>允许包含关联工作的库存移动</strong>选项在工作人员上启用。</td>
<td>是</td>
<td>
<ol>
<li>在仓库应用中开始移动。</li>
<li>输入“起始”和“目标”货位。</li>
</ol></td>
<td>
<ul>
<li>在受移动影响的所有现有工作上，领料货位将更新为新的“目标”货位。</li>
<li>库存变动的新工作已创建并结束。</li>
</ul>
</td>
<td>受从给定货位的数量移动影响的所有现有预留已为同一批次重新预留。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>查看上一行。</td>
<td>受从给定货位的数量移动影响的所有现有预留已为同一批次，以及新的“目标”货位和牌照（如果货位是由牌照控制的）重新预留。</td>
</tr>
</tbody>
</table>

#### <a name="reverse-the-picked-quantity-of-completed-work-from-a-load-or-a-wave"></a>冲销已完成工作的领料数量（从负荷或波次）

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan='6'>不适用</td>
<td>是</td>
<td>
<ol>
<li>打开<strong>冲销工作</strong>页面。</li>
<li>在请求页面上，选择<strong>将物料留在当前货位</strong>选项。</li>
</ol>
</td>
<td>与负荷关联的所有工作被取消。</td>
<td>为同一批次重新预留了数量。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>查看上一行。</td>
<td>数量已为同一批次以及在冲销后保留数量的货位和牌照重新预留。</td>
</tr>
<tr>
<td>是</td>
<td>
<ol>
<li>打开<strong>冲销工作</strong>页面。</li>
<li>在请求页面上，选择<strong>将物料分配给此货位</strong>选项。</li>
</ol>
</td>
<td>
<ul>
<li>当前工作被取消。</li>
<li>库存变动的新工作已创建并结束。</li>
</ul>
</td>
<td>为同一批次重新预留了数量。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>查看上一行。</td>
<td>数量已为同一批次以及在冲销后向其分配数量的货位和牌照重新预留。</td>
</tr>
<tr>
<td>是/否</td>
<td>
<ol>
<li>打开<strong>冲销工作</strong>页面。</li>
<li>在请求页面上，选择<strong>将物料移到此货位</strong>选项。</li>
</ol>
</td>
<td>不支持冲销。</td>
<td>不适用</td>
</tr>
<tr>
<td>是/否</td>
<td>
<ol>
<li>打开<strong>冲销工作</strong>页面。</li>
<li>在请求页面上，选择<strong>根据货位指令移动物料</strong>选项。</li>
</ol>
</td>
<td>不支持冲销。 </td>
<td>不适用</td>
</tr>
</tbody>
</table>

#### <a name="short-pick-a-quantity--register-the-quantity-as-physically-not-found-at-the-locationlicense-plate-while-you-perform-picking-work"></a>领料短缺数量 – 登记在执行领料工作时，在货位/牌照上实际未找到的数量

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan='2'>设置<strong>领料短缺</strong>类型的工作异常，其中，<strong>物料重新分配</strong> = <strong>无</strong>，<strong>调整库存</strong> = <strong>是</strong>，<strong>删除预留</strong> = <strong>否</strong>。</td>
<td>是</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>领料不足</strong>菜单项。</li>
<li>在<strong>领料数量</strong>字段中，输入<strong>0</strong>（零）。</li>
<li>在<strong>原因</strong>字段中，输入<strong>未重新分配</strong>。</li>
</ol>
</td>
<td>
<ul>
<li>当前工作已结束，领料数量为 0（零）。</li>
<li><strong>盘点</strong>类型和<strong>已售出</strong>发货类型的库存交易记录已创建来表示调整。</li>
</ul>
</td>
<td>为同一批次重新预留了数量。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>
<ul>
<li>领料短缺操作失败，并引发错误。</li>
<li>当前工作保持未结状态。</li>
</ul>
</td>
<td>不适用</td>
</tr>
<tr>
<td rowspan='2'>设置<strong>领料短缺</strong>类型的工作异常，其中，<strong>物料重新分配</strong> = <strong>无</strong>，<strong>调整库存</strong> = <strong>是</strong>，<strong>删除预留</strong> = <strong>是</strong>。</td>
<td>是</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>领料不足</strong>菜单项。</li>
<li>在<strong>领料数量</strong>字段中，输入<strong>0</strong>（零）。</li>
<li>在<strong>原因</strong>字段中，输入<strong>未重新分配</strong>。</li>
</ol>
</td>
<td>
<ul>
<li>当前工作已结束，领料数量为 0（零）。</li>
<li><strong>盘点</strong>类型和<strong>已售出</strong>发货类型的库存交易记录已创建来表示调整。</li>
</ul>
</td>
<td>受领料短缺货位的数量调整影响的所有现有预留已为同一批次重新预留。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>查看上一行。</td>
<td>受领料短缺货位的数量调整影响的所有现有预留已删除。</td>
</tr>
<tr>
<td>设置<strong>领料短缺</strong>类型的工作异常，其中，<strong>物料重新分配</strong> = <strong>手动</strong>，<strong>调整库存</strong> = <strong>是</strong>，<strong>删除预留</strong> = <strong>否/是</strong>。 此外，<strong>允许手动重新分配物料</strong>选项在工作人员上启用。</td>
<td>是</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>领料不足</strong>菜单项。</li>
<li>在<strong>领料短缺数量</strong>字段中，输入<strong>0</strong>（零）。</li>
<li>在<strong>原因</strong>字段中，选择<strong>手动重新分配领料短缺</strong>。</li>
<li>在列表中选择货位/牌照。</li>
</ol>
</td>
<td>
<ul>
<li>在当前工作上，将发生以下操作：
<ul>
<li>领料行已关闭，领料数量为 0（零）。</li>
<li>放置行被取消。</li>
<li>新领料行创建。 它使用用户选择的货位/牌照。</li>
<li>新放置行创建。</li>
</ul>
</li>
<li><strong>盘点</strong>类型和<strong>已售出</strong>发货类型的库存交易记录已创建来表示调整。</li>
</ul>
</td>
<td>不适用</td>
</tr>
<tr>
<td>设置<strong>领料短缺</strong>类型的工作异常，其中，<strong>物料重新分配</strong> = <strong>手动</strong>，<strong>调整库存</strong> = <strong>是</strong>，<strong>删除预留</strong> = <strong>否</strong>。 此外，<strong>允许手动重新分配物料</strong>选项在工作人员上启用。</td>
<td>无</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>领料不足</strong>菜单项。</li>
<li>在<strong>领料短缺数量</strong>字段中，输入<strong>0</strong>（零）。</li>
<li>在<strong>原因</strong>字段中，选择<strong>手动重新分配领料短缺</strong>。</li>
</ol>
</td>
<td>领料短缺操作失败，并引发错误。</td>
<td>不适用</td>
</tr>
<tr>
<td>设置<strong>领料短缺</strong>类型的工作异常，其中，<strong>物料重新分配</strong> = <strong>手动</strong>，<strong>调整库存</strong> = <strong>是</strong>，<strong>删除预留</strong> = <strong>是</strong>。 此外，<strong>允许手动重新分配物料</strong>选项在工作人员上启用。</td>
<td>无</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>领料不足</strong>菜单项。</li>
<li>在<strong>领料短缺数量</strong>字段中，输入<strong>0</strong>（零）。</li>
<li>在<strong>原因</strong>字段中，选择<strong>手动重新分配领料短缺</strong>。</li>
<li>在列表中选择货位/牌照。</li>
</ol>
</td>
<td>
<ul>
<li>在当前工作上，将发生以下操作：
<ul>
<li>领料行已关闭，领料数量为 0（零）。</li>
<li>放置行被取消。</li>
</ul>
</li>
<li><strong>盘点</strong>类型和<strong>已售出</strong>发货类型的库存交易记录已创建来表示调整。</li>
</ul>
</td>
<td>受领料短缺货位/牌照的数量调整影响的所有现有预留已删除。</td>
</tr>
<tr>
<td>设置<strong>领料短缺</strong>类型的工作异常，其中，<strong>物料重新分配</strong> = <strong>自动</strong>，<strong>调整库存</strong> = <strong>是/否</strong>，<strong>删除预留</strong> = <strong>是/否</strong>。</td>
<td>不适用</td>
<td>
<ol>
<li>执行领料工作时，在仓库应用中选择<strong>领料不足</strong>菜单项。</li>
<li>在<strong>领料短缺数量</strong>字段中，输入<strong>0</strong>（零）。</li>
<li>在<strong>原因</strong>字段中，选择<strong>自动重新分配领料短缺</strong>。</li>
</ol>
</td>
<td>不支持涉及自动重新分配的领料短缺。</td>
<td>不支持涉及自动重新分配的领料短缺。</td>
</tr>
</tbody>
</table>

#### <a name="change-the-inventory-status"></a>更改库存状态

> [!NOTE]
> 可以从多个入口点执行此仓库操作。 此处显示的示例使用**按货位显示的现有量**页面的**库存状态更改**操作。

<table>
<thead>
<tr>
<th>关键设置参数</th>
<th>批次数量可用</th>
<th>关键用户步骤</th>
<th>仓库工作</th>
<th>订单承诺批次预留</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan='2'>在<strong>仓库</strong>选项卡上，在<strong>仓库</strong>记录中，<strong>删除预留和标记</strong>字段设置为<strong>预留</strong>或<strong>标记和预留</strong>。</td>
<td>是</td>
<td>
<ol>
<li>选择特定位置。</li>
<li>选择具有特定物料、货位和牌照的行（如果货位是由牌照控制的）。</li>
<li>选择<strong>库存状态更改</strong>。</li>
<li>将<strong>库存状态</strong>字段设置为<strong>锁定</strong>。</li>
</ol>
</td>
<td>为工作预留的数量不允许库存状态更改。</td>
<td>
<ul>
<li>为同一批次重新预留了数量。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</li>
<li><strong>库存状态更改</strong>的两个库存交易记录已创建，来表示库存状态维度的更改。</li>
<li><strong>库存锁定</strong>类型和<strong>实际预留</strong>发货类型的库存交易记录已创建，来表示锁定数量的预留。</li>
</ul>
</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>为工作预留的数量不允许库存状态更改。</td>
<td>
<ul>
<li>预留被删除。</li>
<li><strong>库存状态更改</strong>的两个库存交易记录已创建，来表示库存状态维度的更改。</li>
<li><strong>库存锁定</strong>类型和<strong>实际预留</strong>发货类型的库存交易记录已创建，来表示锁定数量的预留。</li>
</ul>
</td>
</tr>
<tr>
<td rowspan='2'>在<strong>仓库</strong>选项卡上，在<strong>仓库</strong>记录中，<strong>删除预留和标记</strong>字段设置为<strong>无</strong>。</td>
<td>是</td>
<td>
<ol>
<li>选择特定位置。</li>
<li>选择具有特定物料、货位和牌照的行（如果货位是由牌照控制的）。</li>
<li>选择<strong>库存状态更改</strong>。</li>
<li>将<strong>库存状态</strong>字段设置为<strong>锁定</strong>。</li>
</ol>
</td>
<td>为工作预留的数量不允许库存状态更改。</td>
<td>为同一批次重新预留了数量。 系统随机分配数量可用的货位和牌照（如果货位是由牌照控制的）。</td>
</tr>
<tr>
<td>否</td>
<td>查看上一行。</td>
<td>为工作预留的数量不允许库存状态更改。</td>
<td>不允许库存状态更改。</td>
</tr>
</tbody>
</table>

## <a name="limitations"></a>限制

- 灵活的仓库级维度预留功能不支持以下功能：

    - 实际称重管理
    - 允许实际负库存
    - 按订购的供应预留
    - 转移单和原材料领料

- 按指令单位包装的集装箱合并规则有局限性。 对于订单承诺预留，我们建议您不要在**按指令单位包装**字段已启用的情况下使用集装箱生成模板。 在当前的设计中，创建仓库工作时不使用货位指令。 因此，在集装化波次步骤期间，仅应用单位序列组中的最低单位（库存单位）。
