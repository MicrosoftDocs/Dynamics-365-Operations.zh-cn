---
title: 具有需求预测的主计划
description: 本主题介绍如何使用计划优化在主计划期间包括需求预测。
author: ChristianRytt
ms.date: 12/02/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ReqPlanSched, ReqGroup, ReqReduceKey, ForecastModel
audience: Application User
ms.reviewer: kamaybac
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Manufacturing
ms.author: crytt
ms.search.validFrom: 2020-12-02
ms.dyn365.ops.version: AX 10.0.13
ms.openlocfilehash: 0f322dd63cb2dee6a9048e6ed086dc075cc0e1b9
ms.sourcegitcommit: 2d6e31648cf61abcb13362ef46a2cfb1326f0423
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/07/2021
ms.locfileid: "7474836"
---
# <a name="master-planning-with-demand-forecasts"></a>具有需求预测的主计划

[!include [banner](../../includes/banner.md)]

您可以将需求预测与计划优化一起使用，以在主计划中考虑预期需求。 您可以使用 Microsoft Dynamics 365 Supply Chain Management 中的需求预测功能手动创建、导入或生成需求预测。 有关需求预测的详细信息，请参阅[需求预测概述](../introduction-demand-forecasting.md)。

> [!NOTE]
> 计划优化不支持单独的预测计划。 因此，在使用计划优化时，**主计划参数** 页面上的 **当前预测计划** 设置无效。

## <a name="set-up-a-master-plan-to-include-a-demand-forecast"></a>设置主计划以包括需求预测

若要配置主计划以使其包括需求预测，请按照下列步骤操作。

1. 转到 **主计划 \> 设置 \> 计划 \> 主计划**。
1. 选择一个现有计划，或创建新计划。
1. 在 **常规** 快速选项卡上，设置以下字段：

    - **预测模型** – 选择要应用的预测模型。 当为当前主计划生成供应建议时，将考虑该模型。
    - **包括需求预测** – 将此选项设置为 *是* 以在当前主计划中包括需求预测。 如果设置为 *否*，需求预测交易将不包含在主计划中。
    - **用于减少预测需求的方法** – 选择应用于减少预测需求的方法。 有关详细信息，请参阅本主题后面的[预测缩减参数](#reduction-keys)部分。

1. 在 **时限（天）** 快速选项卡上，您可以设置以下字段来指定包括需求预测的期间：

    - **预测计划** – 将此选项设置为 *是* 以替代源自各个覆盖范围组的预测计划时限。 设置为 *否* 以使用来自当前主计划的各个覆盖范围组中的值。
    - **预测时段** – 如果您将 **预测计划** 选项设置为 *是*，请指定应该应用需求预测的天数（从今天开始）。

    > [!IMPORTANT]
    > 计划优化尚不支持 **预测计划** 设置。

## <a name="set-up-a-coverage-group-to-include-a-demand-forecast"></a>设置覆盖范围组以包括需求预测

若要配置覆盖范围组以使其包括需求预测，请按照下列步骤操作。

1. 转到 **主计划 \> 设置 \> 计划 \> 覆盖范围组**。
1. 选择一个现有覆盖范围组，或创建新组。
1. 在 **其他** 快速选项卡上，设置以下字段：

    - **预测计划时限** – 输入应该应用需求预测的天数（从今天开始）。 可以使用主计划上的 **预测计划** 选项替代此值，如上一部分所述。
    - **缩减参数** – 选择要应用的缩减参数。 有关详细信息，请参阅本主题后面的[创建和设置预测缩减参数](#create-reduction-key)和[使用缩减参数](#use-reduction-key)部分。
    - **预测减少依据** – 对于 **用于减少预测需求的方法** 字段设置为 *交易 - 缩减参数* 或 *交易 - 动态期间* 的主计划，指定哪些交易应减少预测。 选择以下值之一：

        - **所有交易** – 所有交易都应减少预测。
        - **订单** – 仅销售订单应减少预测。

        > [!NOTE]
        > 如果选择 *所有交易*，在相同的库存维度上具有需求和供应的交易将视为中性，并将在预测减少期间忽略。 例如，如果计划维度设置为仅站点（而不是仓库），将忽略站点 1，仓库 11 和站点 1，仓库 13 之间的转移单，并且不会减少剩余需求预测。

    - **包括内部公司订单** – 如果在减少预测时应包括内部公司订单，将此选项设置为 *是*。 否则，将其设置为 *否*。
    - **在需求预测中包括客户预测** – 指定是否应在整个预测中包括客户预测。 此选项确定实际需求如何减少预测需求。 您可以使用它确保主计划涵盖特定客户采购的物料供应。

        - 将此选项设置为 *是* 以在整个预测中包括客户预测。 在这种情况下，实际客户需求会同时减少客户预测和整个预测。 主计划将生成计划订单以仅涵盖整个预测数量。
        - 如果您不希望在整个预测中包括客户预测，将此选项设置为 *否*。 在这种情况下，实际客户需求仅减少客户预测。 主计划将生成计划订单，以涵盖整个预测数量和每个客户数量的预测。

## <a name="forecast-reduction-keys"></a><a name="reduction-keys"></a>预测缩减参数

此部分提供有关用于减少预测需求的不同方法的信息。 其中包括每种方法的结果的示例。 还介绍如何创建、设置和使用预测缩减参数。 一些方法使用预测缩减参数缩减预测需求。

### <a name="methods-that-are-used-to-reduce-forecast-requirements"></a>用于缩减预测需求的方法

向主计划添加预测时，可以选择包含实际需求时如何缩减预测需求。 请注意，主计划中不包含过去的预测要求，即当天以前的所有预测要求。

若要在主计划中添加预测并选择用于缩减预测需求的方法，请转到 **主计划 \> 设置 \> 计划 \> 主计划**。 在 **预测模型** 字段中，选择一个预测模型。 在 **用于减少预测需求的方法** 字段中，选择一个方法。 选项如下：

- None
- 百分比 - 缩减参数
- 交易 – 缩减参数（计划优化尚不支持）
- 交易记录 - 动态期间

以下部分提供有关每个选项的详细信息。

#### <a name="none"></a>无

如果您选择 **无**，则在主计划编制期间不缩减预测需求。 在此案例中，主计划将创建计划订单以供给预测的需求（预测需求）。 这些计划订单中维持建议的数量，不考虑其他类型的需求。 例如，如果下达销售订单，主计划将创建更多计划订单以供给销售订单。 将不缩减预测需求的数量。

#### <a name="percent--reduction-key"></a>百分比 - 缩减参数

如果选择 **百分比 - 缩减参数**，则根据百分比和缩减参数定义的百分比和期间来缩减预测需求。 在此案例中，主计划创建计划订单，在此类订单中，数量的计算方法是预测数量 × 各期间的缩减参数。 如果有其他类型的需求，主计划还将创建计划订单以满足该需求。

##### <a name="example-percent--reduction-key"></a>示例：百分比 - 缩减参数

此示例显示由缩减参数如何根据由缩减参数定义的百分比和期间缩减需求预测要求。

对于本示例，将在主计划中包含以下需求预测。

| 月    | 需求预测 |
|----------|-----------------|
| 一月  | 1,000           |
| 二月 | 1,000           |
| 三月    | 1,000           |
| 四月    | 1,000           |

在 **缩减参数** 页上，设置以下行。

| 找零 | 单位  | 百分比 |
|--------|-------|---------|
| 1      | 月 | 100     |
| 2      | 月 | 75      |
| 3      | 月 | 50      |
| 4      | 月 | 25      |

将缩减参数分配给物料的覆盖范围组。 然后在 **主计划** 页的 **用于缩减预测需求的方法** 字段中，选择 **百分比 - 缩减参数**。

在此案例中，如果在 1 月 1 日运行预测计划编制，则将根据您在 **缩减参数** 页上设置的百分比来消耗销售预测需求。 以下需求数量将转移到主计划。

| 月                | 计划订单数量 | 计算    |
|----------------------|------------------------|----------------|
| 一月              | 0                      | = 0% × 1,000   |
| 二月             | 250                    | = 25% × 1,000  |
| 三月                | 500                    | = 50% × 1,000  |
| 四月                | 750                    | = 75% × 1,000  |
| 五月到十二月 | 1,000                  | = 100% × 1,000 |

#### <a name="transactions--reduction-key"></a>交易记录 - 缩减参数

如果将 **用于减少预测需求的方法** 字段设置为 *交易记录 - 缩减参数*，将由缩减参数定义的期间发生的符合资格的需求交易记录减少预测需求。

符合资格的需求由 **覆盖范围组** 页中的 **预测减少依据** 字段定义。 如果将 **预测减少依据** 字段设置为 *订单*，则仅将销售订单交易记录视为符合资格的需求。 如果将其设置为 *所有交易记录*，则将所有非内部公司发货库存交易记录都视为符合资格的需求。 如果也应将内部公司销售订单视为符合资格的需求，请将 **包括内部公司订单** 选项设置为 *是*。

预测缩减以缩减参数期间中的第一个（最早）需求预测记录开始。 如果符合资格的库存交易记录数量比同一缩减参数期间的需求预测行数量多，则将使用库存交易记录数量的余额减少上一个期间中的需求预测数量（如果存在未使用的预测）。

如果上一缩减参数期间中未保留未使用的预测，将使用库存交易记录数量的余额减少下月的预测数量（如果有未使用的预测）。

如果 **用于减少预测需求的方法** 字段设置为 *交易记录 - 缩减参数*，则不使用缩减参数行中的 **百分比** 字段的值。 将仅使用这些日期来定义缩减参数期间。

> [!NOTE]
> 当天或之前发布的所有预测都将忽略，不会用于创建计划订单。 例如，如果当月的需求预测是在 1 月 1 日生成的，而您在 1 月 2 日运行其中包括需求预测的主计划，则计算将忽略日期为 1 月 1 日的需求预测。

##### <a name="example-transactions--reduction-key"></a>示例：交易记录 - 缩减参数

此示例显示如何实际订单，这将在由缩减参数和缩减需求预测要求定义的期间发生。

[![运行主计划之前的实际订单和预测。](media/forecast-reduction-keys-1-small.png)](media/forecast-reduction-keys-1.png)

对于本示例，在 *主计划* 页的 **用于缩减预测需求的方法** 字段中，选择 **交易记录 - 缩减参数**。

4 月 1 日存在以下需求预测行。

| 日期     | 预测的份数 |
|----------|-----------------------------|
| 4 月 5 日  | 100                         |
| 4 月 12 日 | 100                         |
| 4 月 19 日 | 100                         |
| 4 月 26 日 | 100                         |
| 5 月 3 日    | 100                         |
| 5 月 10 日   | 100                         |
| 5 月 17 日   | 100                         |

4 月存在以下销售订单行。

| 日期     | 请求的份数 |
|----------|----------------------------|
| 4 月 27 日 | 240                        |

[![基于 4 月订单生成的计划供应。](media/forecast-reduction-keys-2-small.png)](media/forecast-reduction-keys-2.png)

在 4 月 1 日运行主计划时，将把以下需求数量传输到主计划。 您可以看到，将 4 月预测交易记录按顺序减少了 240 个这一需求数量，从这些交易记录中的第一个开始减少。

| 日期     | 所需的份数 |
|----------|---------------------------|
| 4 月 5 日  | 0                         |
| 4 月 12 日 | 0                         |
| 4 月 19 日 | 60                        |
| 4 月 26 日 | 100                       |
| 4 月 27 日 | 240                       |
| 5 月 3 日    | 100                       |
| 5 月 10 日   | 100                       |
| 5 月 17 日   | 100                       |

现在，假设新订单是在 5 月导入的。

5 月存在以下销售订单行。

| 日期   | 请求的份数 |
|--------|----------------------------|
| 5 月 4 日  | 80                         |
| 5 月 11 日 | 130                        |

[![基于 4 月和 5 月订单生成的计划供应。](media/forecast-reduction-keys-3-small.png)](media/forecast-reduction-keys-3.png)

在 4 月 1 日运行主计划时，将把以下需求数量传输到主计划。 您可以看到，将 4 月预测交易记录按顺序减少了 240 个这一需求数量，从这些交易记录中的第一个开始减少。 但是，从 5 月预测交易记录减少了总共 210 个，从 5 月的第一个需求预测交易记录开始。 但是保留了每个期间的总数（4 月为 400，5 月为 300）。

| 日期     | 所需的份数 |
|----------|---------------------------|
| 4 月 5 日  | 0                         |
| 4 月 12 日 | 0                         |
| 4 月 19 日 | 60                        |
| 4 月 26 日 | 100                       |
| 4 月 27 日 | 240                       |
| 5 月 3 日    | 0                         |
| 5 月 4 日    | 80                        |
| 5 月 10 日   | 0                         |
| 5 月 11 日   | 130                       |
| 5 月 17 日   | 90                        |

#### <a name="transactions--dynamic-period"></a>交易记录 - 动态期间

如果选择 **交易记录 - 动态期间**，将按动态期间进行的实际订单交易记录缩减预测需求。 动态期间涵盖当前预测日期，并在下一预测开始时结束。 在此案例中，主计划将创建计划订单以供给预测的需求（预测需求）。 但是，下达实际订单交易记录时，将缩减预测需求。 实际交易记录占用部分预测需求。

在使用此选项时，会发生以下行为：

- 将不需要或不使用缩减参数。 
- 如果完全缩减预测，则当前预测的预测需求变为 0（零）。
- 如果没有将来的预测，则最后一个输入的预测的预测需求会缩减。
- 时限包括在缩减预测计算中。
- 正天数包括在缩减预测计算中。
- 如果实际订单交易记录超过预测的需求，则其余的交易记录不会前进到下一预测期间。

##### <a name="example-1-transactions--dynamic-period"></a>示例 1：交易记录 - 动态期间

下面是一个简单示例，该示例显示 **交易记录 - 动态期间** 方法的工作原理。

对于本示例，将在主计划中包含以下需求预测。

| 日期       | 需求预测 |
|------------|-----------------|
| 1 月 1 日  | 1,000           |
| 2 月 1 日 | 1,000             |

还将创建以下销售订单。

| 日期        | 销售订单数量 |
|-------------|----------------------|
| 1 月 15 日  | 200                  |
| 2 月 15 日 | 400                  |

在此案例中，将创建以下计划订单。

| 需求预测日期 | 数量 | 摘要                           |
|--------------------- |----------|---------------------------------------|
| 1 月 1 日            | 800      | 预测需求 (= 1,000 – 200) |
| 1 月 15 日           | 200      | 销售订单需求             |
| 2 月 1 日           | 600      | 预测需求 (= 1,000 – 400) |
| 2 月 15 日          | 400      | 销售订单需求             |

##### <a name="example-2-transactions--dynamic-period"></a>示例 2：交易记录 - 动态期间

在大多数情况下，会设置系统以使交易记录在特定预测期间减少需求预测：周、月，等等。 这些期间是在缩减参数中定义的。 但是，两个需求预测行之间的时间还可 *提示* 期间。

对于此示例，将为以下日期和数量创建需求预测。

| 日期       | 需求预测 |
|------------|-----------------|
| 1 月 1 日  | 1,000           |
| 1 月 5 日  | 500             |
| 1 月 12 日 | 1,000           |

请注意，在此预测中，预测日期之间没有清晰的间隔。 第一个和第二个日期之间的间隔为四天，第二个和第三个日期之间的间隔为七天。 这些间隔就是动态期间。

还将创建以下销售订单行。

| 日期                             | 销售订单数量 |
|----------------------------------|----------------------|
| 上一年度的 12 月 15 日 | 500                  |
| 1 月 3 日                        | 100                  |
| 1 月 10 日                       | 200                  |

在此案例中，将以下面的方式缩减预测：

- 因为第一个销售订单不在任何期间，因此不会缩减任何预测。
- 因为第二个销售订单是从 1 月 1 日到 1 月 5 日，因此它会将 1 月 1 日的预测缩减 100。
- 因为第三个销售订单是从 5 月 5 日到 5 月 12 日，因此它会将 5 月 5 日的预测缩减 200。

因此，将创建以下计划订单。

| 需求预测日期             | 数量 | 摘要                                                         |
|----------------------------------|----------|---------------------------------------------------------------------|
| 上一年度的 12 月 15 日 | 500      | 销售订单需求                                            |
| 1 月 1 日                        | 900      | 预测需求期间 1 月 1 日到 1 月 5 日 (= 1,000 – 100) |
| 1 月 3 日                        | 100      | 销售订单需求                                            |
| 1 月 5 日                        | 300      | 预测需求期间 1 月 5 日到 1 月 10 日 (= 500 – 200)  |
| 1 月 12 日                       | 1,000    | 预测需求期间 1 月 12 日到月底                      |

### <a name="create-and-set-up-a-forecast-reduction-key"></a><a name="create-reduction-key"></a>创建和设置预测缩减参数

用于缩减预测需求的 **交易记录 - 缩减参数** 和 **百分比- 缩减参数** 方法中使用预测缩减参数。 若要创建和设置缩减参数，请执行以下步骤。

1. 转到 **主计划 \> 设置 \> 覆盖范围 \> 缩减参数**。
2. 选择 **新建** 创建缩减参数。
3. 在 **缩减参数** 字段中，输入预测缩减参数的唯一标识符。 然后在 **名称** 字段中输入名称。 
4. 定义期间和每个期间中的缩减参数百分比：

    - **生效日期** 字段指示开始创建期间的日期。 如果 **使用生效日期** 选项设置为 **是**，期间将在生效日期开始。 如果设置为 **否**，期间将在运行主计划的日期开始。
    - 定义应进行预测缩减的期间。
    - 为具体期间指定应缩减预测需求的百分比。 您可以输入正值以减少需求，或输入负值增加需求。

### <a name="use-a-reduction-key"></a><a name="use-reduction-key"></a>使用一个缩减参数

必须为物料的覆盖范围组分配预测缩减参数。 若要为物料的覆盖范围组分配缩减参数，请执行以下步骤。

1. 转至 **主计划 \> 设置 \> 覆盖范围 \> 覆盖范围组**。
2. 在 **其他** 快速选项卡上的 **缩减参数** 字段中，选择缩减参数分配给覆盖范围组。 缩减参数然后运用于属于该覆盖范围组的所有物料。
3. 在主计划编制期间，若要使用缩减参数计算预测缩减，必须在设置预测计划或主计划时定义此设置。 转至以下位置之一：

    - **主计划 \> 设置 \> 计划 \> 预测计划**
    - **主计划 \> 设置 \> 计划 \> 主计划**

4. 在 **预测计划** 或 **主计划** 页面 **常规** 快速选项卡上的 **用于减少预测需求的方法** 字段中，选择 **百分比 - 缩减参数** 或 **交易记录 - 缩减参数**。

### <a name="reduce-a-forecast-by-transactions"></a>按交易记录缩减预测

如果用于缩减预测需求的方法选择 **交易记录 - 缩减参数** 或 **交易记录 - 动态期间**，则可指定哪些交易记录缩减预测。 如果所有交易记录均应缩减预测，请在 **覆盖范围组** 页面 **其他** 快速选项卡上的 **预测减少依据** 字段中选择 **所有交易记录**，如果只有销售订单才应缩减预测，请选择 **订单**。

## <a name="forecast-models-and-submodels"></a>预测模型和子模型

本节介绍如何创建预测模型以及如何通过设置子模型来合并多个预测模型。

*预测模型* 对特定的预测进行命名和标识。 创建预测模型后，可以向其添加预测行。 要为多个物料添加预测行，使用 **需求预测行** 页。 要为特定的选定物料添加预测行，使用 **已发布产品** 页。

预测模型可以包括来自其他预测模型的预测。 要实现此目的，将其他预测模型添加为父预测模型的 *子模型*。 必须先创建每个相关模型，然后才能将其添加为父预测模型的子模型。

生成的结构将为您提供一种控制预测的有效方法，因为它让您可以合并（聚合）来自多个预测的输入。 因此，从计划的角度，很容易合并预测来进行模拟。 例如，您可以基于定期预测与春季促销预测的组合来设置模拟。

### <a name="submodel-levels"></a>子模型级别

可以添加到父预测模型的子模型的数量没有限制。 但是，结构只能有一个级别。 换言之，作为另一个预测模型的子模型的预测模型不能有自己的子模型。 将子模型添加到预测模型时，系统会检查该预测模型是否已经是另一个预测模型的子模型。

如果主计划遇到有自己的子模型的子模型，您会收到错误消息。

#### <a name="submodel-levels-example"></a>子模型级别示例

预测模型 A 有子模型预测模型 B。 因此，预测模型 B 不能有自己的子模型。 如果您尝试将子模型添加到预测模型 B，会收到以下错误消息：“预测模型 B 是模型 A 的子模型。”

### <a name="aggregating-forecasts-across-forecast-models"></a>跨预测模型聚合预测

在同一天发生的预测行将跨其预测模型及其子模型聚合。

#### <a name="aggregation-example"></a>聚合示例

预测模型 A 有预测模型 B 和 C 两个子模型。

- 预测模型 A 包括 6 月 15 日 2 件 (pcs) 的需求预测。
- 预测模型 B 包括 6 月 15 日 3 pcs 的需求预测。
- 预测模型 C 包括 6 月 15 日 4 pcs 的需求预测。

生成的需求预测将是 6 月 15 日 9 pcs (2 + 3 + 4) 的一个需求。

> [!NOTE]
> 每个子模型使用自己的参数，而不是父预测模型的参数。

### <a name="create-a-forecast-model"></a>创建预测模型

若要创建预测模型，请执行以下步骤。

1. 转到 **主计划 \> 设置 \> 需求预测 \> 预测模型**。
1. 在操作窗格上，选择 **新建**。
1. 为新的预测模型设置以下字段：

    - **模型** – 为模型输入唯一标识符。
    - **名称** – 为模型输入描述性名称。
    - **已停止** – 通常，您应将此选项设置为 *否*。 仅当要阻止编辑分配到模型的所有预测行时再将其设置为 *是*。

    > [!NOTE]
    > **包括在现金流量预测中** 字段和 **项目** 快速选项卡上的字段不会与主计划关联。 因此，您可以在此上下文中忽略它们。 仅在使用 **项目管理和会计** 模块的预测时，才必须考虑它们。

### <a name="assign-submodels-to-a-forecast-model"></a>将子模型分配到预测模型

要将子模型分配到预测模型，请按照下列步骤操作。

1. 转到 **库存管理 \> 设置 \> 预测 \> 预测模型**。
1. 在列表窗格中，选择要为其设置子模型的预测模型。
1. 在 **子模型** 快速选项卡上，选择 **添加** 向网格添加一行。
1. 在新行中，设置以下字段：

    - **子模型** – 选择要添加为子模型的预测模型。 此预测模型必须已经存在，并且不能有自己的任何子模型。
    - **名称** – 为子模型输入描述性名称。 例如，此名称可以指示子模型与父预测模型的关系。

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

