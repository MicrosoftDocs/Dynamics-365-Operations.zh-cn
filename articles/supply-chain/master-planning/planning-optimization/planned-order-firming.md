---
title: 确定计划订单
description: 本主题说明如何确认计划订单。 确认计划订单后，它们将变为实际的采购订单、转移单或生产订单。
author: ChristianRytt
ms.date: 04/22/2021
ms.search.form: ReqTransPo, ReqTransFirmLog
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: crytt
ms.search.validFrom: 2021-04-22
ms.dyn365.ops.version: 10.0.19
ms.openlocfilehash: a709528b04e82c32f644073f79513b7ef11bb6bf
ms.sourcegitcommit: 008779c530798f563fe216810d34b2d56f2c8d3c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/14/2021
ms.locfileid: "7920715"
---
# <a name="firm-planned-orders"></a>确定计划订单

[!include [banner](../../includes/banner.md)]

计划订单必须作为主计划流程的一部分进行 *确认*（即下达）。 确认计划订单后，它们将变为实际的采购订单、转移单或生产订单。 这些订单也称为 *已下达订单* 或 *未结订单*。

有三种确认计划订单的方法：

- **手动确认** – 在列表中选择特定计划订单，然后手动启动流程。
- **自动确认** – 为覆盖范围组、单个物料以及物料与主计划的组合定义默认确认时限。 然后，在主计划运行期间，如果订单日期在指定的确认时限内，将自动确认计划订单。
- **基于查询的确认** – 将查询定义为根据属性选择计划订单。 您可以设置批处理作业来定期运行查询和确认匹配的订单。

本主题详细介绍每种方法。

## <a name="enable-the-features-that-are-described-in-this-topic"></a><a name="enable-features"></a>启用本主题中所述的功能

大多数计划订单功能在使用计划优化的 Microsoft Dynamics 365 Supply Chain Management 的所有标准安装中都有提供。 但是，本主题中所述的一些功能必须先在“功能管理”中打开，然后才能够使用。

### <a name="enable-parallelized-firming-of-planned-orders"></a>启用并行确认计划订单

并行确认通过将确认流程在多个线程之间并行化来帮助加快此流程。 当确认很多计划订单时，此方法会很有用。

要使此功能在您的系统中可用，转到 [功能管理](../../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)，打开 *并行确认计划订单* 功能。 （从 Supply Chain Management 版本 10.0.21 开始，此功能默认开启。）

### <a name="enable-planned-order-firming-with-filtering"></a>启用通过筛选确认计划订单

通过筛选确认计划订单可以让您定义选择要确认的计划订单的逻辑条件。 您还可以预览选择了哪些计划订单，在后台运行流程和/或将其计划为批处理作业。

要使此功能在您的系统中可用，转到 [功能管理](../../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)，打开 *通过筛选确认计划订单* 功能。

### <a name="enable-auto-firming-for-planning-optimization"></a>启用计划优化自动确认

自动确认可以让您在确认时限内作为主计划流程的一部分确认计划订单。 Supply Chain Management 中内置的计划引擎始终支持自动确认。 但是，如果还要将它与计划优化一起使用，则必须打开此功能。

要使此功能在您的系统中可用，转到 [功能管理](../../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)，打开 *计划优化自动确认* 功能。 （从 Supply Chain Management 版本 10.0.21 开始，此功能默认开启。）

## <a name="manually-firm-planned-orders"></a>手动确认计划订单

要手动确认计划订单，查找并选择要确认的计划订单，然后手动开始确认流程。

1. [打开任何一个计划订单列表页](approved-planned-order.md#view-planned-orders)。
1. 使用 **筛选器** 字段、**计划** 字段和列标题对列表进行筛选和排序，以便您可以找到所需的计划订单。
1. 选择要确认的每个计划订单的复选框。 如果要确认页面上当前列出的所有计划订单（基于您应用的筛选器），请跳过此步骤。
1. 在操作窗格上，选择以下按钮之一：

    - **确认** – 仅确认选定的计划订单。
    - **全部确认** – 确认页面上当前列出的所有计划订单（基于您应用的筛选器），无论是否选中了任何复选框。 如果要确认很多计划订单，此选项会非常有用。

1. 在 **确认** 对话框中，在 **参数** 快速选项卡上，设置以下字段。 （这些字段中有很多从 **主计划参数** 页上的 **标准更新** 选项卡获取默认值。）

    - **更新标记** – 选择在确认生产订单时使用的库存标记策略。
    - **出错时停止确认** – 将此选项设置为 *是*，将在计划订单中有一个发生错误时停止确认所有选定的计划订单。 如果 **并行确认** 选项设置为 *是*，此选项必须设置为 *否*。
    - **并行确认** – 仅当系统中启用了 [*计划订单并行确认* 功能](#enable-features)且选择了两个或多个计划订单进行确认时，此选项才可用。 将它设置为 *是* 将并行运行确认流程。 并行确认可以帮助提高性能。
    - **线程数** – 仅当系统中启用了 [*计划订单并行确认* 功能](#enable-features)且您已将 **并行确认** 选项设置为 *是* 时，此选项才可用。 输入用于并行确认流程的线程数。 有关如何在主计划中使用此选项的建议，请参阅[改善主计划性能](../master-planning-performance.md#number-of-threads)。

        > [!NOTE]
        > **线程数** 字段的值为 *0*（零）会增加主计划的运行时间。 因此，我们建议您始终将此字段设置为大于 0 的值。

    - **按供应商进行分组** – 将此选项设置为 *是* 将对计划采购订单进行分组，并在确认期间为每个供应商创建一个采购订单。 或者，您可以创建一个每一行对应一个计划订单的采购订单。
    - **按采购员组进行分组** – 将此选项设置为 *是* 会将计划采购订单进行分组，并创建一个将供应商和采购员组合并的采购订单。 要使用此选项，您还必须将 **按供应商进行分组** 选项设置为 *是*。
    - **按采购协议分组** – 将此选项设置为 *是* 可以将与现有采购协议具有相同供应商的计划采购订单分组到一起，并为每个采购协议创建一个采购订单。 当启用 **按供应商进行分组** 时，此选项会自动启用。 要使用 **按采购协议分组**，**主计划参数** 页上的 **查找采购协议** 必须设置为 *是*。
    - **按期间进行分组**（在 **采购订单** 部分）– 选择用于分组计划采购订单的期间。 若要使用此选项，还必须选择 **按供应商进行分组** 选项。
    - **按期间进行分组**（在 **转移** 部分）– 选择用于分组计划转移单的期间。 订单将基于 **源仓库** 和 **目标仓库** 值进行分组。

    > [!NOTE]
    > 每个“分组依据”选项都会导致系统将每个计划订单转换为单个采购订单中的行，该采购订单是分组的结果。

    ![“确认”对话框中的“参数”快速选项卡。](./media/manual-firming.png "“确认”对话框中的“参数”快速选项卡")

1. 在 **在后台运行** 快速选项卡上，设置作业，使其以批处理模式运行。 但是，在进行手动确认时，设置定期计划是没有意义的。 这些字段的工作方式与它们用于 Supply Chain Management 中其他类型的[后台作业](../../../fin-ops-core/dev-itpro/sysadmin/batch-processing-overview.md)时一样。 但是，对于手动确认，批处理作业将仅处理当前选择的计划订单。 它不会处理与页面上当前应用的筛选器相符的任何订单。
1. 选择 **确定** 应用设置并生成确认的订单。

## <a name="auto-firm-planned-orders"></a>自动确认计划订单

自动确认可以使您作为主计划流程的一部分确认计划订单。 您可以为覆盖范围组、单个物料以及物料与主计划的组合定义确认时限。 然后，在主计划运行期间，如果订单日期在指定的确认时限内，将自动确认计划订单。 由计划优化和内置主计划操作生成的计划订单以不同的方式处理订单日期（即开始日期）。

> [!NOTE]
> 计划采购订单的自动确认仅适用于与供应商关联的物料。
> 
> 如果启用了更改跟踪，已确认的派生订单（即分包采购订单）的状态将为 *正在审核*。

> [!IMPORTANT]
> 必须先在系统中打开 [*计划优化自动确认* 功能](#enable-features)，才能将本节中所述的功能与计划优化一起使用，如本主题开头所述。 自动确认始终可以与内置的主计划引擎一起使用。

### <a name="auto-firming-with-planning-optimization-vs-the-built-in-planning-engine"></a>使用计划优化与内置计划引擎进行自动确认

计划优化和内置计划引擎都可以用来自动确认计划订单。 不过，也存在某些重要差异。 例如，计划优化使用订单日期（即开始日期）来确定要确认的计划订单，而内置计划引擎则使用要求日期（即结束日期）。 下表总结了它们之间的不同。

| 功能 | 计划优化 | 内置计划引擎 |
|---|---|---|
| **日期基数** | 自动确认基于订单日期（开始日期）。 | 自动确认基于需求日期（结束日期）。 |
| **提前期** | 由于订单日期（开始日期）触发确认，因此您不必将提前期视为确认时限的一部分。 | 为了帮助确保及时确认订单，确认时限必须长于提前期。 |
| **当前一周的订单** | 要确认必须在当前一周开始的所有订单，则确认时限必须为一周。 | 要确认必须在当前一周开始的所有订单，则确认时限必须为提前期再加上一周时间。 |

### <a name="set-up-auto-firming-and-the-firming-time-fence"></a>设置自动确认和确认时限

您可以通过为相关的覆盖范围设置分配自动确认时限来启用自动确认，如本节稍后所述。 如果未为任何覆盖范围设置打开自动确认，或者计划从特定页面开始，如已发布产品的 **净要求** 页，将跳过自动确认流程。

用于自动确认的分组和标记选项从 **主计划参数** 页上的 **标准更新** 选项卡获取值。

自动确认时限由您为相关覆盖范围设置输入的天数定义。 您可以通过以下方式启用自动确认和控制确认时限：

- 要定义覆盖范围组的默认确认时限，转到 **主计划 \> 设置 \> 覆盖范围 \> 覆盖范围组**，并选择一个覆盖范围组。 然后，在 **其他** 快速选项卡上的 **自动确认时限(天)** 字段中，输入天数。
- 要覆盖为特定物料的覆盖范围组定义的确认时限，转到 **产品信息管理 \> 已发布产品**。 在操作窗格上，选择 **计划**，然后选择 **物料覆盖范围**。 在 **常规** 选项卡上，选择 **替代时限**，然后在 **自动确认时限(天)** 字段中输入天数。
- 要覆盖为特定主计划的覆盖范围组和物料覆盖范围定义的确认时限，转到 **主计划 \> 设置 \> 主计划**，选择一个主计划。 然后，在 **时限(天)** 快速选项卡上，将 **确认** 选项设置为 *是*，然后输入天数。

如果您将前面提到的所有时限都设置为 *0*（零），实际将禁用相关覆盖物料的自动确认。

## <a name="firm-planned-orders-by-using-a-query"></a>使用查询确认计划订单

基于查询的确认可让您根据预先定义的条件来计划确认。 与自动确认不同，基于查询的确认允许在不同的时间点自动确认订单的不同子集。 此外，您还可以使用手动或自动操作来确认不同类型的计划订单。 您还可以根据您的设置预览选择了哪些确认的订单。 因此，您可以确认所作的选择符合您的预期。

您可以将自动确认与基于查询的确认相结合。 例如，基于查询的确认作业的向前时限比匹配的自动确认覆盖范围配置的时限长。 因此，基于查询的确认作业将在自动确认触发之前处理计划订单。 您可以利用此行为，以与计划其他供应商的类似产品的订单所不同的方式，计划特定供应商的订单。

> [!IMPORTANT]
> 必须先在系统中打开 [*通过筛选确认计划订单* 功能](#enable-features)，才能使用本节中所述的功能，如本主题开头所述。

要使用基于查询的确认流程确认计划订单，请按照下列步骤操作。

1. 转到 **主计划 \> 主计划 \> 运行 \> 计划订单确认**。
1. 在 **计划订单确认** 对话框的 **参数** 快速选项卡上，设置基本处理、标记和分组选项。 这些选项的工作方式与它们在 **确认** 对话框中的工作方式相同。 （有关说明，请参阅上一节。）然后，在 **计划** 部分，设置 **计划订单确认** 对话框特有的以下字段：

    - **计划** – 选择在确认此查询找到的计划订单期间应该应用的主计划。
    - **确认向前时限(天)** – 选择主计划必须计算将来多长时间范围内的各个要求和其他注意事项。
    - **确认向后时限(天)** – 选择主计划必须计算过去多长时间范围内的各个要求和其他注意事项。

    ![“计划订单确认”对话框中的“参数”快速选项卡。](./media/planned-order-firming-main-1.png "“计划订单确认”对话框中的“参数”快速选项卡")

1. 要指定订单中应包含哪些记录，选择 **要包括的记录** 快速选项卡上的 **筛选器** 按钮。 将出现一个标准查询对话，您可以在其中定义选择条件、排序条件和联接。 这些字段的工作方式与它们用于 Supply Chain Management 中其他类型的查询时一样。 此处的字段是只读的，显示与您的查询相关的值。

    ![“计划订单确认”对话框上的“要包括的记录”快速选项卡。](./media/planned-order-firming-main-2.png "“计划订单确认”对话框上的“要包括的记录”快速选项卡")

1. 选择 **预览** 根据您到目前为止的设置预览已确认订单的内容。 将确认的计划订单列表显示为一条消息。 然后，您可以根据需要调整设置，直到预览显示您预期的确认订单。

    ![确认订单预览的示例。](./media/planned-order-firming-preview.png "确认订单预览的示例")

    > [!WARNING]
    > 此功能将确认所有符合筛选条件的计划订单。 不加选择地确认计划订单可能会导致产生大量不需要的采购订单、转移单和生产订单。 在继续之前，请始终使用 **预览** 按钮验证要包括的记录。

1. 在 **在后台运行** 快速选项卡上，设置作业，使其以批处理模式运行，和/或设置定期计划。 这些字段的工作方式与它们用于 Supply Chain Management 中其他类型的[后台作业](../../../fin-ops-core/dev-itpro/sysadmin/batch-processing-overview.md)时一样。
1. 选择 **确定** 应用设置并生成确认的订单。

## <a name="track-firmed-orders"></a>跟踪确认的订单

要跟踪已确认的计划订单，请按照下列步骤操作。

1. [打开任何一个计划订单列表页](approved-planned-order.md#view-planned-orders)。
1. 打开或选择要跟踪的计划订单。
1. 在操作窗格的 **视图** 选项卡上，在 **视图** 组中，选择 **确认历史记录**。

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
