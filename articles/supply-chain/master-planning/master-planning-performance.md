---
title: 改进主计划绩效
description: 本主题介绍可帮助您提高主计划绩效或诊断问题的各种选项。
author: t-benebo
ms.date: 12/18/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ReqCreatePlanWorkspace
audience: Application User
ms.reviewer: kamaybac
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Manufacturing
ms.author: benebotg
ms.search.validFrom: 2019-05-31
ms.dyn365.ops.version: AX 10.0.0
ms.openlocfilehash: 27c1f910fc9fa533877726562c45a9eaa13e2858
ms.sourcegitcommit: 9283caad2d0636f98579c995784abec19fda2e3f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/22/2021
ms.locfileid: "5935801"
---
# <a name="improve-master-planning-performance"></a>改善主计划性能

[!include [banner](../includes/banner.md)]

本主题介绍可帮助您提高主计划绩效或诊断问题的各种选项。 包括有关参数、设置，以及建议的配置和操作的信息。 另外还包括需要执行长时间运行的主计划作业时应考虑的所有重要参数的摘要。

本主题面向有能力进行故障诊断的系统管理员或 IT 用户。 也面向生产或供应规划员，因为其中包含有关与业务计划需求有关的参数的信息。 

## <a name="parameters-related-to-master-planning-performance"></a>与主计划绩效有关的参数

许多参数会影响主计划的运行时间，因此应加以注意。

### <a name="number-of-threads"></a>线程数

可通过 **线程数** 参数调整主计划编制流程，以便在使用特定数据集时改善效果。 此参数指定将用于运行主计划的线程总数。 它会导致主计划运行并行化，这有助于缩短运行时间。 

可设置 **主计划运行** 对话框中的 **线程数** 参数。 若要打开此对话框，请转到 **主计划 \> 主计划 \> 运行 \> 主计划**，或在 **主计划** 工作区中选择 **运行**。 若要确定此参数的最佳值，必须依赖试错流程。 但是，可使用以下公式计算初始值：

- **如果您的行业是制造业：**（线程数）=（计划订单数 ÷ 1,000）
- **否则：**（线程数）=（物料数 ÷ 1,000）

主计划期间使用的帮助程序数必须小于或等于批处理服务器上允许的最大线程数。 如果帮助程序数超过了批处理服务器上的线程数，多余线程不起任何作用。

> [!NOTE]
> 将 **线程数** 参数设置为 **0**（零）会增加主计划运行时间。 因此，建议设置的值始终大于 0。

### <a name="number-of-tasks-in-helper-task-bundle"></a>帮助程序任务捆绑中的任务数

通过更改 **任务捆绑中的任务数** 设置（即捆绑大小），可能能够缩短运行时间。 此设置控制一个帮助程序一起计划的物料的数量。

可设置 **主计划参数** 页（**主计划 \> 设置 \> 主计划参数**）的 **常规** 选项卡上 **绩效** 部分中的 **任务捆绑中的任务数** 参数。 此参数的最佳值取决于您的数据。 因此，建议您从值 **1** 开始，然后通过试错流程确定您的设置的最佳值。

我们通常建议您在物料数极大（成千上万）时增加任务数。 否则，应减少任务数。 对于以下特定行业，请考虑以下建议：

- 在零售和配送行业，独立物料很多，请使用大量帮助程序，因为物料之间不存在依赖关系。 
- 在制造行业，物料清单 (BOM) 和共用子组件很多，请使用较少帮助程序，因为物料之间的依赖关系可能会导致等待时间。

> [!TIP]
> 如果遇到了性能问题，建议将 **任务捆绑中的帮助程序数** 设置减少为 **1**。 然后可以开始执行试错流程，以便找到您的设置的最佳值。 一般来说，一个物料的处理时间比其余物料长时，通常会出现性能问题。 在此情况下，您会发现主计划运行中两个状态为 **覆盖** 的后续任务所用运行时间量相差很大。 极端情况下，相差可能高达 30 分钟。 可以通过查看每个任务的持续时间推导运行任务所用时间量。

### <a name="use-of-cache"></a>暂存区的使用

可通过 **暂存区的使用** 参数调整主计划编制流程，以便在使用特定数据集时效果更出色。 例如，可通过调整此参数实现以下结果：

- 完成的缓存越多，数据存储器中收集的数据越多。 预计以后会再次使用这些数据。 如果数据在存储器中，可以节约一些数据库请求。 但是，完成的缓存越多，需要的存储器越大。
- 如果完成的缓存越少，可能必须从数据库访存相同数据的频率越高。 此外，应用程序对象服务器 (AOS) 在整个流程中存储到内存中的数据越少。

很难预测哪个选项更好，因为每种情况都不仅依赖数据，还依赖硬件。 例如，因为缓存越少，对数据库服务器造成的负载就越大，所以如果数据库服务器已过载，则不太适合使用该选项。

可设置 **主计划参数** 页（**主计划 \> 设置 \> 主计划参数**）的 **常规** 选项卡上 **绩效** 部分中的 **暂存区的使用** 参数。 缓存的效果很大程度依赖于客户数据。 例如，如果从不需要缓存数据，则将数据存储到计划编制流程结束为止只会浪费内存。 在此情况下，如果配置的缓存较少，性能可能上升，因为 AOS 需要的内存较少，并且会释放服务器资源供其他任务使用。

> [!TIP]
> 总之，建议将 **暂存区的使用** 参数设置为 **最大值**，因为该参数应该是一项性能增强功能。 如果在本地部署上运行，并且内存有限（大约 2 \[GB\]），则建议将此参数设置为 **最小值**。

### <a name="number-of-orders-in-firming-bundle"></a>固定捆绑销售中的订单数

**固定捆绑销售中的订单数** 参数指定每个线程/批处理同时处理的订单总数。 这会导致自动确认流程并行化。

可设置 **主计划参数** 页（**主计划 \> 设置 \> 主计划参数**）的 **常规** 选项卡上 **绩效** 部分中的 **固定捆绑销售中的订单数** 参数。 自动确认流程的并行化基于必须一起处理的订单。 例如，如果此参数设置为 **50**，则每个线程或批处理一次性选取 50 个订单并一起处理。 建议通过试错流程找到最佳值。 但是，可使用以下公式计算初始值：

（每个捆绑销售的订单数）=（需求物料数 ÷ 线程数）

> [!NOTE]
> 如果将 **固定捆绑销售中的订单数** 参数设置为 **0**（零），则不会并行化自动确认流程。 整个流程将对一个批处理任务运行，并且会具有累计运行时间。 因此，主计划的运行时间将增加。 所以建议您将此参数设置为大于 **0**（零）的值。

### <a name="time-fences"></a>时限

时限指定主计划计算将来多长时间范围内的计算和其他需求。 时限越大，主计划的运行时间越久。 因此，请根据您的业务要求设置时限。 有关时限的详细信息，请参阅[设置主计划](master-planning-setup.md)。

### <a name="actions"></a>行为

还可以在时限中找到 **行动消息** 参数。 计算行动消息会导致主计划的运行时间更长。 如果不定期（每天、每周等）分析和采用行动消息，请考虑在主计划运行期间关闭计算。 若要关闭计算，请在 **主计划** 页（**主计划 \> 设置 \> 计划 \> 主计划**）上，将 **行动消息** 时限设置为 **0**（零）。 并确保为所有覆盖范围组关闭 **行动消息** 设置。

### <a name="futures"></a>预期

计算预期会导致主计划的运行时间更长。 如果不计划 BOM，或者计划期间不必将延迟从供应传播到需求，请考虑在主计划期间关闭预期计算。 若要关闭这些计算，请将正在运行的主计划的 **预期** 时限设置为 **0**（零）。 并确保为所有覆盖范围组关闭 **预期** 设置。

## <a name="one-heavy-routine-at-a-time"></a>一次一个重大例程

安排主计划时，请勿同时安排其他任何批处理作业。 请务必小心，不要同时安排其他任何重大例程，如库存结转。

## <a name="review-the-session-log"></a>检查会话日志

系统可收集有关主计划期间运行的任务的其他信息。 若要让系统收集此信息，请开启 **主计划运行** 对话框中的 **跟踪处理时间** 设置。 收集的信息可帮助您找到运行中的瓶颈。 例如，如果 **帮助程序任务捆绑中的任务数** 参数设置为 **1**，则可识别运行时间最长的物料。 也可以比较状态为 **覆盖** 的大量线程的运行时间，以及比较每个任务的持续时间。

若要查看系统的主计划运行，请执行以下步骤之一。

- 在 **主计划** 工作区的下拉字段中选择一个主计划，然后在 **主计划** 磁贴中选择 **历史记录**。 选择一个作业，在快速选项卡上选择 **查询**，然后选择 **流程任务持续时间**。
- 在 **主计划** 页的左窗格中选择一个计划，然后在快速选项卡上选择 **历史记录**。 选择一个作业，在快速选项卡上选择 **查询**，然后选择 **流程任务持续时间**。

查看会话日志时，请注意以下几点：

- **更新** 应该不用太长时间（通常应该最多 30 分钟），但是单线程的。
- **复制计划** 应该不用太长时间（应该大约一分钟）。
- **自动固定** 所用时间通常大约 30 分钟。 但是，可以高达数小时，具体取决于订单数量和物料的复杂程度。
- **自动固定** 的时间应该低于 **覆盖**。
- **覆盖** 所用时间相对其他操作应该最长。
- **行动** 和 **预期消息** 所用时间可能很长，具体取决于数据和 BOM 数量。

## <a name="filtering-of-items"></a>筛选物料

**主计划运行** 对话框中的筛选器会影响主计划运行的持续时间。 转到 **主计划 \> 主计划 \> 运行 \> 主计划**，或在 **主计划** 工作区中选择 **运行**。 若要从运行中排除物料，建议按物料的生命周期状态（而不是按物料编号）进行筛选。 按生命周期状态筛选所用时间比按物料编号筛选所用时间短。

## <a name="automatically-filter-by-items-with-direct-demand"></a>根据直接需求按物料自动筛选

为了缩短主计划运行时间，您可以选择仅包含有直接需求的物料。 整个主计划运行只能使用此筛选器，**要包括的记录** 字段不应用其他筛选器。 具有筛选器的主计划运行将忽略 **根据直接需求按物料自动筛选** 设置。

**根据直接需求按物料自动筛选** 字段位于 **主计划参数** 页，可以与预处理和后处理设置一起使用。

### <a name="pre-processing"></a>预处理
**预处理: 根据直接需求按物料自动筛选** 参数确保主计划的预处理阶段仅包含至少满足以下条件之一的物料：
  - 物料具有按预期的收货或发货，例如采购订单、销售订单、报价单、转移单或生产订单。 
  - 物料具有设有安全存货的物料覆盖范围（最小现有库存量）。
  - 物料存在今天以后的预测需求。
  - 物料存在今天以后的预测供应。
  - 物料包括尚未创建的呼叫中心模块的所有连续性行。

> [!NOTE]
> 具有实际可用现有库存量的物料不会显示需求交易记录，因为没有针对物料的需求。

### <a name="post-processing"></a>后处理
**后处理: 根据直接需求按物料自动筛选** 选项仅在您在覆盖范围组中设置了 **物料清单版本要求** 时才有作用。 否则，您无需启用此参数。 

在覆盖步骤开始之前，有一个预覆盖步骤，在此步骤中，覆盖范围设置 **物料清单版本要求** 启用的物料将被重新处理。 这样做是为了确保已计划所需物料清单版本的物料。 在预处理期间被认为有需求的物料不再有需求，因此应将其从计划运行中排除。

## <a name="performance-checklist-summary"></a>绩效核对清单摘要

- **线程数** – 设置为大于 **0**（零）的值。
- **帮助程序任务捆绑中的任务数** – 设置为大于 **0**（零）的值。 （请使用本主题前面提供的公式。）
- **暂存区的使用** – 除非系统的内存较低，否则设置为 **最大值**。
- **固定捆绑销售中的订单数** – 设置为大于 **0**（零）的值。 （请使用本主题前面提供的公式。）
- **时限** – 根据您的业务需要调整。
- **操作和先期备货** – 如果不使用操作和先期备货，请禁用。
- **一次一个重大例程** – 请勿将主计划与其他任何重大例程一起运行。
- **检查会话日志。**
- **筛选物料** – 使用生命周期状态从主计划运行中排除物料。 （请勿使用物料编号。）


[!INCLUDE[footer-include](../../includes/footer-banner.md)]