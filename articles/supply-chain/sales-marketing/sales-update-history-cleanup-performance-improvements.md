---
title: 计划销售历史记录数据清理
description: 本文介绍如何通过计划以定期销间隔运行的售更新历史记录清理定期任务来帮助提高系统性能。
author: myvakalo
ms.date: 03/21/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: myvakalo
ms.search.validFrom: 2021-09-29
ms.dyn365.ops.version: 10.0.19
ms.openlocfilehash: 1b2c9436fbb5020065f8f6ec30eedeca342d8aa9
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/03/2022
ms.locfileid: "8900816"
---
# <a name="schedule-sales-history-data-cleanup"></a>计划销售历史记录数据清理

[!include [banner](../includes/banner.md)]

作为其标准操作的一部分，Microsoft Dynamics 365 Supply Chain Management 会持续生成和存储销售历史记录更新数据。 随着时间的推移，您的系统中可能会积累大量过时的销售历史记录数据。 当过帐与销售订单相关的文档时，这些累积的数据可能会导致性能和功能问题。 （这些文档包括销售订单确认、销售装箱单、销售领料单和发票）。 因此，您应该设置并计划以定期间隔运行的 *销售更新历史记录清理*。 此任务将删除不再需要的所有销售历史记录更新数据。

如果您使用 *销售更新历史记录清理* 定期任务，我们建议您启用 *销售历史记录清理性能改进* 功能，这会使任务更有效地运行。 （不过，您也可以在不启用此功能的情况下运行任务。）

## <a name="turn-on-the-sales-history-cleanup-features"></a>启用销售历史记录清理功能

要设置和使用 *销售更新历史记录清理* 定期任务以及本文中所述的所有功能，您必须在“功能管理”中启用 *销售历史记录清理性能改进* 和 *根据使用时间清理销售更新历史记录*，如以下各小节所述。

### <a name="sales-history-cleanup-performance-improvements"></a>销售历史记录清除性能改进

如果 **销售更新历史记录清理** 定期批处理作业不是经常在具有大量销售更新的环境中运行，可能会花费很长时间。 在这些情况下，*销售历史记录清理性能改进* 功能可以帮助减少运行持续时间并提高可靠性。

此功能用以下方式改进现有清理作业：

- 它将清理拆分为批处理（您可以通过自定义来更改批处理大小）。
- 它将最多运行 2 小时（您可以通过自定义来更改持续时间）。
- 在可能的情况下，它将利用数据库功能来最大程度地减少锁定争用，和避免在清理过程中加入交易表。

启用此功能后，**销售更新历史记录清理** 批处理作业（**销售和市场营销 \> 期间任务 \> 清理 \> 销售更新历史记录清理**）将像以前一样运行，但性能更好，最多运行 2 小时。 这意味着可能需要运行多次才能清理特定保留期限内的所有数据。

必须在系统中开启此功能，然后才能使用。 管理员可以使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)设置检查功能状态和开启功能。 在 **功能管理** 工作区中，此功能按照下面的方式列出：

- **模块**：*销售和市场营销*
- **功能名称**：*销售历史记录清理性能改进功能*

### <a name="clean-up-sales-update-history-based-on-age"></a>根据使用时间清除销售更新历史记录

*根据使用时间清理销售更新历史记录* 功能可让您指定在运行 *销售更新历史记录清理* 定期任务时要保留记录的最长期限。 较早的记录将被删除。 此功能在您将任务设置为定期运行时很有用，因为年限始终是相对于任务运行的日期计算的。 如果不使用此功能，您只能为要保留的最早记录设置特定日期。

必须在系统中开启此功能，然后才能使用。 管理员可以使用[功能管理](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)设置检查功能状态和开启功能。 在 **功能管理** 工作区中，此功能按照下面的方式列出：

- **模块**：*销售和市场营销*
- **功能名称**：*根据使用时间清除销售更新历史记录*

## <a name="set-up-and-schedule-the-sales-history-cleanup-periodic-task"></a>设置和计划销售历史记录清理定期任务

要设置和计划 *销售历史记录清理* 定期任务，请执行以下步骤。

1. 分析您的业务需求，确定您必须保留多少天的历史销售订单过帐数据。 我们通常建议您每三个月运行一次清理任务，最多每六个月运行一次。
1. 转到 **销售和市场营销 \> 定期任务 \> 清理 \> 销售更新历史记录清理**。
1. 在 **清理销售更新历史记录** 对话框中，在 **参数** 快速选项卡上，设置以下字段：

    - **清理** – 选择以下值之一来指定要清理的记录类型：

        - **已执行** – 仅删除已完全处理的记录。 因为您不太可能进一步使用这些记录，所以此选项是最安全的。
        - **已执行与出错** – 删除完全处理的记录和发生错误的记录。 此选项最常用。 您可能想要检查甚至修复错误记录，而不是让它们自动清理。 但是，很多公司同时会选择在大约一个月后清理这些记录，因为到那时这些记录可能不再有用。
        - **所有** – 删除已执行、有错误和等待的记录。 等待记录是有效的，但还未完全处理。 在大多数情况下，您可能不希望它们被自动删除。 但是，在某些情况下，您可能会选择在经过特定时间后自动删除它们。

    - **根据使用时间保留记录** – 指定是要根据任务运行当天的使用时间来清理记录，还是要删除在固定日期之前创建的记录。 如果您将清理计划为定期任务，则应将此选项设置为 *是*，因为使用时间始终是相对于任务运行的日期计算的。

        - 将此选项设置为 *是* 将启用 **最长使用时间** 字段。 您可以使用此字段指定每次运行任务时要保留的记录的最长期限。 **此日期前创建** 字段将被忽略。
        - 将此选项设置为 *否* 将启用 **此日期前创建** 字段。 您可以使用此字段指定任务运行时要保留的记录的最早创建日期。 **最长使用时间** 字段将被忽略。

    - **此日期前创建** – 此设置仅在 **根据使用时间保留记录** 选项设置为 *否* 时应用。 指定任务运行时要保留的记录的最早创建日期。 在此日期之前创建的记录将被删除。
    - **最长使用时间** – 此设置仅在 **根据使用时间保留记录** 选项设置为 *是* 时应用。 指定每次运行任务时要保留的记录的最长期限（天）。 较早的记录将被删除。

1. 在 **在后台运行** 快速选项卡上，指定任务运行的方式、时间和频率。 使用这些设置来实施您在步骤 1 中确定的计划。 这些字段的工作方式与它们用于 Supply Chain Management 中其他类型的[批处理作业](../../fin-ops-core/dev-itpro/sysadmin/batch-processing-overview.md)时一样。
1. 选择 **确定** 应用设置并关闭对话框。
