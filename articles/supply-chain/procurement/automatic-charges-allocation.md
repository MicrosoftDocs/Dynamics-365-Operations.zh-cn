---
title: 自动分配费用
description: Microsoft Dynamics 365 Supply Chain Management 中的费用功能帮助您自动将费用分配给采购订单或销售订单。
author: dasani-madipalli
ms.date: 10/01/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: damadipa
ms.search.validFrom: 2020-10-01
ms.dyn365.ops.version: Release 10.0.15
ms.openlocfilehash: 04e17947073fca63ab68f0b5d0d72eb8366a1600117f61851179e8b0ed2c8184
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/05/2021
ms.locfileid: "6753931"
---
# <a name="automatic-allocation-of-charges"></a>自动分配费用

[!include [banner](../includes/banner.md)]

基于您与之合作的客户或所销售的物料，您可能需要应用特定的附加费用。 Microsoft Dynamics 365 Supply Chain Management 中的 *费用* 功能帮助您自动将费用分配给采购订单或销售订单。

在创建销售订单或采购订单时将自动应用自动费用。 您可以定义特定供应商、客户、供应商组或物料的自动费用。 还可以定义适用于所有供应商、客户或物料的自动费用。

## <a name="set-up-charges-codes"></a>设置费用代码

若要分配费用，您必须首先定义费用代码。

1. 按以下步骤之一：

    - 对于采购订单：转到 **应付帐款 \> 费用设置 \> 费用代码**。
    - 对于销售订单：转到 **应收帐款 \> 费用设置 \> 费用代码**。

1. 在“操作”窗格中，选择 **新建** 以创建费用代码。
1. 在新记录的标题中，设置以下字段：

    - **费用代码** – 输入费用的代码。
    - **描述** – 输入费用的描述。
    - **物料销售税组** – 选择一个物料销售税组（如果适用）。
    - **按比例分配** – 如果您想要按比例分配费用，将此选项设置为 *是*。 此选项仅适用于销售订单。
    - **最大金额** – 输入费用代码允许的最大金额。 此字段用于验证供应商发票的费用。 仅适用于采购订单。

        > [!NOTE]
        > 若要打开用于验证采购订单费用的功能，请转到 **应付帐款 \> 设置 \> 应付帐款参数**。 在 **发票验证** 快速选项卡上的 **发票验证** 部分中，将 **启用发票匹配验证** 选项设置为 *是*。

1. **过帐** 快速选项卡包括 **借方** 和 **贷方** 部分。 设置以下字段，具体取决于要将费用过帐到的分类帐：

    - **类型** – 选择要过帐到的帐户类型（*分类帐*、*客户* 或 *物料*）。
    - **过帐** – 选择要创建的过帐类型（例如 *代理人费用* 或 *客户结算*）。
    - **帐户** – 选择要为其过帐的帐户。

1. 在操作窗格上，选择 **保存**。

## <a name="create-charge-groups"></a>创建费用组

费用组自动将特定费用分配给一组客户或供应商。 以下子部分介绍了如何创建和分配这些费用组。

### <a name="charge-groups-for-purchase-orders"></a>采购订单的费用组

若要创建采购订单的费用组，请按照下列步骤操作。

1. 转到 **应付帐款 \> 费用设置 \> 供应商费用组**。
1. 在“操作”窗格上，选择 **新建** 以向网格添加一行，然后设置以下字段：

    - **费用组** – 输入费用组的名称。
    - **描述** – 输入费用组的描述。

1. 在操作窗格上，选择 **保存**。
1. 转到 **应付帐款 \> 供应商 \> 所有供应商**，然后打开现有供应商或创建新供应商。
1. 在 **采购订单默认值** 快速选项卡上的 **采购订单** 部分中，将 **费用组** 字段设置为您刚创建的费用组。

### <a name="charge-groups-for-sales-orders"></a>销售订单的费用组

若要创建销售订单的费用组，请按照下列步骤操作。

1. 转到 **应收帐款 \> 费用设置 \> 客户费用组**。
1. 在“操作”窗格上，选择 **新建** 以向网格添加一行，然后设置以下字段：

    - **费用组** – 输入费用组的名称。
    - **描述** – 输入费用组的描述。

1. 在操作窗格上，选择 **保存**。
1. 转到 **应收帐款 \> 客户 \> 所有客户**，或者打开现有客户或创建新客户。
1. 在 **采购订单默认值** 快速选项卡上的 **销售订单** 部分中，将 **费用组** 字段设置为您刚创建的费用组。

## <a name="define-auto-charges"></a>定义自动费用

在设置费用代码后，请按照以下步骤定义自动费用。

1. 按以下步骤之一：

    - 对于采购订单：转到 **采购 \> 设置 \> 费用 \> 自动费用**。
    - 对于销售订单：转到 **应收帐款 \> 设置 \> 费用设置 \> 自动费用**。

1. 在列表窗格的 **级别** 字段中，选择您的自动费用适用的级别：

    - *主* – 将费用应用到订单头。
    - *行* – 将费用应用到订单行。

1. 选择现有的自动费用进行编辑，或选择 **新** 以定义新的自动费用。
1. 在 **帐户代码** 列表中，选择以下值之一以指定将受影响的帐户范围：

    - *表* – 将费用分配给特定客户或供应商。
    - *组* – 将费用分配给杂项费用组。
    - *所有* – 将费用分配给所有客户或供应商。

1. 如果将 **帐户代码** 字段设置为 *表*，在 **客户关系** 或 **供应商关系** 字段中，选择特定客户或供应商。 如果将 **帐户代码** 字段设置为 *组*，选择客户或供应商费用组。
1. 在 **物料代码** 字段中，选择以下值之一以指定将受影响的物料范围。 仅当在行级别上定义自动费用时才可以选择物料代码。

    - *表* – 将费用分配给特定物料。
    - *组* – 将费用分配给物料费用组。
    - *所有* – 将费用分配给所有物料。

1. 如果将 **物料代码** 字段设置为 *表*，在 **物料关系** 字段中，选择特定物料。 如果将 **物料代码** 字段设置为 *组*，选择物料费用组。
1. **仅适用于销售订单：** 在 **交货方式代码** 字段中，选择以下值之一以指定将受影响的交货方式的范围：

    - *表* – 将费用分配给特定的交货方式。
    - *组* – 将费用分配给交货方式组。
    - *所有* – 将费用分配给所有交货方式。

1. **仅适用于销售订单：** 如果将 **交货方式代码** 字段设置为 *表*，在 **交货方式关系** 字段中，选择特定的交货方式。 如果将 **交货方式代码** 字段设置为 *组*，选择交货方式组。
1. 在 **行** 快速选项卡上，定义将在应用自动费用时使用的费用和费用比率。 您可以使用此快速选项卡上的工具栏根据需要添加任意数量的行。 对于每一行，设置以下字段：

    - **货币** – 选择应该用于计算费用的货币。
    - **费用代码** – 选择费用的代码。
    - **类别** – 选择以下值之一：

        - *固定* – 该费用在行上作为固定金额输入。 固定费用可同时用于订单头和订单行中的费用。
        - *件* – 费用基于单位计算。 这些费用只能用于订单行。 它们将在您计算订单合计时出现。
        - *百分比* – 该费用在行上作为百分比输入。 百分比费用可同时用于订单头和订单行中的费用。
        - *内部公司百分比* – 该费用在内部公司订单的行上作为百分比输入。 内部公司百分比费用仅可用于订单行。
        - *外部* – 通过与一个或多个装运承运人关联的第三方服务计算该费用。

    - **费用值** – 根据您选择的类别输入费用值。
    - **费用货币代码** – 如果您要使用在 **货币** 字段中指定的货币以外的货币，请指定费用的货币。 如果将所选费用代码的 **借方类型** 或 **贷方类型** 字段设置为 *分类帐帐户* 或 *物料*，仅可以使用不同的货币。
    - **起始金额** – 指定将自动费用应用到的开始金额。 在此情况下，金额引用订单合计。
    - **终止金额** – 指定将自动费用应用到的结束金额。 在此情况下，金额引用订单合计。
    - **销售税组** – 指定销售税组。
    - **站点** 和 **仓库** – 如果仅针对特定的站点和仓库应用费用，指定站点和仓库。
    - **保留** – 选中此复选框以在完成开票后保留这些费用交易记录，以便每次为所选客户帐户创建新发票时应用该费用。

1. **仅适用于销售订单：** 如果您想要计算分层费用，请参阅[销售订单上的分层费用](/dynamicsax-2012/appuser-itpro/about-tiered-charges-on-sales-orders)以获取相关信息。

## <a name="allocate-charges-from-the-header-to-a-line"></a>将费用从标头分配到行

以下过程显示了如何将标头级费用分配到行。 在开始此过程之前，您应该已经有 *固定金额* 类型的标头级费用和将应用该费用的订单。 此外，该订单应该已包括至少一个行项。

1. 打开采购订单或费用订单。
1. 在“操作”窗格上，请按照下列步骤之一操作：

    - 对于采购订单：在 **购买** 选项卡上的 **费用** 组中，选择 **分配费用**。
    - 对于销售订单：在 **销售** 选项卡上的 **费用** 组中，选择 **分配费用**。

1. 在 **将费用分配给订单行** 对话框中，设置以下字段：

    - **费用分配** – 选择以下值之一以指定应如何分配费用：

        - *净额* – 根据每行金额相对于总净额分配费用。
        - *数量* – 根据每行的单位数量相对于单位总数分配费用。
        - *每行* – 根据总行数平均分配费用。

    - **将费用分配给行** – 选择一个值以指定是应该将费用分配给所有行、仅分配给正数行还是仅分配给负数行。
    - **分配所有** – 选中此复选框以将费用分配给订单行，即使费用代码具有借方类型而不是 *物料*。
    - **已收货** – 选中此复选框以将费用仅分配给已收货的订单行。
    - **已贮存** – 选中此复选框以将费用仅分配给库存订单行。
    - **显示所选内容并清除特定行** – 选中此复选框以从此分配中排除特定行。 当选中此复选框时，将打开 **选择要从分配中排除的行** 网格。 此网格仅包括与 **将费用分配给行** 和 **已贮存** 设置中定义的条件相匹配的行。 例如，如果将 **将费用分配给行** 字段设置为 *正数行* 并选中 **已贮存** 复选框，则网格仅显示正数行和库存行。 此外，网格将自动筛选掉已收到全部数量的所有行。 打开网格后，对于应该从分配中排除的每个行，清除 **包括** 复选框。 

        > [!IMPORTANT]
        > 当使用 **选择要从分配中排除的行** 网格时，请确保在选择 **分配** 之前将网格保持打开状态。 如果在选择 **分配** 之前关闭网格，您在网格中的设置将丢失。 因此，将根据您先前定义的条件分配费用。

1. 选择 **分配** 以应用设置并关闭对话框。


[!INCLUDE[footer-include](../../includes/footer-banner.md)]