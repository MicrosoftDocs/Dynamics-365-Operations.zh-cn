---
title: 开始使用税款计算
description: 本文说明如何设置税务计算。
author: wangchen
ms.date: 03/25/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: TaxIntegrationTaxServiceParameters
audience: Application user
ms.reviewer: kfend
ms.custom: intro-internal
ms.search.region: Global
ms.author: wangchen
ms.search.validFrom: 2021-04-01
ms.dyn365.ops.version: 10.0.18
ms.openlocfilehash: c2293102057ac055f0958c1c6b1de2a19cb331d5
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/03/2022
ms.locfileid: "8855271"
---
# <a name="get-started-with-tax-calculation"></a>开始使用税款计算

[!include [banner](../includes/banner.md)]

本文提供有关如何开始使用税务计算的信息。 本文中的各节内容指导您完成 Microsoft Dynamics Lifecycle Services (LCS)、Regulatory Configuration Service (RCS)、Dynamics 365 Finance 和 Dynamics 365 Supply Chain Management 中的高级设计和配置步骤。 

设置由三个主要步骤组成。

1. 在 LCS 中，安装税款计算加载项。
2. 在 RCS 中，设置税务计算功能。 此设置不特定于法人。 它可以在 Finance 和 Supply Chain Management 中跨法人共享。
3. 在 Finance 和 Supply Chain Management 中，按法人设置税务计算参数。

## <a name="high-level-design"></a>高级设计

### <a name="runtime-design"></a><a name="runtime"></a> 运行时设计

下图显示了税款计算的高级运行时设计。 税款计算可以与多个 Dynamics 365 应用集成，此图使用与 Finance 的集成作为示例。

1. 在 Finance 中创建交易记录，如销售订单或采购订单。
2. Finance 会自动使用销售税组和物料销售税组的默认值。
3. 在交易记录中选择 **销售税** 按钮时，将触发税款计算。 然后，Finance 将有效负载发送到税款计算服务。
4. 税款计算服务将有效负载与税务功能中的预定义规则匹配，来同时查找更准确的销售税组和物料销售税组。

    - 如果有效负载可以与 **税组适用性** 矩阵匹配，该有效负载将在适用性规则中用匹配的税组值替代销售税组值。 否则，它将继续使用 Finance 中的销售税组值。
    - 如果有效负载可以与 **物料税组适用性** 矩阵匹配，该有效负载将在适用性规则中用匹配的物料税组值替代物料销售税组值。 否则，它将继续使用 Finance 中的物料销售税组值。

5. 税款计算服务使用销售税组和物料销售税组的交集来确定最终的税代码。
6. 税款计算服务根据其确定的最终税代码计算税款。
7. 税款计算服务将税款计算结果返回到 Finance。

![税款计算运行时设计。](media/tax-calculation-runtime-logic.png)

### <a name="high-level-configuration"></a>高级配置

以下步骤提供了税款计算服务的配置流程的高级概览。

1. 在 LCS 中，在您的 LCS 项目中安装 **税款计算** 加载项。
2. 在 RCS 中，创建 **税款计算** 功能。
3. 在 RCS 中，设置 **税款计算** 功能：

    1. 选择税务配置版本。
    2. 创建税代码。
    3. 创建税组。
    4. 创建物料税组。
    5. 可选：如果要替代从客户或供应商主数据输入的默认销售税组，则创建税组适用性。
    6. 可选：如果要替代从物料主数据输入的默认物料销售税组，则创建物料组适用性。

4. 在 RCS 中，完成并发布 **税款计算** 功能。
5. 在 Finance 中，选择已发布的 **税款计算** 功能。

完成这些步骤后，以下设置将自动从 RCS 同步到 Finance。

- 销售税代码
- 销售税组
- 物料销售税组

本文的其余各节提供更详细的配置步骤。

## <a name="prerequisites"></a>先决条件

在完成本文中的其余过程之前，必须满足以下先决条件：<!--TO HERE-->

- 您必须有权访问 LCS 帐户，并且必须已部署具有运行 Dynamics 365 版本 10.0.21 或更高版本的第 2 层（或以上）环境的 LCS 项目。
- 您必须为组织创建 RCS 环境，并且您必须有权访问您的帐户。 有关如何创建 RCS 环境的详细信息，请参阅 [Regulatory Configuration Service 概览](rcs-overview.md)。
- 必须根据您的业务需求，在已部署的 Finance 或 Supply Chain Management 环境的 **功能管理** 工作区中启用以下功能：

    - 税款计算服务
    - 支持多个增值税登记编号
    - 转移单中的税金

- 必须在已部署的 RCS 环境的 **功能管理** 工作区中启用以下功能。

    - 全球化功能

- 应根据需要为 RCS 环境中的用户分配以下角色：

    - 电子报告开发人员
    - 全球化功能开发人员
    - 税引擎开发人员
    - 税引擎功能顾问
    - 税务服务开发人员

## <a name="set-up-tax-calculation-in-lcs"></a>在 LCS 中设置税务计算

1. 登录到 [LCS](https://lcs.dynamics.com)
2. 完成 Microsoft Power Platform 集成的设置。 有关详细信息，请参阅[加载项概览](../../fin-ops-core/dev-itpro/power-platform/add-ins-overview.md)。
3. 选择已部署的环境之一，然后选择 **安装新加载项**。
4. 选择 **税款计算**。
5. 阅读并同意条款和条件，然后选择 **安装**。

## <a name="set-up-tax-calculation-in-rcs"></a>在 RCS 中设置税务计算

此部分中的步骤与特定法人无关。 您只能完成一次此过程，并且可以在 RCS 中的任何法人中完成该过程。

1. 登录 [RCS](https://marketing.configure.global.dynamics.com/)。
2. 在 **电子申报** 工作区中，添加新配置提供程序。 使用您的公司名称作为提供者的名称。 有关详细信息，请参阅[创建配置提供程序并将其标记为有效](../../fin-ops-core/dev-itpro/analytics/tasks/er-configuration-provider-mark-it-active-2016-11.md)。
3. 选择刚创建的配置提供者，然后选择 **设置有效**。
4. 选择 **Microsoft** 配置提供者，然后选择 **存储库**。
5. 在 **类型** 字段中，选择 **全局**。
6. 选择 **打开**。
7. 转到 **税务数据模型**，展开文件树，然后选择 **税务配置**。
8. 根据 Finance 版本选择正确的 [税务配置版本](global-tax-calcuation-service-overview.md#versions)，然后选择 **导入**。
9. 在 **全球化功能** 工作区，选择 **功能**，选择 **税务计算** 磁贴，然后选择 **添加**。
10. 选择以下功能类型之一：

    - **新功能** – 创建具有空白内容的功能设置。
    - **基于现有功能** – 从现有功能创建功能，然后从现有功能设置复制内容。

11. 输入功能的名称和描述，然后选择 **创建功能**。

    创建功能后，将自动创建该功能的草稿版本。 您可以选择 **获取此版本**，以将草稿版本重新基于任何已完成的版本。

12. 选择功能的草稿版本，然后选择 **编辑**。 填写 **税务计算设置** 页面。
13. 选择 **配置版本**。 您应该看到在步骤 8 中导入的配置版本。

    Microsoft 为税务计算提供默认的税务配置。 此配置涵盖了税务计算行为的大多数要求。 它将根据市场反馈进行更新。 如果必须扩展配置以满足特定要求，请参阅[如何在税务服务中生成扩展](./tax-service-add-data-fields-tax-integration-by-extension.md)，以获取有关如何生成和选择自己的税务配置的信息。

14. 在选择 **配置版本** 后，将显示其他几个选项卡。 按照此处显示的顺序完成必需的选项卡设置。

    **必需的设置**

    - **税码** – 维护税码的主数据。 当您启用当前版本时，在此选项卡上创建的所有税码会自动同步到 Finance。
    - **税组** - 定义该组下的税组主数据和税码。
    - **物料税组** - 定义该组下的物料税组主数据和税码。

    **可选设置**

    - **税组适用性** - 定义确定税组的矩阵。 如果此矩阵中的适用性规则与 Dynamics 365 中的应纳税单据不匹配，则税款计算使用应纳税单据行上的默认值。
    - **物料税组适用性** - 定义确定物料税组的矩阵。 如果此矩阵中的适用性规则与 Dynamics 365 中的应纳税单据不匹配，则税款计算使用应纳税单据行上的默认值。
    - **客户税务登记号的适用性** – 如果针对一位客户有多个税务登记编号，税款计算可以自动确定正确的税务登记编号。 在此选项卡上的矩阵中，定义应该用于进行确定的规则。 否则，Finance 和 Supply Chain Management 将继续在销售交易的应纳税单据上使用默认的税务登记编号。
    - **供应商税务登记号的适用性** – 如果针对一位供应商有多个税务登记编号，税款计算可以自动确定正确的税务登记编号。 在此选项卡上的矩阵中，定义应该用于进行确定的规则。 否则，Finance 和 Supply Chain Management 将继续在采购交易的应纳税单据上使用默认的税务登记编号。
    - **清单代码适用性** – 它可以通过更灵活、可配置的规则帮助自动确定 **清单代码** 字段的值。 在此选项卡上的矩阵中，定义应该用于进行确定的规则。 否则，Finance 和 Supply Chain Management 将继续在应纳税单据上使用默认代码。

14. 在 **税码** 选项卡上，选择 **添加**，然后输入税码和描述。
15. 选择 **税种组分**。 税种组分是在所选税务配置的以前版本中定义的一组方法。 以下税种组分可用：

    - 按净额
    - 按总额
    - 按数量
    - 按利润
    - 税上税

16. 选择 **保存**。 根据您选择的税种组分，更多字段变为可用。
17. 使用以下选项以标识税码的性质：

    - 是免税
    - 是销项税
    - 是冲销费用
    - 从基数金额计算中排除

    对于销项税方案，设置一个具有正税率的税码，然后将其标记为 **是销项税**。

    对于冲销费用方案，设置两个税码，一个具有正税率，另一个具有负税率，但税率值相同。 将负税码标记为 **是冲销费用**。 有关 Finance 中冲销费用解决方案的详细信息，请参阅[增值税/GST 方案的冲销费用机制](emea-reverse-charge.md)。

    对于不应包括在价内交易的税务基数金额计算中的某些税务类型（例如某些国家或地区中的关税），请选中 **从基数金额计算中排除** 复选框。 有关此参数的详细信息，请参阅[启用“含税价”时根据价格计算税金](global-exclude-from-tax-base-amount-calculation.md)。

    保持此税码的税率和税额限制。

18. 重复步骤 14 到步骤 17，以添加所需的所有其他税码。
19. 在 **税组** 选项卡上，选择 **税组** 列，将其添加到矩阵中作为输入条件，然后添加行以维护税组主数据。

    下面是一个示例。

    | 税务组    | 税码           |
    | ------------ | ------------------- |
    | DEU_Domestic | DEU_VAT19；DEU_VAT7 |
    | DEU_EU       | DEU_Exempt          |
    | BEL_Domestic | BEL_VAT21；BEL_VAT6 |
    | BEL_EU       | BEL_Exempt          |

20. 在 **物料税组** 选项卡上，选择 **物料税组** 列，将其添加到矩阵中作为输入条件，然后添加行以维护物料税组主数据。

    下面是一个示例。

    | 物料税组 | 税码                                    |
    | -------------- | -------------------------------------------- |
    | 已满           | DEU_VAT19；BEL_VAT21；DEU_Exempt；BEL_Exempt |
    | 已降低        | DEU_VAT7；BEL_VAT6；DEU_Exempt；BEL_Exempt   |

21. 在 **税组适用性** 选项卡上，选择确定正确税组所需的列，然后选择 **添加**。 输入或选择每列的值。 **税组** 字段将是此矩阵的输出。 如果未配置此选项卡，则将使用交易行上的销售税组。

    下面是一个示例。

    | 业务流程 | 发自 | 发往 | 税务组    |
    | ---------------- | --------- | ------- | ------------ |
    | 销售额            | DEU       | DEU     | DEU_Domestic |
    | 销售额            | DEU       | FRA     | DEU_EU       |
    | 销售额            | BEL       | BEL     | BEL_Domestic |
    | 销售额            | BEL       | FRA     | BEL_EU       |
    
    > [!NOTE]
    > 如果应纳税单据行上的默认销售税组正确，请将此矩阵留空。 有关详细信息，请参阅本文的[运行时设计](#runtime)一节。

22. 在 **物料税组适用性** 选项卡上，选择确定正确税码所需的列，然后选择 **添加**。 输入或选择每列的值。 **物料税组** 字段将是此矩阵的输出。 如果未配置此选项卡，则将使用交易行上的物料销售税组。

    下面是一个示例。

    | 物料代码 | 物料税组 |
    | --------- | -------------- |
    | D0001     | 完整           |
    | D0003     | 已降低        |

    > [!NOTE]
    > 如果应纳税单据行上的默认物料销售税组正确，请将此矩阵留空。 有关详细信息，请参阅本文的[运行时设计](#runtime)一节。

    有关如何在税款计算中确定税码的详细信息，请参阅[销售税组和物料销售税组确定逻辑](global-sales-tax-group-determination.md)。

23. 根据业务需求设置客户税务登记编号、供应商税务登记编号和清单代码的适用性。
24. 选择 **保存**，然后关闭页面。
25. 选择 **更改状态** \> **完成**。 在状态更改为 **完成** 后，无法再编辑该版本。
26. 选择 **更改状态** \> **发布**。 此版本的税务功能设置将推送到全局存储库，并将对 Finance 中的每个法人可见。

## <a name="set-up-tax-calculation-in-dynamics-365"></a>在 Dynamics 365 中设置税务计算

在 RCS 中完成设置后，您将拥有已发布的税务功能版本。 请按照以下步骤在 Finance 中设置税务计算。

本部分中的设置由法人完成。 您必须为要在 Finance 中启用税务计算的每个法人配置它。

1. 在 Finance 中，转到 **税务** \> **设置** \> **税务配置** \> **税款计算参数**。
2. 在 **常规** 选项卡上，设置以下字段：

    - **启用税款计算服务** – 选中此复选框以为法人启用税务计算。 如果未为当前法人启用它，法人将继续使用现有税务引擎来确定和计算税务。
    - **功能设置** – 选择法人的已发布税务功能设置和版本。 有关如何设置和完成已发布税务功能的详细信息，请参阅本文的上一节。
    - **业务流程** – 选择要启用的业务流程。

3. 在 **计算** 选项卡上，定义法人的预期舍入规则。 有关舍入逻辑的详细信息，请参阅[税金计算舍入规则](https://go.microsoft.com/fwlink/?linkid=2166988)。
4. 在 **错误处理** 选项卡上，为法人定义预期的错误处理方法。 提供了三个选项：

    - 否
    - 警告
    - 错误​

    您可以在 **详细信息** 部分中为每个结果代码设置错误处理方法。 或者，如果某些结果代码未通过税款计算服务同步，则可以在 **常规** 部分中设置默认方法。

5. 在 **多个增值税登记** 选项卡上，您可以分别启用增值税申报、欧盟销售清单和内部统计，以便在多个增值税登记方案下工作。 有关多个增值税登记的纳税申报的详细信息，请参阅[申报多个增值税登记](emea-reporting-for-multiple-vat-registrations.md)。
6. 保存设置，并对每个其他法人重复以前的步骤。 发布新版本并且希望应用新版本时，请在 **税款计算参数** 页面的 **常规** 选项卡上设置 **功能设置** 字段（请参阅第 2 步）。
