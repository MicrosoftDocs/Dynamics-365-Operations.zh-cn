---
title: 已扫描文档的发票自动化
description: 本文说明对供应商发票（甚至是包括附件的发票）端到端自动化提供的功能。
author: abruer
ms.date: 03/24/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: VendEditInvoiceHeaderStagingListPage
audience: Application User
ms.reviewer: twheeloc
ms.search.region: Global
ms.author: shpandey
ms.search.validFrom: 2016-11-30
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: e7d8e55fc1293e2b33b15f3862498363a6b23f1f
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/03/2022
ms.locfileid: "8883407"
---
# <a name="invoice-automation-for-scanned-documents"></a>已扫描文档的发票自动化

[!include [banner](../includes/banner.md)]

本文说明对供应商发票（包括具有附件的发票）端到端自动化提供的数据实体。

想要优化其应付帐款 (AP) 流程的组织通常将发票处理确定为应提高效率的优先流程领域。 在大多数情况下，这些组织将纸质发票的处理委托给第三方光学字符识别 (OCR) 服务提供商。 然后，他们收到机器可读的发票元数据和每张发票的扫描图像。 为了帮助实现自动化，生成了“最后一英里”解决方案以实现这些项目在发票系统中的使用。 现在通过发票自动化解决方案实现此现成的“最后一英里”自动化。

## <a name="solution-context"></a>解决方案环境

发票自动化解决方案支持标准界面，可以接受发票抬头和发票行的发票元数据，以及适用于发票的附件。 可能生成符合此界面的项目的任何外部系统将能够发送馈送进行发票和附件的自动化处理。

下图显示 Contoso 与 OCR 服务提供商合作进行供应商发票处理的集成示例场景。 Contoso 的供应商通过电子邮件将发票发送给服务提供商。 通过 OCR 处理，该服务提供商生成发票元数据（抬头和/或行）和发票的扫描图像。 然后，集成层将这些项目进行转换，使其可以使用。

![集成示例场景。](media/vendor_invoice_automation_01.png)

如果要求发票集成，上述场景可以存在多种变体。 数据迁移是使用此界面创建发票和附件的另一个使用案例。

### <a name="solution-components"></a>解决方案构成

解决方案足迹包括以下构成：

+ 发票抬头、发票行和发票附件的数据实体
+ 异常发票处理
+ 发票中的并行附件查看器

本文的其余内容提供关于这些解决方案构成的详细说明。

## <a name="data-entities"></a>数据实体

数据包是指必须发送以创建发票抬头、发票行和发票附件的工作单元。 以下数据实体用于构成数据包的项目：

+ 供应商发票标题
+ 供应商发票行
+ 供应商发票文档附件

供应商发票文档附件是作为此功能的一部分而引进的新数据实体。 供应商发票抬头实体已经过修改以支持附件。 供应商发票行实体未针对此功能进行修改。

有关数据包的详细信息，请参阅[数据管理概述](../../fin-ops-core/dev-itpro/data-entities/data-entities-data-packages.md)。 有关如何使用数据管理工作区创建数据包的信息，请参阅[处理和使用 Dynamics 365 Finance and Operations 应用解决方案中的数据包](../../fin-ops-core/dev-itpro/lcs-solutions/process-data-packages-lcs-solutions.md)。

要快速生成包括发票和附件的测试数据，请执行以下步骤。

1. 登录您的实例。
1. 转到 **应付帐款** > **发票** > **待定供应商发票**。
1. 创建具有行和附件的发票。

    > [!NOTE]
    > 附件必须是抬头附件。 目前，供应商发票文档附件实体不支持行附件。

1. 打开 **数据管理** 工作区。
1. 创建包括供应商发票抬头、供应商发票行和供应商发票文档附件实体的导出作业。
1. 导出数据。
1. 将导出的数据下载为包。 您现在可以使用包将数据导入到目标实例以用于测试目的。

### <a name="determining-the-legal-entity-for-an-invoice"></a>确定发票的法人

通过数据包导入的发票可以通过两种方式与他们所属的法人关联：

+ 处理发票的导入作业将其导入到在 **数据管理** 工作区中计划作业的相同公司。 换言之，作业的公司确定发票所属的公司。
+ 将包含发票的数据包发送到 Finance 后，调用方（即在 Finance 以外运行的集成应用）可以在 HTTP 请求中明确记载公司 ID。 在这种情况下，在 Finance 中运行的处理作业的公司环境被覆盖，发票被导入到通过 HTTP 请求传递的公司。

> [!NOTE]
> 此行为是标准数据管理行为。 此处仅出于完整性的目的在发票上下文中对其进行了解释。

## <a name="exception-processing"></a>异常处理

在供应商发票通过集成进入到 Finance and Operations 的场景中，应付账款团队成员必须可以通过简单的方法处理异常或失败的发票和使用失败的发票创建待定发票。 此供应商发票异常处理现在是 Finance and Operations 的一部分。

### <a name="vendor-invoices-that-failed-to-import-list-page"></a>无法导入列表页面的供应商发票

新的发票异常列表页在 **应付帐款** > **发票** > **导入功能** > **导入失败的供应商发票** 中可用。 此页显示来自供应商发票抬头数据实体暂存表的所有供应商发票抬头记录。 请注意，您可以从 **数据管理** 工作区查看相同的记录。 也可以从 **数据管理** 工作区执行在异常处理功能中提供的相同操作。 已针对功能性用户优化异常处理功能，使其更易于使用。

![异常列表页面。](media/vendor_invoice_automation_02.png)

此列表页包括通过馈送进入的以下字段：

+ **公司** – 发票所属的公司
+ **错误消息** –数据管理框架签发的错误消息，用来解释无法创建发票的原因
+ **编号** - 发票编号
+ **发票帐户**
+ **名称** - 供应商的名称
+ **供应商帐户**
+ **采购订单** - 发票的采购订单 (PO) 编号
+ **过帐日期**
+ **发票日期**
+ **发票描述**
+ **币种**
+ **日志**
+ **行参考** –来自外部系统的标识符

    > [!NOTE]
    > 行参考不是发票 ID。

此列表页还具有预览窗格，您可以通过以下方式使用：

+ 查看完整的错误消息，因而无需在网格中扩展 **错误消息** 列。

列表页支持以下操作：

+ **编辑** –在编辑模式中打开异常记录，以便修复问题。
+ **选项** –访问在列表页提供的标准选项。 您可以使用 **添加到工作区** 选项将异常列表页作为列表或图块固定到您的工作区。

### <a name="vendor-invoices-that-failed-to-import-details-page"></a>无法导入详细信息页面的供应商发票

当您开始编辑模式时，将打开具有问题的发票的 **无法导入详细信息的供应商发票** 页面。 如果包含附件的发票存在问题，则不会显示附件。 附件必须重新附加到发票。

**无法导入详细信息的供应商发票** 页面可让您创建待定发票。 在异常处理过程中修复发票上的问题后，选择 **创建待定发票** 按钮以创建待定发票。 将在后台创建待定发票。 

### <a name="shared-service-vs-organization-based-exception-processing"></a>共享服务与基于组织的异常处理

异常列表页支持 **数据管理** 工作区支持处理暂存记录的标准安全结构。 发票导入作业可以通过以下方式受到保护：

+ 按用户角色
+ 按用户
+ 按法人

![按用户角色和法人受到保护的导入作业。](media/vendor_invoice_automation_04.png)

如果对发票导入作业配置安全性，异常列表页将遵守这些设置。 用户将仅能够看到此设置允许他们看到的发票异常记录。

例如，Contoso 已决定按法人处理发票异常。 因此，发票导入作业上的安全性配置方式使法人中的用户 A 仅可看到法人 A 中的发票异常，而法人 B 中的用户仅可看到法人 B 中的发票异常。此设置支持对发票异常管理的职责划分。

Contoso 还可以决定不强制执行任何安全性，因此相同用户可以处理所有法人的发票异常。 此设置至此和发票异常管理的共享服务场景。

## <a name="side-by-side-attachment-viewer"></a>并行附件查看器

为了帮助您轻松查看供应商发票的附件，在开票流程中使用的以下页提供一个附件查看器：

+ **异常处理**
+ **待定供应商发票** 页（在发票审核流程中也可用）
+ **发票日记帐** 查询页（用于过帐的发票）

这是附件查看器提供的主要功能：

+ 查看文档管理支持的所有附件类型（文件、图像、URL 和注释）
+ 显示多页 TIFF 文件。
+ 对图像文件执行以下操作：
  + 突出显示图像的某些部分。
  + 阻止图像的某些部分。
  + 添加图像注释。
  + 缩放图像。
  + 平移图像。
  + 撤销和重新执行操作。
  + 适应图像大小。

> [!NOTE]
> 这些操作仅对图像文件（JPEG、TIFF、PNG 等）可用。 您通过这些操作对图像进行的任何更改均保存到图像文件。 目前，附件查看器不包括版本控制和审核功能。

### <a name="default-attachment"></a>默认附件

如果供应商发票具有多个附件，您可以在 **附件** 页将其中一个文档设置为默认附件。 **为默认附件** 选项是作为此功能的一部分添加的一个新选项。 此选项也在供应商发票单据附件数据实体中公开。 因此，可以通过集成设置默认附件。

仅一个单据可以设置为默认附件。 将单据设置为默认附件后，在打开发票时会自动显示在附件查看器中。 如果您没有将任何单据设置为默认附件，则在打开发票时，查看器不会自动显示任何单据。

### <a name="showhide-invoice-attachments"></a>显示/隐藏发票附件

在 **异常处理**、**待定发票** 和 **发票日记帐** 查询页面提供的新按钮让您能够显示或隐藏附件查看器。

## <a name="security"></a>安全性

附件查看器中的以下操作通过基于角色的安全性进行控制：

+ 突出显示
+ 锁定
+ 批注

### <a name="pending-vendor-invoices-page"></a>待定供应商发票页

以下权限提供对附件查看器执行突出显示、锁定和批注操作的只读访问权限或读/写访问权限：

+ **维护供应商发票图像** –此权限提供读/写访问权限。
+ **查看供应商发票图像** –此权限提供只读访问权限。

以下职责提供对附件查看器执行以下操作的只读访问权限或读/写访问权限：

+ **维护供应商发票** - 维护供应商发票图像权限被分配到此职责。
+ **查询供应商发票状态** - 查看供应商发票图像权限被分配到此职责。

以下角色提供对附件查看器执行以下操作的只读访问权限或读/写访问权限：

+ **应付帐款职员** 和 **应付帐款经理** – 维护供应商发票职责被分配到这些角色。
+ **应付帐款职员**、**应付帐款经理**、**应付帐款的集中付款员** 和 **应付帐款付款职员** – 查询供应商发票状态职责被分配到这些角色。

### <a name="vendor-invoice-attachment"></a>供应商发票附件

以下权限提供对附件查看器执行突出显示、锁定和批注操作的只读访问权限或读/写访问权限。

> [!NOTE]
> 本节提及的这些角色创造性地提供对附件查看器中的发票图像的只读访问权限。 如果某个角色必须具有对图像的写入访问权限，您可以使用此处描述的权限和职责对该角色授予写入访问权限。

+ **维护供应商发票抬头实体图像** – 此权限提供对附件查看器中的发票图像的读/写访问权限。
+ **查看供应商发票抬头实体图像** – 此权限提供对附件查看器中的发票图像的只读视图。

以下职责提供对附件查看器执行以下操作的只读访问权限：

+ **维护供应商发票** - 维护供应商发票抬头实体图像权限被分配到此职责。

以下角色提供对附件查看器执行以下操作的只读访问权限：

+ **应付帐款职员** 和 **应付帐款经理** – 维护供应商发票职责被分配到这些角色。

默认情况下，如果用户角色提供对任何页面的编辑权限，则用户还将拥有对附件查看器执行突出显示、锁定和批注操作的编辑权限。 但是，如果有些场景中要求特定角色对页面（而不是附件查看器）具有编辑权限，则上述列表中的相应权限可用来满足该使用案例。


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
