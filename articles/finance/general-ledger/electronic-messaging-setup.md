---
title: 设置电子消息
description: 本主题提供有关如何设置电子消息 (EM) 功能的信息。
author: liza-golub
ms.date: 11/18/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: ''
ms.search.region: Global
ms.author: elgolu
ms.search.validFrom: 2021-06-23
ms.dyn365.ops.version: 8.0999999999999996
ms.openlocfilehash: a9d623c712de34afd1b38dbc6a8738ebf9613d49
ms.sourcegitcommit: 8c17717b800c2649af573851ab640368af299981
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/23/2021
ms.locfileid: "7860550"
---
# <a name="set-up-electronic-messages"></a>设置电子消息

[!include [banner](../includes/banner.md)]

**电子消息** (EM) 功能帮助您维护不同文档类型的不同电子报告流程。 在一些支持[特定于国家/地区的报告功能](electronic-messaging.md#country-specific-regulatory-features-supported-by-the-em-functionality)的复杂场景中，设置 EM 功能，以便它包含很多消息状态、消息项状态、行动、额外字段和可执行类的组合。 对于这些场景，数据实体包可以导入。 如果您使用这些数据实体包，使用数据管理工具将其导入到法人中。 有关如何使用数据管理工具的详细信息，请参阅[数据管理](../../fin-ops-core/dev-itpro/data-entities/data-entities-data-packages.md)。

如果您不导入数据实体包，可以手动设置 EM 功能。 在这种情况下，必须设置以下元素：

- [编号规则](#sequences)
- [消息项类型](#types)
- [消息项状态](#item)
- [消息状态](#statuses)
- [附加字段](#additional)
- [可执行类设置](#executable)
- [填充记录行为](#populate)
- [填充多个公司的记录](#multiple-companies-populate)
- [Web 应用程序](#applications)
- [Web 服务设置](#settings)
- [消息处理操作](#actions)
- [电子消息处理](#processing)

以下部分提供有关每个元素的详细信息。

## <a name="number-sequences"></a><a id="sequences"></a>编号规则

为消息和消息项设置编号规则。 然后，此编号规则用于自动为消息和消息项编号。 将分配的编号用作消息和消息项在系统中的唯一标识符。 您可以通过转到 **总帐** \> **分类帐设置** \> **总帐参数** 为电子消息设置编号规则。

## <a name="message-item-types"></a><a id="types"></a>消息项类型

消息项类型标识在电子消息中使用的记录的类型。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **消息项类型** 设置消息项类型。

## <a name="message-item-statuses"></a><a id="item"></a>消息项状态

消息项状态标识应用于您正在设置的处理中的消息项的状态。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **消息项状态** 设置消息项状态。

消息项状态的 **允许删除** 参数定义您是否可在 **电子消息** 页面或 **电子消息项** 页面上删除具有此状态的消息项。

## <a name="message-statuses"></a><a id="statuses"></a>消息状态

设置应该在消息处理中呈现的消息状态。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **消息状态** 设置消息状态。

下表描述 **消息状态** 页的字段。

| 字段名称          | 说明 |
|---------------------|-------------|
| 消息状态      | 输入消息状态的唯一名称。 消息状态可用于表示电子消息在各阶段的状态特征。 您输入的名称在 **电子消息** 页面中和与电子消息有关的日志中显示。 |
| 说明         | 输入消息状态的描述。 |
| 响应类型       | 选择消息状态的响应类型。 处理中的某些操作可以生成多种响应类型。 例如，**Web 服务** 类型的操作可以生成 **已成功执行** 类型或 **技术错误** 类型的响应，具体取决于其执行结果。 在这种情况下，定义这两种响应类型的消息状态。 有关操作类型及相关响应类型的详细信息，请参阅本主题后面的[消息处理操作类型](#action-types)部分。 |
| 消息项状态 | 电子消息的状态有时一定会影响相关消息项的状态。 请选择此字段中的消息项状态将其与消息状态关联。 |
| 允许删除        | 如果用户应该可以删除在 **电子消息** 页面上具有此状态的电子消息，请选中此复选框。 |

## <a name="additional-fields"></a><a id="additional"></a>附加字段

EM 功能使您可以收集 Microsoft Dynamics 365 Finance 中交易表中的记录作为消息项。 这样，您可以为报告准备记录，然后报告它们。 但是，有时交易记录表中的信息不足，无法按照可满足申报要求的方式填写记录。 若要填写必须为记录报告的所有信息，您可以设置附加字段。 附加字段可与消息和消息项关联。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **附加字段** 设置附加字段。

下表描述 **附加字段** 页的常规字段。

| 字段       | 说明 |
|-------------|-------------|
| 字段名称  | 输入与此流程相关的电子消息或消息项的附加字段的名称。 在处理流程时，此名称显示在用户界面 (UI) 中。 该名称还可以用于与流程相关的电子报告 (ER) 配置。 |
| 说明 | 输入附加字段的描述。 |
| 用户编辑   | 如果用户应该可以在 UI 中更改附加字段的值，请将此选项设置为 **是**。 |
| 计数器     | 如果附加字段应该包含电子消息中的编号规则，请将此选项设置为 **是**。 运行 **电子报告导出** 类型的操作时，将自动填写附加字段的值。 |
| 隐藏      | 如果应在 **电子消息** 页面或 **电子消息项** 页面上在 UI 中隐藏附加字段，请将此选项设置为 **是**。 |

在 **值** 快速选项卡上，您可以预定义附加字段可以具有的值。 然后，这些值可供用户进行选择。 因此，他们不必在处理期间手动填写。 下表介绍这些字段。

| 字段                | 说明 |
|----------------------|-------------|
| 字段值          | 输入在报告过程中要用于消息或消息项的字段值。 |
| 说明          | 输入字段值的描述。 |
| 科目类型         | 有些字段值可能被限制为特定科目类型。 选择以下值之一：**所有**、**客户** 或 **供应商**。 |
| 帐户编码         | 如果您在 **科目类型** 字段中选择了 **客户** 或 **供应商**，您可以进一步将字段值的使用限定为特定组或表。 |
| 帐户/组编号 | 如果您在 **科目类型** 字段中选择了 **客户** 或 **供应商**，并且如果您在 **帐户编码** 字段中输入了组或表，您可以在此字段中输入特定组或票务代理。 |
| 生效            | 指定应该开始考虑值的日期。 |
| 到期           | 指定应该停止考虑值的日期。 |

默认情况下，**帐户/组编号**、**帐户编码**、**生效** 和 **到期** 字段定义的条件组合不会影响为附加字段选择值。 但是，可以在可执行类中使用这些组合来实施特定逻辑以计算附加字段的值。

## <a name="executable-class-settings"></a><a id="executable"></a>可执行类设置

可执行类是一个 X++ 方法或类，如果流程需要一些评估，电子消息处理可以对行动调用它。

您可以手动设置一个可执行类，必须通过转到 **税务** \> **设置** \> **电子消息** \> **可执行类设置** 在处理期间调用该类。 在 **可执行类设置** 页面上，创建一行，并设置以下字段。

| 字段                 | 说明 |
|-----------------------|-------------|
| 可执行类      | 输入将在设置此类为其调用的消息处理行动期间使用的名称。 |
| 说明           | 输入可执行类的描述。 |
| 可执行类名称 | 选择 X++ 可执行类。 |
| 执行级别       | 因为将为选择的可执行类预定义值，因此此字段将自动设置。 此字段限制相关评估运行的级别。 |
| 类描述     | 因为将为选择的可执行类预定义值，因此此字段将自动设置。 |
| 操作类型           | 当在 **功能管理** 工作区中打开 **\[EM\] 可执行类操作类型** 功能时，此字段可用。 使用此字段指定可执行类的操作类型。 此字段可以更精确地控制可用于 **电子消息** 页面上的电子消息的后续操作。 |

某些可执行类可能有必需参数，必须在首次运行该可执行类之前定义。 若要定义这些参数，请在操作窗格上，选择 **参数**。 在显示的对话框中，设置字段，然后选择 **确定**。 务必选择 **确定**。 否则，不会将这些参数保存到数据库，这样就不能正确调用可执行类。

## <a name="populate-records-actions"></a><a id="populate"></a>填充记录行为

您使用填充记录操作设置将记录添加到消息项表以使其可以添加到电子消息的操作。 例如，如果您的电子消息必须报告客户发票，则必须设置链接到“客户发票日记帐”表中的 **数据源** 字段的填充记录操作。

您可以通过转到 **税务** \> **设置** \> **电子消息** \> **填充记录操作** 设置填充记录操作。 为应将记录添加到表的每个操作创建新记录，然后设置以下字段。

| 字段       | 说明 |
|-------------|-------------|
| 姓名        | 为在您的流程中填充记录的操作输入名称。 |
| 说明 | 输入填充记录操作的描述。 |

在 **数据源设置** 快速选项卡上，为用于流程的每个数据源添加一个行，并设置以下字段。

| 字段                  | 说明 |
|------------------------|-------------|
| 姓名                   | 输入数据源的名称。 |
| 消息项类型      | 选择要在为数据源创建记录时使用的消息项的类型。 |
| 帐户类型           | 选择要与来自数据源的记录关联的帐户的类型。 |
| 主表名称      | 选择将是数据源的表。 |
| 单据编号字段  | 在所选主表中选择将从中获取文档编号的字段。 此字段的值用作消息项的 **文档编号** 字段的值。 |
| 单据日期字段    | 在所选主表中选择将从中获取文档日期的字段。 此字段的值用作消息项的 **消息项日期** 字段的值。 |
| 文档帐户字段 | 在所选主表中选择将从中获取文档帐户的字段。 此字段的值用作消息项的 **帐户编号** 字段的值。 |
| 公司                | 在 **功能管理** 工作区中打开 **填充记录操作的跨公司查询** 功能时，此字段可用。 使用此功能为填充记录操作设置跨公司数据源。 可以从多个公司获取数据。 |
| 用户查询             | <p>如果您通过选择网格上方的 **编辑查询** 来设置查询，并且指定必须应用于从中填充数据的所选主表的条件，此复选框将自动选中。 否则，所有记录从所选主表源填充。</p><p>当在 **功能管理** 工作区中打开 **填充记录操作的跨公司查询** 功能，并且必须从多个公司收集记录时，请为每个必须包含在报告中的附加法人添加一行。 对于每个新行，选择 **编辑查询**，并指定特定于在行上的 **公司** 字段中指定的法人的相关条件。 完成后，**数据源设置** 网格将包含必须包括在报告中的所有法人的行。</p> |

## <a name="populate-records-from-multiple-companies"></a><a id="multiple-companies-populate"></a>填充多个公司的记录

如果您的公司必须从同一 Finance 数据库中的多个法人中进行报告，请为报告中必须包含其数据的所有法人设置[填充记录操作](#populate)。

要在您的 Finance 环境中启用此功能，请执行以下步骤。 

1. 转到 **工作区** \> **功能管理**。
2. 在列表中查找并选择 **填充记录操作的跨公司查询**。
3. 选择 **立即启用**。 

要为必须在报告中包含其数据的多个公司设置[填充记录操作](#populate)，请执行以下步骤。

1. 转到 **税务** \> **设置** \> **电子消息** \> **填充记录行为**。

    启用 **填充记录操作的跨公司查询** 功能后，**填充记录操作** 页上的 **数据源设置** 网格包括 **公司** 字段。 对于在[填充记录操作](#populate)的一般设置期间创建的现有记录，此字段显示当前法人的标识符。

2. 在 **数据源设置** 网格中，为必须包含在报告中的每个子公司法人添加一行，并设置以下字段。

    | 字段名称             | 值 |
    |------------------------|-------|
    | Name                   | 输入帮助您了解此记录的来源的文本值。 例如，输入 **数据源的名称 - 子公司 1**。 |
    | 消息项类型      | 选择 EM 处理所需的消息项类型。 |
    | 帐户类型           | 指定 EM 处理所需的帐户类型。 如果您的 EM 处理没有特定的帐户类型，请选择 **全部**。 |
    | 主表名称      | 指定 EM 处理所需的主表的名称。 |
    | 单据编号字段  | 指定在 EM 处理记录中包含文档编号的字段。 |
    | 单据日期字段    | 指定在 EM 处理记录中包含文档日期的字段。 |
    | 文档帐户字段 | 指定在 EM 处理记录中包含文档帐户的字段。 |
    | 公司                | 选择子公司法人的 ID。 |
    | 用户查询             | 当您通过选择 **编辑查询** 定义条件时，将自动选择此复选框。 |

3. 对于每个新行，选择 **编辑查询**，并为在行上的 **公司** 字段中指定的法人指定相关条件。

## <a name="web-applications"></a><a id="applications"></a>Web 应用程序

使用 Web 应用程序设置来设置 Web 应用程序，以使其支持 Open Authorization (OAuth) 2.0。 OAuth 是一种开放标准，供用户在不共享自己的访问凭证的情况下，为该应用程序授予代表自己的“安全委托访问权限”。 也可以获取授权码和访问令牌来了解授权流程。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **Web 应用程序** 设置 Web 应用程序设置。

下表描述 **Web 应用程序** 页的字段。

| 字段                        | 说明 |
|------------------------------|-------------|
| 应用程序名称             | 为 Web 应用程序输入名称。 |
| 说明                  | 输入 Web 应用程序的描述。 |
| 基 URL                     | 输入 Web 应用程序的基 Internet 地址。 |
| 授权 URL 路径       | 指定用于构成进行授权的 URL 的路径。 |
| 令牌 URL 路径               | 指定用于构成令牌的 URL 的路径。 |
| 重定向 URL                 | 输入重定向 URL。 |
| 客户端 ID                    | 输入 Web 应用程序的客户端 ID。 |
| 客户端密钥                | 输入 Web 应用程序的客户端密钥。 |
| 服务器令牌                 | 输入 Web 应用程序的服务器令牌。 |
| 授权格式映射 | 选择用于生成授权请求的 ER 格式。 |
| 导入令牌模型映射   | 选择用于存储访问令牌的 ER 导入模型。 |
| 授予作用域                | 为应用程序授予的请求作用域。 将自动更新此字段。 |
| 访问令牌将于以下时间到期  | 访问令牌的剩余有效时间。 将自动更新此字段。 | 
| 接受                       | 指定 Web 请求的 **接受** 属性。 例如，输入 **application/vnd.hmrc.1.0+json**。 |
| 内容类型                 | 指定内容类型。 例如，输入 **application/json**。 |

此外，**Web 应用程序** 页面的操作窗格中还有以下按钮，用于支持授权流程：

- **获取授权代码** - 初始化 Web 应用程序的授权。 此功能使用在 **授权格式映射** 字段中指定的 ER 格式生成授权请求。
- **获取访问令牌** - 初始化访问令牌的获取流程。
- **刷新访问令牌** - 刷新访问令牌。 此功能使用在 **导入令牌模型映射** 字段中指定的 ER 格式导入有关接收的访问令牌的信息。

可将以加密格式存储在系统的数据库中的 Web 应用程序访问令牌用于请求 Web 服务。 出于安全目的，只有允许解决这些请求的安全角色才能访问令牌。 如果安全组外的任何人尝试解决请求，他们将收到一个错误，说明不允许其通过使用所选 Web 应用程序进行互操作。 若要设置有权访问访问令牌的安全角色，请使用 **Web 应用程序** 页面上的 **安全角色** 快速选项卡。 如果不为 Web 应用程序定义安全角色，则只有系统管理员可以使用 Web 应用程序互操作。

对于所选 Web 应用程序的每个操作，**操作日志** 快速选项卡保存有关用户的信息以及日期和时间。

某些 Web 服务可能要求在请求中包含不同的标头。 系统管理员可以在 **辅助标头** 快速选项卡上设置其他标头及其值，然后在请求生成期间使用它们。

## <a name="web-service-settings"></a><a id="settings"></a>Web 服务设置

使用 Web 服务设置对传输到 Web 服务的直接数据传输进行设置。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **Web 服务设置** 来设置 Web 服务设置。

下表描述 **Web 服务设置** 页的字段。

| 字段                          | 说明 |
|--------------------------------|-------------|
| Web 服务                    | 为 Web 服务输入名称。 |
| 说明                    | 输入 Web 服务的描述。 |
| Internet 地址               | <p>输入 Web 服务的 Internet 地址。 如果为 Web 服务指定了 Web 应用程序，并且该 Web 服务的 Internet 地址应该与为该 Web 应用程序定义的 Internet 地址相同，请选择 **复制基 URL**。 然后，将 Web 应用程序的基 URL 复制到此字段。</p><p>**警告：** 您在此处配置的第三方服务或其他服务不需要认证，并且可能不符合 Microsoft 隐私标准。 您应该查看每个服务的隐私文档并与每个服务提供商合作，以了解有关其服务提供的合规性级别的详细信息。 您有责任确保这些服务符合您的安全、隐私和法律标准。 使用服务的风险由您承担。 Microsoft 不提供任何明示保证、保障或条件。 我们强烈建议您仅使用提供安全和授权连接的服务，例如 HTTPS。</p> |
| 证书                    | 选择之前设置的 Azure 密钥保管库证书。 |
| Web 应用程序                | 选择之前设置的 Web 应用程序证书。 |
| 响应类型 - XML        | 如果响应类型是 XML，将此选项设置为 **是**。 |
| 请求方法                 | 指定请求的方法。 HTTP 定义指示应该为给定资源执行的操作的一组请求方法。 请求方法可以是 **GET**、**POST**，或其他 HTTP 方法。 |
| 请求标题                | 指定请求标题。 请求标题是可在 HTTP 请求中使用的 HTTP 标题。 它与消息的内容无关。 |
| 接受                         | 指定 Web 请求的接受属性。 |
| 接受编码                | 指定接受编码值。 接受编码请求 HTTP 标题给予客户可以了解的内容编码的建议。 此内容编码通常是压缩算法。 |
| 内容类型                   | 指定内容类型。 内容类型实体 HTTP 标题指示资源的媒体类型。 |
| 成功的响应代码       | 指定用于指示请求已成功的 HTTP 状态代码。 |
| 请求标题格式映射 | 选择用于生成 Web 请求标题的 ER 格式。 |

## <a name="message-processing-actions"></a><a id="actions"></a>消息处理操作

您使用消息处理操作创建流程的操作和设置操作参数。 您可以通过转到 **税务** \> **设置** \> **电子消息** \> **消息处理操作** 设置消息处理操作。

下表描述 **消息处理操作** 页的字段。

### <a name="general-fasttab"></a>常规快速选项卡

| 字段                                     | 说明 |
|-------------------------------------------|-------------|
| 操作类型                               | 选择操作的类型。 有关可用选项的信息，请参阅本主题后面的[消息处理操作类型](#action-types)部分。 |
| 格式映射                            | 选择应为操作调用的 ER 格式。 此字段仅可用于 **电子报告导出**、**电子报告导入** 和 **电子报告导出消息** 类型的操作。 |
| URL 路径的格式映射               | 选择应为操作调用的 ER 格式。 此信息用于构成将添加到为所选 Web 服务器指定的基 internet 地址的 URL 地址的路径。 此字段仅可用于 **Web 服务** 类型的操作。 |
| 消息项类型                         | 选择应为其评估操作的记录的类型。 此字段可用于 **消息项执行级别**、**电子报告导出**、**电子报告导入**、**Web 服务** 类型以及其他类型的操作。 如果将此字段留空，为消息处理定义的所有消息项类型都将进行评估。 |
| 可执行类                          | 选择现有的可执行类设置。 此字段仅可用于 **消息项执行级别** 和 **消息项执行级别** 类型的操作。 |
| 填充记录行为                   | 选择现有的填充记录操作。 此字段仅可用于 **填充记录** 类型的操作。 |
| Web 服务                               | 选择现有的 Web 服务。 此字段仅可用于 **Web 服务** 类型的操作。 |
| 要发送的文件名                         | 输入必须通过此操作发送的电子消息的附件名称。 如果多个附件具有相同的原始文件名，则将发送最新的附件。 如果未找到具有指定原始文件名的附件，则将发送该请求而不包含内容。 此字段仅可用于 **Web 服务** 类型的操作。 |
| 文件名                                 | 指定将充当操作结果的文件的名称。 此文件可以是 Web 服务器的响应或生成的报告。 此操作仅适用于 **Web 服务** 和 **电子申报导出消息** 类型的操作。 |
| 将文件附加到原始单据          | 选中此复选框以将生成的文件附加到 EM 项目的引用主表中的记录。 此字段仅适用于 **电子报告导出** 和 **Web 服务** 类型的操作。 |
| 将来自输出存档的文件附加到项目 | 选中此复选框以从输出存档文件中提取单独的 XML 文件并将其附加到相应的电子消息项。 此字段仅适用于 **电子报告导出** 类型的操作。 |
| 每次导出的消息项数量        | 指定必须包含在一个文件（消息）中的消息项数量的限制。 此字段仅适用于 **电子报告导出** 类型的操作。 |
| 使用 ER 源                             | 选中此复选框以使用 ER 源参数进行导入。 否则，使用来自电子消息的附件。 此字段仅适用于 **电子报告导入** 类型的操作。 |
| 显示对话框                               | 如果必须在生成报表之前向用户显示对话框，请将此选项设置为 **是**。 此操作仅适用于 **电子申报导出消息** 类型的操作。 |

#### <a name="message-processing-action-types"></a><a id="action-types"></a>消息处理操作类型

**操作类型** 字段中具有以下选项：

- **创建消息** – 使用此操作类型允许用户在 **电子消息** 页手动创建消息。 无法为此类型的操作设置初始状态。
- **填充记录** – 此操作类型必须已设置。 将其与填充记录操作关联以使操作包括在处理中。 假设此操作类型用于消息处理中的第一个操作（当未提前创建电子消息时），或用于向 **创建消息** 操作类型之前创建的消息添加消息项的操作。 因此，对于此类型的操作，只能为消息项设置结果状态。 只能为消息设置初始状态。
- **消息执行级别** – 使用此操作类型设置应在消息级别评估的可执行类。
- **消息项执行级别** – 使用此操作类型设置应在消息项级别评估的可执行类。
- **电子报告导出** – 为应基于消息项级别的导出 ER 配置生成报表的操作使用此操作类型。
- **电子报告导出消息** – 为应基于消息级别的导出 ER 配置生成报表的操作使用此操作类型（例如，当消息不包含任何消息项时）。
- **电子报告导入** – 为应基于导入 ER 配置生成报表的操作使用此操作类型。
- **消息级别用户处理** – 为假定一些用户在消息级别手动操作的操作使用此操作类型。 例如，用户可能更新消息的状态。
- **用户处理** – 为假定一些用户在消息项级别手动操作的操作使用此操作类型。 例如，用户可能更新消息项的状态。
- **Web 服务** – 为应将生成的报表传输到 Web 服务的操作使用此操作类型。 此操作类型不用于“意大利采购和销售发票通信”报告。 对于此操作类型，**消息处理操作** 页面中包含 **杂项详细信息** 快速选项卡，可在其中指定确认文本。 在解决对所选 Web 服务的请求之前，向用户显示此确认文本。
- **请求验证** – 使用此操作类型从服务器请求验证。

### <a name="initial-statuses-fasttab"></a>初始状态快速选项卡

> [!NOTE]
> **初始状态** 快速选项卡不可用于具有 **创建消息** 初始操作类型的操作。

| 字段               | 说明 |
|---------------------|-------------|
| 消息项状态 | 选择应为其评估所选的消息处理操作的消息项状态。 |
| 说明         | 所选消息项状态的描述。 |

### <a name="result-statuses-fasttab"></a>结果状态快速选项卡

| 字段               | 说明 |
|---------------------|-------------|
| 消息状态      | 选择应为其评估所选的消息处理操作的消息状态。 此字段仅可用于在消息级别评估的消息处理操作。 例如，适用于 **电子申报导出** 和 **电子申报导入** 类型的操作，但不适用于 **用户处理** 和 **消息项执行级别** 类型的操作。 |
| 说明         | 所选消息状态的描述。 |
| 响应类型       | 所选消息状态的响应类型。 |
| 消息项状态 | 选择应在评估所选消息处理操作后可用的生成的状态。 此字段仅可用于在消息项级别评估的消息处理操作。 例如，它可用于 **用户处理** 和 **消息项执行级别** 类型的操作。 对于在消息级别评估的消息处理操作，此字段显示为所选消息状态设置的消息项状态。 |

下表显示必须为不同操作类型和响应类型设置的结果状态。

| 电子消息操作类型/响应类型 | 已成功执行 | 业务错误 | 技术错误 | 用户定义的 | 取消 |
|----------------------------------------------|-----------------------|----------------|-----------------|--------------|--------|
| 创建消息                               | X                     |                |                 |              |        |
| 电子报告导出                  | X                     |                |                 |              |        |
| 电子报告导入                  |                       |                |                 |              |        |
| Web 服务                                  | X                     |                | X               |              |        |
| 用户处理                              |                       |                |                 |              |        |
| 消息执行级别                      |                       |                |                 |              |        |
| 填充记录                             |                       |                |                 |              |        |
| 消息项执行级别                 |                       |                |                 |              |        |
| 请求验证                         | X                     | X              | X               |              |        |
| 电子报告导出消息          | X                     |                |                 |              |        |
| 消息级别用户处理                |                       |                |                 |              |        |

## <a name="electronic-message-processing"></a><a id="processing"></a>电子消息处理

电子消息处理是 EM 功能的基本概念。 它聚合应为电子消息评估的操作。 可通过使用初始状态和结果状态链接操作。 或者，**用户处理** 类型的操作可以独立启动。 若要设置电子消息的处理，请转到 **税务** \> **设置** \> **电子消息** \> **电子消息处理**。

**操作** 快速选项卡让您可以将预定义的操作添加到处理。 您可以指定是否必须单独运行操作，或者它是否可以通过处理启动。 若要指定处理中的操作可以由用户初始化，请将该操作的 **单独运行** 字段设置为 **是**。 如果某个操作应该由对于状态定义为操作初始状态的消息或消息项启动，请将 **单独运行** 字段设置为 **否**。 **用户操作** 类型的操作始终必须单独运行。

有时，必须将多个操作聚合为序列，即使第一个操作设置为单独运行。 例如，用户必须初始化报表生成。 但是，在生成报表后，必须立即发送给 Web 服务，并且必须在系统中反映 Web 服务的响应。 在此情况下，可以为始终必须一起运行的操作创建不可分序列。 在 **操作** 快速选项卡上，选择网格上方的 **不可分序列**，然后创建序列。 然后，对于必须在一个序列中一起运行的所有操作，在 **不可分序列** 字段中选择该序列。 对于此示例，可以为序列中的第一个操作将 **单独运行** 字段设置为 **是**，并且为其他所有操作设置为 **否**。

**电子报告导出** 和 **电子报告导出消息** 类型的操作运行具有输入参数的 ER 格式。 如果电子消息处理包含其中任一类型的操作，您必须在报表生成之前为输入参数指定值。 这样，系统可以使用批处理制度来生成报表。 您可以选择网格上方的 **参数** 为所选操作类型（**电子报告导出** 或 **电子报告导出消息**）设置参数。 为必须在批处理制度中使用指定参数运行的操作选中 **使用参数** 复选框。

使用 **消息项附加字段** 快速选项卡以添加与消息项相关的预定义附加字段。 您必须为与字段相关的每个消息项类型添加附加字段。 您可以指定将在处理期间分配给附加字段的默认值。

使用 **消息附加字段** 快速选项卡以添加与消息相关的预定义附加字段。 您可以指定将在处理期间分配给附加字段的默认值。

使用 **安全角色** 快速选项卡以设置在进行特定处理的系统中预定义的安全角色。 具有特定角色的用户将只看到为该角色定义的处理。

使用 **批处理** 快速选项卡以设置在批处理制度中执行的处理。 当您在操作窗格上选择 **运行处理** 以启动处理时，我们建议您直接在 **电子消息** 或 **电子消息项** 页面上为您的处理设置批处理制度。
