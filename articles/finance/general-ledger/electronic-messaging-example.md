---
title: 设置并运行处理以调用简单的导出 ER 格式来生成 Excel 报表
description: 本主题提供显示如何设置和使用电子消息的示例。
author: liza-golub
ms.date: 07/06/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: kfend
ms.custom: ''
ms.search.region: Global
ms.author: elgolu
ms.search.validFrom: 2021-06-24
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: c2735df09ecf029503ae96a88a523ea40197da8f
ms.sourcegitcommit: 5d1772bdeb21a9bec6dc49e64550aaf34127a4e2
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/10/2022
ms.locfileid: "8734990"
---
# <a name="set-up-and-run-processing-to-call-a-simple-exporting-er-format-to-generate-an-excel-report"></a>设置并运行处理以调用简单的导出 ER 格式来生成 Excel 报表

[!include [banner](../includes/banner.md)]

在创建您的 ER 格式后，将其映射到数据源，然后完成它，您可以从 **电子报告** 工作区中运行它。 生成报表后，您可以将其保存到本地。

若要控制报告流程的以下方面，请设置电子消息处理：

- 记录有关生成报表人员的信息。
- 记录有关报表的生成时间的信息。
- 保存为以前期间生成的报表。

以下示例显示如何设置电子消息以基于 Microsoft Excel 的导出 ER 格式生成报表。 如果要按此示例操作，必须已经创建了 Excel 的导出 ER 格式，并映射到数据源并且已完成。 此外，还必须已经为电子消息设置了编号规则。

在您创建处理时，如果您首先定义将设置的处理操作和状态将会很有用。 下图显示此示例的处理。

![处理方案](media/processing-scheme.png)

## <a name="create-message-statuses"></a>创建消息状态

1. 转到 **税务** \> **设置** \> **电子消息** \> **消息状态**。
2. 创建以下消息状态：

    - 新建
    - 已准备
    - 已生成

    ![消息状态](media/message-statuses.png)

3. 在 **新建** 状态的行中，选中 **允许删除** 复选框以让用户可以删除具有此状态的消息。

## <a name="create-additional-fields"></a>创建附加字段

1. 转到 **税务** \> **设置** \> **电子消息** \> **附加字段**。
2. 添加附加字段及其值。
3. 将 **用户编辑** 选项设置为 **是** 以允许用户编辑此字段。

![附加字段](media/additional-fields.png)

## <a name="create-message-processing-actions"></a>创建消息处理操作

对于本示例，将创建以下消息处理操作：

- **创建消息**
- **更新为已准备**
- **生成报表**
- **更新为初始状态**（可选）

请按照以下步骤创建操作。

1. 转到 **税务** \> **设置** \> **电子消息** \> **消息处理操作**。
2. 创建名为 **创建消息** 的操作。 在 **常规** 快速选项卡上，在 **操作类型** 字段中，选择 **创建消息**。
3. 创建名为 **更新为已准备** 的操作，然后设置以下字段：

    - 在 **常规** 快速选项卡上，在 **操作类型** 字段中，选择 **消息级别用户处理**。
    - 在 **初始状态** 快速选项卡上，在 **消息状态** 字段中，选择 **新**。
    - 在 **结果状态** 快速选项卡上，在 **消息状态** 字段中，选择 **已准备**。 在 **响应类型** 字段中，输入 **已成功执行**。

4. 创建名为 **生成报表** 的操作，然后设置以下字段：

    - 在 **常规** 快速选项卡上，在 **操作类型** 字段中，选择 **电子报告导出**。 在 **格式映射** 字段中，选择导出 ER 格式。 选项有 **Excel**、**XML**、**JSON**、**文本** 和 **其他**。
    - 在 **初始状态** 快速选项卡上，在 **消息状态** 字段中，选择 **已准备**。
    - 在 **结果状态** 快速选项卡上，在 **消息状态** 字段中，选择 **已生成**。 在 **响应类型** 字段中，输入 **已成功执行**。

    ![生成报表操作](media/generate-report-action.png)

5. 可选：若要使用户能够多次重新生成报表，请创建名为 **更新为初始状态** 的操作并设置以下字段：

    - 在 **常规** 快速选项卡上，在 **操作类型** 字段中，选择 **消息级别用户处理**。
    - 在 **初始状态** 快速选项卡上，在 **消息状态** 字段中，选择 **已生成**。
    - 在 **结果状态** 快速选项卡上，为这两个消息状态（**已准备** 和 **新**）分别添加一行。 为这两行将 **响应类型** 字段设置为 **已成功执行**。

## <a name="electronic-message-processing"></a>电子消息处理

对于本示例，应设置所有操作，以便其单独运行。 假定用户将初始化每个操作。

1. 转到 **税务** \> **设置** \> **电子消息** \> **电子消息处理**。
2. 为您的处理添加记录，添加所有先前定义的操作和附加字段。
3. 可选：在 **安全角色** 快速选项卡上，为您的处理定义安全角色以限制对特定报告的访问。
4. 转到 **税务** \> **查询和报表** \> **电子消息** \> **电子消息**。
5. 选择 **新建** 创建消息。 此时，您可以添加日期和描述。 您还可以根据需要更新附加字段的值。

    ![创建电子消息](media/create-electronic-message.png)

    **操作日志** 快速选项卡上的网格将自动填充为对消息执行的所有操作的日志。

    您现在可以删除或更新消息状态。 

6. 若要更新消息状态，请选择 **更新状态**。 在 **新状态** 字段中，选择 **已准备**，然后选择 **确定**。

    ![更新消息状态](media/update-status.png)

    消息状态更新为 **已准备**。

7. 通过选择 **生成报表** 来生成报表。

    将生成报表，消息状态和操作日志将更新。

8. 若要查看生成的报表，请选择页面右上角的 **附件** 按钮（回形针符号）。

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
