---
title: "零售渠道的会计集成"
description: "此主题概要介绍 Retail POS 的会计集成。"
author: josaw
manager: annbe
ms.date: 11/01/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-365-retail
ms.technology: 
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2018-11-1
ms.dyn365.ops.version: 8.1.1
ms.translationtype: HT
ms.sourcegitcommit: 0450326dce0ba6be99aede4ebc871dc58c8039ab
ms.openlocfilehash: c852d095505abecbd44d29e9e7b53875e9069def
ms.contentlocale: zh-cn
ms.lasthandoff: 11/01/2018

---
# <a name="fiscal-integration-for-retail-channel"></a>零售渠道的会计集成

[!include [banner](../includes/banner.md)]

此主题是 Microsoft Dynamics 365 for Retail 中提供的会计集成功能的概述。 会计功能是用于支持旨在防止零售业欺诈的地方财政法的框架。 可能通过使用会计集成应对的典型场景包括：

- 打印财务收据并提供给客户。
- 为向主管机构提供的外部服务提交有关在 POS 上执行的销售和退货的信息提供保护。
- 利用主管机构授权的数字签名使用保护数据。

此主题提供有关设置会计集成以便用户可以执行以下任务的指南。 

- 配置会计连接器，其是用于会计登记目的的税控设备或服务，如会计数据的保存、数字签名和安全提交。
- 配置单据提供程序，其定义会计单据生成的输出方法和算法。
- 配置会计登记流程，其定义步骤顺序和每个步骤中使用的连接器组。
- 将会计登记流程分配到 POS 功能配置文件。
- 分配连接器技术配置文件，分配到硬件配置文件（对于本地会计连接器）或 POS 功能配置文件（对于其他会计连接器类型）。

## <a name="fiscal-integration-execution-flow"></a>会计集成执行流
以下场景显示通用会计集成执行流。

1. 会计登记流程的初始化。
  
   在执行需要会计登记的一些操作后，例如，在零售交易记录完成后，会计登记流程将与当前的 POS 功能配置文件关联。

1. 搜索会计连接器。
   
   对于会计登记流程中包括的每个会计登记步骤，系统将匹配会计连接器的列表。 这些连接器在指定的连接器组中包括功能配置文件，并且附带包含与当前硬件配置文件关联（对于仅为**本地**的连接器类型）或与当前的 POS 功能配置文件关联（对于其他连接器类型）。
   
1. 执行会计集成。

   系统执行与找到的连接器链接的程序集定义的所有必要操作。 这根据在此连接器的前一个步骤中找到的功能配置文件和技术配置文件的设置。

## <a name="setup-needed-before-using-fiscal-integration"></a>使用会计集成前所需的设置
在使用会计集成功能之前，应定义以下设置：

- 在**零售参数**页为会计功能配置文件编号定义编号规则。
  
- 在**零售共享参数**页为以下引用定义编号规则：
  
  - 财政技术配置文件编号
  - 财政连接器组编号
  - 登记流程编号

- 在**零售 >渠道设置 > 会计集成 > 会计连接器**中为您计划用于会计集成目的的每个设备或服务创建**会计连接器**。

-  在**零售 > 渠道设置 > 会计集成 > 会计单据提供程序**中为所有会计连接器创建**会计单据提供程序**。 数据映射被视为会计单据提供程序的一部分。 若要为相同连接器设置不同的数据映射（如州特定法规），您应创建不同的会计单据提供程序。

- 在**零售 > 渠道设置 > 会计集成 > 连接器功能配置文件**中为每个会计单据提供程序创建**连接器功能配置文件**。
  - 选择连接器名称。
  - 选择单据提供程序。
  - 在**服务设置**选项卡上指定增值税税率设置。
  - 在**数据映射**选项卡上指定增值税代码映射和支付方式映射。

  #### <a name="examples"></a>示例 

  |  | 格式 | 示例 | 
  |--------|--------|--------|
  | 增值税税率设置 | 值 : VATrate | 1 : 2000、2 : 1800 |
  | 增值税代码映射 | VATcode : 值 | vat20 : 1、vat18 : 2 |
  | 支付方式映射 | TenderTyp : 值 | 现金 : 1、卡 : 2 |

- 在**零售 > 渠道设置 > 会计集成 > 会计连接器组**中创建**会计连接器组**。 连接器组是与会计连接器链接的功能配置文件的子集，会计连接器执行相同的功能，并在会计登记流程内用于同一个阶段。

   - 向连接器组添加功能配置文件。 在**功能配置文件**页单击**添加**并选择配置文件编号。
   - 如果要暂停功能配置文件的使用，将**禁用**设置为**是**。 
   
     此更改只影响当前的连接器组。 您可以在其他连接器组中继续使用相同的功能配置文件。

     >[!NOTE]
     > 在连接器组内，每个会计连接器只能有一个功能配置文件。

- 在**零售 > 渠道设置 > 会计集成 > 连接器技术配置文件**中为每个会计连接器创建**连接器技术配置文件**。
  - 选择连接器名称。
  - 选择连接器类型： 
      - **本地** - 在本地计算机上为安装的物理设备或应用程序设置此类型。
      - **内部** - 为连接到 Retail Server 的税控设备和服务设置此类型。
      - **外部** - 用于税务主管机构提供的 Web 门户等外部会计服务。
    
  - 在**连接**选项卡上指定设置。

      
 >[!NOTE]
 > 之前加载的更新的配置版本将同时为功能和技术配置文件加载。 如果合适的连接器或凭据提供程序已在使用，您将收到通知。 默认情况下，在功能和技术配置文件中手动进行的所有更改将被存储。 要使用来自配置的一组默认参数覆盖这些配置文件，请单击**连接器功能配置文件**页和**连接器技术配置文件**页上的**更新**。
 
- 在**零售 > 渠道设置 > 会计集成 > 会计登记流程**中为每个会计集成的唯一流程创建**会计登记流程**。 登记流程由登记步骤的顺序和每个步骤中使用的连接器组定义。 
  
  - 向流程添加登记步骤：
      - 单击**添加**。
      - 选择连接器类型。
      
      >[!NOTE]
      > 此字段定义系统将在技术配置文件中的哪个位置搜索连接器，在连接器类型为**本地**的硬件配置文件中，或者其他会计连接器类型的 POS 功能配置文件中。
      
   - 选择连接器组。
   
     >[!NOTE]
     > 单击**验证**检查登记流程结构的完整性。 建议在以下情况下进行验证：
       >- 对于在所有设置完成后的新登记流程，包括绑定到 POS 功能配置文件和硬件配置文件。
       >- 在对现有的登记流程进行更新后。

-  在**零售 > 渠道设置 > POS 设置 > POS 配置文件 > 功能配置文件**中将会计登记流程绑定到 POS 功能配置文件。
   - 在**会计登记流程**选项卡上单击**编辑**并选择**流程编号**。
- 在**零售 > 渠道设置 > POS 设置 > POS 配置文件 > 硬件配置文件**中将连接器技术配置文件绑定到硬件配置文件。
   - 单击**编辑**，然后单击**会计技术配置文件** 选项卡上的**新建**。
   - 在**配置文件编号**字段中选择连接器技术配置文件。
   
     >[!NOTE]
     > 您可以将多个技术配置文件添加到硬件配置文件。 但是，如果硬件配置文件具有与任何连接器组的交集时，这不受支持。 为了避免错误设置，建议您在更新所有硬件配置文件后验证登记流程。

