---
title: 零售渠道的会计整合概览
description: 此主题提供 Microsoft Dynamics 365 for Retail 中可用的会计整合功能的概览。
author: josaw
manager: annbe
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 3c6092a7eba328048ef2f28188c42f33cb1f7136
ms.sourcegitcommit: 2b890cd7a801055ab0ca24398efc8e4e777d4d8c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "1516230"
---
# <a name="overview-of-fiscal-integration-for-retail-channels"></a><span data-ttu-id="add4a-103">零售渠道的会计整合概览</span><span class="sxs-lookup"><span data-stu-id="add4a-103">Overview of fiscal integration for Retail channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="add4a-104">简介</span><span class="sxs-lookup"><span data-stu-id="add4a-104">Introduction</span></span>

<span data-ttu-id="add4a-105">此主题是 Microsoft Dynamics 365 for Retail 中可用的会计整合功能的概览。</span><span class="sxs-lookup"><span data-stu-id="add4a-105">This topic is an overview of the fiscal integration capabilities that are available in Microsoft Dynamics 365 for Retail.</span></span> <span data-ttu-id="add4a-106">会计整合包括与不同会计设备和服务的集成，这些设备和服务支持依据旨在防止零售行业的税收欺诈的地方政法进行零售销售的会计登记。</span><span class="sxs-lookup"><span data-stu-id="add4a-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of retail sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="add4a-107">以下是可以使用会计整合应对的一些典型场景：</span><span class="sxs-lookup"><span data-stu-id="add4a-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="add4a-108">在连接到 Retail point of sale (POS) 的会计设备（如税控打印机）上登记零售销售，以及为客户打印财务收据。</span><span class="sxs-lookup"><span data-stu-id="add4a-108">Register a retail sale on a fiscal device that is connected to Retail point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="add4a-109">安全地向税务主管机构管理的外部 Web 服务提交与在 Retail POS 完成的销售和退货相关的信息。</span><span class="sxs-lookup"><span data-stu-id="add4a-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="add4a-110">通过数字签名帮助确保销售交易数据的不变性。</span><span class="sxs-lookup"><span data-stu-id="add4a-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="add4a-111">Retail 中的会计整合功能是一个框架，为进一步开发和自定义 Retail POS 与会计设备和服务之间的整合提供通用解决方案。</span><span class="sxs-lookup"><span data-stu-id="add4a-111">The fiscal integration functionality in Retail is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="add4a-112">此功能还包括支持特定国家或地区的基本零售方案，以及使用特定会计设备或服务的会计整合示例。</span><span class="sxs-lookup"><span data-stu-id="add4a-112">The functionality also includes fiscal integration samples that support basic retail scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="add4a-113">会计整合示例由若干 Retail 组件的扩展组成，包含在 Retail 软件开发套件 (SDK) 中。</span><span class="sxs-lookup"><span data-stu-id="add4a-113">A fiscal integration sample consists of several extensions of Retail components and is included in the Retail software development kit (SDK).</span></span> <span data-ttu-id="add4a-114">有关 Retail SDK 中可用的会计整合示例的详细信息，请参阅 [Retail SDK 中的会计整合示例](#fiscal-integration-samples-in-the-retail-sdk)。</span><span class="sxs-lookup"><span data-stu-id="add4a-114">For more information about the fiscal integration samples that are available in the Retail SDK, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="add4a-115">有关如何安装和使用 Retail SDK 的信息，请参阅 [Retail SDK 概述](../dev-itpro/retail-sdk/retail-sdk-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="add4a-115">For information about how to install and use the Retail SDK, see [Retail SDK overview](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="add4a-116">为了支持会计整合示例不支持的其他方案，将 Retail POS 与其他会计设备或服务整合，或者满足其他国家或地区的要求，您必须扩展用现有的会计整合示例或将现有示例用作范例创建新示例。</span><span class="sxs-lookup"><span data-stu-id="add4a-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="add4a-117">会计设备的会计登记流程和会计整合示例</span><span class="sxs-lookup"><span data-stu-id="add4a-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="add4a-118">Retail POS 中的会计登记流程可以包含一个或多个步骤。</span><span class="sxs-lookup"><span data-stu-id="add4a-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="add4a-119">每个步骤涉及一个会计设备或服务的特定零售交易或事件的会计登记。</span><span class="sxs-lookup"><span data-stu-id="add4a-119">Each step involves fiscal registration of specific retail transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="add4a-120">以下解决方案组件参与连接到硬件工作站的会计设备上的会计登记：</span><span class="sxs-lookup"><span data-stu-id="add4a-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="add4a-121">**Commerce runtime (CRT) 扩展** – 此组件序列化同时用于与会计设备交互的格式的零售交易/事件数据，分析来自会计设备的回应，并在通道数据库中存储响应。</span><span class="sxs-lookup"><span data-stu-id="add4a-121">**Commerce runtime (CRT) extension** – This component serializes retail transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="add4a-122">此扩展还定义必须登记的特定交易和事件。</span><span class="sxs-lookup"><span data-stu-id="add4a-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="add4a-123">此组件通常称为*会计单据提供程序*。</span><span class="sxs-lookup"><span data-stu-id="add4a-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="add4a-124">**硬件工作站扩展** – 此组件初始化与会计设备的通信，基于从会计单据提取的零售交易/事件数据向会计设备发送请求和直接命令，并接收来自会计设备的响应。</span><span class="sxs-lookup"><span data-stu-id="add4a-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the retail transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="add4a-125">此组件通常称为*会计连接器*。</span><span class="sxs-lookup"><span data-stu-id="add4a-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="add4a-126">会计设备的会计整合示例分别包含会计单据提供程序和会计连接器的 CRT 和硬件工作站扩展。</span><span class="sxs-lookup"><span data-stu-id="add4a-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="add4a-127">它还包含以下组件配置：</span><span class="sxs-lookup"><span data-stu-id="add4a-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="add4a-128">**会计单据提供程序配置** – 此配置定义会计单据的输出方法和格式。</span><span class="sxs-lookup"><span data-stu-id="add4a-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="add4a-129">它还包含税收和付款方式的数据映射，以使 Retail POS 中的数据与会计设备固件中预定义的值兼容。</span><span class="sxs-lookup"><span data-stu-id="add4a-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="add4a-130">**会计连接器配置** – 此配置定义与特定会计设备的实际通信。</span><span class="sxs-lookup"><span data-stu-id="add4a-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="add4a-131">特定 POS 登记的会计登记流程由 POS 功能配置文件中的相应设置定义。</span><span class="sxs-lookup"><span data-stu-id="add4a-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="add4a-132">有关如何配置会计登记流程、上载会计单据提供程序和会计连接器配置以及更改其参数的更多详细信息，请参阅[设置会计登记流程](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process)。</span><span class="sxs-lookup"><span data-stu-id="add4a-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="add4a-133">以下示例显示会计设备的典型会计登记执行流。</span><span class="sxs-lookup"><span data-stu-id="add4a-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="add4a-134">此流从 POS 中的事件开始（例如，销售交易的最终完成），实现以下步骤序列：</span><span class="sxs-lookup"><span data-stu-id="add4a-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="add4a-135">POS 从 CRT 请求会计单据。</span><span class="sxs-lookup"><span data-stu-id="add4a-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="add4a-136">CRT 确定当前事件是否需要会计登记。</span><span class="sxs-lookup"><span data-stu-id="add4a-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="add4a-137">基于会计登记流程设置，CRT 标识用于会计登记的会计连接器和对应的会计单据提供程序。</span><span class="sxs-lookup"><span data-stu-id="add4a-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="add4a-138">CRT 运行生成表示零售交易或事件的会计单据（例如，XML 文档）的会计单据提供程序。</span><span class="sxs-lookup"><span data-stu-id="add4a-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the retail transaction or event.</span></span>
5. <span data-ttu-id="add4a-139">POS 将 CRT 准备的会计单据发送到硬件工作站。</span><span class="sxs-lookup"><span data-stu-id="add4a-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="add4a-140">硬件工作站运行处理会计单据并将其传送到会计设备或服务的会计连接器。</span><span class="sxs-lookup"><span data-stu-id="add4a-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="add4a-141">POS 分析来自会计设备或服务的响应以确定会计登记是否成功。</span><span class="sxs-lookup"><span data-stu-id="add4a-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="add4a-142">CRT 将响应保存到通道数据库。</span><span class="sxs-lookup"><span data-stu-id="add4a-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="add4a-143">![解决方案架构](media/emea-fiscal-integration-solution.png "解决方案架构")</span><span class="sxs-lookup"><span data-stu-id="add4a-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="add4a-144">错误处理</span><span class="sxs-lookup"><span data-stu-id="add4a-144">Error handling</span></span>

<span data-ttu-id="add4a-145">会计整合框架在会计登记期间提供以下处理失败情况的选项：</span><span class="sxs-lookup"><span data-stu-id="add4a-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="add4a-146">**重试** – 操作员可以在失败能够快速解决时使用此选项，会计登记可以重新运行。</span><span class="sxs-lookup"><span data-stu-id="add4a-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="add4a-147">例如，此选项可以在会计设备未连接、税控打印机缺纸或税控打印机卡纸时使用。</span><span class="sxs-lookup"><span data-stu-id="add4a-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="add4a-148">**取消** – 此选项允许操作员在登记失败时延期当前交易或事件的会计登记。</span><span class="sxs-lookup"><span data-stu-id="add4a-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="add4a-149">登记延期后，操作员可以继续在 POS 上工作，并可以完成不需要会计登记的任何操作。</span><span class="sxs-lookup"><span data-stu-id="add4a-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="add4a-150">在需要会计登记的任何事件在 POS 中发生时（例如，打开新交易记录），错误处理对话框将自动显示以通知操作员上一项交易未正确登记并提供错误处理选项。</span><span class="sxs-lookup"><span data-stu-id="add4a-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="add4a-151">**跳过** – 操作可以在会计登记可在特定条件下忽略并且可以继续在 POS 上执行常规操作时使用此选项。</span><span class="sxs-lookup"><span data-stu-id="add4a-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="add4a-152">例如，当会计登记失败的销售交易可以在特殊的纸质日记帐中登记时，可以使用此选项。</span><span class="sxs-lookup"><span data-stu-id="add4a-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="add4a-153">**标记为已登记** – 当交易在会计设备中实际已登记（例如，财务收据已打印），但在会计响应保存到通道数据库时失败的情况下，操作员可以使用此选项。</span><span class="sxs-lookup"><span data-stu-id="add4a-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="add4a-154">在使用前，**跳过**和**标记为已登记**选项必须在会计登记流程中启用。</span><span class="sxs-lookup"><span data-stu-id="add4a-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="add4a-155">此外，必须向操作员授予相应权限。</span><span class="sxs-lookup"><span data-stu-id="add4a-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="add4a-156">**跳过**和**标记为已登记**选项支持信息代码获取有关失败的一些具体信息，如失败原因或跳过会计登记或将交易标记为已登记的理由。</span><span class="sxs-lookup"><span data-stu-id="add4a-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="add4a-157">有关如何设置错误处理参数的更多详细信息，请参阅[设置错误处理设置](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings)。</span><span class="sxs-lookup"><span data-stu-id="add4a-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="add4a-158">可选会计登记</span><span class="sxs-lookup"><span data-stu-id="add4a-158">Optional fiscal registration</span></span>

<span data-ttu-id="add4a-159">会计登记对某些操作而言为强制，但对其他操作则为可选。</span><span class="sxs-lookup"><span data-stu-id="add4a-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="add4a-160">例如，常规销售和退货的会计登记可能为强制，但是与客户存款有关的操作的会计登记可能为可选。</span><span class="sxs-lookup"><span data-stu-id="add4a-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="add4a-161">在此情况下，未能完成销售的会计登记可能会妨碍更多销售，但是未能完成客户存款的会计登记应该不会妨碍更多销售。</span><span class="sxs-lookup"><span data-stu-id="add4a-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="add4a-162">若要区分强制操作和可选操作，建议通过不同单据提供程序处理，并且在这些提供程序的会计登记流程中设置单独的步骤。</span><span class="sxs-lookup"><span data-stu-id="add4a-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="add4a-163">应该为与可选会计登记有关的所有步骤启用**出错时继续**参数。</span><span class="sxs-lookup"><span data-stu-id="add4a-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="add4a-164">有关如何设置错误处理参数的更多详细信息，请参阅[设置错误处理设置](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings)。</span><span class="sxs-lookup"><span data-stu-id="add4a-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="add4a-165">手动运行会计登记</span><span class="sxs-lookup"><span data-stu-id="add4a-165">Manually running fiscal registration</span></span>

<span data-ttu-id="add4a-166">如果失败后已推迟了交易记录或事件的会计登记（例如，如果操作员在错误处理对话框中选择了**取消**），可以通过调用相应操作手动重新运行会计登记。</span><span class="sxs-lookup"><span data-stu-id="add4a-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="add4a-167">有关更多详细信息，请参阅[启用已推迟会计登记的手动执行](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration)。</span><span class="sxs-lookup"><span data-stu-id="add4a-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="add4a-168">会计登记运行状况检查</span><span class="sxs-lookup"><span data-stu-id="add4a-168">Fiscal registration health check</span></span>

<span data-ttu-id="add4a-169">会计登记的运行状况检查过程用于在特定事件发生时验证会计设备或服务的可用性。</span><span class="sxs-lookup"><span data-stu-id="add4a-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="add4a-170">如果当前不能完成会计登记，将提前通知操作员。</span><span class="sxs-lookup"><span data-stu-id="add4a-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="add4a-171">发生以下事件时，POS 将运行运行状况检查：</span><span class="sxs-lookup"><span data-stu-id="add4a-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="add4a-172">开立了新交易记录。</span><span class="sxs-lookup"><span data-stu-id="add4a-172">A new transaction is opened.</span></span>
- <span data-ttu-id="add4a-173">撤回了封存的交易记录。</span><span class="sxs-lookup"><span data-stu-id="add4a-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="add4a-174">完成了销售或退货交易记录。</span><span class="sxs-lookup"><span data-stu-id="add4a-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="add4a-175">如果运行状况检查失败，POS 将显示运行状况检查对话框。</span><span class="sxs-lookup"><span data-stu-id="add4a-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="add4a-176">此对话框中提供以下按钮：</span><span class="sxs-lookup"><span data-stu-id="add4a-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="add4a-177">**确定** – 操作员可使用此按钮忽略运行状况检查错误并继续处理操作。</span><span class="sxs-lookup"><span data-stu-id="add4a-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="add4a-178">仅当为其启用了**允许跳过运行状况检查错误**权限，操作员才能选择此按钮。</span><span class="sxs-lookup"><span data-stu-id="add4a-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="add4a-179">**取消** – 如果操作员选择此按钮，POS 将取消最后一个操作（例如，不向新交易记录添加某项）。</span><span class="sxs-lookup"><span data-stu-id="add4a-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="add4a-180">仅当当前操作需要会计登记，并且为会计登记流程的当前步骤禁用了**出错时继续**参数，才会运行运行状况检查。</span><span class="sxs-lookup"><span data-stu-id="add4a-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="add4a-181">有关更多详细信息，请参阅[设置错误处理设置](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings)。</span><span class="sxs-lookup"><span data-stu-id="add4a-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="add4a-182">在会计交易记录中存储会计响应</span><span class="sxs-lookup"><span data-stu-id="add4a-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="add4a-183">当交易或事件的会计登记成功时，会计交易记录将在通道数据库中创建并链接到原始交易或事件。</span><span class="sxs-lookup"><span data-stu-id="add4a-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="add4a-184">同样，如果为失败的会计登记选择了**跳过**或**标记为已登记**选项，此信息将存储在会计交易记录中。</span><span class="sxs-lookup"><span data-stu-id="add4a-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="add4a-185">会计交易记录保留会计设备或服务的会计响应。</span><span class="sxs-lookup"><span data-stu-id="add4a-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="add4a-186">如果会计登记流程包括多个步骤，将为登记成功或失败的流程的每个步骤创建一个会计交易记录。</span><span class="sxs-lookup"><span data-stu-id="add4a-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="add4a-187">会计交易记录通过 *P 作业*与零售交易记录一起转移到Retail Headquarters。</span><span class="sxs-lookup"><span data-stu-id="add4a-187">Fiscal transactions are transferred to Retail Headquarters by the *P-job*, together with retail transactions.</span></span> <span data-ttu-id="add4a-188">在**零售商店交易记录**页的**会计交易记录**快速选项卡上，您可以查看链接到零售交易记录的会计交易记录。</span><span class="sxs-lookup"><span data-stu-id="add4a-188">On the **Fiscal transactions** FastTab of the **Retail store transactions** page, you can view the fiscal transactions that are linked to retail transactions.</span></span>

<span data-ttu-id="add4a-189">会计交易记录存储以下详细信息：</span><span class="sxs-lookup"><span data-stu-id="add4a-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="add4a-190">会计登记流程详细信息（流程、连接器组、连接器等）。</span><span class="sxs-lookup"><span data-stu-id="add4a-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="add4a-191">另外还存储**登记编号**字段中会计设备的序列号（如果此信息包含在会计响应中）。</span><span class="sxs-lookup"><span data-stu-id="add4a-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="add4a-192">会计登记的状态：**已完成**表示成功的登记，如果操作员为失败的登记选择了**跳过**选项则为**已跳过**，或者如果操作员选择了**标记为已登记**选项，则为**标记为已登记**。</span><span class="sxs-lookup"><span data-stu-id="add4a-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="add4a-193">与所选会计交易记录相关的信息代码交易记录。</span><span class="sxs-lookup"><span data-stu-id="add4a-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="add4a-194">要查看信息代码交易记录，在**会计交易记录**快速选项卡上，选择状态为**已跳过**或**标记为已登记**的会计交易记录，然后选择**信息代码交易记录**。</span><span class="sxs-lookup"><span data-stu-id="add4a-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="add4a-195">折扣的会计文本</span><span class="sxs-lookup"><span data-stu-id="add4a-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="add4a-196">某些国家或地区对在应用不同类型的折扣时必须在财务收据上打印的其他文本有特殊要求。</span><span class="sxs-lookup"><span data-stu-id="add4a-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="add4a-197">会计整合功能允许您在财务收据上打印的折扣行后面设置特殊的折扣文本。</span><span class="sxs-lookup"><span data-stu-id="add4a-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="add4a-198">对于手动折扣，您可以为在 POS 功能配置文件中指定为**产品折扣**信息代码的信息代码配置会计文本。</span><span class="sxs-lookup"><span data-stu-id="add4a-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="add4a-199">有关如何为折扣设置会计文本的更多详细信息，请参阅[设置折扣的会计文本](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts)。</span><span class="sxs-lookup"><span data-stu-id="add4a-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="add4a-200">打印会计 X 和会计 Z 报表</span><span class="sxs-lookup"><span data-stu-id="add4a-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="add4a-201">会计整合功能支持生成特定于整合的会计设备或服务的日结报表：</span><span class="sxs-lookup"><span data-stu-id="add4a-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="add4a-202">运行相应操作的新按钮应添加到 POS 屏幕布局。</span><span class="sxs-lookup"><span data-stu-id="add4a-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="add4a-203">更多详细信息，请参阅[从 POS 设置会计 X/Z 报表](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos)。</span><span class="sxs-lookup"><span data-stu-id="add4a-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="add4a-204">在会计整合示例中，这些操作应匹配到会计设备的相应操作。</span><span class="sxs-lookup"><span data-stu-id="add4a-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="add4a-205">Retail SDK 中的会计整合示例</span><span class="sxs-lookup"><span data-stu-id="add4a-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="add4a-206">以下会计整合示例当前在通过 Retail 发布的 Retail SDK 中可用：</span><span class="sxs-lookup"><span data-stu-id="add4a-206">The following fiscal integration samples are currently available in the Retail SDK that is released with Retail:</span></span>

- [<span data-ttu-id="add4a-207">意大利税控打印机集成示例</span><span class="sxs-lookup"><span data-stu-id="add4a-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="add4a-208">波兰税控打印机集成示例</span><span class="sxs-lookup"><span data-stu-id="add4a-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="add4a-209">奥地利的会计登记服务集成示例</span><span class="sxs-lookup"><span data-stu-id="add4a-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="add4a-210">捷克共和国的会计登记服务集成示例</span><span class="sxs-lookup"><span data-stu-id="add4a-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)

<span data-ttu-id="add4a-211">以下会计整合功能也在 Retail SDK 中可用，但当前不利用会计整合框架。</span><span class="sxs-lookup"><span data-stu-id="add4a-211">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="add4a-212">在以后的更新中已计划了将此功能迁移到会计整合框架。</span><span class="sxs-lookup"><span data-stu-id="add4a-212">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>

- [<span data-ttu-id="add4a-213">法国数字签名</span><span class="sxs-lookup"><span data-stu-id="add4a-213">Digital signature for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="add4a-214">挪威数字签名</span><span class="sxs-lookup"><span data-stu-id="add4a-214">Digital signature for Norway</span></span>](emea-nor-cash-registers.md)
- [<span data-ttu-id="add4a-215">瑞典的控制单元集成示例</span><span class="sxs-lookup"><span data-stu-id="add4a-215">Control unit integration sample for Sweden</span></span>](./retail-sdk-control-unit-sample.md)
