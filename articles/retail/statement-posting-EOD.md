---
title: "对帐单过帐功能改进"
description: "此主题介绍对对报单过帐功能的改进。"
author: josaw1
manager: AnnBe
ms.date: 04/26/2016
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: retail
ms.author: anpurush
ms.search.validFrom: 2018-04-30
ms.dyn365.ops.version: AX 7.0.0, Retail July 2017 update
ms.translationtype: HT
ms.sourcegitcommit: 190d0b59ad2e232b33b3c0d1700cbaf95c45aeca
ms.openlocfilehash: 3e8c5466a68fa87326c46a4e36bf7399be1279c6
ms.contentlocale: zh-cn
ms.lasthandoff: 01/04/2019

---

# <a name="improvements-to-statement-posting-functionality"></a><span data-ttu-id="8ceec-103">对帐单过帐功能改进</span><span class="sxs-lookup"><span data-stu-id="8ceec-103">Improvements to statement posting functionality</span></span>

[!include[banner](includes/banner.md)]

<span data-ttu-id="8ceec-104">此主题介绍对对报单过帐功能的第一组改进。</span><span class="sxs-lookup"><span data-stu-id="8ceec-104">This topic describes the first set of improvements that have been made to the statement posting feature.</span></span> <span data-ttu-id="8ceec-105">Microsoft Dynamics 365 for Finance and Operations 7.3.2 中提供了这些改进。</span><span class="sxs-lookup"><span data-stu-id="8ceec-105">These improvements are available in Microsoft Dynamics 365 for Finance and Operations 7.3.2.</span></span>

## <a name="activation"></a><span data-ttu-id="8ceec-106">激活</span><span class="sxs-lookup"><span data-stu-id="8ceec-106">Activation</span></span>

<span data-ttu-id="8ceec-107">默认情况下，部署 Finance and Operations 7.3.2 期间，程序设置为使用传统功能执行对帐单过帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-107">By default, during deployment of Finance and Operations 7.3.2, the program is set up to use the legacy feature for statement postings.</span></span> <span data-ttu-id="8ceec-108">若要启用改进的对帐单过帐功能，必须为其开启配置键。</span><span class="sxs-lookup"><span data-stu-id="8ceec-108">To enable the improved statement posting feature, you must turn on the configuration key for it.</span></span>

- <span data-ttu-id="8ceec-109">转至**系统管理** \> **设置** \> **许可证配置**，然后在**零售**节点下，清除**零售对帐单(旧)** 复选框，然后选中**零售对帐单**复选框。</span><span class="sxs-lookup"><span data-stu-id="8ceec-109">Go to **System administration** \> **Setup** \> **License configuration**, and then, under the **Retail** node, clear the **Retail statements (legacy)** check box, and select the **Retail statements** check box.</span></span>

<span data-ttu-id="8ceec-110">新的**零售对帐单**配置开启后，将有一个名称为**零售对帐单**的新菜单项。</span><span class="sxs-lookup"><span data-stu-id="8ceec-110">When the new **Retail statements** configuration key is turned on, a new menu item that is named **Retail statements** is available.</span></span> <span data-ttu-id="8ceec-111">可通过此菜单项手动创建、计算和过帐对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-111">This menu item lets you manually create, calculate, and post statements.</span></span> <span data-ttu-id="8ceec-112">可通过此菜单项访问执行批量过帐过程时导致错误的任何过帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-112">Any statement that causes an error when the batch posting process is used will also be available through this menu item.</span></span> <span data-ttu-id="8ceec-113">（开启**零售过帐单(旧)** 配置键后，此菜单项名称为**未结过帐单**。）</span><span class="sxs-lookup"><span data-stu-id="8ceec-113">(When the **Retail statements (legacy)** configuration key is turned on, the menu item is named **Open statements**.)</span></span>

<span data-ttu-id="8ceec-114">Finance and Operations 中包含与以下配置键有关的验证：</span><span class="sxs-lookup"><span data-stu-id="8ceec-114">Finance and Operations includes the following validations that are related to these configuration keys:</span></span>

- <span data-ttu-id="8ceec-115">这两个配置键不能同时开启。</span><span class="sxs-lookup"><span data-stu-id="8ceec-115">Both configuration keys can't be turned on at the same time.</span></span>
- <span data-ttu-id="8ceec-116">在给定过帐单生命周期（创建、计算、清除、过帐等）内，必须对为该对帐单执行的所有操作使用相同的配置键。</span><span class="sxs-lookup"><span data-stu-id="8ceec-116">The same configuration keys must be used for all the operations that are performed on a given statement during its lifecycle (Create, Calculate, Clear, Post, and so on).</span></span> <span data-ttu-id="8ceec-117">例如，不能在**零售对帐单(旧)** 配置键已开启时创建并计算一个对帐单，然后在**零售对帐单**配置键已开启时尝试过帐同一个对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-117">For example, you can't create and calculate a statement while the **Retail statement (legacy)** configuration key is turned on, and then try to post the same statement while the **Retail statement** configuration key is turned on.</span></span>

> [!NOTE]
> <span data-ttu-id="8ceec-118">建议使用**零售对帐单**配置键以利用改进的对帐单过帐功能，除非有充分的理由需要改用**零售对帐单(旧)** 配置键。</span><span class="sxs-lookup"><span data-stu-id="8ceec-118">We recommend that you use the **Retail statements** configuration key for the improved statement posting feature, unless you have compelling reasons to use the **Retail statements (legacy)** configuration key instead.</span></span> <span data-ttu-id="8ceec-119">Microsoft 将继续在新增对帐单过帐功能和改进的对帐单过帐功能上投入，而您最好抓住机会尽早转移过去，以便从中受益。</span><span class="sxs-lookup"><span data-stu-id="8ceec-119">Microsoft will continue to invest in the new and improved statement posting feature, and it's important that you switch to it at the earliest opportunity to benefit from it.</span></span> <span data-ttu-id="8ceec-120">在以后的版本中，将弃用旧对帐单过帐功能。</span><span class="sxs-lookup"><span data-stu-id="8ceec-120">The legacy statement posting feature will be deprecated in a future release.</span></span>

## <a name="setup"></a><span data-ttu-id="8ceec-121">设置</span><span class="sxs-lookup"><span data-stu-id="8ceec-121">Setup</span></span>

<span data-ttu-id="8ceec-122">在对帐单过帐功能的改进中，**零售参数**页**过帐**选项卡上**对帐单**快速选项卡上引入了三个新参数：</span><span class="sxs-lookup"><span data-stu-id="8ceec-122">As part of the improvements to the statement posting feature, three new parameters have been introduced on the **Statement** FastTab on the **Posting** tab of the **Retail parameters** page:</span></span>

- <span data-ttu-id="8ceec-123">**禁用清空对帐单** – 此选项仅适用于旧对帐单过帐功能。</span><span class="sxs-lookup"><span data-stu-id="8ceec-123">**Disable clear statement** – This option is applicable only for the legacy statement posting feature.</span></span> <span data-ttu-id="8ceec-124">建议将此选项设置为**否**，以免用户清空半过帐状态的对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-124">We recommend that you set this option to **No** to prevent users from clearing statements that are in a semi-posted state.</span></span> <span data-ttu-id="8ceec-125">如果清空半过帐状态的对帐单，将损坏数据。</span><span class="sxs-lookup"><span data-stu-id="8ceec-125">If statements that are in a semi-posted state are cleared, data becomes corrupted.</span></span> <span data-ttu-id="8ceec-126">应仅在特殊情况下才将此选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-126">You should set this option to **Yes** only in exceptional circumstances.</span></span>
- <span data-ttu-id="8ceec-127">**在计算过程中预留库存** – 建议对库存预留使用**过帐库存**批处理作业，并将此选项设置为**否**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-127">**Reserve inventory during calculation** – We recommend that you use the **Post inventory** batch job for inventory reservation, and that you set this option to **No**.</span></span> <span data-ttu-id="8ceec-128">如果此选项设置为**否**，则在计算时，改进的对帐单过帐功能不会尝试创建库存预留条目（如果未通过**过帐库存**批处理作业创建条目）。</span><span class="sxs-lookup"><span data-stu-id="8ceec-128">When this option is set to **No**, the improved statement posting feature doesn't try to create inventory reservation entries at the time of calculation (if entries weren't already created through the **Post inventory** batch job).</span></span> <span data-ttu-id="8ceec-129">相反，此功能仅在过帐时创建库存预留条目。</span><span class="sxs-lookup"><span data-stu-id="8ceec-129">Instead, the feature creates inventory reservation entries only at the time of posting.</span></span> <span data-ttu-id="8ceec-130">此实施为设计选项，基础是计算过程与过帐过程之间的时间段通常极小。</span><span class="sxs-lookup"><span data-stu-id="8ceec-130">This implementation was a design choice and was based on the fact that the time window between the calculation process and the posting process is typically small.</span></span> <span data-ttu-id="8ceec-131">但是，如果要在计算时预留库存，可将此选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-131">However, if you want to reserve inventory at the time of calculation, you can set this option to **Yes**.</span></span>

    <span data-ttu-id="8ceec-132">无论此选项如何设置，旧对帐单过帐功能始终在对帐单计算过程中预留库存（如果尚未通过**过帐库存**批处理作业执行预留）。</span><span class="sxs-lookup"><span data-stu-id="8ceec-132">The legacy statement posting feature always reserves inventory during the statement calculation process (if reservation wasn't already done through the **Post inventory** batch job), regardless of the setting of this option.</span></span>

- <span data-ttu-id="8ceec-133">**禁用所需的盘点** – 如果此选项设置为**是**，则继续执行对帐单过帐过程，即使对帐单的盘点金额与交易金额之差超出了零售商店的**对帐单**快速选项卡中定义的阈值。</span><span class="sxs-lookup"><span data-stu-id="8ceec-133">**Disable counting required** – When this option is set to **Yes**, the posting process for a statement continues, even if the difference between the counted amount and the transaction amount on the statement is outside the threshold that is defined on the **Statement** FastTab for Retail stores.</span></span>

<span data-ttu-id="8ceec-134">此外，**批处理**快速选项卡中已引入了**并行对帐单过帐的最大数目**字段。</span><span class="sxs-lookup"><span data-stu-id="8ceec-134">Additionally, the **Maximum number of parallel statement posting** field has been introduced on the **Batch processing** FastTab.</span></span> <span data-ttu-id="8ceec-135">此字段定义应同时运行的批处理任务数量。</span><span class="sxs-lookup"><span data-stu-id="8ceec-135">This field defines the number of batch tasks should be run at the same time.</span></span> <span data-ttu-id="8ceec-136">现在，必须手动设置此字段的值。</span><span class="sxs-lookup"><span data-stu-id="8ceec-136">Currently, you must manually set the value of this field.</span></span>

<span data-ttu-id="8ceec-137">此外，在使用新的过帐流程时，需要在**零售参数**页**过帐**选项卡上的**礼品卡**快速选项卡中定义**礼品卡产品**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-137">Also, with the new posting process, it is required to define a **Gift card product** on the **Gift card** FastTab on the **Posting** tab of the **Retail parameters** page.</span></span> <span data-ttu-id="8ceec-138">即使组织不使用礼品卡，这一条也成立。</span><span class="sxs-lookup"><span data-stu-id="8ceec-138">This is true even if no Gift cards are used by the organization.</span></span>

<span data-ttu-id="8ceec-139">请注意，与对帐单过帐有关的所有设置和参数，以及在零售商店上定义和在**零售参数**页上定义的设置和参数适用于改进的对帐单过帐功能。</span><span class="sxs-lookup"><span data-stu-id="8ceec-139">Note that all settings and parameters that are related to statement postings, and that are defined on Retail stores and on the **Retail parameters** page, are applicable to the improved statement posting feature.</span></span>

## <a name="processing"></a><span data-ttu-id="8ceec-140">处理中</span><span class="sxs-lookup"><span data-stu-id="8ceec-140">Processing</span></span>

<span data-ttu-id="8ceec-141">可使用菜单项**成批计算对帐单**和**成批过帐对帐单**计算和过帐对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-141">Statements can be calculated and posted in batch using the menu items **Calculate statements in batch** and **Post statements in batch**.</span></span> <span data-ttu-id="8ceec-142">也可以使用改进的对帐单过帐功能提供的**零售对帐单**菜单项手动计算和过帐对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-142">Alternatively, statements can be manually calculated and posted by using the **Retail statements** menu item that the improved statement posting feature provides.</span></span>

<span data-ttu-id="8ceec-143">成批计算对帐单和过帐对帐单的流程和步骤相同，因为它们曾经属于旧对帐单过帐功能。</span><span class="sxs-lookup"><span data-stu-id="8ceec-143">The process and steps for calculating and posting statements in a batch are the same as they were in the legacy statement posting feature.</span></span> <span data-ttu-id="8ceec-144">但是，已对对帐单的核心后端处理进行了重大改进。</span><span class="sxs-lookup"><span data-stu-id="8ceec-144">However, significant improvements have been made in the core back-end processing of the statements.</span></span> <span data-ttu-id="8ceec-145">这些改进提高了流程的弹性，可以更好地查看状态和错误信息。</span><span class="sxs-lookup"><span data-stu-id="8ceec-145">These improvements make the process more resilient, and provide for better visibility into the states and error information.</span></span> <span data-ttu-id="8ceec-146">因此，用户可以解决错误的根源，然后继续执行过帐流程，并且不会导致数据损坏，也不会导致需要修复数据。</span><span class="sxs-lookup"><span data-stu-id="8ceec-146">Therefore, users can address the root cause of errors and then continue the posting process without causing data corruption and without causing data fixes to be required.</span></span>

<span data-ttu-id="8ceec-147">以下部分介绍零售对帐单和已过帐对帐单的用户界面中显示的对帐单过帐功能的主要改进。</span><span class="sxs-lookup"><span data-stu-id="8ceec-147">The following sections describe some of the major improvements for the statement posting feature that appear in the user interface for retail statements and posted statements.</span></span>

### <a name="status-details"></a><span data-ttu-id="8ceec-148">状态详细信息</span><span class="sxs-lookup"><span data-stu-id="8ceec-148">Status details</span></span>

<span data-ttu-id="8ceec-149">计算流程和过帐流程中的对帐单过帐例程引入了新的状态模型。</span><span class="sxs-lookup"><span data-stu-id="8ceec-149">A new state model has been introduced in the statement posting routine across the calculation and posting processes.</span></span>

<span data-ttu-id="8ceec-150">下表介绍计算流程中的各种状态及其顺序。</span><span class="sxs-lookup"><span data-stu-id="8ceec-150">The following table describes the various states and their order during the calculation process.</span></span>

| <span data-ttu-id="8ceec-151">状态顺序</span><span class="sxs-lookup"><span data-stu-id="8ceec-151">State order</span></span> | <span data-ttu-id="8ceec-152">状态</span><span class="sxs-lookup"><span data-stu-id="8ceec-152">State</span></span>      | <span data-ttu-id="8ceec-153">说明</span><span class="sxs-lookup"><span data-stu-id="8ceec-153">Description</span></span> |
|-------------|------------|-------------|
| <span data-ttu-id="8ceec-154">1</span><span class="sxs-lookup"><span data-stu-id="8ceec-154">1</span></span>           | <span data-ttu-id="8ceec-155">已启动</span><span class="sxs-lookup"><span data-stu-id="8ceec-155">Started</span></span>    | <span data-ttu-id="8ceec-156">对帐单已创建并且已准备就绪，可以计算。</span><span class="sxs-lookup"><span data-stu-id="8ceec-156">The statement was created and is ready to be calculated.</span></span> |
| <span data-ttu-id="8ceec-157">2</span><span class="sxs-lookup"><span data-stu-id="8ceec-157">2</span></span>           | <span data-ttu-id="8ceec-158">已标记</span><span class="sxs-lookup"><span data-stu-id="8ceec-158">Marked</span></span>     | <span data-ttu-id="8ceec-159">对帐单范围内的交易记录根据对帐单参数标识，并使用对帐单 ID 标记。</span><span class="sxs-lookup"><span data-stu-id="8ceec-159">The transactions that are in scope for the statement are identified based on the statement parameters, and they are marked with the statement ID.</span></span> |
| <span data-ttu-id="8ceec-160">3</span><span class="sxs-lookup"><span data-stu-id="8ceec-160">3</span></span>           | <span data-ttu-id="8ceec-161">已计算</span><span class="sxs-lookup"><span data-stu-id="8ceec-161">Calculated</span></span> | <span data-ttu-id="8ceec-162">已计算并显示对帐单行。</span><span class="sxs-lookup"><span data-stu-id="8ceec-162">The statement lines are computed and shown.</span></span> |

<span data-ttu-id="8ceec-163">下表介绍对帐流程中的各种状态及其顺序。</span><span class="sxs-lookup"><span data-stu-id="8ceec-163">The following table describes the various states and their order during the posting process.</span></span>

| <span data-ttu-id="8ceec-164">状态顺序</span><span class="sxs-lookup"><span data-stu-id="8ceec-164">State order</span></span> | <span data-ttu-id="8ceec-165">状态</span><span class="sxs-lookup"><span data-stu-id="8ceec-165">State</span></span>                   | <span data-ttu-id="8ceec-166">说明</span><span class="sxs-lookup"><span data-stu-id="8ceec-166">Description</span></span> |
|-------------|-------------------------|-------------|
| <span data-ttu-id="8ceec-167">1</span><span class="sxs-lookup"><span data-stu-id="8ceec-167">1</span></span>           | <span data-ttu-id="8ceec-168">已检查</span><span class="sxs-lookup"><span data-stu-id="8ceec-168">Checked</span></span>                 | <span data-ttu-id="8ceec-169">已完成了与参数（如处置费用）、对帐单和对帐单行（例如，盘点金额与交易记录金额之差）有关的多项验证。</span><span class="sxs-lookup"><span data-stu-id="8ceec-169">Multiple validations are done that are related to parameters (for example, the disposition charge), and to the statement and statement lines (for example, the difference between the counted amount and the transaction amount).</span></span> |
| <span data-ttu-id="8ceec-170">2</span><span class="sxs-lookup"><span data-stu-id="8ceec-170">2</span></span>           | <span data-ttu-id="8ceec-171">已聚合</span><span class="sxs-lookup"><span data-stu-id="8ceec-171">Aggregated</span></span>              | <span data-ttu-id="8ceec-172">基于配置聚合指定的客户和未指定的客户的销售交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-172">Sales transactions for named and unnamed customers are aggregated based on the configuration.</span></span> <span data-ttu-id="8ceec-173">聚合的每个交易记录最终都会转换为销售订单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-173">Every aggregated transaction is eventually converted to a sales order.</span></span> |
| <span data-ttu-id="8ceec-174">3</span><span class="sxs-lookup"><span data-stu-id="8ceec-174">3</span></span>           | <span data-ttu-id="8ceec-175">客户订单已创建</span><span class="sxs-lookup"><span data-stu-id="8ceec-175">Customer order created</span></span>  | <span data-ttu-id="8ceec-176">已基于聚合交易记录在系统中创建了销售订单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-176">Based on the aggregated transaction, sales orders are created in the system.</span></span> |
| <span data-ttu-id="8ceec-177">4</span><span class="sxs-lookup"><span data-stu-id="8ceec-177">4</span></span>           | <span data-ttu-id="8ceec-178">客户订单已开票</span><span class="sxs-lookup"><span data-stu-id="8ceec-178">Customer order invoiced</span></span> | <span data-ttu-id="8ceec-179">已为销售订单开票。</span><span class="sxs-lookup"><span data-stu-id="8ceec-179">Sales orders are invoiced.</span></span> |
| <span data-ttu-id="8ceec-180">5</span><span class="sxs-lookup"><span data-stu-id="8ceec-180">5</span></span>           | <span data-ttu-id="8ceec-181">折扣已过帐</span><span class="sxs-lookup"><span data-stu-id="8ceec-181">Discounts posted</span></span>        | <span data-ttu-id="8ceec-182">已基于配置过帐了定期折扣日记帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-182">Periodic discount journals are posted based on the configuration.</span></span> |
| <span data-ttu-id="8ceec-183">6</span><span class="sxs-lookup"><span data-stu-id="8ceec-183">6</span></span>           | <span data-ttu-id="8ceec-184">收入/费用已过帐</span><span class="sxs-lookup"><span data-stu-id="8ceec-184">Income/expense posted</span></span>   | <span data-ttu-id="8ceec-185">收入/费用交易记录已作为凭证过帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-185">Income/expense transactions are posted as vouchers.</span></span> |
| <span data-ttu-id="8ceec-186">7</span><span class="sxs-lookup"><span data-stu-id="8ceec-186">7</span></span>           | <span data-ttu-id="8ceec-187">已链接凭证</span><span class="sxs-lookup"><span data-stu-id="8ceec-187">Vouchers linked</span></span>         | <span data-ttu-id="8ceec-188">付款日记帐已创建并链接至相应发票。</span><span class="sxs-lookup"><span data-stu-id="8ceec-188">Payment journals are created and linked to the corresponding invoice.</span></span> |
| <span data-ttu-id="8ceec-189">8</span><span class="sxs-lookup"><span data-stu-id="8ceec-189">8</span></span>           | <span data-ttu-id="8ceec-190">付款已过帐</span><span class="sxs-lookup"><span data-stu-id="8ceec-190">Payments posted</span></span>         | <span data-ttu-id="8ceec-191">付款日记帐已过帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-191">Payment journals are posted.</span></span> |
| <span data-ttu-id="8ceec-192">9</span><span class="sxs-lookup"><span data-stu-id="8ceec-192">9</span></span>           | <span data-ttu-id="8ceec-193">礼品卡已过帐</span><span class="sxs-lookup"><span data-stu-id="8ceec-193">Gift cards posted</span></span>       | <span data-ttu-id="8ceec-194">礼品卡交易记录已作为凭证过帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-194">Gift card transactions are posted as vouchers.</span></span> |
| <span data-ttu-id="8ceec-195">10</span><span class="sxs-lookup"><span data-stu-id="8ceec-195">10</span></span>          | <span data-ttu-id="8ceec-196">已过帐</span><span class="sxs-lookup"><span data-stu-id="8ceec-196">Posted</span></span>                  | <span data-ttu-id="8ceec-197">对帐单标记为已过帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-197">The statement is marked as posted.</span></span> |

<span data-ttu-id="8ceec-198">上面的表中的每种状态本质上都是独立的，并将在这些状态之间建立层次结构依赖关系。</span><span class="sxs-lookup"><span data-stu-id="8ceec-198">Every state in the preceding tables is independent in nature, and a hierarchical dependency is built between the states.</span></span> <span data-ttu-id="8ceec-199">此依赖关系自上而下。</span><span class="sxs-lookup"><span data-stu-id="8ceec-199">This dependency flows from top to bottom.</span></span> <span data-ttu-id="8ceec-200">如果系统在处理状态时遇到任何错误，将把对帐单的状态恢复为上一个状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-200">If the system encounters any errors while it's processing a state, the status of the statement is reverted to the previous state.</span></span> <span data-ttu-id="8ceec-201">以后只要重试此过程，都将从失败的状态恢复并继续。</span><span class="sxs-lookup"><span data-stu-id="8ceec-201">Any subsequent reattempt of the process resumes from the state that failed and continues to move forward.</span></span> <span data-ttu-id="8ceec-202">这种方法的优点如下：</span><span class="sxs-lookup"><span data-stu-id="8ceec-202">This approach has the following benefits:</span></span>

- <span data-ttu-id="8ceec-203">用户可以洞察出错的状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-203">The user has complete visibility into the state where the error occurred.</span></span>
- <span data-ttu-id="8ceec-204">避免损坏数据。</span><span class="sxs-lookup"><span data-stu-id="8ceec-204">Data corruption is avoided.</span></span> <span data-ttu-id="8ceec-205">例如，在传统对帐单过帐功能中，有时已经为一些销售订单开票，但是另一些却处于未结状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-205">For example, in the legacy statement posting feature, there were instances where some sales orders were invoiced but others were left open.</span></span> <span data-ttu-id="8ceec-206">还有时一些付款日记帐没有要结算的对应发票，因为发票过帐已出错。</span><span class="sxs-lookup"><span data-stu-id="8ceec-206">There were also instances where some payment journals didn't have a corresponding invoice to settle, because the invoice posting had an error.</span></span>
- <span data-ttu-id="8ceec-207">用户可以使用对帐单的**执行详细信息**组中的**状态详细信息**按钮查看对帐单的当前状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-207">Users can see the current state of a statement by using the **Status details** button in the **Execution details** group of the statement.</span></span> <span data-ttu-id="8ceec-208">状态详细信息页分为三部分：</span><span class="sxs-lookup"><span data-stu-id="8ceec-208">The status details page has three sections:</span></span>

    - <span data-ttu-id="8ceec-209">列表部分显示对帐单的当前状态，以及错误代码和详细的错误消息（如果出错）。</span><span class="sxs-lookup"><span data-stu-id="8ceec-209">The first section shows the current status of the statement, together with the error code and a detailed error message, if an error occurred.</span></span>
    - <span data-ttu-id="8ceec-210">第二部分显示计算过程的各状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-210">The second section shows the various states of the calculation process.</span></span> <span data-ttu-id="8ceec-211">可视提示指示已运行成功的状态、因出错而无法运行的状态和尚未运行的状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-211">Visual cues indicate states that have been successfully run, states that could not be run because of errors, and states that haven't yet been run.</span></span>
    - <span data-ttu-id="8ceec-212">第三部分显示过帐过程的各状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-212">The third section shows the various states of the posting process.</span></span> <span data-ttu-id="8ceec-213">可视提示指示已运行成功的状态、因出错而无法运行的状态和尚未运行的状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-213">Visual cues indicate states that have been successfully run, states that could not be run because of errors, and states that haven't yet been run.</span></span>

<span data-ttu-id="8ceec-214">此外，第二部分和第三部分的标题还显示相关过程的总体状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-214">Additionally, the header of the second and third sections shows the overall status of the relevant process.</span></span>

### <a name="event-logs"></a><span data-ttu-id="8ceec-215">事件日志</span><span class="sxs-lookup"><span data-stu-id="8ceec-215">Event logs</span></span>

<span data-ttu-id="8ceec-216">一个对帐单会经历各种操作（如创建、计算、清除和过帐），而在对帐单的生命周期内，可能会多次调用同一个操作。</span><span class="sxs-lookup"><span data-stu-id="8ceec-216">A statement goes through various operations (for example, Create, Calculate, Clear, and Post), and multiple instances of the same operation might be called during the statement's lifecycle.</span></span> <span data-ttu-id="8ceec-217">例如，创建并计算对帐单之后，用户可以清除并再次计算该对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-217">For example, after a statement is created and calculated, a user can clear the statement and calculate it again.</span></span> <span data-ttu-id="8ceec-218">对帐单的**执行详细信息**组中的**事件日志**按钮提供对对帐单调用的各操作的完整审计线索，以及有关何时调用这些操作的信息。</span><span class="sxs-lookup"><span data-stu-id="8ceec-218">The **Event logs** button in the **Execution details** group of the statement provides a complete audit trail of the various operations that were called on a statement, together with information about when those operations were called.</span></span>

### <a name="aggregated-transactions"></a><span data-ttu-id="8ceec-219">聚合交易记录</span><span class="sxs-lookup"><span data-stu-id="8ceec-219">Aggregated transactions</span></span>

<span data-ttu-id="8ceec-220">审计期间，将基于此配置聚合销售交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-220">During the posting process, the sales transactions are aggregated based on the configuration.</span></span> <span data-ttu-id="8ceec-221">这些聚合交易记录存储在系统中，用于创建销售订单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-221">These aggregated transactions are stored in the system and used to create sales orders.</span></span> <span data-ttu-id="8ceec-222">每个聚合交易记录在系统中创建一个对应的销售订单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-222">Every aggregated transaction creates one corresponding sales order in the system.</span></span> <span data-ttu-id="8ceec-223">可以使用对帐单的**执行详细信息**组中的**状态详细信息**按钮查看聚合交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-223">You can view the aggregated transactions by using the **Aggregated transactions** button in the **Execution details** group of the statement.</span></span>

<span data-ttu-id="8ceec-224">聚合交易记录的**销售订单详细信息**选项卡显示以下信息：</span><span class="sxs-lookup"><span data-stu-id="8ceec-224">The **Sales order detail** tab of an aggregated transaction shows the following information:</span></span>

- <span data-ttu-id="8ceec-225">**记录 ID** – 聚合交易记录的 ID。</span><span class="sxs-lookup"><span data-stu-id="8ceec-225">**Record ID** – The ID of the aggregated transaction.</span></span>
- <span data-ttu-id="8ceec-226">**对帐单编号** – 聚合交易记录所属的对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-226">**Statement number** – The statement that the aggregated transaction belongs to.</span></span>
- <span data-ttu-id="8ceec-227">**日期** – 聚合交易记录的创建日期。</span><span class="sxs-lookup"><span data-stu-id="8ceec-227">**Date** – The date when the aggregated transaction was created.</span></span>
- <span data-ttu-id="8ceec-228">**销售 ID** – 从聚合交易记录创建销售订单后的销售订单 ID。</span><span class="sxs-lookup"><span data-stu-id="8ceec-228">**Sales ID** – When a sales order is created from the aggregated transaction, the sales order ID.</span></span> <span data-ttu-id="8ceec-229">如果此字段为空，说明尚未创建对应的销售订单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-229">If this field is blank, the corresponding sales order hasn't been created.</span></span>
- <span data-ttu-id="8ceec-230">**已聚合的行的数目** – 聚合交易记录和销售订单的总行数。</span><span class="sxs-lookup"><span data-stu-id="8ceec-230">**Number of aggregated lines** – The total number of lines for the aggregated transaction and sales order.</span></span>
- <span data-ttu-id="8ceec-231">**状态** – 聚合交易记录的最新状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-231">**Status** – The last status of the aggregated transaction.</span></span>
- <span data-ttu-id="8ceec-232">**发票 ID** – 为聚合交易记录的销售订单开票后的销售发票 ID。</span><span class="sxs-lookup"><span data-stu-id="8ceec-232">**Invoice ID** – When the sales order for the aggregated transaction is invoiced, the sales invoice ID.</span></span> <span data-ttu-id="8ceec-233">如果此字段为空，说明尚未过帐销售订单的发票。</span><span class="sxs-lookup"><span data-stu-id="8ceec-233">If this field is blank, the invoice for the sales order hasn't been posted.</span></span>

<span data-ttu-id="8ceec-234">聚合交易记录的**交易记录明细**选项卡显示已提取到聚合交易记录中的所有零售交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-234">The **Transaction details** tab of an aggregated transaction shows all the retail transactions that have been pulled into the aggregated transaction.</span></span> <span data-ttu-id="8ceec-235">聚合交易记录上的聚合行显示来自零售交易记录的所有聚合记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-235">The aggregated lines on the aggregated transaction show all the aggregated records from the retail transactions.</span></span> <span data-ttu-id="8ceec-236">聚合行还显示所有详细信息，如物流、变型、数量、价格、净额、单位和仓库。</span><span class="sxs-lookup"><span data-stu-id="8ceec-236">The aggregated lines also show details such as the item, variant, quantity, price, net amount, unit, and warehouse.</span></span> <span data-ttu-id="8ceec-237">基本上，每个聚合行都对应一个销售订单行。</span><span class="sxs-lookup"><span data-stu-id="8ceec-237">Basically, each aggregated line corresponds to one sales order line.</span></span>

<span data-ttu-id="8ceec-238">可通过使用**导出销售订单 XML** 按钮从**聚合交易记录**页下载特定聚合交易记录的 XML。</span><span class="sxs-lookup"><span data-stu-id="8ceec-238">From the **Aggregated transactions** page, you can download the XML for a specific aggregated transaction by using the **Export sales order XML** button.</span></span> <span data-ttu-id="8ceec-239">可使用该 XML 调试涉及销售订单创建和过帐的问题。</span><span class="sxs-lookup"><span data-stu-id="8ceec-239">You can use the XML to debug issues that involve sales order creation and posting.</span></span> <span data-ttu-id="8ceec-240">只需下载该 XML，将其上传到测试环境，然后在测试环境中调试问题。</span><span class="sxs-lookup"><span data-stu-id="8ceec-240">Just download the XML, upload it to a test environment, and debug the issue in the test environment.</span></span> <span data-ttu-id="8ceec-241">已过帐的对帐单不支持下载聚合交易记录的 XML。</span><span class="sxs-lookup"><span data-stu-id="8ceec-241">The functionality for downloading the XML for aggregated transactions isn't available for statements that have been posted.</span></span>

<span data-ttu-id="8ceec-242">聚合交易记录具有以下优点：</span><span class="sxs-lookup"><span data-stu-id="8ceec-242">The aggregated transaction view provides the following benefits:</span></span>

- <span data-ttu-id="8ceec-243">用户可以查看销售订单创建期间失败的聚合交易记录和开票期间失败的销售订单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-243">The user has visibility into the aggregated transactions that failed during sales order creation and the sales orders that failed during invoicing.</span></span>
- <span data-ttu-id="8ceec-244">用户可以查看交易记录如何聚集。</span><span class="sxs-lookup"><span data-stu-id="8ceec-244">The user has visibility into how transactions are aggregated.</span></span>
- <span data-ttu-id="8ceec-245">用户拥有从零售交易记录到销售订单，再到销售发票的完整审计线索。</span><span class="sxs-lookup"><span data-stu-id="8ceec-245">The user has a complete audit trail, from retail transactions, to sales orders, to sales invoices.</span></span> <span data-ttu-id="8ceec-246">此审计线索在传统对帐单过帐功能中不可用。</span><span class="sxs-lookup"><span data-stu-id="8ceec-246">This audit trail wasn't available in the legacy statement posting feature.</span></span>
- <span data-ttu-id="8ceec-247">通过聚合 XML 文件可以更轻松地识别销售订单创建和开票期间出现的问题。</span><span class="sxs-lookup"><span data-stu-id="8ceec-247">Aggregated XML file make it easier to identify issues during sales order creation and invoicing.</span></span>

### <a name="journal-vouchers"></a><span data-ttu-id="8ceec-248">日记帐凭证</span><span class="sxs-lookup"><span data-stu-id="8ceec-248">Journal vouchers</span></span>

<span data-ttu-id="8ceec-249">对帐单的**执行详细信息**组中的**日记帐凭证**按钮显示为对帐单创建的和为与折扣、收入/费用科目、礼品卡等有关的所有各种凭证交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-249">The **Journal vouchers** button in the **Execution details** group of the statement shows all the various voucher transactions that are created for a statement, and that are related to discounts, income/expense accounts, gift cards, and so on.</span></span>

<span data-ttu-id="8ceec-250">本程序现在仅显示已过帐对帐单的这些数据。</span><span class="sxs-lookup"><span data-stu-id="8ceec-250">Currently, the program shows this data only for posted statements.</span></span>

### <a name="payment-journals"></a><span data-ttu-id="8ceec-251">付款日记帐</span><span class="sxs-lookup"><span data-stu-id="8ceec-251">Payment journals</span></span>

<span data-ttu-id="8ceec-252">对帐单的**执行详细信息**组中的**付款日记帐**按钮显示为对帐单创建的所有各种付款日记帐。</span><span class="sxs-lookup"><span data-stu-id="8ceec-252">The **Payment journals** button in the **Execution details** group of the statement shows all the various payment journals that are created for a statement.</span></span>

<span data-ttu-id="8ceec-253">本程序现在仅显示已过帐对帐单的这些数据。</span><span class="sxs-lookup"><span data-stu-id="8ceec-253">Currently, the program shows this data only for posted statements.</span></span>

## <a name="other-improvements"></a><span data-ttu-id="8ceec-254">其他改进</span><span class="sxs-lookup"><span data-stu-id="8ceec-254">Other improvements</span></span>

<span data-ttu-id="8ceec-255">已对对帐单过帐功能进行了用户可查看的其他后端改进。</span><span class="sxs-lookup"><span data-stu-id="8ceec-255">Other, back-end improvements that users can see have been made to the statement posting feature.</span></span> <span data-ttu-id="8ceec-256">下面举了一些示例加以说明：</span><span class="sxs-lookup"><span data-stu-id="8ceec-256">Here are some examples:</span></span>

- <span data-ttu-id="8ceec-257">聚合不考虑员工、终端和班次实体。</span><span class="sxs-lookup"><span data-stu-id="8ceec-257">The aggregation doesn't consider the staff, terminal, and shift entities.</span></span> <span data-ttu-id="8ceec-258">由于聚合参数较少，所以必须处理的销售订单行也较少。</span><span class="sxs-lookup"><span data-stu-id="8ceec-258">Because there are fewer aggregation parameters, fewer sales order lines must be processed.</span></span>
- <span data-ttu-id="8ceec-259">通过引入更多扩展表和对零售交易记录表执行插入操作，而不是执行更新操作，降低了零售交易记录表死锁的出现。</span><span class="sxs-lookup"><span data-stu-id="8ceec-259">The occurrence of deadlock on retail transaction tables is reduced by introducing additional extension tables and by doing insert operations instead of update operations on the retail transaction tables.</span></span>
- <span data-ttu-id="8ceec-260">运行批处理任务的数量已参数化并受到限制。</span><span class="sxs-lookup"><span data-stu-id="8ceec-260">The number of running batch tasks has been parameterized and limited.</span></span> <span data-ttu-id="8ceec-261">因此，可专门针对客户的环境调整此数字。</span><span class="sxs-lookup"><span data-stu-id="8ceec-261">Therefore, this number can be fine-tuned specifically to a customer's environment.</span></span> <span data-ttu-id="8ceec-262">在传统对帐单过帐功能中，同时可创建的批处理任务数量不受限制。</span><span class="sxs-lookup"><span data-stu-id="8ceec-262">In the legacy statement posting feature, an unlimited number of batch tasks was created at the same time.</span></span> <span data-ttu-id="8ceec-263">结果是服务器承受难以处理的负载、开销和瓶颈。</span><span class="sxs-lookup"><span data-stu-id="8ceec-263">The results were unmanageable loads, overhead, and bottlenecks on the batch server.</span></span>
- <span data-ttu-id="8ceec-264">可通过为具有最大交易记录数量的对帐单设置优先级，高效地为对帐单设置队列以进行处理。</span><span class="sxs-lookup"><span data-stu-id="8ceec-264">Statements are efficiently queued for processing by prioritizing the statements that have the maximum number of transactions.</span></span>
- <span data-ttu-id="8ceec-265">**成批计算对帐单**和**成批过帐对帐单**之类批处理流程将以批处理模式运行。</span><span class="sxs-lookup"><span data-stu-id="8ceec-265">Batch processes such as **Calculate statements in batch** and **Post statements in batch** are run only in batch mode.</span></span> <span data-ttu-id="8ceec-266">在传统对帐单过帐功能中，用户可以选择以交互模式运行这些批处理流程，这种模式是单线程操作，与批处理流程不同，后者为多线程。</span><span class="sxs-lookup"><span data-stu-id="8ceec-266">In the legacy statement posting feature, users could choose to run these batch processes in an interactive mode which is s single threaded operation unlike batch processes which are multi-threaded.</span></span>
- <span data-ttu-id="8ceec-267">在传统对帐单过帐功能中，只要批处理任务失败，都将让整个批处理作业进入错误状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-267">In the legacy statement posting feature, any failure of a batch task put the whole batch job in an error state.</span></span> <span data-ttu-id="8ceec-268">在改进后的功能中，如果其他批处理任务成功完成，则批处理任务失败不会让批处理作业进入错误状态。</span><span class="sxs-lookup"><span data-stu-id="8ceec-268">In the improved feature, batch task failures don't put the batch job in an error state if other batch tasks are successfully completed.</span></span> <span data-ttu-id="8ceec-269">应评估批处理执行的对帐状态，方法是使用**零售对帐单**页，可在其中查看因错而未过帐的所有对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-269">You should assess the posting status for a batch execution run by using the **Retail statements** page, where you can see any statements that weren't posted because of errors.</span></span>
- <span data-ttu-id="8ceec-270">在传统对帐单过帐功能中，对帐单首次出错将导致整个批处理失败。</span><span class="sxs-lookup"><span data-stu-id="8ceec-270">In the legacy statement posting feature, the first occurrence of a statement failure causes the whole batch to fail.</span></span> <span data-ttu-id="8ceec-271">将不处理剩余对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-271">The remaining statements aren't processed.</span></span> <span data-ttu-id="8ceec-272">在改进后的功能中，批处理流程将继续处理所有对帐单，即使部分对帐单失败也不例外。</span><span class="sxs-lookup"><span data-stu-id="8ceec-272">In the improved feature, the batch process continues to process all statements, even if some of the statements fail.</span></span> <span data-ttu-id="8ceec-273">其中一个优点是用户可查看准确的出错对帐单数量。</span><span class="sxs-lookup"><span data-stu-id="8ceec-273">One benefit is that users gain visibility into the exact number of statements that have errors.</span></span> <span data-ttu-id="8ceec-274">这样用户就不必陷入修复错误并运行对帐单过帐流程直到所有对帐单均已过帐的连续循环中。</span><span class="sxs-lookup"><span data-stu-id="8ceec-274">Therefore, users don't have to be stuck in a continous loop of fixing the errors and running the post statement process till all statements are posted.</span></span>

## <a name="general-guidance-about-the-statement-posting-process"></a><span data-ttu-id="8ceec-275">有关对帐单过帐流程的一般指南</span><span class="sxs-lookup"><span data-stu-id="8ceec-275">General guidance about the statement posting process</span></span>

- <span data-ttu-id="8ceec-276">建议成批运行对帐单过帐流程，因为成批运行可以以多线程的形式利用批处理框架。</span><span class="sxs-lookup"><span data-stu-id="8ceec-276">We recommend that you run the statement posting process in a batch, because batch runs take advantage of the power of the batch framework in terms of multithreading.</span></span> <span data-ttu-id="8ceec-277">需要多线程才能应对通常在对帐单过帐中才会出现的巨量交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-277">Multithreading is required in order to handle the huge volumes of transactions that are normally seen in statement postings.</span></span>
- <span data-ttu-id="8ceec-278">建议在物料模型组中开启负实际库存，以便获得无缝的过帐体验。</span><span class="sxs-lookup"><span data-stu-id="8ceec-278">We recommend that you turn on negative physical inventory on the item model group, so that you have a seamless posting experience.</span></span> <span data-ttu-id="8ceec-279">在某些情况下，除非存在负实际库存，否则可能不能过帐负对帐单。</span><span class="sxs-lookup"><span data-stu-id="8ceec-279">In some scenarios, negative statements might not be able to be posted unless there is negative physical inventory.</span></span> <span data-ttu-id="8ceec-280">例如，理论上如果库存中某种物料只有一个单位，但同时有一个销售交易记录和一个退货交易记录需要该物料，即使未开启负库存，应该也可以过帐交易记录。</span><span class="sxs-lookup"><span data-stu-id="8ceec-280">For example, in theory, if there is only one unit of an item in inventory, and there have been a sales transaction and a return transaction for the item, the transaction should be able to be posted even if negative inventory isn't turned on.</span></span> <span data-ttu-id="8ceec-281">但是，因为对帐单过帐流程同时提取销售交易记录和退货交易记录并放入一个销售订单中，所以不能保证先过帐销售行，后过帐退货行。</span><span class="sxs-lookup"><span data-stu-id="8ceec-281">However, because the statement posting process pulls both the sales transaction and the return transaction in a single customer order, there is no guarantee that the sales line will be posted first, followed by the return line.</span></span> <span data-ttu-id="8ceec-282">因此可能出错。</span><span class="sxs-lookup"><span data-stu-id="8ceec-282">Therefore, errors can occur.</span></span> <span data-ttu-id="8ceec-283">如果在这种情况下开启了负库存，则交易记录过帐不会受到负面影响，而系统将正确地反映库存。</span><span class="sxs-lookup"><span data-stu-id="8ceec-283">If negative inventory is turned on in this scenario, the transaction posting isn't negatively affected, and the system will correctly reflect the inventory.</span></span>
- <span data-ttu-id="8ceec-284">建议在计算和过帐对帐单时使用聚合。</span><span class="sxs-lookup"><span data-stu-id="8ceec-284">We recommend that you use aggregation while you calculate and post statements.</span></span> <span data-ttu-id="8ceec-285">因此，建议为部分聚合参数执行以下设置：</span><span class="sxs-lookup"><span data-stu-id="8ceec-285">Therefore, the following settings are recommended for some of the aggregation parameters:</span></span>

    - <span data-ttu-id="8ceec-286">转至**零售** \> **总部设置** \> **参数** \> **零售参数**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-286">Go to **Retail** \> **Headquarters setup** \> **Parameters** \> **Retail parameters**.</span></span> <span data-ttu-id="8ceec-287">然后，在**过帐**选项卡上**库存更新**快速选项卡的**详细程度**字段中，选择**摘要**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-287">Then, on the **Posting** tab, on the **Inventory update** FastTab, in the **Detail level** field, select **Summary**.</span></span>
    - <span data-ttu-id="8ceec-288">转至**零售** \> **总部设置** \> **参数** \> **零售参数**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-288">Go to **Retail** \> **Headquarters setup** \> **Parameters** \> **Retail parameters**.</span></span> <span data-ttu-id="8ceec-289">然后，在**过帐**选项卡上的**聚合**快速选项卡中，将**凭证交易记录**选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="8ceec-289">Then, on the **Posting** tab, on the **Aggregation** FastTab, set the **Voucher transactions** option to **Yes**.</span></span>

