---
title: "维度层次结构"
description: "此主题提供有关维度层次结构的信息。 您使用维度层次结构定义成本核算中的报告结构、成本策略和安全设置。"
author: AndersGirke
manager: AnnBe
ms.date: 06/16/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
ms.search.form: CAMDimensionHierarchy,
audience: Application User
ms.reviewer: yuyus
ms.search.scope: Operations, Core
ms.custom: 
ms.assetid: 
ms.search.region: global
ms.search.industry: Manufacturing
ms.author: YuyuScheller
ms.search.validFrom: 2016-11-30
ms.dyn365.ops.version: Version 1611
ms.translationtype: HT
ms.sourcegitcommit: 69eeb90387ca5765c163c7d482295ea104cc078c
ms.openlocfilehash: cef54fa8109ebce0f8a6ca67c93afc30ec8a6781
ms.contentlocale: zh-cn
ms.lasthandoff: 09/29/2017

---

# <a name="dimension-hierarchy"></a>维度层次结构

[!include[banner](../includes/banner.md)]

此主题提供有关维度层次结构的信息。 您使用维度层次结构定义成本核算中的报告结构、成本策略和安全设置。  

## <a name="overview"></a>概览

维度层次结构用于成本核算的多个位置。 通过维度层次结构可以定义以下信息：

-  适应组织要求的报告结构
-  成本策略
-  安全设置

以下是维度层次结构的示例。

![维度层次结构的示例](./media/dimension-hierarchy.png)

可以为以下维度类型创建维度层次结构：

-  成本元素维度
-  成本对象维度
-  统计维度

> [!NOTE]
> - 如果要求不同视角，您可以为相同维度创建多个维度层次结构。
> - 一个维度层次结构只能与一个维度相关联。
> - 一个维度层次结构的结构中可以有无限个级别。 所有级别在**成本控制**工作区中可用。 出于报告目的使用 Microsoft Excel 或 Microsoft Power BI 时，仅导出维度层次结构的前 15 个级别。 存在此限制是因为 Excel 和 Power BI 均要求固定架构。
> - 维度层次结构没有日期限制。 因此，对维度层次结构的任何更改立即保存到记录，且您无法比较此日期之前的维度层次结构和此日期之后的维度层次结构。

## <a name="dimension-hierarchy-type"></a>维度层次结构类型

创建新的维度层次结构时，必须选择层次结构类型。 转到**成本核算** > **维度** > **维度层次结构**。 单击**新建**，然后选择维度层次结构类型。 您可以选择**维度分类层次结构**或**维度分级层次结构**。

### <a name="dimension-categorization-hierarchy"></a>维度分类层次结构

**维度分类层次结构**类型用于报告目的。 它仅支持成本元素维度。 当您选择此类型时，以下规则适用：

-  一个维度成员在层次结构中可关联多次。
-  您可以通过将成本行为分配到叶节点的方式将成本元素维度成员放置到不同的节点。

### <a name="dimension-classification-hierarchy"></a>维度分类层次结构

**维度分级层次结构**类型用于定义规则和用于报告目的。 它支持所有维度，例如成本对象、成本元素和统计维度。 当您选择此类型时，一个维度成员在层次结构中仅可关联一次。

## <a name="create-and-maintain-a-dimension-hierarchy"></a>创建并维护维度层次结构

维度层次结构创建为具有节点和叶节点关系的树结构。

-  一个节点可以具有 1:_n_个子节点。
-  一个节点不能同时分配有子节点和叶节点。
-  叶节点只能在层次结构的最低级别进行分配。

### <a name="example"></a>示例

一个小公司具有以下组织结构，其中财务和人力资源属于管理部门，装配和包装属于生产部门。

![组织结构的示例](./media/dimension-hierarchy-org.png)

成本对象维度表示组织中的所有成本中心。

- 成本对象维度
    - 成本中心

表示所有成本中心的成本对象维度可以按此处所示进行设置。

| 成本中心 | 说明 |
|--------------|-------------|
| CC001        | HR          |
| CC002        | 财务     |
| CC003        | 税金         |
| CC007        | AR/AP       |
| CC005        | 程序集    |
| CC006        | 包装   |

成本元素维度表示组织中的所有成本元素。

- 成本元素维度
    - 成本元素

表示所有成本元素的成本元素维度可以按此处所示进行设置。

| 成本元素 | 说明 |
|---------------|-------------|
| 10001         | 电 |
| 10010         | 清洗    |
| 10011         | 加热     |
| 40001         | COGS        |

符合组织报告要求的维度层次结构可以按此处所示进行设置。

**维度层次结构明细**

| 维度层次结构名称 | 维度    | 维度层次结构类型名称      | 访问列表层次结构 |
|--------------------------|--------------|------------------------------------|-----------------------|
| 组织             | 成本中心 | 维度分类层次结构 | 无                    |

用于报告的维度层次结构可以按此处所示进行设置。

|                   | 维度成员范围   |                         |
|-------------------|---------------------------|-------------------------|
| **节点**         | **起始维度成员** | **截止维度成员** |
| 组织      |                           |                         |
| &nbsp;&nbsp;管理         |                           |                         |
|&nbsp;&nbsp;&nbsp;&nbsp;财务   | CC002                     | CC003                   |
|                   | CC007                     | CC007                   |
| &nbsp;&nbsp;&nbsp;&nbsp;HR        | CC001                     | CC001                   |
| &nbsp;&nbsp;生产    |                           |                         |
| &nbsp;&nbsp;&nbsp;&nbsp;包装 | CC005                     | CC005                   |
| &nbsp;&nbsp;&nbsp;&nbsp;程序集  | CC006                     | CC006                   |

符合策略要求的维度层次结构可以按此处所示进行设置。

**维度层次结构明细**

| 维度层次结构名称 | 维度     | 维度层次结构类型名称      |
|--------------------------|---------------|------------------------------------|
| 成本行为            | 成本元素 | 维度分类层次结构 |

用于策略的维度层次结构可以按此处所示进行设置。

|                   | 维度成员范围   |                         |
|-------------------|---------------------------|-------------------------|
| **节点**         | **起始维度成员** | **截止维度成员** |
| 成本行为     |                           |                         |
| &nbsp;&nbsp;固定成本    | 10001                     | 10011                   |
|&nbsp;&nbsp;可变成本 | 40001                     | 40010                   |

> [!NOTE]
> 在**维度成员范围**下，一个节点可以包含 1:_n_个维度成员范围。 您可以插入尚未作为维度成员存在的维度成员 ID。 此方法使层次结构可以弹性地适应未来的需求。  

### <a name="copy-a-hierarchy"></a>复制层次结构

您可以复制当前维度层次结构作为新维度层次结构的起始点。 如果您要比较之前的维度层次结构与新的维度层次结构，则此方法很有用。

### <a name="rearrange-nodes-in-a-hierarchy"></a>重新排列层次结构中的节点

您可以将节点在结构的当前级别范围内上移和下移。 通过此方法可以重新排列用于报告的节点在**成本控制**工作区中的顺序。

您可以通过选择目标节点将节点移动到层次结构中的新位置。 可通过两种方式移动节点：

- **下移** - 将所选节点从层次结构中的当前位置移动并插入到选定目标节点的**下方**。
- **后移** - 将所选节点从层次结构中的当前位置移动并插入到它的层次结构级别的选定目标节点的**后面**。

> [!NOTE] 
> 在您将数据导出到 Excel 或 Power BI 时，不维持节点的顺序，因为这些工具默认使用按字母顺序排序。 您应手动重新排列顺序。

## <a name="define-dimension-hierarchies-for-reporting"></a>定义用于报告的维度层次结构

维度层次结构对于报告十分重要。 您可以通过它们定义适应单个组织的特定结构。 在维度层次级别的节点级别完成的合并让组织任何级别的利益干系人可以看到任何级别的数据。

维度层次结构可用于以下报告工具。 此方法有助于保证报告结构中的一致性。

- **成本控制**工作区（客户端）：

    - 通过配置控制。

- **成本控制**工作区（移动应用）：

    - 通过配置控制。

- Excel

    - 提供选项用于按导出定义选择特定的维度层次结构：

        - 一个成本元素维度层次结构（必需）
        - 一个成本对象维度层次结构（可选）
        - 一个统计维度层次结构（可选）

- Power BI：

    - 所有维度层次结构可用。
    
如果使用 Excel 或 Power BI 创建报表，则仅导出维度层次结构的前 15 个级别。 存在此限制是因为在 Excel 和 Power BI 中均要求固定架构。 如果一个层次结构有 15 个以上级别，则不会导出额外级别。 标准化表包含层次结构中各维度成员的记录。 因此发生自动化合并。 此行为有助于保证层次结构中的 15 个可用级别的任何一个级别的余额仍然正确。

以下示例显示维度层次结构在报告结构中可能是什么样子。

| 成本对象维度层次结构 - 级别 1 | 成本对象维度层次结构 - 级别 2 | 成本对象维度层次结构 - 级别 3 | 成本对象维度层次结构 - 级别 4 | 成本对象维度层次结构 - 级别 15 |
|-------------------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|--------------------------------------------|
| 组织                              | 管理                                     | 财务                                   | CC002                                     |                                            |
| 组织                              | 管理                                     | 财务                                   | CC003                                     |                                            |
| 组织                              | 管理                                     | 财务                                   | CC007                                     |                                            |
| 组织                              | 管理                                     | HR                                        | CC001                                     |                                            |
| 组织                              | 生产                                | 包装                                 | CC005                                     |                                            |
| 组织                              | 生产                                | 程序集                                  | CC006                                     |                                            |

### <a name="update-the-dimension-hierarchies-that-are-used-for-reporting"></a>更新用于报告的维度层次结构 

在一段时间后，必须更新在前面提及的报告工具中使用的维度层次结构。 您可以通过刷新客户端更新维度层次结构。

- **成本控制**工作区（客户端）
- **成本控制**工作区（移动应用）

对维度层次结构的更新每 24 小时由预缓存作业提取。 更新导出数据后，更新的维度层次结构可用于以下工具：

- Excel
- Power BI

> [!NOTE] 
> 要手动触发维度层次结构缓存的更新，您可以为必须更新的一个或多个维度层次结构新建导出到 Excel。

## <a name="define-dimension-hierarchies-for-cost-policies"></a>定义用于成本策略的维度层次结构

成本核算包括定义了详细规则的多个策略。 您必须定义以下策略的一个或多个维度层次结构：

- 成本行为
- 成本分配
- 成本分摊
- 成本累积

维度层次结构将便于创建规则。 若要避免必须为每个维度成员创建规则，您可以利用按维度层次结构级别提供的维度成员的合并。 如果您具有重叠规则，您必须定义系统在执行开销计算时将考虑的特定规则。

### <a name="example-define-a-cost-behavior-policy"></a>示例：定义成本行为策略

创建新的成本行为策略，且为策略分配相应的维度层次结构，如此处所示。

**成本行为策略**

| 策略名称   | 成本元素维度层次结构 | 成本对象维度层次结构 | 记帐币种 |
|---------------|----------------------------------|---------------------------------|---------------------|
| 成本行为 | 成本行为                    | 组织                    | 美元                 |

**规则**

| 成本元素维度层次结构节点 | 成本对象维度层次结构节点 | 固定百分比 | 固定金额 | 生效日期 | 失效日期 |
|---------------------------------------|--------------------------------------|------------------|--------------|------------|----------|
| 固定成本                            | 组织                         | 100.00           | 0.00         | 1/1/2017   | 从不    |
| 10001                                 | 组织                         | 0.00             | 150.00       | 1/1/2017   | 从不    |
| 10001（“\*”）                             | 财务                              |                  | 50.00        | 1/1/2017   | 从不    |
| 成本行为或可变成本 (\*\*)   | 组织                         | 0.00             | 0.00         | 1/1/2017   | 从不    |

\* 不要求可变成本节点。 如果成本未分类为固定成本，则它必须是可变成本。

\*\* 为成本元素成员 10001 和在财务层次结构级别下合并的所有成本对象成员（CC002、CC003、CC007）的组合创建详细规则。

之前的规则显示了维度层次结构提供的灵活性。 通过定义高级别规则，您可以帮助尽量减少维护。 然后，您可以定义详细规则以适应特定的业务目标。

如果在规则中使用的维度层次结构被更新，系统将自动提供更新。

如果不再需要规则中的精细程度级别，可终止规则。

例如，不再需要财务成本对象维度层次结构节点的特定成本行为规则。 在这种情况下，请单击**终止规则**来终止规则。

| 成本元素维度层次结构节点 | 成本对象维度层次结构节点 | 固定百分比 | 固定金额 | 生效日期 | 失效日期  |
|---------------------------------------|--------------------------------------|------------------|--------------|------------|-----------|
| 固定成本                            | 组织                         | 100,00           | 0.00         | 1/1/2017   | 从不     |
| 10001                                 | 组织                         | 0.00             | 150,00       | 1/1/2017   | 从不     |
| 10001                                 | 财务                              |                  | 50,00        | 1/1/2017   | 20/1/2017 |
| 成本行为或可变成本        | 组织                         | 0.00             | 0.00         | 1/1/2017   | 从不     |

在 2017 年 1 月 20 日之后运行的任何开销计算不再考虑此规则。

> [!NOTE] 
> **生效日期**和**失效日期**具有日期和时间限制。 您可以在同一天终止此规则和运行新的开销计算。

## <a name="define-dimension-hierarchies-for-security-setup"></a>定义用于安全设置的维度层次结构

成本核算数据应提供给负责报告单位的所有经理。 在成本核算术语中，一个报告单位表示为一个成本对象或一组成本对象。

有可能所有经理都将能够访问高度敏感的业务数据，例如收入和毛利。 因此，设置安全性十分重要，这样经理仅能看到与他们有关的数据。 为了帮助控制数据安全，您定义维度层次结构。

- 维度层次结构的使用仅适用于在维度层次结构引用中选择的维度值为成本对象维度时。
- 访问列表层次结构中的每个成本对象维度仅可启用一个维度层次结构。

**维度层次结构明细**

| 维度层次结构名称 | 维度    | 维度层次结构类型名称      | 访问列表层次结构 |
|--------------------------|--------------|------------------------------------|-----------------------|
| 组织             | 成本中心 | 维度分类层次结构 | **是**               |

新**用户**快速选项卡在层次结构设计器中可用。 在此处，您可以在层次结构的每个节点中插入一个或多个用户 ID。

|                 | 用户            | 维度成员范围   |                         |
|-----------------|------------------|---------------------------|-------------------------|
| **节点**       | **用户 ID**      | **起始维度成员** | **截止维度成员** |
| 组织    | 本杰明，克莱尔 |                           |                         |
| &nbsp;&nbsp;管理         | 四月            |                           |                         |
| &nbsp;&nbsp;&nbsp;&nbsp;财务   | 艾丽西亚           | CC002                     | CC003                   |
|                 |                  | CC007                     | CC007                   |
| &nbsp;&nbsp;&nbsp;&nbsp;HR        | 尔尼            | CC001                     | CC001                   |
| &nbsp;&nbsp;生产    | 大卫            |                           |                         |
| &nbsp;&nbsp;&nbsp;&nbsp;包装 | 爱伦            | CC005                     | CC005                   |
| &nbsp;&nbsp;&nbsp;&nbsp;程序集  | 克里斯            | CC006                     | CC006                   |

> [!NOTE] 
> 成本会计员应分配到该层次结构的顶层，以便他们可以查看成本核算中的所有条目。

要启用访问列表层次结构及其安全设置，请转到**成本核算** > **设置** > **参数** > **常规**。 选择**为成本对象维度成员启用视图访问**参数。

访问列表层次结构的设置用于控制在以下区域显示的数据：

- **成本控制**工作区（客户端）：

    - 用于钻取方案的窗体中的数据。

- **成本控制**工作区（移动应用）：

    - 卡内余额

- Power BI：

    - Power BI 可视化项中显示的数据
    - Microsoft Dynamics 365 for Finance and Operations Enterprise Edition 客户端中嵌入的数据 Power BI 可视化项。

> [!NOTE] 
> - 在访问列表层次结构可能会影响 Power BI 中的数据前，Power BI 中的访问列表层次结构和行级别安全性必须配对。 有关详细信息，请参阅 [设置成本核算内容包的安全性](../../dev-itpro/analytics/setup-security-cost-accounting-content-pack.md)。
> - 访问列表层次结构对将数据安全导出到 Excel 没有帮助。 因此，该报告工具应仅由必须具有查看数据的完全访问权限的成本会计师和经理使用。

