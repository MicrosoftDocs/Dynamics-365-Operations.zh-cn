---
title: "数据导入和导出作业"
description: "使用数据管理工作区创建和管理数据导入和导出作业。"
author: Sunil-Garg
manager: AnnBe
ms.date: 08/28/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Application user
ms.reviewer: margoc
ms.search.scope: Operations
ms.search.region: Global
ms.author: sunilg
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: cf531c3a8f3bdb17314d1de436b98249169f82a3
ms.openlocfilehash: d58bab48c65bb891155af95c79738b019e5760bf
ms.contentlocale: zh-cn
ms.lasthandoff: 08/08/2018

---

# <a name="data-import-and-export-jobs"></a>数据导入和导出作业

[!include [banner](../includes/banner.md)]

要在 Microsoft Dynamics 365 for Finance and Operations 中创建和管理数据导入和导出作业，请使用**数据管理**工作区。 默认情况下，数据导入和导出流程为目标数据库中的每个实体创建一个暂存表。 通过暂存表可以在移动数据之前验证、清理或转换数据。

> [!NOTE]
> 此主题假定您熟悉[数据实体](data-entities.md)。

## <a name="data-importexport-process"></a>数据导入/导出流程
以下是导入或导出数据的步骤。

1. 在完成以下任务后创建导入或导出作业：

    - 定义项目类别。
    - 确定要导入或导出的实体。
    - 设置作业的数据格式。
    - 给实体排序，以便以合理的顺序在逻辑组中处理这些实体。
    - 确定是否使用暂存表。

2. 验证源数据和目标数据是否正确映射。
3. 验证您的导入或导出作业的安全性。
4. 运行导入或导出作业。
5. 查看作业历史纪录，验证作业是否按预期运行。
6. 清除暂存表。

本主题的其余部分提供有关流程的每个步骤的详细信息。

> [!NOTE]
> 要刷新“数据导入/导出”窗体以查看最新进度，请使用窗体刷新图标。 不建议执行浏览器级刷新，因为这将中断所有未批量运行的导入/导出作业。

## <a name="create-an-import-or-export-job"></a>创建导入或导出作业
可以一次性运行或分多次运行数据导入或导出作业。

### <a name="define-the-project-category"></a>定义项目类别
我们建议您花时间为导入或导出作业选择合适的项目类别。 项目类别有助于管理相关作业。

### <a name="identify-the-entities-to-import-or-export"></a>确定要导入或导出的实体
您可以将特定实体添加到导入或导出作业或选择一个要应用的模板。 模板使用一个实体列表填充一个作业。 给作业命名并保存作业后，**应用模板**选项可用。

### <a name="set-the-data-format-for-the-job"></a>设置作业的数据格式
选择一个实体后，必须选择要导出或导入的数据的格式。 使用**数据源设置**磁贴定义格式。 源数据格式是**类型**、**文件格式**、**行分隔符**和**列分隔符**的组合。 还有其他属性，但以上属性则是需要了解的关键属性。 下表列出了有效组合。

| **文件格式**        | **行/列分隔符**                   | **XML 样式**             |
|------------------------|--------------------------------------------|---------------------------|
| Excel                  | Excel                                      | \-NA-                     |
| XML                    | \-NA-                                      | XML 元素 XML 属性 |
| 分隔，固定宽度 | 逗号、分号、制表符、竖线、冒号 | \-NA-                     |



### <a name="sequence-the-entities"></a>给实体排序
实体可以在数据模板或导入和导出作业中排序。 运行的作业包含多个数据实体时，必须确保数据实体的序列正确。 给实体排序的主要目的是为了解决实体中的任何功能依赖项。 如果实体不具有任何功能依赖项，可以计划并行导入或导出。

#### <a name="execution-units-levels-and-sequences"></a>执行单元、级别和序列
执行单元、执行单元中的级别以及实体序列有助于控制导出或导入数据的顺序。

- 不同执行单元中的实体并行处理。
- 在每个执行单元中，具有相同级别的实体并行处理。
- 在每个级别中，根据实体在该级别中的序列号处理实体。
- 处理完一个级别后，再处理下一个级别。

#### <a name="resequencing"></a>重新排序
在以下情形中，您可能想要对实体重新排序：

- 如果只有一个数据作业用于您的所有更改，可以使用重新排序选项来优化整个作业的执行时间。 在这些情况下，您可以使用执行单元表示模块，用级别表示模块中的功能区域，用序列表示实体。 使用此方法可以并行处理不同模块，但也仍然能在一个模块中按顺序处理。 为了帮助保证成功完成并行操作，必须考虑所有依赖项。
- 如果使用多个数据作业（例如，一个模块使用一个作业），可以使用排序来影响实体的级别和顺序，以获得最佳执行。
- 如果没有任何依赖项，可以在不同执行单元对实体排序，以最大程度地进行优化。

选择多个实体时，**重新排序**菜单可用。 可以基于执行单元、级别或顺序选项重新排序。 可以设定增量，以对选定的实体重新排序。 为每个实体选择的单元、级别和/或序列号按指定增量进行更新。

#### <a name="sorting"></a>排序
用户可以使用**排序依据**选项按顺序查看实体列表。

### <a name="truncating"></a>截断
对于导入项目，可在导入前选择截断实体中的记录。 如果必须将记录导入一套干净的表中，这很有用。 默认情况下，此设置已关闭。

## <a name="validate-that-the-source-data-and-target-data-are-mapped-correctly"></a>验证源数据和目标数据是否正确映射
映射是同时适用于导入和导出作业的一项功能。

- 在导入作业情况下，映射描述源文件中的哪些列成为暂存表中的列。 因此，系统可以确定源文件中的哪些列数据必须复制到暂存表中的哪一列。
- 在导出作业情况下，映射描述暂存表（即源）中的哪些列成为目标文件中的列。

如果暂存表和文件中的列名称匹配，则系统自动基于名称建立映射。 但是，如果名称有差异，则不会自动映射列。 在这些情况下，必须在数据作业中的实体上选择**查看映射**选项，以完成映射。

有两个映射视图：**映射可视化**，即默认视图，以及**映射详细信息**。 红色星号 (\*) 标识实体中的任何必填字段。 必须映射这些字段后才能处理实体。 处理实体时，可以按需要取消其他字段的映射。 要取消字段映射，选择**实体**列或**源**列中的字段，然后选择**删除选择**。 选择**保存**以保存更改，然后关闭页面以返回项目。 在导入后，您可以使用相同流程编辑来自源的字段映射。

通过选择**生成源映射**可以在页面上生成映射。 生成的映射表现地类似于自动映射。 因此，您必须手动映射所有未映射的字段。

![数据映射](./media/dixf-map.png)

## <a name="verify-the-security-for-your-import-or-export-job"></a>验证您的导入或导出作业的安全性
**数据管理**工作区的访问权限可能受到限制，因此非管理员用户可能仅可访问特定的数据作业。 对数据作业的访问权限暗示着对该作业的执行历史记录的完全访问权限和对暂存表的访问权限。 因此，您必须确保在创建数据作业时采取适当的访问权限控制。

### <a name="secure-a-job-by-roles-and-users"></a>按角色和用户保护作业安全
使用**适用的角色**菜单将作业限制到一个或多个安全角色。 仅这些角色的用户具有该作业的访问权限。

您还可以将该作业限制到特定用户。 当您按用户而不是角色保护作业安全时，如果有多个用户分配到角色，则具有更多的控制性。

### <a name="secure-a-job-by-legal-entity"></a>通过法人保护作业安全
数据作业在性质上是全局的。 因此，如果在法人中创建和使用数据作业，该作业将在系统中的其他法人中可见。 此默认行为可能在有些应用方案中优先。 例如，使用数据实体导入发票的组织可能提供一个集中发票处理团队负责管理组织中的所有部门的发票错误。 在此方案中，它有助于集中发票处理团队获得所有法人的发票导入作业的访问权限。 因此，从一个法人的角度看，默认行为满足要求。

但是，组织可能希望每个法人各有一个发票处理团队。 在这种情况下，一个法人中的团队应仅具有它自己的法人的发票导入作业的访问权限。 为了满足此要求，您可以使用数据作业内的**适用的法人**菜单在数据作业上配置基于法人的访问权限控制。 配置完成后，用户仅可以看到他们当前分配的法人中可用的作业。 若要查看其他法人的作业，用户必须切换到该法人。

可同时按角色、用户和法人保护作业安全。

## <a name="run-the-import-or-export-job"></a>运行导入或导出作业
在定义作业后，您可以选择**导入**或**导出**按钮运行一次作业。 若要设置重复执行的作业，请选择**创建重复性数据作业**。

## <a name="validate-that-the-job-ran-as-expected"></a>验证该作业按预期运行
作业历史记录可用于导入和导出作业的故障排除和调查。 历史作业运行按时间范围进行组织。

![作业历史记录范围](./media/dixf-job-history.md.png)

每次作业运行提供以下详细信息：

- 执行详细信息
- 执行日志

执行详细信息显示作业处理的每个数据实体的状态。 因此，您可以迅速找到以下信息：

- 处理了哪些实体
- 对于实体，处理成功的记录数量和处理失败的记录数量
- 每个实体的暂存记录

您可以将暂存数据下载到一个文件用于导出作业，或将其下载为包用于导入和导出作业。

您还可以从执行详细信息打开执行日志。

## <a name="clean-up-the-staging-tables"></a>清除暂存表
您可以使用**数据管理**工作区中的**暂存清除**功能清除暂存表。 您可以使用以下选项选择从哪个暂存表删除哪些记录：

- **实体** - 如果仅提供一个实体，则删除来自该实体暂存表的所有记录。 选择此选项以清除跨所有数据项目和所有作业的实体的所有数据。
- **作业 ID** - 如果仅提供一个作业 ID，则从相应的暂存表中删除选定作业中的所有实体的所有记录。
- **数据项目** - 如果仅选择一个数据项目，则删除选定数据项目的所有实体和跨所有作业的所有记录。

您还可以合并这些选项以进一步限制被删除的记录集。

