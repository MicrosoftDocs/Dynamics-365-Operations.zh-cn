---
title: 分配的订单管理 (DOM)
description: 本主题将介绍 Dynamics 365 Commerce 中的“分配的订单管理 (DOM)”功能。
author: josaw1
manager: AnnBe
ms.date: 05/22/2020
ms.topic: index-page
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.custom: ''
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: josaw
ms.search.validFrom: 2018-11-15
ms.dyn365.ops.version: ''
ms.openlocfilehash: 1121cc89b278c3694d0bbd667f1a540d17f4d180
ms.sourcegitcommit: b7af921189048d9f2eb4d3fd57c704c742bc96e8
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/23/2020
ms.locfileid: "3396024"
---
# <a name="distributed-order-management-dom"></a><span data-ttu-id="4b1be-103">分配的订单管理 (DOM)</span><span class="sxs-lookup"><span data-stu-id="4b1be-103">Distributed order management (DOM)</span></span>

[!include [banner](includes/banner.md)]

<span data-ttu-id="4b1be-104">在新的商业运营范例中，零售商努力提供个性化的客户参与、全渠道体验以及轻松互动。</span><span class="sxs-lookup"><span data-stu-id="4b1be-104">In the new paradigm for commerce operations, retailers strive to provide personalized customer engagement, omni-channel experiences, and frictionless interactions.</span></span> <span data-ttu-id="4b1be-105">由于提供的选择众多，无论消费者在哪里采购，他们都能获得最实惠的体验。</span><span class="sxs-lookup"><span data-stu-id="4b1be-105">Because so many choices are available, consumers will shop wherever they can have the most favorable experience.</span></span> <span data-ttu-id="4b1be-106">在很多情况下，消费者不再将价格和产品作为主要决定因素。</span><span class="sxs-lookup"><span data-stu-id="4b1be-106">In many cases, prices and products are no longer the top deciding factors for consumers.</span></span>

<span data-ttu-id="4b1be-107">为了帮助提高客户体验，零售商必须实时了解其所有渠道的库存。</span><span class="sxs-lookup"><span data-stu-id="4b1be-107">To help improve the customer experience, retailers must have visibility into their inventory in real time, across all their channels.</span></span> <span data-ttu-id="4b1be-108">对所有库存采用单一、全面的视图可帮助优化订单履行、分配和配送。</span><span class="sxs-lookup"><span data-stu-id="4b1be-108">A single, holistic view of all the inventory can help optimize order fulfillment, allocation, and distribution.</span></span> <span data-ttu-id="4b1be-109">因此，对零售商而言，采用和实施分配的订单管理 (DOM) 系统变得愈加迫切。</span><span class="sxs-lookup"><span data-stu-id="4b1be-109">Therefore, adoption and implementation of a distributed order management (DOM) system are becoming more imperative for retailers.</span></span>

<span data-ttu-id="4b1be-110">DOM 可跨复杂的系统网络和流程优化订单履行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-110">DOM optimizes order fulfillment across a complex network of systems and processes.</span></span> <span data-ttu-id="4b1be-111">它依赖整个组织采用的单一、全局性库存视图来智能地管理订单，从而以更具成本效益的方式准确地履行订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-111">It relies on a single, global view of inventory across the whole organization to intelligently manage orders, so that they are fulfilled accurately and in a more cost-effective manner.</span></span> <span data-ttu-id="4b1be-112">通过提高零售商的供应链效率，DOM 可帮助零售商更好地满足客户期望。</span><span class="sxs-lookup"><span data-stu-id="4b1be-112">By improving the efficiency of a retailer's supply chain, DOM helps the retailer better meet customer expectations.</span></span>

<span data-ttu-id="4b1be-113">下图显示了 DOM 系统中销售订单的生命周期。</span><span class="sxs-lookup"><span data-stu-id="4b1be-113">The following illustration shows the lifecycle of a sales order in a DOM system.</span></span>

![![DOM 情景下的销售订单生命周期](./media/flow.png "DOM 情景下的销售订单生命周期")](./media/flow.png "Sales order lifecycle in the context of DOM")

## <a name="set-up-dom"></a><span data-ttu-id="4b1be-115">设置 DOM</span><span class="sxs-lookup"><span data-stu-id="4b1be-115">Set up DOM</span></span>

1. <span data-ttu-id="4b1be-116">转到**系统管理 \> 设置 \> 许可证配置**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-116">Go to **System administration \> Setup \> License configuration**.</span></span>
2. <span data-ttu-id="4b1be-117">在 **Configuration keys** 选项卡中，展开 **Commerce** 节点，然后选中**分配的订单管理**复选框。</span><span class="sxs-lookup"><span data-stu-id="4b1be-117">On the **Configuration keys** tab, expand the **Commerce** node, and then select the **Distributed Order Management** check box.</span></span>
3. <span data-ttu-id="4b1be-118">转到 **Retail 和 Commerce \> 分配的订单管理 \> 设置 \> DOM 参数**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-118">Go to **Retail and Commerce \> Distributed order management \> Setup \> DOM parameters**.</span></span>
4. <span data-ttu-id="4b1be-119">在**常规**选项卡上，设置以下值：</span><span class="sxs-lookup"><span data-stu-id="4b1be-119">On the **General** tab, set the following values:</span></span>

    - <span data-ttu-id="4b1be-120">**启用分配的订单管理** - 将此选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-120">**Enable distributed order management** – Set this option to **Yes**.</span></span>
    - <span data-ttu-id="4b1be-121">**确认 DOM 的必应地图使用情况** - 将此选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-121">**Confirm Bing Maps usage for DOM** – Set this option to **Yes**.</span></span>

        > [!NOTE]
        > <span data-ttu-id="4b1be-122">仅当**Commerce 共享参数**页面（**Retail 和 Commerce \> Headquarters 设置 \> 参数 \> Commerce 共享参数**）的**必应地图**选项卡上的**启用必应地图**选项也设置为**是**，并且在**必应地图键**字段中输入了有效的键时，才可以将此选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-122">You can set this option to **Yes** only if the **Enable Bing Maps** option on the **Bing Maps** tab of the **Commerce shared parameters** page (**Retail and Commerce \> Headquarters setup \> Parameters \> Commerce shared parameters**) is also set to **Yes**, and if a valid key is entered in the **Bing Maps key** field.</span></span>

    - <span data-ttu-id="4b1be-123">**保留期(天)** - 指定 DOM 运行生成的履行计划要在系统中保留多长时间。</span><span class="sxs-lookup"><span data-stu-id="4b1be-123">**Retention period in days** – Specify how long the fulfillment plans that DOM runs generate are kept in the system.</span></span> <span data-ttu-id="4b1be-124">**DOM 履行数据删除作业设置**批处理作业将删除在此处指定的天数之前生成的任何履行计划。</span><span class="sxs-lookup"><span data-stu-id="4b1be-124">The **DOM fulfillment data deletion job setup** batch job will delete any fulfillment plan that is older than the number of days that you specify here.</span></span>
    - <span data-ttu-id="4b1be-125">**拒绝期(天)** - 指定必须在多长时间之后才可以将被拒绝的订单行分配到相同位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-125">**Rejection period (in days)** – Specify how much time must pass before a rejected order line can be assigned to the same location.</span></span>

5. <span data-ttu-id="4b1be-126">在**求解器**选项卡上，设置以下值：</span><span class="sxs-lookup"><span data-stu-id="4b1be-126">On the **Solver** tab, set the following values:</span></span>

    - <span data-ttu-id="4b1be-127">**最大自动履行尝试次数** - 指定 DOM 引擎尝试将一个订单行代理到某个位置的次数。</span><span class="sxs-lookup"><span data-stu-id="4b1be-127">**Max auto-fulfillment attempts** – Specify how many times the DOM engine will try to broker an order line to a location.</span></span> <span data-ttu-id="4b1be-128">如果 DOM 引擎无法在指定的尝试次数内将一个订单行代理到某个位置，则它会将该订单行标记为异常。</span><span class="sxs-lookup"><span data-stu-id="4b1be-128">If the DOM engine can't broker an order line to a location in the specified number of attempts, it will flag the order line as an exception.</span></span> <span data-ttu-id="4b1be-129">然后，在以后的运行中它会跳过该行，直至用户手动重置此状态。</span><span class="sxs-lookup"><span data-stu-id="4b1be-129">It will then skip that line in future runs until the status is manually reset.</span></span>
    - <span data-ttu-id="4b1be-130">**本地商店地区半径** - 输入一个值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-130">**Local store region radius** – Enter a value.</span></span> <span data-ttu-id="4b1be-131">此字段可帮助确定位置的分组方式以及在什么情况下会被视为距离相等。</span><span class="sxs-lookup"><span data-stu-id="4b1be-131">This field helps determine how locations are grouped and considered equal in terms of distance.</span></span> <span data-ttu-id="4b1be-132">例如，如果您输入 **100**，则履行地址的 100 英里半径范围内的每个商店或配送中心都将视为距离相等。</span><span class="sxs-lookup"><span data-stu-id="4b1be-132">For example, if you enter **100**, every store or distribution center within a 100-mile radius of the fulfillment address is considered equal in terms of distance.</span></span>
    - <span data-ttu-id="4b1be-133">**求解器类型** - 选择一个值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-133">**Solver type** – Select a value.</span></span> <span data-ttu-id="4b1be-134">随 Commerce 发布了两种求解器类型：**生产求解器**和**简化求解器**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-134">Two solver types are released with Commerce: **Production Solver** and **Simplified Solver**.</span></span> <span data-ttu-id="4b1be-135">对于要运行 DOM 的所有机器（即，属于 DOMBatch 组的所有服务器），必须选择**生产求解器**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-135">For all machines that will run DOM (that is, all servers that are part of the DOMBatch group), **Production Solver** must be selected.</span></span> <span data-ttu-id="4b1be-136">生产求解器要求默认情况下在生产环境中许可和部署的特殊许可证密钥。</span><span class="sxs-lookup"><span data-stu-id="4b1be-136">The Production Solver requires the special license key that, by default, is licensed and deployed in production environments.</span></span> <span data-ttu-id="4b1be-137">对于非生产环境，必须手动部署此许可证密钥。</span><span class="sxs-lookup"><span data-stu-id="4b1be-137">For non-production environments, this license key must be manually deployed.</span></span> <span data-ttu-id="4b1be-138">要手动部署许可证密钥，请按照以下步骤操作：</span><span class="sxs-lookup"><span data-stu-id="4b1be-138">To manually deploy the license key, follow these steps:</span></span>

        1. <span data-ttu-id="4b1be-139">在 Microsoft Dynamics Lifecycle Services 中，打开共用资产库，选择**模型**作为资产类型，并下载 **DOM 许可证**文件。</span><span class="sxs-lookup"><span data-stu-id="4b1be-139">In Microsoft Dynamics Lifecycle Services, open the Shared asset library, select **Model** as the asset type, and download the **DOM license** file.</span></span>
        2. <span data-ttu-id="4b1be-140">启动 Microsoft Internet 信息服务 (IIS) 管理器，右键单击 **AOSService 网站**，然后选择**浏览**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-140">Start Microsoft Internet Information Services (IIS) Manager, right-click **AOSService website**, and then select **Explore**.</span></span> <span data-ttu-id="4b1be-141">随后，**\<AOS 服务根目录\>\\webroot** 下将打开一个 Windows 资源管理器窗口。</span><span class="sxs-lookup"><span data-stu-id="4b1be-141">A Windows Explorer window is opened at **\<AOS service root\>\\webroot**.</span></span> <span data-ttu-id="4b1be-142">记下 \<AOS 服务根目录\> 路径，因为在下一步中会用到。</span><span class="sxs-lookup"><span data-stu-id="4b1be-142">Make a note of the \<AOS Service root\> path, because you will use it in the next step.</span></span>
        3. <span data-ttu-id="4b1be-143">复制 **\<AOS Service root\>\\PackagesLocalDirectory\\DOM\\bin** 目录中的配置文件。</span><span class="sxs-lookup"><span data-stu-id="4b1be-143">Copy the configuration file in the **\<AOS Service root\>\\PackagesLocalDirectory\\DOM\\bin** directory.</span></span>
        4. <span data-ttu-id="4b1be-144">转到 Headquarters 客户端，然后打开 **DOM 参数**页面。</span><span class="sxs-lookup"><span data-stu-id="4b1be-144">Go to the Headquarters client, and open the **DOM parameters** page.</span></span> <span data-ttu-id="4b1be-145">在 **求解器** 选项卡上的 **求解器类型** 字段中，选择 **生产求解器**，并确认未显示错误消息。</span><span class="sxs-lookup"><span data-stu-id="4b1be-145">On the **Solver** tab, in the **Solver type** field, select **Production solver**, and confirm that no error messages appear.</span></span>

        > [!NOTE]
        > <span data-ttu-id="4b1be-146">提供了简化求解器，这样零售商无需部署特殊许可证即可试用 DOM 功能。</span><span class="sxs-lookup"><span data-stu-id="4b1be-146">The Simplified Solver is provided so that retailers can try out the DOM feature without having to deploy the special license.</span></span> <span data-ttu-id="4b1be-147">组织不应在生产环境中使用简化求解器。</span><span class="sxs-lookup"><span data-stu-id="4b1be-147">Organizations should not use the Simplified Solver in production environments.</span></span>
        >
        > <span data-ttu-id="4b1be-148">尽管简化求解器与生产求解器提供相同的功能集，但在性能（一次运行中可以处理的订单和订单行数）和结果汇聚（在某些情况下，一批订单可能不会产生最佳结果）方面存在限制。</span><span class="sxs-lookup"><span data-stu-id="4b1be-148">Although the Simplified Solver provides the same set of capabilities as the Production Solver, there are limitations as to performance (the number of orders and order lines that can be handled in a run) and convergence of results (a batch of orders might not yield the best result in some scenarios).</span></span>
     
6. <span data-ttu-id="4b1be-149">返回 **Retail 和 Commerce \> 分配的订单管理 \> 设置 \> DOM 参数**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-149">Go back to **Retail and Commerce \> Distributed order management \> Setup \> DOM parameters**.</span></span>
7. <span data-ttu-id="4b1be-150">在**编号规则**选项卡上，为各个 DOM 实体分配所需的编号规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-150">On the **Number sequences** tab, assign the required number sequences to the various DOM entities.</span></span>

    > [!NOTE]
    > <span data-ttu-id="4b1be-151">在为实体分配编号规则之前，必须在**编号规则**页面（**组织管理 \> 编号规则 \> 编号规则**）中定义编号规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-151">Before the number sequences can be assigned to the entities, they must be defined on the **Number sequences** page (**Organization administration \> Number sequences \> Number sequences**).</span></span>

8. <span data-ttu-id="4b1be-152">DOM 功能支持定义各种类型的 DOM 规则，组织可以根据其业务需求配置多个规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-152">The DOM feature supports the definition of various types of DOM rules, and organizations can configure multiple rules, depending on their business needs.</span></span> <span data-ttu-id="4b1be-153">可以为一组位置或单个位置以及特定的产品类别、产品或变型定义 DOM 规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-153">DOM rules can be defined for a group of locations or individual locations, and for a specific product category, product, or variant.</span></span> <span data-ttu-id="4b1be-154">要创建 DOM 规则必须使用的位置分组，请按照以下步骤操作：</span><span class="sxs-lookup"><span data-stu-id="4b1be-154">To create the grouping of locations that must be used for the DOM rules, follow these steps:</span></span>

    1. <span data-ttu-id="4b1be-155">转到 **Retail 和 Commerce \> 渠道设置 \> 履行组**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-155">Go to **Retail and Commerce \> Channel setup \> Fulfillment groups**.</span></span>
    2. <span data-ttu-id="4b1be-156">选择**新建**，然后为新组输入名称和说明。</span><span class="sxs-lookup"><span data-stu-id="4b1be-156">Select **New**, and enter a name and description for the new group.</span></span>
    3. <span data-ttu-id="4b1be-157">选择**保存**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-157">Select **Save**.</span></span>
    4. <span data-ttu-id="4b1be-158">选择**添加行**，将单个位置添加到组中。</span><span class="sxs-lookup"><span data-stu-id="4b1be-158">Select **Add line** to add a single location to the group.</span></span> <span data-ttu-id="4b1be-159">或者，选择**添加多行**以添加多个位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-159">Alternatively, select **Add lines** to add multiple locations.</span></span>
    
    > [!NOTE]
    > <span data-ttu-id="4b1be-160">在 Commerce 版本 10.0.12 及更高版本中，必须在**功能管理**工作区中启用**用于在履行组中将位置指定为已启用的“装运”或“提货”的功能**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-160">In Commerce version 10.0.12 and higher, **Ability to specify locations as 'Shipping' or 'Pickup' enabled within Fulfillment group** must be enabled in the **Feature Management** workspace.</span></span>
    >
    > <span data-ttu-id="4b1be-161">此功能将在**履行组**页面上添加新的配置，这样您可以定义能否将仓库用于装运，或者能否将仓库/商店组合用于装运、提货或同时用于二者。</span><span class="sxs-lookup"><span data-stu-id="4b1be-161">This feature add new configurations on the **Fulfillment group** page so you can define if the warehouse can be used for shipping or if the warehouse/store combination can be used for shipping, pickup, or both.</span></span> 
    >
    > <span data-ttu-id="4b1be-162">如果启用此功能，则在 POS 中创建提货或装运订单时，可用于位置选择的选项将会更新。</span><span class="sxs-lookup"><span data-stu-id="4b1be-162">If you enable the feature, the options available for location selection when you create pickup or shipment orders in POS will be updated.</span></span>
    >
    > <span data-ttu-id="4b1be-163">如果选择了“全部装运”或“装运所选产品”操作，则启用此功能后还会刷新 POS 中的页面。</span><span class="sxs-lookup"><span data-stu-id="4b1be-163">Enabling the feature also results in updated pages in POS when the "ship all" or "ship selected" operations are selected.</span></span>

9. <span data-ttu-id="4b1be-164">要定义规则，请转到 **Retail 和 Commerce \> 分配的订单管理 \> 设置 \> 管理规则**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-164">To define rules, go to **Retail and Commerce \> Distributed order management \> Setup \> Manage rules**.</span></span> <span data-ttu-id="4b1be-165">当前支持以下 DOM 规则：</span><span class="sxs-lookup"><span data-stu-id="4b1be-165">The following DOM rules are currently supported:</span></span>

    - <span data-ttu-id="4b1be-166">**最小库存量规则** - 此规则类型允许组织将特定数量的产品限定用于订单履行之外的用途。</span><span class="sxs-lookup"><span data-stu-id="4b1be-166">**Minimum inventory rule** – This rule type lets organizations "ring fence" a specific quantity of a product for purposes other than order fulfillment.</span></span> <span data-ttu-id="4b1be-167">例如，组织可能不希望 DOM 考虑将商店中可用的所有库存用于订单履行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-167">For example, organizations might not want DOM to consider all the inventory that is available in a store for order fulfillment.</span></span> <span data-ttu-id="4b1be-168">而是，他们可能需要保留一些库存给散客。</span><span class="sxs-lookup"><span data-stu-id="4b1be-168">Instead, they might want to reserve some inventory for walk-in customers.</span></span> <span data-ttu-id="4b1be-169">在使用此规则类型时，可以根据位置或位置组为某类产品、单个产品或产品变型定义要保留的最小库存量。</span><span class="sxs-lookup"><span data-stu-id="4b1be-169">When this rule type is used, you can define the minimum inventory to keep for a category of products, an individual product, or a product variant per location or group of locations.</span></span>
    - <span data-ttu-id="4b1be-170">**履行库位优先级规则** - 此规则类型允许组织定义位置层次结构，以确定在 DOM 引擎尝试为特定产品标识履行位置时将考虑的优先级。</span><span class="sxs-lookup"><span data-stu-id="4b1be-170">**Fulfillment location priority rule** – This rule type lets organizations define a hierarchy of locations to establish the priority that the DOM engine considers when it tries to identify fulfillment locations for specific products.</span></span> <span data-ttu-id="4b1be-171">优先级的有效范围为从 1 至 10，其中 1 为最高优先级，10 为最低优先级。</span><span class="sxs-lookup"><span data-stu-id="4b1be-171">The valid range of priorities is 1 through 10, where 1 is the highest priority and 10 is the lowest priority.</span></span> <span data-ttu-id="4b1be-172">相对于具有较低优先级的位置，将会先考虑具有较高优先级的位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-172">Locations that have higher priority are considered before locations that have lower priority.</span></span> <span data-ttu-id="4b1be-173">如果将规则定义为硬性约束规则，订单将会仅代理到定义了优先级的位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-173">If the rule is defined as a hard constraint rule, orders are brokered only to locations that priorities are defined for.</span></span>
    - <span data-ttu-id="4b1be-174">**部分订单数规则** - 此规则允许组织定义是否可以部分履行订单或订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-174">**Partial orders rule** – This rule lets organizations define whether an order or order lines can be partially fulfilled.</span></span> <span data-ttu-id="4b1be-175">提供了以下参数：</span><span class="sxs-lookup"><span data-stu-id="4b1be-175">The following parameters are available:</span></span>

        - <span data-ttu-id="4b1be-176">**履行部分订单?**</span><span class="sxs-lookup"><span data-stu-id="4b1be-176">**Fulfill partial orders?**</span></span> <span data-ttu-id="4b1be-177">- 如果此选项设置为**是**，则 DOM 可以仅履行订单行上数量的一部分。</span><span class="sxs-lookup"><span data-stu-id="4b1be-177">– If this option is set to **Yes**, DOM can fulfill only part of the quantity on an order line.</span></span> <span data-ttu-id="4b1be-178">通过拆分订单行可实现此部分履行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-178">This partial fulfillment is achieved by splitting the order line.</span></span>
        - <span data-ttu-id="4b1be-179">**履行部分行?**</span><span class="sxs-lookup"><span data-stu-id="4b1be-179">**Fulfill partial lines?**</span></span> <span data-ttu-id="4b1be-180">- 如果此选项设置为**是**，则 DOM 可以履行订单行数量的一部分。</span><span class="sxs-lookup"><span data-stu-id="4b1be-180">– If this option is set to **Yes**, DOM can fulfill a partial quantity of order lines.</span></span> <span data-ttu-id="4b1be-181">通过拆分订单行可实现此部分履行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-181">This partial fulfillment is achieved by splitting the order line.</span></span>
        - <span data-ttu-id="4b1be-182">**仅从一个位置履行订单** - 如果此选项设置为**是**，DOM 确保将从单个位置履行订单上的所有行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-182">**Fulfill order from one location only** – If this option is set to **Yes**, DOM makes sure that all lines on an order are fulfilled from a single location.</span></span>


        <span data-ttu-id="4b1be-183">下表解释了定义这些参数的组合时的行为。</span><span class="sxs-lookup"><span data-stu-id="4b1be-183">The following table explains the behavior when a combination of these parameters is defined.</span></span>

        |      | <span data-ttu-id="4b1be-184">履行部分订单</span><span class="sxs-lookup"><span data-stu-id="4b1be-184">Fulfill partial orders</span></span> | <span data-ttu-id="4b1be-185">履行部分行</span><span class="sxs-lookup"><span data-stu-id="4b1be-185">Fulfill partial lines</span></span> | <span data-ttu-id="4b1be-186">仅从一个位置履行订单</span><span class="sxs-lookup"><span data-stu-id="4b1be-186">Fulfill order from one location only</span></span> | <span data-ttu-id="4b1be-187">说明</span><span class="sxs-lookup"><span data-stu-id="4b1be-187">Description</span></span> |
        |------|------------------------|-----------------------|--------------------------------------|-------------|
        | <span data-ttu-id="4b1be-188">1</span><span class="sxs-lookup"><span data-stu-id="4b1be-188">1</span></span>    | <span data-ttu-id="4b1be-189">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-189">Yes</span></span>                    | <span data-ttu-id="4b1be-190">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-190">Yes</span></span>                   | <span data-ttu-id="4b1be-191">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-191">Yes</span></span>                                  | <span data-ttu-id="4b1be-192">可以履行订单的几行，可以部分履行各行，但在 DOM 运行实例中，所有行必须来自同一位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-192">A few lines of the order can be fulfilled, and individual lines can be partially fulfilled, but all the lines must be from the same location in an instance of the DOM run.</span></span> <span data-ttu-id="4b1be-193">（当前不支持此组合。）</span><span class="sxs-lookup"><span data-stu-id="4b1be-193">(This combination isn't currently supported.)</span></span> |
        | <span data-ttu-id="4b1be-194">2</span><span class="sxs-lookup"><span data-stu-id="4b1be-194">2</span></span>    | <span data-ttu-id="4b1be-195">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-195">Yes</span></span>                    | <span data-ttu-id="4b1be-196">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-196">No</span></span>                    | <span data-ttu-id="4b1be-197">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-197">Yes</span></span>                                  | <span data-ttu-id="4b1be-198">可以履行订单的几行，但不能部分履行各行，并且在 DOM 运行实例中，所有行必须来自同一位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-198">A few lines of the order can be fulfilled, but individual lines can't be partially fulfilled, and all the fulfilled lines must be from the same location in an instance of the DOM run.</span></span> <span data-ttu-id="4b1be-199">（当前不支持此组合。）</span><span class="sxs-lookup"><span data-stu-id="4b1be-199">(This combination isn't currently supported.)</span></span> |
        | <span data-ttu-id="4b1be-200">3</span><span class="sxs-lookup"><span data-stu-id="4b1be-200">3</span></span>    | <span data-ttu-id="4b1be-201">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-201">Yes</span></span>                    | <span data-ttu-id="4b1be-202">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-202">Yes</span></span>                   | <span data-ttu-id="4b1be-203">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-203">No</span></span>                                   | <span data-ttu-id="4b1be-204">可以履行订单的几行，可以部分履行各行，并且在 DOM 运行实例中，可以从多个位置履行每行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-204">A few lines of the order can be fulfilled, individual lines can be partially fulfilled, and each line can be fulfilled from more than one location in an instance of the DOM run.</span></span> |
        | <span data-ttu-id="4b1be-205">4\*</span><span class="sxs-lookup"><span data-stu-id="4b1be-205">4\*</span></span>  | <span data-ttu-id="4b1be-206">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-206">No</span></span>                     | <span data-ttu-id="4b1be-207">不适用</span><span class="sxs-lookup"><span data-stu-id="4b1be-207">Not applicable</span></span>        | <span data-ttu-id="4b1be-208">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-208">No</span></span>                                   | <span data-ttu-id="4b1be-209">必须履行所有订单行，不能部分履行各行，并且可以从不同位置履行每个订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-209">All order lines must be fulfilled, individual lines can't be partially fulfilled, and each order line can be fulfilled from a different location.</span></span> |
        | <span data-ttu-id="4b1be-210">5\*</span><span class="sxs-lookup"><span data-stu-id="4b1be-210">5\*</span></span>  | <span data-ttu-id="4b1be-211">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-211">No</span></span>                     | <span data-ttu-id="4b1be-212">不适用</span><span class="sxs-lookup"><span data-stu-id="4b1be-212">Not applicable</span></span>        | <span data-ttu-id="4b1be-213">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-213">Yes</span></span>                                  | <span data-ttu-id="4b1be-214">必须履行所有订单行，不能部分履行各行，并且只能从一个位置交付所有订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-214">All order lines must be fulfilled, individual lines can't be partially fulfilled, and all the order lines can be delivered from one location only.</span></span> |
        | <span data-ttu-id="4b1be-215">6\*</span><span class="sxs-lookup"><span data-stu-id="4b1be-215">6\*</span></span>  | <span data-ttu-id="4b1be-216">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-216">No</span></span>                     | <span data-ttu-id="4b1be-217">不适用</span><span class="sxs-lookup"><span data-stu-id="4b1be-217">Not applicable</span></span>        | <span data-ttu-id="4b1be-218">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-218">No</span></span>                                   | <span data-ttu-id="4b1be-219">此组合与组合 4 的工作方式相同，因为当**履行部分订单**设置为**否**时，**履行部分行**不能设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-219">This combination works like combination 4, because **Fulfill partial lines** can't be set to **Yes** when **Fulfill partial orders** is set to **No**.</span></span> |
        | <span data-ttu-id="4b1be-220">7\*</span><span class="sxs-lookup"><span data-stu-id="4b1be-220">7\*</span></span>  | <span data-ttu-id="4b1be-221">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-221">No</span></span>                     | <span data-ttu-id="4b1be-222">不适用</span><span class="sxs-lookup"><span data-stu-id="4b1be-222">Not applicable</span></span>        | <span data-ttu-id="4b1be-223">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-223">Yes</span></span>                                  | <span data-ttu-id="4b1be-224">此组合与组合 5 的工作方式相同，因为当**履行部分订单**为**否**时，**履行部分行**不能为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-224">This combination works like combination 5, because **Fulfill partial lines** can't be **Yes** when **Fulfill partial orders** is **No**.</span></span> |
        | <span data-ttu-id="4b1be-225">8</span><span class="sxs-lookup"><span data-stu-id="4b1be-225">8</span></span>    | <span data-ttu-id="4b1be-226">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-226">Yes</span></span>                    | <span data-ttu-id="4b1be-227">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-227">No</span></span>                    | <span data-ttu-id="4b1be-228">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-228">No</span></span>                                   | <span data-ttu-id="4b1be-229">可以履行订单的几行，但不能部分履行各行，并且在 DOM 运行实例中，可以从多个位置履行各个订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-229">A few lines of the order can be fulfilled, but individual lines can't be partially fulfilled, and the various order lines can be fulfilled from more than one location in an instance of the DOM run.</span></span> |
        | <span data-ttu-id="4b1be-230">9\*</span><span class="sxs-lookup"><span data-stu-id="4b1be-230">9\*</span></span>  | <span data-ttu-id="4b1be-231">否</span><span class="sxs-lookup"><span data-stu-id="4b1be-231">No</span></span>                     | <span data-ttu-id="4b1be-232">不适用</span><span class="sxs-lookup"><span data-stu-id="4b1be-232">Not applicable</span></span>        | <span data-ttu-id="4b1be-233">是</span><span class="sxs-lookup"><span data-stu-id="4b1be-233">Yes</span></span>                                  | <span data-ttu-id="4b1be-234">必须履行所有订单行，必须仅从单个位置履行所有订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-234">All order lines must be fulfilled, and all the order lines must be fulfilled from one location only.</span></span> |

        <span data-ttu-id="4b1be-235">\* 如果**履行部分订单**设置为**否**，**履行部分行**将始终视为设置为**否**，而不管实际是如何设置的。</span><span class="sxs-lookup"><span data-stu-id="4b1be-235">\* If **Fulfill partial orders** is set to **No**, **Fulfill partial lines** is always considered to be set to **No**, regardless of how it's actually set.</span></span>

        > [!NOTE]
        > <span data-ttu-id="4b1be-236">在 Retail 版本 10.0.5 中，参数**仅从一个位置履行订单**已更改为**最大履行位置数**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-236">In Retail version 10.0.5, the parameter **Fulfill order from one location only** was changed to **Maximum fulfilling locations**.</span></span> <span data-ttu-id="4b1be-237">此前，用户可选择配置为仅从一个位置履行订单或者从尽可能多的位置履行订单；现在，用户可以指定是从确定的一组位置（最多 5 个）还是从尽可能多的位置履行订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-237">Instead of allowing a user to configure whether orders can be fulfilled from one location only or fulfilled from as many locations as it can be, users can now specify whether the fulfillment can be from a definite set of locations (up to 5) or from as many locations as it can be.</span></span> <span data-ttu-id="4b1be-238">这为可以从多少个位置履行订单提供了更大的灵活性。</span><span class="sxs-lookup"><span data-stu-id="4b1be-238">This provides more flexibility in terms of how many locations the order can be fulfilled from.</span></span>

   - <span data-ttu-id="4b1be-239">**脱机履行库位规则** - 此规则允许组织将一个位置或一组位置指定为对 DOM 脱机或不可用，这样就无法将订单分配到这些位置进行履行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-239">**Offline fulfillment location rule** – This rule lets organizations specify a location or group of locations as offline or unavailable to DOM, so that orders can't be assigned to those locations for fulfillment.</span></span>
    - <span data-ttu-id="4b1be-240">**最大拒绝次数规则** - 此规则允许组织定义拒绝次数阈值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-240">**Maximum rejects rule** – This rule lets organizations define a threshold for rejections.</span></span> <span data-ttu-id="4b1be-241">当达到阈值时，DOM 处理器会将订单或订单行标记为异常，并将其从进一步处理中排除。</span><span class="sxs-lookup"><span data-stu-id="4b1be-241">When the threshold is reached, the DOM processor will mark an order or order line as an exception, and exclude it from further processing.</span></span>

        <span data-ttu-id="4b1be-242">将订单行分配到某个位置后，该位置可以拒绝分配的订单行，因为它可能会由于某些原因无法履行该行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-242">After order lines are assigned to a location, the location can reject an assigned order line, because it might not be able to fulfill that line for some reasons.</span></span> <span data-ttu-id="4b1be-243">被拒绝的行将标记为异常，并重新放回池中，以供在下一次运行中处理。</span><span class="sxs-lookup"><span data-stu-id="4b1be-243">Rejected lines are marked as an exception and put back into the pool for processing in the next run.</span></span> <span data-ttu-id="4b1be-244">在下一次运行期间，DOM 会尝试将拒绝的行分配到其他位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-244">During the next run, DOM will try to assign the rejected line to a different location.</span></span> <span data-ttu-id="4b1be-245">新位置也可以拒绝所分配的订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-245">The new location can also reject the assigned order line.</span></span> <span data-ttu-id="4b1be-246">此分配和拒绝周期可以发生多次。</span><span class="sxs-lookup"><span data-stu-id="4b1be-246">This cycle of assignment and rejection can occur multiple times.</span></span> <span data-ttu-id="4b1be-247">当拒绝次数达到所拒绝的阈值时，DOM 会将该订单行标记为永久异常，并且不会再次选择该行来进行分配。</span><span class="sxs-lookup"><span data-stu-id="4b1be-247">When the rejection count hits the threshold that is defined, DOM will mark the order line as a permanent exception and won't pick the line for assignment again.</span></span> <span data-ttu-id="4b1be-248">仅当用户手动重置订单行的状态时，DOM 才会考虑对该订单行进行重新分配。</span><span class="sxs-lookup"><span data-stu-id="4b1be-248">DOM will consider the order line again for reassignment only if a user manually resets the status of the order line.</span></span>

   - <span data-ttu-id="4b1be-249">**最大距离规则** - 此规则允许组织定义一个位置或一组位置可以达到的最大距离，以便履行订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-249">**Maximum distance rule** – This rule lets organizations define the maximum distance that a location or group of locations can be to fulfill the order.</span></span> <span data-ttu-id="4b1be-250">如果为一个位置定义了重叠的最大距离规则，则 DOM 将应用为该位置定义的最大距离最低值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-250">If overlapping maximum distance rules are defined for a location, DOM will apply the lowest maximum distance that is defined for that location.</span></span>
    - <span data-ttu-id="4b1be-251">**最大订单数规则** - 此规则允许组织定义一个位置或一组位置可以在一个日历日期间处理的最大订单数。</span><span class="sxs-lookup"><span data-stu-id="4b1be-251">**Maximum orders rule** – This rule lets organizations define the maximum number of orders that a location or group of locations can process during a calendar day.</span></span> <span data-ttu-id="4b1be-252">如果在一天中为一个位置分配了最大订单数，则在该日历日剩下的时间中 DOM 将不会为该位置分配任何更多的订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-252">If the maximum number of orders is assigned to a location in a single day, DOM won't assign any more orders to that location for the rest of that calendar day.</span></span>

   <span data-ttu-id="4b1be-253">下面是可以为所有前述规则类型定义的一些公共属性：</span><span class="sxs-lookup"><span data-stu-id="4b1be-253">Here are some of the common attributes that can be defined for all the preceding rule types:</span></span>

   - <span data-ttu-id="4b1be-254">**开始日期**和**结束日期** - 使用这些字段可以为每个规则设置生效日期。</span><span class="sxs-lookup"><span data-stu-id="4b1be-254">**Start date** and **End date** – Every rule can be made date-effective by using the these fields.</span></span>
   - <span data-ttu-id="4b1be-255">**已禁用** - 在 DOM 运行中将仅考虑此字段的值为**否**的规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-255">**Disabled** – Only rules that have a value of **No** for this field are considered in a DOM run.</span></span>
   - <span data-ttu-id="4b1be-256">**硬性约束** - 可以将规则定义为硬性约束或非硬性约束。</span><span class="sxs-lookup"><span data-stu-id="4b1be-256">**Hard constraint** – A rule can be defined as either a hard constraint or not a hard constraint.</span></span> <span data-ttu-id="4b1be-257">每次 DOM 运行都会经历两次迭代。</span><span class="sxs-lookup"><span data-stu-id="4b1be-257">Every DOM run goes through two iterations.</span></span> <span data-ttu-id="4b1be-258">在第一个迭代中，每个规则都将被视为一个硬性约束规则，而不管此字段采用什么设置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-258">In the first iteration, every rule is treated as a hard constraint rule, regardless of the setting of this field.</span></span> <span data-ttu-id="4b1be-259">换言之，系统将应用每个规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-259">In other words, every rule is applied.</span></span> <span data-ttu-id="4b1be-260">唯一的例外是**位置优先级**规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-260">The only exception is the **Location priority** rule.</span></span> <span data-ttu-id="4b1be-261">在第二次迭代中，将会删除未定义为硬性约束的规则，并且应用所有规则时未分配到位置的订单或订单行将分配到位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-261">In the second iteration, the rules that weren't defined as hard constraint rules are removed, and the order or order lines that weren't assigned to locations when all the rules were applied are assigned to locations.</span></span>

10. <span data-ttu-id="4b1be-262">履行配置文件用于对规则、法人、销售订单来源和交货方式集合进行分组。</span><span class="sxs-lookup"><span data-stu-id="4b1be-262">Fulfillment profiles are used to group a collection of rules, legal entities, sales order origins, and modes of delivery.</span></span> <span data-ttu-id="4b1be-263">每次 DOM 运行针对特定的履行配置文件。</span><span class="sxs-lookup"><span data-stu-id="4b1be-263">Every DOM run is for a specific fulfillment profile.</span></span> <span data-ttu-id="4b1be-264">通过此方法，组织可以对具有特定销售订单来源和交货方式的订单运行一组法人的一组规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-264">In this way, organizations can define and run a set of rules for a set of legal entities, on orders that have specific sales order origins and modes of delivery.</span></span> <span data-ttu-id="4b1be-265">因此，如果必须对不同的销售订单来源或交货方式集运行不同的规则集，可以相应地定义履行配置文件。</span><span class="sxs-lookup"><span data-stu-id="4b1be-265">Therefore, if different set of rules must be run for different sets of sales order origins or modes of delivery, the fulfillment profiles can be defined accordingly.</span></span> <span data-ttu-id="4b1be-266">要设置履行配置文件，请按照以下步骤操作：</span><span class="sxs-lookup"><span data-stu-id="4b1be-266">To set up fulfillment profiles, follow these steps:</span></span>  

    1. <span data-ttu-id="4b1be-267">转到 **Retail 和 Commerce \> 分配的订单管理 \> 设置 \> 履行配置文件**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-267">Go to **Retail and Commerce \> Distributed order management \> Setup \> Fulfillment profiles**.</span></span>
    2. <span data-ttu-id="4b1be-268">选择**新建**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-268">Select **New**.</span></span>
    3. <span data-ttu-id="4b1be-269">在**配置文件**和**说明**字段中输入值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-269">Enter values in the **Profile** and **Description** fields.</span></span>
    4. <span data-ttu-id="4b1be-270">设置**自动应用结果**选项。</span><span class="sxs-lookup"><span data-stu-id="4b1be-270">Set the **Auto apply result** option.</span></span> <span data-ttu-id="4b1be-271">如果将此选项设置为**是**，则会自动将配置文件的 DOM 运行结果应用于销售订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-271">If you set this option to **Yes**, the results of the DOM run for the profile will be automatically applied to the sales order lines.</span></span> <span data-ttu-id="4b1be-272">如果将此选项设置为**否**，则只能在履行计划中查看结果。</span><span class="sxs-lookup"><span data-stu-id="4b1be-272">If you set it to **No**, the results can only be viewed in the fulfillment plan.</span></span> <span data-ttu-id="4b1be-273">它们将不会应用于销售订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-273">They won't be applied to the sales order lines.</span></span>
    5. <span data-ttu-id="4b1be-274">如果想要对具有每个销售订单来源的订单（包括未定义销售订单来源的订单）运行 DOM 配置文件，请将**处理销售订单来源为空的订单**选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-274">If you want the DOM profile to be run for orders that have every sales order origin, including orders where the sales order origin is undefined, set the **Process orders with empty sales origin** option to **Yes**.</span></span> <span data-ttu-id="4b1be-275">要仅对几个销售订单来源运行配置文件，可以在**销售来源**页面上定义，如后面所述。</span><span class="sxs-lookup"><span data-stu-id="4b1be-275">To run the profile for only a few sales order origins, you can define them on the **Sales origins** page, as explained later.</span></span>

    > [!NOTE]
    > <span data-ttu-id="4b1be-276">在 Commerce 版本 10.0.12 及更高版本中，必须在**功能管理**工作区中启用**能够将履行组分配给履行配置文件**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-276">In Commerce version 10.0.12 and higher, **Ability to assign Fulfillment group to a Fulfillment Profile** must be enabled in the **Feature Management** workspace.</span></span> 
    >
    > <span data-ttu-id="4b1be-277">此功能将在**履行配置文件**页面上添加可以关联到单个履行组的新配置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-277">This feature adds a new configuration on the **Fulfillment profile** page that can be associated to a single fulfilment group.</span></span> 
    >
    > <span data-ttu-id="4b1be-278">如果选择了履行组，则履行该配置文件的 DOM 规则将能针对履行组中包括的“装运”仓库高效运行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-278">If you select the fulfilment group, the DOM rules for that fulfilment profile will efficiently run against the "shipping" warehouses included in the fulfilment group.</span></span> 
    > 
    > <span data-ttu-id="4b1be-279">为了有效地使用此功能，请确保有一个包含所有装运仓库的履行组，然后将该履行组关联到履行配置文件。</span><span class="sxs-lookup"><span data-stu-id="4b1be-279">To effectively use this feature, ensure that there is one fulfillment group that contains all the shipping warehouses, and then associate that fulfillment group to the fulfillment profile.</span></span>
    
    6. <span data-ttu-id="4b1be-280">在**法人**快速选项卡上，选择**添加**，然后选择一个法人。</span><span class="sxs-lookup"><span data-stu-id="4b1be-280">On the **Legal entities** FastTab, select **Add**, and then select a legal entity.</span></span>
    7. <span data-ttu-id="4b1be-281">在**规则**快速选项卡上，选择**添加**，然后选择要链接到该配置文件的规则。</span><span class="sxs-lookup"><span data-stu-id="4b1be-281">On the **Rules** FastTab, select **Add**, and then select the rule to link to the profile.</span></span>
    8. <span data-ttu-id="4b1be-282">重复前两个步骤，直至所有需要的规则与该配置文件关联。</span><span class="sxs-lookup"><span data-stu-id="4b1be-282">Repeat the previous two steps until all the required rules are associated with the profile.</span></span>
    9. <span data-ttu-id="4b1be-283">选择**保存**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-283">Select **Save**.</span></span>
    10. <span data-ttu-id="4b1be-284">在“操作”窗格上的**设置**选项卡中，选择**交货方式**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-284">On the Action Pane, on the **Setup** tab, select **Modes of delivery**.</span></span>
    11. <span data-ttu-id="4b1be-285">在**交货方式**页面上，选择**新建**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-285">On the **Modes of delivery** page, select **New**.</span></span>
    12. <span data-ttu-id="4b1be-286">在**公司**字段中，选择相应法人。</span><span class="sxs-lookup"><span data-stu-id="4b1be-286">In the **Company** field, select the legal entity.</span></span> <span data-ttu-id="4b1be-287">公司列表仅限为先前添加的法人。</span><span class="sxs-lookup"><span data-stu-id="4b1be-287">The list of companies is limited to the legal entities that you added earlier.</span></span>
    13. <span data-ttu-id="4b1be-288">在**交货方式**字段中，选择要与此配置文件关联的交货方式。</span><span class="sxs-lookup"><span data-stu-id="4b1be-288">In the **Mode of delivery** field, select the mode of delivery to associate with this profile.</span></span> <span data-ttu-id="4b1be-289">交货方式不能与多个活动的配置文件关联。</span><span class="sxs-lookup"><span data-stu-id="4b1be-289">A mode of delivery can't be associated with multiple active profiles.</span></span>
    14. <span data-ttu-id="4b1be-290">重复前两个步骤，直至所有需要的交货方式与该配置文件关联。</span><span class="sxs-lookup"><span data-stu-id="4b1be-290">Repeat the previous two steps until all the required modes of delivery are associated with the profile.</span></span>
    15. <span data-ttu-id="4b1be-291">关闭**交货方式**页面。</span><span class="sxs-lookup"><span data-stu-id="4b1be-291">Close the **Modes of delivery** page.</span></span>
    16. <span data-ttu-id="4b1be-292">在“操作”窗格上的**设置**选项卡中，选择**销售订单来源**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-292">On the Action Pane, on the **Setup** tab, select **Sales order origins**.</span></span>
    17. <span data-ttu-id="4b1be-293">在**销售来源**页面上，选择**新建**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-293">On the **Sales origins** page, select **New**.</span></span>
    18. <span data-ttu-id="4b1be-294">在**公司**字段中，选择相应法人。</span><span class="sxs-lookup"><span data-stu-id="4b1be-294">In the **Company** field, select the legal entity.</span></span> <span data-ttu-id="4b1be-295">公司列表仅限为先前添加的法人。</span><span class="sxs-lookup"><span data-stu-id="4b1be-295">The list of companies is limited to the legal entities that you added earlier.</span></span>
    19. <span data-ttu-id="4b1be-296">在**销售来源**字段中，选择要与此配置文件关联的销售来源。</span><span class="sxs-lookup"><span data-stu-id="4b1be-296">In the **Sales origin** field, select the sales origin to associate with this profile.</span></span> <span data-ttu-id="4b1be-297">销售来源不能与多个活动的配置文件关联。</span><span class="sxs-lookup"><span data-stu-id="4b1be-297">A sales origin can't be associated with multiple active profiles.</span></span>
    20. <span data-ttu-id="4b1be-298">重复前两个步骤，直至所有需要的销售来源与该配置文件关联。</span><span class="sxs-lookup"><span data-stu-id="4b1be-298">Repeat the previous two steps until all the required sales origins are associated with the profile.</span></span>
    21. <span data-ttu-id="4b1be-299">关闭**销售来源**页面。</span><span class="sxs-lookup"><span data-stu-id="4b1be-299">Close the **Sales origins** page.</span></span>
    22. <span data-ttu-id="4b1be-300">将**启用配置文件**选项设置为**是**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-300">Set the **Enable profile** option to **Yes**.</span></span> <span data-ttu-id="4b1be-301">如果设置中存在任何错误，您将会收到警告消息。</span><span class="sxs-lookup"><span data-stu-id="4b1be-301">If there are any errors in the setup, you receive a warning message.</span></span>

## <a name="dom-processing"></a><span data-ttu-id="4b1be-302">DOM 处理</span><span class="sxs-lookup"><span data-stu-id="4b1be-302">DOM processing</span></span>

<span data-ttu-id="4b1be-303">DOM 将仅在批处理作业中运行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-303">DOM will run only in a batch job.</span></span> <span data-ttu-id="4b1be-304">要为 DOM 运行配置批处理作业，请按照以下步骤操作。</span><span class="sxs-lookup"><span data-stu-id="4b1be-304">To configure the batch job for DOM runs, follow these steps.</span></span>

1. <span data-ttu-id="4b1be-305">转到 **Retail 和 Commerce \> 分配的订单管理 \> 批处理 \> DOM 处理器作业设置**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-305">Go to **Retail and Commerce \> Distributed order management \> Batch processing \> DOM processor job setup**.</span></span>
1. <span data-ttu-id="4b1be-306">在**参数**快速选项卡上的**履行配置文件**字段中，选择必须对其运行 DOM 的配置文件。</span><span class="sxs-lookup"><span data-stu-id="4b1be-306">On the **Parameters** FastTab, in the **Fulfillment profile** field, select a profile that DOM must be run for.</span></span>
1. <span data-ttu-id="4b1be-307">在**在后台运行**快速选项卡上的**批处理组**字段中，选择所配置的批处理组。</span><span class="sxs-lookup"><span data-stu-id="4b1be-307">On the **Run in the background** FastTab, in the **Batch group** field, select a configured batch group.</span></span>
1. <span data-ttu-id="4b1be-308">在**任务描述**字段中，输入批处理作业的名称。</span><span class="sxs-lookup"><span data-stu-id="4b1be-308">In the **Task description** field, enter a name for the batch job.</span></span>
1. <span data-ttu-id="4b1be-309">选择**重复执行**并定义重新执行批处理作业。</span><span class="sxs-lookup"><span data-stu-id="4b1be-309">Select **Recurrence**, and define the recurrence of the batch job.</span></span>
1. <span data-ttu-id="4b1be-310">选择**确定**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-310">Select **OK**.</span></span>

<span data-ttu-id="4b1be-311">在处理时，DOM 将按照如下所述考虑订单和订单行：</span><span class="sxs-lookup"><span data-stu-id="4b1be-311">At the time of processing, DOM will consider the order and order lines as described here:</span></span>

- <span data-ttu-id="4b1be-312">满足 DOM 配置文件中为销售订单来源、交货方式和法人定义的条件，同时还满足任何下列条件的行：</span><span class="sxs-lookup"><span data-stu-id="4b1be-312">Order lines that meet the criteria for sales order origins, modes of delivery, and legal entity as defined in the DOM profile, and that also meet any of these criteria:</span></span>

    - <span data-ttu-id="4b1be-313">它们是从商业渠道创建的。</span><span class="sxs-lookup"><span data-stu-id="4b1be-313">They are created from commerce channels.</span></span>
    - <span data-ttu-id="4b1be-314">它们从未由 DOM 代理。</span><span class="sxs-lookup"><span data-stu-id="4b1be-314">They have never been brokered by DOM.</span></span>
    - <span data-ttu-id="4b1be-315">它们在先前由 DOM 代理，但标记为异常，并且低于尝试次数的最大阈值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-315">They have been brokered by DOM before, but they are marked as exceptions and are below the maximum threshold for attempts.</span></span>
    - <span data-ttu-id="4b1be-316">交货方式不是提货或电子交货。</span><span class="sxs-lookup"><span data-stu-id="4b1be-316">The mode of delivery isn't pick-up or electronic delivery.</span></span>
    - <span data-ttu-id="4b1be-317">它们未标记为交货。</span><span class="sxs-lookup"><span data-stu-id="4b1be-317">They aren't marked for delivery.</span></span>
    - <span data-ttu-id="4b1be-318">未手动将它们排除。</span><span class="sxs-lookup"><span data-stu-id="4b1be-318">They aren't manually excluded.</span></span>

- <span data-ttu-id="4b1be-319">不处于暂停状态的订单</span><span class="sxs-lookup"><span data-stu-id="4b1be-319">Orders that aren't on hold</span></span>

<span data-ttu-id="4b1be-320">在应用规则、库存约束和优化之后，DOM 将选择与客户的交货地址最近的位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-320">After it applies the rules, inventory constraints, and optimization, DOM picks the location that is closest to the customer's delivery address.</span></span>

![![销售订单条件](./media/ordercriteria.png "销售订单条件")](./media/ordercriteria.png "Sales order criteria")

## <a name="results-of-dom-runs"></a><span data-ttu-id="4b1be-322">DOM 运行结果</span><span class="sxs-lookup"><span data-stu-id="4b1be-322">Results of DOM runs</span></span>

<span data-ttu-id="4b1be-323">如果履行配置文件设置为**自动应用**，则运行的结果将会自动应用于销售订单行，并且可以单独查看履行计划。</span><span class="sxs-lookup"><span data-stu-id="4b1be-323">If the fulfillment profile is set to **Auto apply**, the results of the run will be automatically applied to the sales order lines, and the fulfillment plan can be viewed separately.</span></span> <span data-ttu-id="4b1be-324">但是，如果履行配置文件未设置为**自动应用**，则只能从履行计划视图查看运行结果。</span><span class="sxs-lookup"><span data-stu-id="4b1be-324">However, if the fulfillment profile isn't set to **Auto apply**, the results of the run can be seen only from the fulfillment plan view.</span></span> 

<span data-ttu-id="4b1be-325">要查看所生成的所有履行计划，请按照以下步骤操作。</span><span class="sxs-lookup"><span data-stu-id="4b1be-325">To view all the fulfillment plans that are generated, follow these steps.</span></span>

1. <span data-ttu-id="4b1be-326">转到 **Retail 和 Commerce \> 分配的订单管理 \> 分配的订单管理**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-326">Go to **Retail and Commerce \> Distributed order management \> Distributed order management**.</span></span>
2. <span data-ttu-id="4b1be-327">在**分配的订单管理**工作区中，选择**履行计划**磁贴。</span><span class="sxs-lookup"><span data-stu-id="4b1be-327">In the **Distributed order management** workspace, select the **Fulfillment Plans** tile.</span></span>
3. <span data-ttu-id="4b1be-328">选择要查看履行计划的相关订单履行计划的 ID。</span><span class="sxs-lookup"><span data-stu-id="4b1be-328">Select the ID of the relevant order fulfillment plan to view the fulfillment plan.</span></span>

    <span data-ttu-id="4b1be-329">履行计划的订单详细信息部分显示了作为运行一部分的原始销售订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-329">The order details section of the fulfillment plan shows the original sales order lines that were part of the run.</span></span> <span data-ttu-id="4b1be-330">除了标准销售订单行字段外，订单详细信息部分还包括以下三个与 DOM 相关的字段：</span><span class="sxs-lookup"><span data-stu-id="4b1be-330">Besides the standard sales order line fields, the order details section also includes the following three DOM-related fields:</span></span>

    - <span data-ttu-id="4b1be-331">**履行类型** - 此字段指示是已将销售订单行完全代理、部分代理还是根本未代理到某个位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-331">**Fulfillment type** – This field indicates whether the sales order line is fully brokered, partially brokered, or not brokered at all to a location.</span></span>
    - <span data-ttu-id="4b1be-332">**拆分** - 此字段指示是否已将某个销售订单行拆分并代理到其他位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-332">**Split** – This field indicates whether one sales order line has been split and brokered to different locations.</span></span>
    - <span data-ttu-id="4b1be-333">**履行位置数** - 此字段指示为某个销售订单行创建了多少个履行行（基于原始销售订单行所代理到的位置数）。</span><span class="sxs-lookup"><span data-stu-id="4b1be-333">**Number of fulfillment locations** – This field indicates how many fulfillment lines were created for one sales order line (based on the number of locations that the original sales order line was brokered to).</span></span>

    <span data-ttu-id="4b1be-334">订单履行详细信息部分显示将原始销售订单行分配到了其他位置及其数量。</span><span class="sxs-lookup"><span data-stu-id="4b1be-334">The order fulfillment details section shows the assignment of the original sales order lines to different locations, together with their quantities.</span></span>

## <a name="order-line-actions-and-statuses"></a><span data-ttu-id="4b1be-335">订单行操作和状态</span><span class="sxs-lookup"><span data-stu-id="4b1be-335">Order line actions and statuses</span></span>

<span data-ttu-id="4b1be-336">下面介绍了订单行上的设置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-336">The following describes settings on the order line.</span></span> <span data-ttu-id="4b1be-337">要打开订单行，请转到 **Retail 和 Commerce \> 客户 \> 所有销售订单**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-337">To open the order line, go to **Retail and Commerce \> Customers \> All sales orders**.</span></span>
- <span data-ttu-id="4b1be-338">如果在销售订单行的**常规**选项卡上将**从 DOM 处理中排除**选项设置为**是**，则系统将从 DOM 处理中排除该订单或订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-338">If you set the **Exclude from DOM processing** option on the **General** tab of the sales order line to **Yes**, the order or order line will be excluded from DOM processing.</span></span>
- <span data-ttu-id="4b1be-339">销售订单行的**常规**选项卡上的 **DOM 状态**字段可以设置为下列值之一：</span><span class="sxs-lookup"><span data-stu-id="4b1be-339">The **DOM status** field on the **General** tab of the sales order line can be set to one of the following values:</span></span>

    - <span data-ttu-id="4b1be-340">**无** - 从未代理订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-340">**None** – The order line has never been brokered.</span></span>
    - <span data-ttu-id="4b1be-341">**完成** - 已成功将订单行代理并分配到某个位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-341">**Complete** – The order line has been successfully brokered and assigned to a location.</span></span>
    - <span data-ttu-id="4b1be-342">**异常** - 已成功代理订单行，但无法分配到某个位置。</span><span class="sxs-lookup"><span data-stu-id="4b1be-342">**Exception** – The order line has been brokered but can't be assigned to a location.</span></span> <span data-ttu-id="4b1be-343">从 DOM 工作区可以查看异常的多个子类型：</span><span class="sxs-lookup"><span data-stu-id="4b1be-343">Exceptions have multiple subtypes that can be viewed from the DOM workspace:</span></span>

        - <span data-ttu-id="4b1be-344">**无可用数量** - 位置中没有可用库存，无法向其分配订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-344">**No quantity available** – There is no available inventory to assign the order to in the locations.</span></span>
        - <span data-ttu-id="4b1be-345">**最大拒绝次数** - 订单行已达到拒绝次数的最大阈值。</span><span class="sxs-lookup"><span data-stu-id="4b1be-345">**Maximum rejections** – The order line has reached the maximum threshold for rejections.</span></span>
        - <span data-ttu-id="4b1be-346">**数据修改冲突** - 成功代理订单后发生更改的销售订单行。</span><span class="sxs-lookup"><span data-stu-id="4b1be-346">**Data modification conflict** – The sales order line has been changed since the order was brokered.</span></span> <span data-ttu-id="4b1be-347">因此，无法将履行计划应用于该订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-347">Therefore, the fulfillment plan can't be applied to the order.</span></span>
        - <span data-ttu-id="4b1be-348">**订单行特定异常** - 订单行上有多个异常。</span><span class="sxs-lookup"><span data-stu-id="4b1be-348">**Order line specific exception** – There are multiple exceptions on the order line.</span></span>

- <span data-ttu-id="4b1be-349">在销售订单输入期间，可以在交互模式下运行 DOM。</span><span class="sxs-lookup"><span data-stu-id="4b1be-349">During the sales order entry, DOM can be run in an interactive mode.</span></span> <span data-ttu-id="4b1be-350">输入订单行时，在指定产品和数量后，可以选择**更新行**，然后在 **DOM** 下，选择**建议履行位置**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-350">While you're entering an order line, after you specify the product and quantity, you can select **Update line** and then, under **DOM**, select **Suggest fulfillment location**.</span></span> <span data-ttu-id="4b1be-351">然后，您将看到一个基于 DOM 规则的位置列表，这些规则可以履行订单行上的数量。</span><span class="sxs-lookup"><span data-stu-id="4b1be-351">You then see a list of locations that is based on DOM rules that can fulfill the quantity on the order line.</span></span> <span data-ttu-id="4b1be-352">该列表按距离排序。</span><span class="sxs-lookup"><span data-stu-id="4b1be-352">This list is sorted by distance.</span></span> <span data-ttu-id="4b1be-353">选择一个位置以在销售订单行上设置相关场所和仓库。</span><span class="sxs-lookup"><span data-stu-id="4b1be-353">Select a location to set the relevant site and warehouse on the sales order line.</span></span> <span data-ttu-id="4b1be-354">要使此功能正常工作，必须存在现有的活动履行配置文件，该配置文件与销售行上的销售来源和交货模式匹配。</span><span class="sxs-lookup"><span data-stu-id="4b1be-354">For this functionality to work, there must be an existing, active fulfillment profile that matches the sales origin and delivery mode on the sales line.</span></span>
- <span data-ttu-id="4b1be-355">要查看销售订单行的 DOM 运行日志，请选择**销售订单行**，然后在 **DOM** 下选择**查看 DOM 日志**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-355">To view the DOM run logs for a sales order line, select **Sales order line**, and then, under **DOM**, select **View DOM Logs**.</span></span> <span data-ttu-id="4b1be-356">DOM 日志显示由 DOM 运行生成的所有事件和日志。</span><span class="sxs-lookup"><span data-stu-id="4b1be-356">The DOM logs show all the events and logs that were generated by the DOM run.</span></span> <span data-ttu-id="4b1be-357">该日志可帮助您理解为什么将特定的位置分配到该订单行，以及什么规则和约束将为视为分配的一部分。</span><span class="sxs-lookup"><span data-stu-id="4b1be-357">The logs can help you understand why a specific location was assigned to the order line, and what rules and constraints were considered as a part of the assignment.</span></span> <span data-ttu-id="4b1be-358">在**管理**选项卡上，还在销售订单头级别提供了 DOM 日志。</span><span class="sxs-lookup"><span data-stu-id="4b1be-358">On the **Manage** tab, the DOM logs are also available at the level of the sales order header.</span></span>

## <a name="run-a-clean-up-job-for-dom-fulfillment-plans"></a><span data-ttu-id="4b1be-359">对 DOM 履行计划运行清除作业</span><span class="sxs-lookup"><span data-stu-id="4b1be-359">Run a clean-up job for DOM fulfillment plans</span></span>

<span data-ttu-id="4b1be-360">运行 DOM 处理时，将创建履行计划。</span><span class="sxs-lookup"><span data-stu-id="4b1be-360">As DOM processing is run, fulfillment plans are created.</span></span> <span data-ttu-id="4b1be-361">随着时间的推移，系统将会保留很多的履行计划。</span><span class="sxs-lookup"><span data-stu-id="4b1be-361">Over time, the system will keep numerous fulfillment plans.</span></span> <span data-ttu-id="4b1be-362">要管理系统保留的履行计划数，可以基于**保留期(天)** 值配置将删除较早履行计划的批处理作业。</span><span class="sxs-lookup"><span data-stu-id="4b1be-362">To manage the number of fulfillment plans that the system keeps, you can configure a batch job that deletes older fulfillment plans, based on the **Retention period in days** value.</span></span>

1. <span data-ttu-id="4b1be-363">转到 **Retail 和 Commerce \> 分配的订单管理 \> 批处理 \> DOM 履行数据删除作业设置**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-363">Go to **Retail and Commerce \> Distributed order management \> Batch processing \> DOM fulfillment data deletion job setup**.</span></span> 
1. <span data-ttu-id="4b1be-364">在**批处理组**字段中，选择所配置的批处理组。</span><span class="sxs-lookup"><span data-stu-id="4b1be-364">In the **Batch group** field, select a configured batch group.</span></span>
1. <span data-ttu-id="4b1be-365">选择**重复执行**并定义重新执行批处理作业。</span><span class="sxs-lookup"><span data-stu-id="4b1be-365">Select **Recurrence**, and define the recurrence of the batch job.</span></span>
1. <span data-ttu-id="4b1be-366">选择**确定**。</span><span class="sxs-lookup"><span data-stu-id="4b1be-366">Select **OK**.</span></span>

## <a name="more-information"></a><span data-ttu-id="4b1be-367">更多信息</span><span class="sxs-lookup"><span data-stu-id="4b1be-367">More information</span></span>

<span data-ttu-id="4b1be-368">下面是在使用 DOM 功能时要考虑的一些事项：</span><span class="sxs-lookup"><span data-stu-id="4b1be-368">Here are some things to consider when you use the DOM feature:</span></span>

- <span data-ttu-id="4b1be-369">当前，DOM 仅查看从商业渠道创建的订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-369">Currently, DOM looks only at orders that are created from commerce channels.</span></span> <span data-ttu-id="4b1be-370">当**商业销售**选项设置为**是**时，销售订单将标识为销售订单。</span><span class="sxs-lookup"><span data-stu-id="4b1be-370">Sales orders are identified as sales orders when the **Commerce sale** option is set to **Yes**.</span></span>
- <span data-ttu-id="4b1be-371">Microsoft 未使用高级仓库管理功能对 DOM 进行测试。</span><span class="sxs-lookup"><span data-stu-id="4b1be-371">Microsoft hasn't tested DOM with advanced warehouse management features.</span></span> <span data-ttu-id="4b1be-372">客户和合作伙伴必须仔细判断 DOM 是否与高级仓库管理功能及其相关流程兼容。</span><span class="sxs-lookup"><span data-stu-id="4b1be-372">Customers and partners must be careful to determine whether DOM is compatible with the advanced warehouse management capabilities and processes that are relevant to them.</span></span>
- <span data-ttu-id="4b1be-373">DOM 仅在云版本的 Commerce 中可用。</span><span class="sxs-lookup"><span data-stu-id="4b1be-373">DOM is available only on the cloud version of Commerce.</span></span> <span data-ttu-id="4b1be-374">它在本地部署中不受支持。</span><span class="sxs-lookup"><span data-stu-id="4b1be-374">It isn't supported in on-premises deployments.</span></span>
