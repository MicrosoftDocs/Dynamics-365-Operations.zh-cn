---
title: 全渠道付款概述
description: 本主题提供有关 Dynamics 365 Commerce 中的全渠道付款的概述。
author: rubendel
manager: AnnBe
ms.date: 09/17/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application user
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: AX 8.1.3
ms.openlocfilehash: 3fe64dad3c60560363428d76566d910868b87111
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/15/2021
ms.locfileid: "5244903"
---
# <a name="omni-channel-payments-overview"></a><span data-ttu-id="2a5b5-103">全渠道付款概述</span><span class="sxs-lookup"><span data-stu-id="2a5b5-103">Omni-channel payments overview</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="2a5b5-104">本主题提供有关 Dynamics 365 Commerce 中的全渠道付款的概述。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-104">This topic provides an overview of omni-channel payments in Dynamics 365 Commerce.</span></span> <span data-ttu-id="2a5b5-105">其中包括丰富的受支持方案列表、有关功能的信息、设置、疑难解答和某些典型问题的说明。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-105">It includes a comprehensive list of supported scenarios, information about functionality, setup, and troubleshooting, and descriptions of some typical issues.</span></span>

## <a name="key-terms"></a><span data-ttu-id="2a5b5-106">重要术语</span><span class="sxs-lookup"><span data-stu-id="2a5b5-106">Key terms</span></span>

| <span data-ttu-id="2a5b5-107">术语</span><span class="sxs-lookup"><span data-stu-id="2a5b5-107">Term</span></span> | <span data-ttu-id="2a5b5-108">说明</span><span class="sxs-lookup"><span data-stu-id="2a5b5-108">Description</span></span> |
|---|---|
| <span data-ttu-id="2a5b5-109">标志</span><span class="sxs-lookup"><span data-stu-id="2a5b5-109">Token</span></span> | <span data-ttu-id="2a5b5-110">支付处理程序作为引用提供的数据字符串。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-110">A string of data that a payment processor provides as a reference.</span></span> <span data-ttu-id="2a5b5-111">标志可以提供付款卡号、付款授权和以前的付款捕获。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-111">Tokens can represent payment card numbers, payment authorizations, and previous payment captures.</span></span> <span data-ttu-id="2a5b5-112">标志非常重要，因为可以将敏感数据保存在销售点 (POS) 系统外部。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-112">Tokens are important because they help keep sensitive data out of the point of sale (POS) system.</span></span> <span data-ttu-id="2a5b5-113">它们有时也称为 *引用*。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-113">They are sometimes also referred to as *references*.</span></span> |
| <span data-ttu-id="2a5b5-114">卡标志</span><span class="sxs-lookup"><span data-stu-id="2a5b5-114">Card token</span></span> | <span data-ttu-id="2a5b5-115">付款处理程序提供来存储到 POS 系统中的标志。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-115">A token that a payment processor provides for storage in the POS system.</span></span> <span data-ttu-id="2a5b5-116">只有卡标志的接收商家才能使用卡标志。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-116">A card token can be used only by the merchant who receives it.</span></span> <span data-ttu-id="2a5b5-117">卡标志有时也称为 *卡引用*。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-117">Card tokens are sometimes also referred to as *card references*.</span></span> |
| <span data-ttu-id="2a5b5-118">授权标志</span><span class="sxs-lookup"><span data-stu-id="2a5b5-118">Authorization (auth) token</span></span> | <span data-ttu-id="2a5b5-119">POS 系统创建了授权请求之后付款流程作为发送给 POS 的响应的一部分提供的唯一 ID。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-119">A unique ID that a payment process provides as part of the response that it sends to a POS system after the POS system makes an authorization request.</span></span> <span data-ttu-id="2a5b5-120">如果调用了处理程序以执行撤销或废除授权之类操作，则可在以后使用授权标志。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-120">An authorization token can be used later if the processor is called to perform actions such as reversing or voiding the authorization.</span></span> <span data-ttu-id="2a5b5-121">但是，最常用于在履行订单或完成交易记录时捕获资金。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-121">However, it's most often used to capture funds when an order is fulfilled or a transaction is finalized.</span></span> <span data-ttu-id="2a5b5-122">授权标志有时也称为 *授权引用*。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-122">Authorization tokens are sometimes also referred to as *authorization references*.</span></span> |
| <span data-ttu-id="2a5b5-123">捕获标志</span><span class="sxs-lookup"><span data-stu-id="2a5b5-123">Capture token</span></span> | <span data-ttu-id="2a5b5-124">完成或捕获付款时付款处理程序提供给 POS 系统的引用。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-124">A reference that a payment processor provides to a POS system when a payment is finalized or captured.</span></span> <span data-ttu-id="2a5b5-125">然后，可将捕获标志用于在后续操作（如退款请求）中引用付款捕获。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-125">The capture token can then be used to reference the payment capture in subsequent operations, such as refund requests.</span></span> | 
| <span data-ttu-id="2a5b5-126">无卡</span><span class="sxs-lookup"><span data-stu-id="2a5b5-126">Card not present</span></span> | <span data-ttu-id="2a5b5-127">表示不存在实体卡的付款交易记录的术语。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-127">A term that refers to payment transactions where a physical card isn't presented.</span></span> <span data-ttu-id="2a5b5-128">例如，电子商务或呼叫中心方案中可能会出现此类交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-128">For example, these transactions can occur in e-commerce or call center scenarios.</span></span> <span data-ttu-id="2a5b5-129">对于此类交易记录，将在电子商务网站、呼叫中心流或 POS 或付款终端中手动输入与付款有关的信息。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-129">For these transactions, the payment-related information is manually entered on an e-commerce website, in a call center flow, or on the POS or payment terminal.</span></span> |
| <span data-ttu-id="2a5b5-130">有卡</span><span class="sxs-lookup"><span data-stu-id="2a5b5-130">Card present</span></span> | <span data-ttu-id="2a5b5-131">表示实体卡存在且在与 Microsoft Dynamics 365 POS 系统相连的付款终端中使用的付款交易记录的术语。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-131">A term that refers to payment transactions where a physical card is presented and used on a payment terminal that is connected to the Microsoft Dynamics 365 POS system.</span></span> |

## <a name="overview"></a><span data-ttu-id="2a5b5-132">概览</span><span class="sxs-lookup"><span data-stu-id="2a5b5-132">Overview</span></span>

<span data-ttu-id="2a5b5-133">一般来说，术语 *全渠道付款* 描述在一个渠道中创建订单，然后在另一个渠道中履行的能力。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-133">In general, the term *omni-channel payments* describes the ability to create an order in one channel and fulfill it in another channel.</span></span> <span data-ttu-id="2a5b5-134">全渠道付款支持的关键是维护付款详细信息和订单的其余详细信息，然后在另一个渠道中重新调用或处理订单时使用这些付款详细信息。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-134">The key to omni-channel payment support is preserving payment details together with the rest of the order details, and then using those payment details when the order is recalled or processed in another channel.</span></span> <span data-ttu-id="2a5b5-135">“在线购买，店内提货”方案就是一个经典示例。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-135">A classic example is the "Buy online, pick up in store" scenario.</span></span> <span data-ttu-id="2a5b5-136">在此方案中，付款详细信息是当在线创建订单时添加的。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-136">In this scenario, the payment details are added when the order is created online.</span></span> <span data-ttu-id="2a5b5-137">然后提货时在 POS 重新调用，以便向客户的付款卡扣款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-137">They are then recalled at the POS to charge the customer's payment card at the time of pickup.</span></span> 

<span data-ttu-id="2a5b5-138">本主题中介绍的所有方案都可以通过使用 Commerce 随附的标准付款软件开发套件 (SDK) 实施。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-138">All the scenarios that are described in this topic can be implemented by using the standard Payments software development kit (SDK) that is provided with Commerce.</span></span> <span data-ttu-id="2a5b5-139">[适用于 Adyen 的 Dynamics 365 Payment Connector](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) 提供此处介绍的每种方案的现成实施。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-139">The [Dynamics 365 Payment Connector for Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) provides an out-of-box implementation of every scenario that is described here.</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="2a5b5-140">先决条件</span><span class="sxs-lookup"><span data-stu-id="2a5b5-140">Prerequisites</span></span>

<span data-ttu-id="2a5b5-141">本主题中介绍的每种方案都需要支持全渠道付款的付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-141">Every scenario that is described in this topic requires a payment connector that supports omni-channel payments.</span></span> <span data-ttu-id="2a5b5-142">也可以使用现成的 Adyen 连接器，因为它支持通过付款 SDK 提供的方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-142">The out-of-box Adyen connector can also be used, because it supports the scenarios that are made available through the Payments SDK.</span></span> <span data-ttu-id="2a5b5-143">有关如何实施付款连接器的详细信息，以及有关 Retail SDK 的常规信息，请访问[面向 IT 专业人员和开发人员的 Retail 主页](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors)。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-143">For more information about how to implement payment connectors, and about the Retail SDK in general, visit the [Retail for IT pros and developers home page](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).</span></span>

#### <a name="supported-versions"></a><span data-ttu-id="2a5b5-144">支持的版本</span><span class="sxs-lookup"><span data-stu-id="2a5b5-144">Supported versions</span></span>

<span data-ttu-id="2a5b5-145">本主题中介绍的全渠道付款功能是在 Microsoft Dynamics 365 for Retail 版本 8.1.3 中发布的。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-145">The omni-channel payment capabilities that are described in this topic were released as part of Microsoft Dynamics 365 for Retail version 8.1.3.</span></span> 

#### <a name="card-present-and-card-not-present-connectors"></a><span data-ttu-id="2a5b5-146">“有卡”和“无卡”连接器</span><span class="sxs-lookup"><span data-stu-id="2a5b5-146">"Card present" and "card not present" connectors</span></span>

<span data-ttu-id="2a5b5-147">付款 SDK 依赖两组应用程序编程接口 (API) 进行付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-147">The Payments SDK relies on two sets of application programming interfaces (APIs) for payments.</span></span> <span data-ttu-id="2a5b5-148">第一组 API 称为 **iPaymentProcessor**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-148">The first set of APIs is named **iPaymentProcessor**.</span></span> <span data-ttu-id="2a5b5-149">用于实施可在呼叫中心中使用的“无卡”付款连接器和带有 Microsoft Dynamics 电子商务平台的“无卡”付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-149">It's used to implement "card not present" payment connectors that can be used in call centers and with the Microsoft Dynamics e-Commerce platform.</span></span> <span data-ttu-id="2a5b5-150">有关 **iPaymentProcessor** 接口的详细信息，请参阅[实施付款连接器和付款设备](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf)白皮书，其中介绍了付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-150">For more information about the **iPaymentProcessor** interface, see the [Implement a payment connector and a payment device](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf) white paper, which covers payments.</span></span> 

<span data-ttu-id="2a5b5-151">第二组 API 称为 **iNamedRequestHandler**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-151">The second set of APIs is named **iNamedRequestHandler**.</span></span> <span data-ttu-id="2a5b5-152">它支持实施使用付款终端的“有卡”付款集成。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-152">It supports the implementation of "card present" payment integrations that use a payment terminal.</span></span> <span data-ttu-id="2a5b5-153">有关 **iNamedRequestHandler** 接口的详细信息，请参阅[为付款终端创建付款集成](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension)。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-153">For more information about the **iNamedRequestHandler** interface, see [Create a payment integration for a payment terminal](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension).</span></span> 

### <a name="setup-and-configuration"></a><span data-ttu-id="2a5b5-154">设置和配置</span><span class="sxs-lookup"><span data-stu-id="2a5b5-154">Setup and configuration</span></span>

<span data-ttu-id="2a5b5-155">需要以下组件和设置步骤：</span><span class="sxs-lookup"><span data-stu-id="2a5b5-155">The following components and setup steps are required:</span></span>

- <span data-ttu-id="2a5b5-156">**电子商务集成：** 需要与 Commerce 集成以支持订单源于在线店面的方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-156">**eCommerce integration:** An integration with Commerce is required to support scenarios where an order originates in an online storefront.</span></span> <span data-ttu-id="2a5b5-157">有关 Retail 电子商务 SDK 的详细信息，请参阅[电子商务平台软件开发套件 (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk)。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-157">For more information about the Retail e-Commerce SDK, see [e-Commerce platform software development kit (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk).</span></span> <span data-ttu-id="2a5b5-158">在演示环境中，引用店面支持全渠道付款方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-158">In a demo environment, the reference storefront supports omni-channel payment scenarios.</span></span> 
- <span data-ttu-id="2a5b5-159">**在线付款配置：** 设置在线渠道必须包括已经更新为支持全渠道付款的付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-159">**Online payments configuration:** The setup of the online channel must include a payment connector that has been updated to support omni-channel payments.</span></span> <span data-ttu-id="2a5b5-160">也可以使用现成的付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-160">Alternatively, the out-of-box payment connector can be used.</span></span> <span data-ttu-id="2a5b5-161">有关如何针对在线商店配置 Adyen 付款连接器的信息，请参阅 [Adyen 付款连接器](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce)。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-161">For information about how to configure the Adyen payment connector for online stores, see [Adyen payment connector](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce).</span></span> <span data-ttu-id="2a5b5-162">除了该主题中介绍的电子商务设置步骤，还必须在 Adyen 连接器的设置中将 **允许在电子商务中保存付款信息** 参数设置为 **True**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-162">In addition to the eCommerce setup steps that are described in that topic, the **Allow saving payment information in e-commerce** parameter must be set to **True** in the settings for the Adyen connector.</span></span> 
- <span data-ttu-id="2a5b5-163">**全渠道付款配置：** 在后端，转到 **Retail 和 Commerce \> 总部设置 \> 参数 \> Commerce 共享参数**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-163">**Omni-channel payments configuration:** In the back office, go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce shared parameters**.</span></span> <span data-ttu-id="2a5b5-164">然后在 **全渠道付款** 选项卡中，将 **使用全渠道付款** 选项设置为 **是**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-164">Then, on the **Omni-channel payments** tab, set the **Use omni-channel payments** option to **Yes**.</span></span> <span data-ttu-id="2a5b5-165">在 Commerce 版本 10.0.12 及更高版本中，此设置位于 **功能管理** 工作区。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-165">In Commerce versions 10.0.12 and later, this setting is in the **Feature Management** workspace.</span></span> <span data-ttu-id="2a5b5-166">选择 **全渠道付款** 功能，单击 **立即启用**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-166">Select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="2a5b5-167">**付款服务：** 呼叫中心使用 **付款服务** 页中的默认付款连接器处理付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-167">**Payment services:** The call center uses the default payment connector on the **Payment services** page to process payments.</span></span> <span data-ttu-id="2a5b5-168">若要支持“呼叫中心购买，店内提货”之类方案，这个默认付款连接器必须为 Adyen 付款连接器或满足全渠道付款实施要求的付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-168">To support scenarios such as "Buy in call center, pick up in store," this default payment connector must be the Adyen payment connector or a payment connector that meets the implementation requirements for omni-channel payments.</span></span>
- <span data-ttu-id="2a5b5-169">**EFT 服务：** 必须在硬件配置文件的 **EFT 服务** 快速选项卡中设置通过付款终端的付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-169">**EFT service:** Payments through a payment terminal must be set up on the **EFT service** FastTab of the hardware profile.</span></span> <span data-ttu-id="2a5b5-170">Adyen 连接器支持现成的全渠道付款方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-170">The Adyen connector supports omni-channel payments scenarios out of the box.</span></span> <span data-ttu-id="2a5b5-171">如果其他支持 **iNamedRequestHandler** 接口的付款连接器支持全渠道付款，也可以使用这些连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-171">Other payment connectors that support the **iNamedRequestHandler** interface can also be used if they support omni-channel payments.</span></span>
- <span data-ttu-id="2a5b5-172">**付款连接器可用性：** 重新调用订单时，与订单一起重新调用的付款支付行中包括用于创建与该订单关联的授权的付款连接器的名称。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-172">**Payment connector availability:** When an order is recalled, the payment tender lines that are recalled together with the order include the name of the payment connector that was used to create the authorizations that are associated with that order.</span></span> <span data-ttu-id="2a5b5-173">履行该订单时，付款 SDK 将尝试使用用于创建原始授权的同一个连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-173">When the order is fulfilled, the Payments SDK tries to use the same connector that was used to create the original authorization.</span></span> <span data-ttu-id="2a5b5-174">因此，必须可以捕获具有相同商家属性的付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-174">Therefore, a payment connector that has the same merchant properties must be available for capture.</span></span> 
- <span data-ttu-id="2a5b5-175">**卡类型：** 要让全渠道方案正常工作，每个渠道可用于全渠道的支付方式的设置必须相同。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-175">**Card types:** For omni-channel scenarios to work properly, each channel must have the same setup for tender types that can be used for omni-channel.</span></span> <span data-ttu-id="2a5b5-176">此设置中包括付款方式 ID 和卡类型 ID。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-176">This setup includes payment method IDs and card type IDs.</span></span> <span data-ttu-id="2a5b5-177">例如，如果 **卡** 支付方式在在线商店设置中的 ID 为 **2**，则在零售商店设置中应具有同一个 ID。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-177">For example, if the **Cards** tender type has an ID of **2** in the online store setup, it should have the same ID in the retail store setup.</span></span> <span data-ttu-id="2a5b5-178">同样的要求适用于卡类型 ID。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-178">The same requirement applies to card type IDs.</span></span> <span data-ttu-id="2a5b5-179">如果卡号 **12** 在在线商店中设置为 **VISA**，则应该为零售商店设置同一个 ID。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-179">If card number **12** is set to **VISA** in the online store, the same ID should be set up for the retail store.</span></span> 
- <span data-ttu-id="2a5b5-180">带内置硬件工作站的适用于 Windows 或 Android 的 Retail Modern POS   -或-</span><span class="sxs-lookup"><span data-stu-id="2a5b5-180">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="2a5b5-181">带连接的共享硬件工作站的适用于 iOS 的 Modern POS 或 Cloud POS。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-181">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

### <a name="basic-principle-supporting-omni-channel-payments"></a><span data-ttu-id="2a5b5-182">支持全渠道付款的基本原则</span><span class="sxs-lookup"><span data-stu-id="2a5b5-182">Basic principle supporting omni-channel payments</span></span>

<span data-ttu-id="2a5b5-183">付款连接器和付款处理程序使用标志（也称为引用）来引用与卡付款有关的交互。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-183">Payment connectors and payment processors use tokens, or references, to reference interactions that are related to card payments.</span></span> <span data-ttu-id="2a5b5-184">例如，在请求付款授权时，将提供该授权的引用。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-184">For example, when a payment authorization is requested, a reference to that authorization is provided.</span></span> <span data-ttu-id="2a5b5-185">因此，可以在以后履行期间捕获资金时引用该授权。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-185">Therefore, the authorization can be referenced later, when funds are captured at the time of fulfillment.</span></span> <span data-ttu-id="2a5b5-186">此授权对商家、付款连接器和处理程序是唯一的。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-186">This authorization is unique to the merchant, payment connector, and processor.</span></span> 

<span data-ttu-id="2a5b5-187">如果正在商店中为在线创建的订单提货，必须重新调用和使用该订单的相同付款详细信息。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-187">If an order that was created online is being picked up in the store, the same payment details for that order must be recalled and used.</span></span> <span data-ttu-id="2a5b5-188">在请求捕获针对原始授权的付款期间提供原始详细信息时，付款处理程序可以处理该请求和捕获付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-188">When the original details are provided as part of the request to capture a payment against the original authorization, the payment processor will be able to handle the request and capture the payment.</span></span> 

<span data-ttu-id="2a5b5-189">若要正确引用在线订单，还必须提供支持相同处理程序的“无卡”付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-189">To correctly reference the online order, a "card not present" payment connector that supports the same processor must also be available.</span></span> <span data-ttu-id="2a5b5-190">这样，POS 系统就可以有一个处理程序来处理“有卡”付款，但是也可以通过使用不同付款处理程序来访问其他付款处理程序以履行在其他渠道中创建的订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-190">In this way, the POS system can have one processor for "card present" payments, but it can also have access to other payment connectors so that it can fulfill orders that are created in other channels by using different payment processors.</span></span> 

## <a name="supported-scenarios"></a><span data-ttu-id="2a5b5-191">支持的方案</span><span class="sxs-lookup"><span data-stu-id="2a5b5-191">Supported scenarios</span></span>

<span data-ttu-id="2a5b5-192">支持下列全渠道付款方案：</span><span class="sxs-lookup"><span data-stu-id="2a5b5-192">The following omni-channel payment scenarios are supported:</span></span>

- <span data-ttu-id="2a5b5-193">在线购买，店内提货</span><span class="sxs-lookup"><span data-stu-id="2a5b5-193">Buy online, pick up in store</span></span>
- <span data-ttu-id="2a5b5-194">呼叫中心购买，店内提货</span><span class="sxs-lookup"><span data-stu-id="2a5b5-194">Buy in call center, pick up in store</span></span>
- <span data-ttu-id="2a5b5-195">商店 A 购买，商店 B 提货</span><span class="sxs-lookup"><span data-stu-id="2a5b5-195">Buy in store A, pick up in store B</span></span>
- <span data-ttu-id="2a5b5-196">商店 A 购买，发货给客户</span><span class="sxs-lookup"><span data-stu-id="2a5b5-196">Buy in store A, ship to customer</span></span>

    > [!NOTE]
    > <span data-ttu-id="2a5b5-197">在呼叫中心进行的映射到“普通”付款功能的付款必须标记为 **预付** = **是**，以在 POS 中撤回订单时反映在到期金额中。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-197">Payments made in the call center that map to the "Normal" payment function must be marked as **Prepay** = **Yes** to be reflected in the amount due when recalling the order in the POS.</span></span> <span data-ttu-id="2a5b5-198">在 POS 中撤回订单时，不会识别“普通”类型的非预付付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-198">Non-prepay payments of type "Normal" are not recognized when the order is recalled in POS.</span></span> 

<span data-ttu-id="2a5b5-199">也支持验证这些方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-199">Variations of these scenarios are also supported.</span></span> <span data-ttu-id="2a5b5-200">例如，一个在线订单中可能同时包含要发货给客户的行和店内提货的行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-200">For example, an online order might include both lines that will be shipped to the customer and lines that will be picked up in a store.</span></span> <span data-ttu-id="2a5b5-201">将通过全渠道付款支持所有订单履行选项。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-201">All order fulfillment options are supported via omni-channel payments.</span></span> 

<span data-ttu-id="2a5b5-202">下列章节介绍每个方案的步骤，并显示如何通过使用演示数据运行方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-202">The following sections describe the steps for each scenario and show how to run the scenario by using demo data.</span></span> 

### <a name="buy-online-pick-up-in-store"></a><span data-ttu-id="2a5b5-203">在线购买，店内提货</span><span class="sxs-lookup"><span data-stu-id="2a5b5-203">Buy online, pick up in store</span></span>

<span data-ttu-id="2a5b5-204">首先，请确保满足以下先决条件：</span><span class="sxs-lookup"><span data-stu-id="2a5b5-204">Before you start, make sure that the following prerequisites are in place:</span></span>

- <span data-ttu-id="2a5b5-205">您有配置了 Adyen 连接器的引用店面。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-205">You have a reference storefront where the Adyen connector is configured.</span></span>
- <span data-ttu-id="2a5b5-206">**Commerce 共享参数** 页中的 **全渠道付款** 选项设置为 **True**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-206">The **Omni-channel payments** option on the **Commerce shared parameters** page is set to **True**.</span></span> <span data-ttu-id="2a5b5-207">在以后的版本中，此设置将移到 **功能管理** 工作区，您可以在其中选择 **全渠道付款** 功能，然后单击 **立即启用**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-207">In later versions this settng is moved to the **Feature Management** workspace where you can select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="2a5b5-208">为休斯顿 POS 收银机配置了 Adyen 付款连接器。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-208">The Adyen payment connector is configured for the Houston POS register.</span></span>
- <span data-ttu-id="2a5b5-209">带内置硬件工作站的适用于 Windows 或 Android 的 Retail Modern POS   -或-</span><span class="sxs-lookup"><span data-stu-id="2a5b5-209">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="2a5b5-210">带连接的共享硬件工作站的适用于 iOS 的 Modern POS 或 Cloud POS。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-210">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

<span data-ttu-id="2a5b5-211">执行下列步骤运行方案。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-211">Follow these steps to run the scenario.</span></span>

1. <span data-ttu-id="2a5b5-212">在引用店面中，为店内提货创建一个订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-212">In the reference storefront, create an order for in-store pickup.</span></span> <span data-ttu-id="2a5b5-213">务必选择 **休斯顿** 商店。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-213">Be sure to select the **Houston** store.</span></span> 
2. <span data-ttu-id="2a5b5-214">执行结帐步骤，然后使用测试选项卡号付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-214">Go through the checkout steps, and pay by using a test credit card number.</span></span> <span data-ttu-id="2a5b5-215">可以在 [Adyen 测试卡号](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description)页中找到测试信用卡号。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-215">You can find test credit card numbers on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description).</span></span>
3. <span data-ttu-id="2a5b5-216">在 Commerce 中，使用 **同步订单** 批处理作业和 **P-001** 配送计划在后端创建订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-216">In Commerce, use the **Synchronize orders** batch job and the **P-001** distribution schedule to create the orders in the back office.</span></span>
4. <span data-ttu-id="2a5b5-217">在 POS 中的欢迎页，选择 **提货订单** 操作查看店内提货订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-217">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
5. <span data-ttu-id="2a5b5-218">从在引用店面中创建的订单选择一行或多行，然后选择 **提货**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-218">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="2a5b5-219">将从后端检索订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-219">The order is retrieved from the back office.</span></span> 

6. <span data-ttu-id="2a5b5-220">从后端检索订单行详细信息，并且检测到可用于全渠道的卡付款时，将通知您有付款方式可用。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-220">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
7. <span data-ttu-id="2a5b5-221">选择 **使用可用的付款方式** 通过使用在引用店面中输入的卡详细信息完成交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-221">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="2a5b5-222">将在交易记录页中加载订单行，而结欠金额为 0（零）。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-222">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span> 

8. <span data-ttu-id="2a5b5-223">选择 **付款** 选项卡查看从在线订单提取的支付方式行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-223">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
9. <span data-ttu-id="2a5b5-224">选择任何付款方式完成交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-224">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-call-center-pick-up-in-store"></a><span data-ttu-id="2a5b5-225">呼叫中心购买，店内提货</span><span class="sxs-lookup"><span data-stu-id="2a5b5-225">Buy in call center, pick up in store</span></span>

1. <span data-ttu-id="2a5b5-226">在 Commerce 中 **客户服务** 页的搜索栏中，输入 **Karen Berg**，然后选择 **搜索**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-226">In Commerce, on the **Customer service** page, enter **Karen Berg** in the search bar, and then select **Search**.</span></span> 
3. <span data-ttu-id="2a5b5-227">在搜索结果中选择 **Karen Berg**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-227">Select **Karen Berg** in the search results.</span></span>
4. <span data-ttu-id="2a5b5-228">Karen 加载到 **客户服务** 页中，选择 **新建销售订单**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-228">After Karen is loaded onto the **Customer service** page, select **New sales order**.</span></span>
5. <span data-ttu-id="2a5b5-229">在新的销售订单页中，选择 **抬头** 查看订单抬头。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-229">On the new sales order page, select **Header** to view the order header.</span></span> 
6. <span data-ttu-id="2a5b5-230">在 **订单抬头** 页中，将站点设置为 **中心**，将仓库设置为 **休斯敦**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-230">On the **Order header** page, set the site to **Central** and the warehouse to **Houston**.</span></span>
7. <span data-ttu-id="2a5b5-231">在 **交货** 选项卡中，将 **交货方式** 字段设置为 **60** 表示客户提货。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-231">On the **Deliver** tab, set the **Mode of delivery** field to **60** for customer pickup.</span></span>
8. <span data-ttu-id="2a5b5-232">选择 **行**，然后向订单添加一行或多行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-232">Select **Lines**, and then add one or more lines to the order.</span></span> 
9. <span data-ttu-id="2a5b5-233">选择 **完成** 以进入订单完成流程。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-233">Select **Complete** to enter the order completion flow.</span></span>
10. <span data-ttu-id="2a5b5-234">向下滚动到付款部分，选择 **添加**，然后选择付款方式类型设置为 **卡** 的行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-234">Scroll down to the payments section, select **Add**, and then select a line where the payment method type is set to **Cards**.</span></span> 
11. <span data-ttu-id="2a5b5-235">选择加号 (**+**) 添加卡付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-235">Select the plus sign (**+**) to add a card payment.</span></span> 
12. <span data-ttu-id="2a5b5-236">输入在 [Adyen 测试卡号](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description)页中找到的测试信用卡号的详细信息，然后选择 **确定**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-236">Enter the details for a test credit card number that you found on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description), and then select **OK**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2a5b5-237">如果输入的卡号的卡品牌与启动付款时选择的品牌不同，付款仍将继续。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-237">If the card brand for the card number that you entered differs from the brand that was selected when the payment was initiated, the payment will still go through.</span></span> <span data-ttu-id="2a5b5-238">但是，会过帐到映射到您在步骤 10 中选择的卡品牌的帐户。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-238">However, it will be posted to the accounts that are mapped to the card brand that you selected in step 10.</span></span>

12. <span data-ttu-id="2a5b5-239">再次选择 **确定** 关闭 **订单完成付款** 对话框。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-239">Select **OK** again to close the **Order completion payments** dialog box.</span></span>
13. <span data-ttu-id="2a5b5-240">在 **销售订单摘要** 页中，选择 **提交**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-240">On the **Sales order summary** page, select **Submit**.</span></span>
14. <span data-ttu-id="2a5b5-241">在 POS 中的欢迎页，选择 **提货订单** 操作查看店内提货订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-241">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="2a5b5-242">从在引用店面中创建的订单选择一行或多行，然后选择 **提货**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-242">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="2a5b5-243">将从后端检索订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-243">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="2a5b5-244">从后端检索订单行详细信息，并且检测到可用于全渠道的卡付款时，将通知您有付款方式可用。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-244">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="2a5b5-245">选择 **使用可用的付款方式** 通过使用在引用店面中输入的卡详细信息完成交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-245">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="2a5b5-246">将在交易记录页中加载订单行，而结欠金额为 0（零）。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-246">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="2a5b5-247">选择 **付款** 选项卡查看从在线订单提取的支付方式行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-247">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="2a5b5-248">选择任何付款方式完成交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-248">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-pick-up-in-store-b"></a><span data-ttu-id="2a5b5-249">商店 A 购买，商店 B 提货</span><span class="sxs-lookup"><span data-stu-id="2a5b5-249">Buy in store A, pick up in store B</span></span>

1. <span data-ttu-id="2a5b5-250">启动休斯顿商店的 POS。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-250">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="2a5b5-251">在 **交易记录** 页中，通过使用数字小键盘输入 **2001** 来将 Karen Berg 添加到交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-251">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="2a5b5-252">向交易记录添加一行或多行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-252">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="2a5b5-253">选择 **订单** 以查看订单选项。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-253">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="2a5b5-254">选择 **全部提货**，然后在系统提示时选择 **客户订单**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-254">Select **Pick up all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="2a5b5-255">在搜索栏中，输入 **西雅图**，然后选择 **西雅图** 商店提货。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-255">In the search bar, enter **Seattle**, and then select the **Seattle** store for pickup.</span></span> 
7. <span data-ttu-id="2a5b5-256">选择 **确定** 接受当前日期作为提货日期。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-256">Select **OK** to accept the current date as the date of pickup.</span></span>
9. <span data-ttu-id="2a5b5-257">选择 **卡支付** 启动付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-257">Select **Pay card** to initiate the payment.</span></span>
10. <span data-ttu-id="2a5b5-258">为卡付款支付存款结欠金额。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-258">Tender the card payment for the amount that is due for the deposit.</span></span> 
11. <span data-ttu-id="2a5b5-259">在付款终端完成存款付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-259">Complete the deposit payment on the payment terminal.</span></span> 
12. <span data-ttu-id="2a5b5-260">支付存款后，选择使用同一张卡履行的选项，然后等待订单完成。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-260">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span> 
13. <span data-ttu-id="2a5b5-261">启动西雅图商店的 POS。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-261">Start the POS for the Seattle store.</span></span>
14. <span data-ttu-id="2a5b5-262">在 POS 中的欢迎页，选择 **提货订单** 操作查看店内提货订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-262">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="2a5b5-263">从在引用店面中创建的订单选择一行或多行，然后选择 **提货**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-263">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="2a5b5-264">将从后端检索订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-264">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="2a5b5-265">从后端检索订单行详细信息，并且检测到可用于全渠道的卡付款时，将通知您有付款方式可用。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-265">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="2a5b5-266">选择 **使用可用的付款方式** 通过使用在引用店面中输入的卡详细信息完成交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-266">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="2a5b5-267">将在交易记录页中加载订单行，而结欠金额为 0（零）。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-267">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="2a5b5-268">选择 **付款** 选项卡查看从在线订单提取的支付方式行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-268">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="2a5b5-269">选择任何付款方式完成交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-269">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-ship-to-customer"></a><span data-ttu-id="2a5b5-270">商店 A 购买，发货给客户</span><span class="sxs-lookup"><span data-stu-id="2a5b5-270">Buy in store A, ship to customer</span></span>

1. <span data-ttu-id="2a5b5-271">启动休斯顿商店的 POS。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-271">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="2a5b5-272">在 **交易记录** 页中，通过使用数字小键盘输入 **2001** 来将 Karen Berg 添加到交易记录。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-272">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="2a5b5-273">向交易记录添加一行或多行。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-273">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="2a5b5-274">选择 **订单** 以查看订单选项。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-274">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="2a5b5-275">选择 **全部装运**，然后在系统提示时选择 **客户订单**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-275">Select **Ship all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="2a5b5-276">在装运方式页面中，选择 **标准隔夜**，然后选择 **确定** 接受今天的日期作为装运日期。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-276">In the shipping method page, select **Standard overnight**, and then select **OK** to accept today's date as the shipping date.</span></span> 
7. <span data-ttu-id="2a5b5-277">选择 **确定** 接受当前日期作为提货日期。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-277">Select **OK** to accept the current date as the date of pickup.</span></span>
8. <span data-ttu-id="2a5b5-278">选择 **卡支付** 启动付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-278">Select **Pay card** to initiate the payment.</span></span>
9. <span data-ttu-id="2a5b5-279">为卡付款支付存款结欠金额。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-279">Tender the card payment for the amount that is due for the deposit.</span></span> 
10. <span data-ttu-id="2a5b5-280">在付款终端完成存款付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-280">Complete the deposit payment on the payment terminal.</span></span> 
11. <span data-ttu-id="2a5b5-281">支付存款后，选择使用同一张卡履行的选项，然后等待订单完成。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-281">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span>

<span data-ttu-id="2a5b5-282">为订单提货、包装和在后端开票时，将把在 POS 中提供的付款详细信息用于捕获正在装运给客户的获取的资金。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-282">When the order is picked, packed, and invoiced in the back office, the payment details that are provided at the POS will be used to capture the funds for the goods that are being shipped to the customer.</span></span> 

## <a name="scenario-details"></a><span data-ttu-id="2a5b5-283">方案详细信息</span><span class="sxs-lookup"><span data-stu-id="2a5b5-283">Scenario details</span></span>

<span data-ttu-id="2a5b5-284">除了刚才介绍的基本方案，还对付款 SDK 进行了若干增强以支持全渠道付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-284">In addition to the basic scenarios that were just described, several enhancements have been made to the Payments SDK to support omni-channel payments.</span></span> 

### <a name="pos"></a><span data-ttu-id="2a5b5-285">POS</span><span class="sxs-lookup"><span data-stu-id="2a5b5-285">POS</span></span>

#### <a name="single-swipedip-for-customer-orders"></a><span data-ttu-id="2a5b5-286">客户订单单次刷卡</span><span class="sxs-lookup"><span data-stu-id="2a5b5-286">Single swipe/dip for customer orders</span></span>

<span data-ttu-id="2a5b5-287">在实施全渠道付款功能之前，在 POS 中创建包含存款的客户订单时，客户需要刷卡两次：一次存款，一次标志化卡以便后续履行订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-287">Before the omni-channel payments feature was implemented, when customer orders that included deposits were created at the POS, customers were required to swipe (or dip) their card two times: one time to pay the deposit and one time to tokenize the card for subsequent order fulfillment.</span></span> <span data-ttu-id="2a5b5-288">开启全渠道标志化功能后，客户只需刷卡一次即可存款和为以后将履行的商品结欠金额授权。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-288">When the omni-channel tokenization feature is turned on, customers must swipe their card only one time to both pay the deposit and authorize the amount that is due for goods that will be fulfilled later.</span></span> <span data-ttu-id="2a5b5-289">在履行时，将捕获授权的资金。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-289">At the time of fulfillment, the authorized funds are captured.</span></span> <span data-ttu-id="2a5b5-290">实施全渠道标志化功能之前，将仅创建一个循环卡标志来后续履行订单。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-290">Before the omni-channel tokenization feature was implemented, only a recurring card token was created for subsequent order fulfillment.</span></span> <span data-ttu-id="2a5b5-291">因此，不为已挂起履行的资金授权，并且因为针对这笔具体购买冻结了资金，所以不太可能在以后捕获。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-291">Therefore, the funds for the pending fulfillment weren't authorized, and because those funds weren't being held for that specific purchase, it was less likely that they could be captured later.</span></span>

> [!NOTE]
> <span data-ttu-id="2a5b5-292">Retail 版本 8.1.3 不支持单次刷卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-292">Single swipe isn't supported in Retail version 8.1.3.</span></span> <span data-ttu-id="2a5b5-293">版本 8.1.3 中的客户订单使用实施全渠道标志化功能之前使用的相同流程。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-293">Customer orders in version 8.1.3 use the same flow that was used before the omni-channel tokenization feature was implemented.</span></span> 

### <a name="cards-that-cant-issue-recurring-card-tokens"></a><span data-ttu-id="2a5b5-294">不能颁发循环卡标志的卡</span><span class="sxs-lookup"><span data-stu-id="2a5b5-294">Cards that can't issue recurring card tokens</span></span>

<span data-ttu-id="2a5b5-295">某些卡不能用于全渠道付款，因为不支持颁发循环卡标志。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-295">Some cards can't be used for omni-channel payments, because they don't support issuing recurring card tokens.</span></span> <span data-ttu-id="2a5b5-296">在 POS 中创建订单时，如果存款是通过使用不支持循环卡标志的卡支付的，则使用之前的标志化流程。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-296">When an order is created at the POS, if the deposit is paid by using a card that doesn't support recurring card tokens, the previous card tokenization flow is used.</span></span> <span data-ttu-id="2a5b5-297">因此，希望提供将用于后续履行订单的付款的客户必须再提供一张卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-297">Therefore, a customer who wants to provide a payment that will be used for subsequent order fulfillment must present a second card.</span></span> <span data-ttu-id="2a5b5-298">如果第二张卡不支持循环卡标志，将拒绝标志化操作，并提醒收银员请客户提供其他卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-298">If the second card doesn't support recurring card tokens, the tokenization action will be declined, and the cashier will be prompted to ask the customer to provide a different card.</span></span> 

### <a name="using-a-different-card"></a><span data-ttu-id="2a5b5-299">使用其他卡</span><span class="sxs-lookup"><span data-stu-id="2a5b5-299">Using a different card</span></span>

<span data-ttu-id="2a5b5-300">到店提货的客户可以选择使用其他卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-300">A customer who comes to the store for order pickup has the option to use a different card.</span></span> <span data-ttu-id="2a5b5-301">如果在订单提货时收银员收到 **使用可用的付款方式** 提示时，该收银员可以询问客户是否要使用同一张卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-301">When the cashier receives the **Use available payment method** prompt at the time of order pickup, he or she can ask whether the customer wants to use the same card.</span></span> <span data-ttu-id="2a5b5-302">如果客户用于创建订单的卡丢失，并且希望使用其他卡为订单付款，收银员可以选择 **使用其他付款方式**。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-302">If the customer has lost the card that was used to create the order and wants to pay for the order by using a different card, the cashier can select **Use a different payment method**.</span></span> <span data-ttu-id="2a5b5-303">如果客户以后回来提取同一个订单的更多商品，并且原始卡授权仍然有效，收银员可以再次询问客户是否要使用该卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-303">If the customer comes back later to pick up more items for the same order, if the original card authorization is still valid, the cashier can again ask whether the customer wants to use that card.</span></span>

### <a name="invalid-authorizations"></a><span data-ttu-id="2a5b5-304">无效授权</span><span class="sxs-lookup"><span data-stu-id="2a5b5-304">Invalid authorizations</span></span>

<span data-ttu-id="2a5b5-305">如果用于创建订单的卡不再有效，选择要提取的产品时，付款捕获请求将失败。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-305">If the card that was used to create an order is no longer valid, when products are selected for pickup, the payment capture request will fail.</span></span> <span data-ttu-id="2a5b5-306">然后，POS 付款连接器将使用相同卡详细信息尝试创建新的授权和捕获。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-306">The POS payment connector will then try to create a new authorization and capture by using the same card details.</span></span> <span data-ttu-id="2a5b5-307">如果新授权或捕获失败，将通知收银员无法处理该付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-307">If the new authorization or capture fails, the cashier will be informed that the payment could not be processed.</span></span> <span data-ttu-id="2a5b5-308">然后，收银员必须请客户进行新的付款。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-308">The cashier must then get a new payment from the customer.</span></span> 

### <a name="multiple-available-payments"></a><span data-ttu-id="2a5b5-309">多个可用付款</span><span class="sxs-lookup"><span data-stu-id="2a5b5-309">Multiple available payments</span></span>

<span data-ttu-id="2a5b5-310">为具有多种支付方式和多行的订单提货时，收银员首先会收到 **使用可用的付款方式** 提示。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-310">When an order that has multiple tenders and multiple lines is picked up, the cashier first receives the **Use available payment method** prompt.</span></span> <span data-ttu-id="2a5b5-311">如果有多张卡，在收银员选择 **使用可用的付款方式** 时，将捕获现有卡支付方式行，直到余额达到正在提货的商品的要求。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-311">If there are multiple cards, when the cashier selects **Use available payment method**, existing card tender lines will be captured until the balance is met for the goods that are currently being picked up.</span></span> <span data-ttu-id="2a5b5-312">收银员不能选择应该用于正在提货的商品的卡。</span><span class="sxs-lookup"><span data-stu-id="2a5b5-312">The cashier won't have the option to select the card that should be used for the goods that are being picked up.</span></span> 

## <a name="related-topics"></a><span data-ttu-id="2a5b5-313">相关主题</span><span class="sxs-lookup"><span data-stu-id="2a5b5-313">Related topics</span></span>

- [<span data-ttu-id="2a5b5-314">付款常见问题</span><span class="sxs-lookup"><span data-stu-id="2a5b5-314">Payments FAQ</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/payments-retail)
- [<span data-ttu-id="2a5b5-315">适用于 Adyen 的 Dynamics 365 付款连接器</span><span class="sxs-lookup"><span data-stu-id="2a5b5-315">Dynamics 365 Payment Connector for Adyen</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3)
- [<span data-ttu-id="2a5b5-316">在 Dynamics 365 Commerce 评估环境中配置 BOPIS</span><span class="sxs-lookup"><span data-stu-id="2a5b5-316">Configure BOPIS in a Dynamics 365 Commerce evaluation environment</span></span>](https://docs.microsoft.com/dynamics365/commerce/cpe-bopis)



[!INCLUDE[footer-include](../includes/footer-banner.md)]