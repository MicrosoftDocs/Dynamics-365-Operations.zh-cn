---
title: 将抬头费用按比例分配给匹配的销售行
description: 本主题介绍通过使用高级自动费用功能为商业渠道订单计算和应用自动费用的附加功能。
author: hhaines
ms.date: 03/30/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: josaw
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: Retail
ms.author: hhaines
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.1
ms.openlocfilehash: c36948cc58291b56c1bbe8a3d5c3db52dccc8399
ms.sourcegitcommit: 08ce2a9ca1f02064beabfb9b228717d39882164b
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/11/2021
ms.locfileid: "6018598"
---
# <a name="prorate-header-charges-to-matching-sales-lines"></a>将抬头费用按比例分配给匹配的销售行


[!include [banner](includes/banner.md)]

本主题介绍组合抬头级别自动费用并将其按比例分配给商业销售行的功能。 此功能适用于在 Retail 版本 10.0.1 中销售终端 (POS) 内创建的交易记录和在 Retail 版本 10.0.2 中在呼叫中心创建的销售。

仅当使用 **商业参数** 页面中的选项开启了[高级自动费用](/dynamics365/unified-operations/retail/omni-auto-charges)功能时，此功能才可用。 此外，自动费用增强计算方法仅适用于通过商业渠道（POS、呼叫中心和 Dynamics 电子商务平台）创建的销售订单。

这项新功能可以提高组织在计算抬头级别费用并应用于销售交易记录时的灵活性。

在 10.0.1 之前的应用版本中，仅当存在销售订单抬头中定义的特定交货方式的匹配项时，才计算具有该交货方式关系的抬头级别自动费用。

例如，为交货方式 **99** 和 **11** 定义了抬头级别自动费用。 创建了一个销售订单，并在订单抬头定义了交货方式 **99**。 但是，设置了一些销售行，以便使用交货方式 **11** 为其发货。 在此情况下，将仅考虑链接到交货方式 **99** 的抬头级别费用，并将这些费用应用于该销售订单。

在 Commerce 中，抬头级别费用还有一项功能，用于定义基于订单值的[分层费用配置](/dynamics365/unified-operations/retail/configure-call-center-delivery)。 例如，如果订单值介于 $50.00 与 $200.00 之间，组织可能希望收取 $5.00 的运费。 但是，如果订单值介于 $200.01 与 $500.00 之间，运费可能为 $4.00。

某些组织可能希望享受抬头级别费用的分层费用计算优势。 但是，如果涉及混合交货方式，他们也希望确保基于每个销售行中定义的交货方式的匹配项计算费用。

现在可以配置抬头级别自动费用，以便在计算费用时考虑订单中的所有交货方式。 此功能需要更复杂的计算逻辑来计算抬头级别费用。 该逻辑将使用同一种交货方式发货的所有项组合到一起，并在计算抬头级别自动费用时将该组视为这些项的计算组。 对于交货方式相同的项，将基于这些项的销售值之和计算自动费用。 这样就可以确定正确的自动费用。

获取了使用同一种交货方式发货的销售行的正确抬头级别费用后，计算所得费用将向下按比例分配给销售行级别。 因为这些费用属于行级别，而不是保留在抬头级别，所以将在项和为其计算的费用值之间建立更具体的链接。 此行为在部分退货方案中可能非常有用，在这种方案中，因为只有部分项退货，所以组织希望仅退还部分费用，而不是全部费用。

## <a name="scenarios"></a>方案

下面的两个示例方案概述使用这些新功能和不使用时如何计算这些费用。

### <a name="scenario-1"></a>方案 1

此方案概述如果在设置自动费用时将 **按比例分配给匹配的销售行** 选项设置为 **否** 后的行为。 （此行为等于版本 10.0.1 之前应用版本中的抬头级别费用的行为。）

在此方案中，组织为交货方式关系 **99** 和 **11** 定义了抬头级别费用。 没有为交货方式 **21** 配置自动费用。

![关闭了匹配行按比例分配时交货方式 99 的自动费用](media/99_disabled.png)

![关闭了匹配行按比例分配时交货方式 11 的自动费用](media/11_disabled.png)

在呼叫中心创建一个销售订单，并将交货方式设置为 **99**。 此订单中包含五个项。 已将两个订单号配置为使用交货方式 **99**，将两个行配置为使用交货方式 **11**，将一个行配置为使用交货方式 **21**，如下表中所示。

| 项目  | 行数量 | 传递模式 | 单位价格 |
|-------|---------------|---------------|----------------|
| 81331 | 1             | 11            | $10            |
| 81332 | 1             | 99            | $50            |
| 81333 | 2             | 11            | $30            |
| 81334 | 3             | 99            | $10            |
| 81334 | 3             | 21            | $5             |

在此方案中，将使用交货方式 **99** 针对自动费用表计算整个订单。 将使用所有订单行的全部总计确定自动费用配置中的匹配层，并在订单抬头级别应用此费用。 在此示例中，订单总计为 $165.00，并为订单抬头应用 $15.00 的运费。 始终不会引用或应用为交货方式 **11** 配置的自动费用。

在此方案中，如果一个客户退还了订单中的部分项，并且[已经为了退款配置了费用代码](/dynamics365/unified-operations/retail/omni-auto-charges#setup-and-configuration-2)，将把抬头级别费用总计系统性地应用于退款，即使只有部分项退货也不例外。

### <a name="scenario-2"></a>方案 2

在此方案中，为交货方式关系 **99** 和 **11** 定义了抬头级别费用。 但是，为这些自动费用表把 **按比例分配给匹配的销售行** 选项设置为 **是**。

![开启了匹配行按比例分配时交货方式 99 的自动费用](media/99_enabled.png)

![开启了匹配行按比例分配时交货方式 11 的自动费用](media/11_enabled.png)

此方案使用同一个包含五个行的销售订单。 订单抬头中的交货方式设置为 **99**，但是销售订单中各项的交货方式配置如下表。

| 项目  | 行数量 | 传递模式 | 单位价格 |
|-------|---------------|---------------|----------------|
| 81331 | 1             | 11            | $10            |
| 81332 | 1             | 99            | $50            |
| 81333 | 2             | 11            | $30            |
| 81334 | 3             | 99            | $10            |
| 81334 | 3             | 21            | $5             |

因为自动费用配置设置为按比例分配给匹配的销售行，所以系统执行以下计算步骤。

1. 交货方式相同的所有项组合在一起，系统将计算组中项的产品值总和。

    **交货方式 11**

    - 项 81331，数量 1 = $10
    - 项 81333，数量 2 = 净额 $60（每单位 $30）
    - **交货方式 11 的产品值总和 = $70**

    **交货方式 99**

    - 项 81332，数量 1 = $50
    - 项 81334，数量 3 = 净额 $30
    - **交货方式 99 的产品值总和 = $80**

    **交货方式 21**

    - 项 81334，数量 3 = 净额 $15
    - **交货方式 21 的产品值总和 = $15**

2. 系统查找与每组项的客户和交货方式设置匹配的抬头级别自动收费配置。 如果找到了该配置，系统将基于交货方式组中的产品值总和在分层配置中查找应该应用的费用。

    **交货方式 11**

    - 产品值总和 = $70
    - **费用值 = $7**

    **交货方式 99**

    - 产品值总和 = $80
    - **费用值 = $15**

    **交货方式 21**

    - 产品值总和 = $15
    - **费用值 = $0**（尚未为客户和交货方式的此组合配置任何自动费用。）

    ![交货方式 11 费用在突出显示的层中](media/step2mode11.png)

    ![交货方式 99 费用在突出显示的层中](media/step2mode99.png)

3. 系统基于按比例分配逻辑（这种逻辑将考虑与组的产品值总和有关的行的按比例分配值）计算将为每个行应用的费用值。

    **交货方式 11**

    - 费用值 = $7
    - 组产品值 = $70
    - 行 1 值 = $10（= 组值的 14.2857%）
    - 行 3 值 = $60（= 组值的 85.7143%）
    - **行 1 的行费用 = $1**
    - **行 3 的行费用 = $6**

    **交货方式 99**

    - 费用值 = $15
    - 组产品值 = $80
    - 行 2 值 = $50（= 组值的 62.5%）
    - 行 4 值 = $30（= 组值的 37.5%）
    - **行 2 的行费用 = $9.38**
    - **行 4 的行费用 = $5.62**

    **交货方式 21**

    - 费用值 = $0
    - 组产品值 = $15
    - 行 5 值 = $15（= 组值的 100%）
    - **行 5 的行费用 = $0**

因此，对于此示例，将为项 81334 分配 $5.62 的运费。 可在销售行的 **维护费用** 页面中查看这些费用。 下图显示项 81334 的此页面的显示效果。

![项 81334 的销售行的按比例分配费用](media/proratedlinecharge.png)

如果在部分退货方案中使用这种计算方法，并且费用代码为可退款，则该项退货时仅为分配给该行的那部分费用退款。

## <a name="additional-resources"></a>其他资源

[全渠道高级自动费用](omni-auto-charges.md)

[按渠道启用和配置自动费用](auto-charges-by-channel.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]