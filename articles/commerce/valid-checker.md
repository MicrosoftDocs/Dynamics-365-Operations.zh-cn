---
title: 验证用于进行对帐单计算的商店交易记录
description: 本主题将介绍 Microsoft Dynamics 365 Commerce 中用于验证商店交易记录的功能。
author: analpert
ms.date: 12/15/2021
ms.topic: index-page
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgriffin
ms.custom: ''
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: analpert
ms.search.validFrom: 2019-01-15
ms.dyn365.ops.version: 10
ms.openlocfilehash: 008368ae32aa92682d578b75b148e0587fcc94e0
ms.sourcegitcommit: 70ac76be31bab7ed5e93f92f4683e65031fbdf85
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/16/2021
ms.locfileid: "7924763"
---
# <a name="validate-store-transactions-for-statement-calculation"></a>验证用于进行对帐单计算的商店交易记录

[!include [banner](includes/banner.md)]

本主题将介绍 Microsoft Dynamics 365 Commerce 中用于验证商店交易记录的功能。 在选取交易记录进行对帐单过帐之前，验证流程可识别和标记会导致过帐错误的交易记录。

当您尝试过帐对帐单时，由于商业交易记录表中存在不一致的数据，验证过程可能会失败。 以下是可能导致数据不一致的部分因素示例：

- 标头表中的交易记录总计与行中的交易记录总计不匹配。
- 标头表中指定的物料数与交易记录表中的物料数不匹配。
- 标头表中的税额与行中的税额不匹配。 

当对帐单过帐流程选择不一致的交易记录时，将创建不一致的销售发票和付款日记帐，会导致对帐单过帐失败。 **验证商店交易记录** 流程可确保仅通过交易记录验证规则的交易记录会传递到交易记录对帐单计算流程中，从而防止这些问题的发生。

下图显示了用于上传交易记录、验证交易记录、计算和过帐交易记录对帐单的定期日间流程以及财务报表计算和过帐的日结流程。

![示意图显示了用于上传交易记录、验证交易记录、计算和过帐交易记录对帐单的定期日间流程以及财务报表计算和过帐的日结流程](./media/valid-checker-statement-posting-flow.png)

## <a name="store-transaction-validation-rules"></a>商店交易记录验证规则

**验证商店交易记录** 批处理流程将根据以下验证规则检查商业交易记录表的一致性。

> [!NOTE]
> 后续版本将继续添加验证规则。

### <a name="transaction-header-validation-rules"></a>交易记录标头验证规则

下表列出了交易记录标头验证规则，在将交易记录传递到对帐单过帐之前，该规则会对这些零售交易记录标头进行检查。

| 标题 | 说明 |
|-------|-------------|
| 业务日期 | 此规则可验证交易记录的业务日期是否与分类帐中的启用会计期间关联。 |
| 货币舍入 | 此规则可验证交易记录金额是否根据货币舍入规则舍入。 |
| 客户帐户 | 此规则可验证在交易记录中使用的客户是否存在于数据库中。 |
| 折扣金额 | 此规则可验证标头上的折扣金额是否等于行的折扣金额总和。 |
| 会计单据过帐状态（巴西） | 此规则可验证会计单据是否可以成功过帐。 |
| 总额 | 此规则可验证交易记录标头上的总额是否和交易记录行的净额（含税）与费用之和相匹配。 |
| 净额 | 此规则可验证交易记录标头上的净额是否和交易记录行的净额（不含税）与费用之和相匹配。 |
| 净额 + 税额 | 此规则可验证交易记录标头上的总额是否和交易记录行的净额（不含税）与所有税款和费用之和相匹配。 |
| 物料数量 | 此规则可验证在交易记录标头上指定的物料数量是否与交易记录行中的数量总和匹配。 |
| 付款金额 | 此规则可验证交易记录标头上的付款金额是否与所有付款交易记录的总和相匹配。 |
| 免税计算 | 此规则可验证计算的金额与费用行的免税金额的总和是否等于原始计算金额。 |
| 含税定价 | 此规则可验证交易记录标头和税收交易记录中的 **价格已含税** 标记是否一致。 |
| 交易记录不为空 | 此规则可验证交易记录是否包含行，且至少有一行未失效。 |
| 未足额支付/超额支付 | 此规则可验证总额与付款金额的差额未超过最大未足额支付/超额支付配置金额。 |

### <a name="transaction-line-validation-rules"></a>交易记录行验证规则

下表列出了交易记录行验证规则，在将交易记录传递到对帐单过帐之前，该规则会对这些零售交易记录行详细信息进行检查。

| 标题 | 说明 |
|-------|-------------|
| 条形码 | 此规则可验证交易记录行上使用的所有物料条形码是否都存在于数据库中。 |
| 费用行 | 此规则可验证计算的金额与费用行的免税金额的总和是否等于原始计算金额。 |
| 礼品卡退货 | 此规则可验证交易记录中没有礼品卡的退货记录。 |
| 物料变型 | 此规则可验证在交易记录行上使用的所有物料和所有变型是否都存在于数据库中。 |
| 行折扣 | 此规则可验证行折扣金额是否与折扣交易记录总和相匹配。 |
| 行税款 | 此规则可验证行税额是否与税交易记录总和相匹配。 |
| 负价格 | 此规则可验证交易记录行没有使用负价格。 |
| 通过序列号控制 | 此规则可验证通过序列号控制的物料的序列号是否存在于交易记录行中。 |
| 序列号维度 | 此规则可验证如果物料的序列号维度处于禁用状态，则不提供任何序列号。 |
| 符号冲突 | 该规则可验证数量符号和净额符号是否在所有交易记录行中都相同。 |
| 免税 | 此规则可验证行物料价格与免税金额的总和是否等于原价。 |
| 税组分配 | 此规则可验证销售税组与物料税组的组合是否会产生有效的税交集。 |
| 度量单位转换 | 此规则可验证所有行的度量单位是否已转换为有效的库存度量单位。 |

## <a name="enable-the-store-transaction-validation-process"></a>启用商店交易记录验证流程

配置 **验证商店交易记录** 作业以在 Commerce Headquarters 中定期运行（**Retail 和 Commerce \> Retail 和 Commerce IT \> POS 过帐**）。 批处理作业是根据商店的组织层次结构安排的。 我们建议您将此批处理流程配置为与您的 **P 作业** 和 **交易记录对帐单计算** 批处理作业以相同的频率运行。

## <a name="results-of-the-validation-process"></a>验证流程的结果

可从每项零售商店交易记录中查看 **验证商店交易记录** 批处理流程的结果。 交易记录中的 **验证状态** 字段设置为 **成功**、**错误** 或 **无**。 **上次验证时间** 字段显示上次验证执行的日期。

下表介绍了所有验证状态。

| 验证状态 | 说明 |
|-------------------|-------------|
| 成功 | 已通过所有已启用的验证规则。 |
| 错误 | 启用的验证规则已识别出错误。 您可以选择“操作窗格”上的 **验证错误** 来查看有关错误的更多详细信息。 |
| 无 | 交易记录类型不需要应用验证规则。 |

![商店交易记录页面显示“验证状态”字段和“验证错误”按钮。](./media/valid-checker-validation-status-errors.png)

只有验证状态为 **成功** 的交易记录才会导入交易记录对帐单中。 要查看状态为 **错误** 的交易记录，请查看 **商店财务** 工作区中的 **现金和结转验证失败** 磁贴。

![商店财务工作区中的磁贴。](./media/valid-checker-cash-carry-validation-failures.png)

有关如何解决现金和结转验证失败问题的详细信息，请参阅[编辑并审计现金和结转及现金管理交易记录](edit-cash-trans.md)。

## <a name="additional-resources"></a>其他资源

[编辑并审计现金和结转及现金管理交易记录](edit-cash-trans.md)

[!INCLUDE[footer-include](../includes/footer-banner.md)]
