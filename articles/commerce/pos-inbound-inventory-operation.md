---
title: POS 中的入站库存操作
description: 此主题介绍销售点 (POS) 入站库存操作的功能。
author: hhaines
manager: annbe
ms.date: 09/17/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: josaw
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: Retail
ms.author: hhaines
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.9
ms.openlocfilehash: f3dd442f979c23a87ae4b7e69a37de65d5d9bd70
ms.sourcegitcommit: 38d40c331c8894acb7b119c5073e3088b54776c1
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/15/2021
ms.locfileid: "4972622"
---
# <a name="inbound-inventory-operation-in-pos"></a>POS 中的入站库存操作

[!include [banner](includes/banner.md)]

在 Microsoft Dynamics 365 Commerce 版本 10.0.10 及更高版本中，销售点 (POS) 中的入站和出站操作取代了领料和收货操作。

> [!NOTE]
> 在 Commerce 版本 10.0.10 及更高版本中，POS 应用程序中中与接收商店库存和采购订单及转移单有关的所有新功能将添加到 **入站操作** POS 操作中。 如果您正在使用 POS 中的领料和收货操作，建议您指定策略从该操作迁移到新的入站和出站操作。 虽然此产品中不会移除领料和收货操作，但是在版本 10.0.9 之后，从功能角度到性能角度，都不会再对其进行更多投入。

## <a name="prerequisite-configure-an-asynchronous-document-framework"></a>先决条件：配置异步单据框架

入站操作中包含性能改进，以便确保在大量商店或公司需要过帐大量收货且拥有大量库存单据的的用户可以将这些单据传输给 Commerce Headquarters，并且不会超时或失败。 这些改进需要使用异步单据框架。

使用异步单据框架时，可以将入站单据更改从 POS 提交到 Commerce Headquarters，然后继续执行其他任务，同时在后台传输到 Commerce Headquarters。 可以通过 POS 中的 **入站操作** 单据列表页检查单据的状态，以确保过帐成功。 在 POS 应用程序中，也可以使用入站操作活动单据列表查看无法过帐到 Commerce Headquarters 的任何单据。 如果单据失败，POS 用户可以进行更正，然后再次尝试将其传输到 Commerce Headquarters。

> [!IMPORTANT]
> 必须在公司尝试在 POS 中使用入站操作之前配置异步单据框架。

若要配置异步单据框架，请完成以下过程。

### <a name="create-and-configure-a-number-sequence"></a>创建和配置编号规则

1. 转到 **组织管理 \> 编号规则 \> 编号规则**。
2. 在 **编号规则** 页，创建一个编号规则。
3. 在 **编号规则代码** 和 **名称** 字段中，输入用户定义的值。
4. 在 **引用** 快速选项卡上，选择 **添加**。
5. 在 **区域** 字段中，选择 **Commerce 参数**。
4. 在 **引用** 字段中，选择 **零售单据操作标识**。
5. 在 **常规** 快速选项卡的 **设置** 部分中，将 **连续** 选项设置为 **否** 以确保无性能问题。

### <a name="create-and-schedule-two-batch-jobs-for-the-document-processing-and-monitoring-tasks"></a>为单据处理和监视任务创建和计划两个批处理作业

> [!NOTE]
> 在 Commerce 版本 10.0.13 和更高版本中，您不必通过批处理作业框架配置这些批处理作业。 批处理流程可以从 **Retail 和 Commerce > Retail 和 Commerce IT** 菜单配置。 使用 **零售单据操作监控** 和 **零售单据操作处理** 菜单选项来配置批处理作业。

将把创建的批处理作业用于处理失败或超时的单据。还会在从 POS 处理的活动库存单据数量超过系统配置的值时使用。

1. 转到 **系统管理 \> 查询 \> 批处理作业**。
2. 在 **批处理作业** 页面上，创建两个批处理作业：

    - 将一个作业配置为运行 **RetailDocumentOperationMonitorBatch** 类。
    - 将另一个作业配置为运行 **RetailDocumentOperationProcessingBatch** 类。

2. 将新批处理作业计划为重复运行。 例如，将计划设置为每隔五分钟运行一次作业。

## <a name="prerequisite-add-inbound-operation-to-the-pos-screen-layout"></a>先决条件：向 POS 屏幕布局添加入站操作

组织必须在一个或多个 [POS 屏幕布局](https://docs.microsoft.com/dynamics365/unified-operations/retail/pos-screen-layouts)中配置 **入站操作** POS 操作，才能使用入站操作功能。 在生产环境中部署新操作之前，确保彻底测试该操作，并为用户培训使用方法。

## <a name="overview"></a>概览

POS 用户可通过入站操作执行以下任务：

- 从已确认采购订单单据或已装运转移单单据库存库存并放到商店存货中。
- 查看有关单据完全收货后七天内的历史库存收货的信息。
- 创建新的入站转移单请求。

从 POS 应用程序开始执行入站操作时，将显示列表页视图。 此视图显示其中包含计划由当前商店收货的库存行的未结采购订单和转移单单据。 若要查找和选择特定单据，用户可以滚动列表或使用搜索功能。

入站库存单据列表中有三个选项卡：

- **有效** – 此选项卡显示全部或部分未结，并且包含仍然必须收货的行或数量的单据。
- **草稿** – 此选项卡显示商店创建的新入站转移单请求。 但是，这些单据仅保存在本地。 尚未提交到 Commerce Headquarters 进行处理。
- **完成** – 此选项卡显示过去七天内商店已全部收货的采购订单或转移单单据的列表。 此选项卡仅供参考。 对于商店来说，有关这些单据的所有信息均为只读数据。

查看这些选项卡中任何一个上的单据时，**状态** 字段可以帮助您了解单据所处阶段。

- **草稿** – 转移单单据仅已本地保存到商店的渠道数据库。 尚未将有关转移单请求的任何信息提交到 Commerce Headquarters。
- **已请求** – 已在 Commerce Headquarters 中创建并完全打开了采购订单或转移单。 尚未处理单据的任何收货。 对于采购订单单据类型的单据，状态为 **已请求** 时，随时可以开始收货。
- **已部分装运** – 转移单单据有一个或多个行或部分行数量已经被出站仓库作为装运过帐。 可以通过入站操作接收这些装运的行。
- **已完全装运** – 转移单的所有行和整行数量已经被出站仓库作为装运过帐。 可以通过入站操作对整个单据收货。
- **已部分收货** – 商店已收到了采购订单或转移单单据的部分行或行数量的货物，但是部分行仍然未结。
- **已全部收货** – 已收到了采购订单或转移单单据的全部行或数量的货物。 这些单据只能通过 **完成** 选项卡访问，并且只有商店用户才能查看。
- **进行中** – 此状态用于通知设备用户另一位用户正在主动处理该单据。
- **已暂停** – 选择 **暂停接收** 以暂时停止接收流程之后，显示此状态。
- **正在 HQ 处理** – 单据已从 POS 应用程序提交到 Commerce Headquarters，但是尚未成功过帐到 Commerce Headquarters。 单据将经历异步单据过帐流程。 将单据成功过帐到 Commerce Headquarters 之后，其状态应该会更新为 **已完全接收** 或 **已部分接收**。
- **处理失败** – 单据已过帐到 Commerce Headquarters，但被拒绝。 **详细信息** 窗格显示过帐失败的原因。 必须编辑单据以解决数据问题，然后必须将其重新提交到 Commerce Headquarters 进行处理。

在列表中选择单据行之后，将显示 **详细信息** 窗格。 此窗格显示有关单据的更多信息，如装运和日期信息。 进度条显示还必须处理多少个物料。 如果未将单据成功过帐到 Commerce Headquarters，**详细信息** 窗格还会显示与失败有关的错误消息。

在单据列表页视图中，可以选择应用程序栏中的 **订单详细信息** 查看单据详细信息。 也可以在符合资格的单据行中激活收据处理。

在单据列表页视图中，还可以为商店创建新的入站转移单请求。 单据继续保持 **草稿** 状态，并且将其提交给 Commerce Headquarters 进行处理之前，可以进行调整或删除。 提交到 Commerce Headquarters 之后，不能从 POS 应用程序更改转移单行。

## <a name="receiving-process"></a>收货流程

在 **有效** 选项卡上选择采购订单或转移单单据之后，可以选择 **订单详细信息** 开始执行收货流程。

默认情况下，将显示 **立即收货** 视图。 此视图已针对条形码扫描进行了优化。 可用于创建已扫描物料列表，这样就可以对这些物料进行收货。 若要开始执行收货流程，可以开始扫描物料条形码。

在 **立即收货** 视图中扫描了物料条形码之后，应用程序将根据所选采购订单或转移单单据验证物料，以确保扫描的每个物料与单据中的有效物料匹配。 在 **立即收货** 视图中，每次扫描条形码都视为收货一个单位的数量，除非条形码中嵌入了数量。 可以在此视图中重复扫描条形码，以便建立所有物料和收货数量的列表。

### <a name="example-scenario"></a>示例场景

用户收到了一个采购订单，其中包含 10 个单位的条形码 5657900266。 用户可以扫描该条形码 10 次以按照每次扫描一个单位的频率更新 **立即收货** 字段。 用户完成扫描后，物料行的 **立即收货** 字段将显示已收货数量为 10。

此外，如果物料数量极大，用户可能希望手动输入数量，而不是扫描收到的每个物料的条形码。 在这种情况下，用户可以扫描条形码一次，以将物料添加到 **立即收货** 清单。 然后，用户可以在 **立即收货** 视图中选择关联行，再在页面右侧显示的 **详细信息** 窗格中更新该物料的 **收货数量** 字段。

虽然 **立即收货** 视图已针对条形码扫描进行了优化，用户还是可以选择应用程序栏中的 **接收产品**，然后通过对话框输入物料 ID 或条形码数据。 验证输入的物料之后，将提示用户输入收货数量。

**立即收货** 视图提供焦点方法供用户查看正在扫描哪些产品。 也可以使用 **完整订单列表** 视图。 此视图显示所选采购订单或转移单单据的单据行完整列表。 用户可以在此列表中手动选择行，然后在 **详细信息** 窗格中更新所选行的 **收货数量** 字段。 在 **完整订单列表** 视图中，用户可以选择条形码，也可以使用 **接收产品** 功能输入物料 ID 或条形码，以及有关收货数量的数据，不必先在列表中选择匹配物料行。

### <a name="over-receiving-validations"></a>超收验证

单据行的接收流程中执行验证。 其中包括超交验证。 如果用户尝试接收的库存比采购订单中订购的多，但是未配置超交，或接收的量超过了为采购订单行配置的超交容差，用户将收到错误，并且不能接收超额数量。

转移单单据不允许超收。 用户如果尝试收货数量超过为转移单行装运的数量，则始终会收到错误。

### <a name="close-purchase-order-lines"></a>结转采购订单行

如果发货人已确认他们无法装运请求的全部数量，则可以在收货流程中结转入站采购订单上的剩余数量。 若要这样做，必须将公司配置为允许欠交采购订单。 此外，还必须为采购订单行定义欠交容差百分比。

若要将公司配置为允许欠交采购订单，请在 Commerce Headquarters 中，转到 **采购** > **设置** > **采购参数**。 在 **交货** 选项卡上，打开 **接受欠交** 参数。 然后，运行 **1070**（**渠道配置**）配送计划作业以将设置更改同步到渠道。

可以在 Commerce Headquarters 中配置产品时为产品预定义采购订单行的欠交容差百分比。 此外，还可以在 Commerce Headquarters 中在特定采购订单上设置或覆盖它们。

在组织完成采购订单欠交配置后，当在 **入站库存** 操作中选择入站采购订单行时，POS 用户将在 **详细信息** 窗格中看到一个新的 **结转剩余数量** 选项。 如果用户结转剩余数量，POS 将执行验证以验证要结转的数量是否在采购订单行中定义的欠交容差百分比内。 如果超过欠交容差，将显示一条错误消息，并且用户将无法结转剩余数量，直到之前收货的数量加上 **立即收货** 数量等于或超过根据欠交容差百分比需要收货的最小数量。 

如果为采购订单行打开了 **结转剩余数量** 选项，当用户使用 **完成收货** 操作完成收货时，结转请求还将发送给 Commerce Headquarters，并且将取消此订单行的任何未收货数量。 此时，该行将视为已完全收货。 

### <a name="receiving-location-controlled-items"></a>接收位置控制的物料

如果正在接收的物料受位置控制，用户可以选择在收货流程要接收物料的位置。 建议为商店仓库配置默认收货位置，以便提高此流程的效率。 即使配置了默认位置，用户也可以在需要时替换所选行中的收货位置。

此操作采用 **位置** 存储维度中的 **允许空收货** 配置，如果配置了空收货，则不要求输入位置维度。 如果不允许物料采用空收货位置，POS 应用程序将显示错误，并要求先输入位置，之后才能过帐收据。

### <a name="receive-all"></a>全部接收

可以按照您的要求选择应用程序栏中的 **全部接收** 以将所有单据行的 **立即接收** 数量快速更新到可为这些行收货的最大值。

### <a name="receipt-of-unplanned-items-on-purchase-orders"></a>在采购订单上接收计划外物料

在 Commerce 版本 10.0.14 和更高版本中，用户可以接收最初不在采购订单上的产品。 要启用此功能，请打开 **在销售点接收期间向采购订单添加行**。  

此功能仅适用于采购订单接收。 如果先前未从出站仓库订购和装运物料，则无法根据转移单接收物料。

如果采购订单[更改管理工作流](https://docs.microsoft.com/dynamics365/supply-chain/procurement/purchase-order-approval-confirmation)在 Commerce headquarters (HQ) 中启用，用户将无法在 POS 接收期间将新产品添加到采购订单中。 要启用更改管理，必须先批准对采购订单的所有更改，然后才允许接收。 因为此流程允许接收者向采购订单添加新行，所以如果启用了更改管理工作流，接收将失败。 如果为所有采购订单或在 POS 中主动接收的与采购订单链接的供应商启用了更改管理，用户将无法在 POS 接收期间将新产品添加到采购订单中。

启用添加行的功能不能用作接收采购订单上已有的额外产品数量的解决方法。 超收通过采购订单上产品行的标准[超收](https://docs.microsoft.com/dynamics365/commerce/pos-inbound-inventory-operation#over-receiving-validations)设置来管理。

如果启用了 **在销售点接收期间向采购订单添加行**，当用户在使用 POS 中的 **入站操作** 接收时，如果用户扫描或键入的产品条码或产品编号未被识别为当前采购订单上的物料，但被识别为有效物料，用户会收到一条有关将该物料添加到采购订单中的消息。 如果用户将物料添加到采购订单中，在 **正在接收** 中输入的数量将被视为采购订单行的订购数量。

采购订单收货完成并提交到 HQ 进行处理时，将在采购订单主文档上创建添加的行。 在 HQ 中的采购订单行上，采购订单行的 **常规** 选项卡上将有一个 **POS 添加** 标记。 **POS 添加** 指示采购订单行是由 POS 接收流程添加的，不是接收之前采购订单上的行。

### <a name="cancel-receiving"></a>取消接收

仅当要退出单据，并且不希望保存任何更改时，才应使用应用程序栏中的 **取消收货** 功能。 例如，最初选择了错误的单据，因此不需要之前保存的任何收货数据。

### <a name="pause-receiving"></a>暂停接收

如果要接收库存，并且希望暂时停止收货流程，可以使用 **暂停收货** 功能。 例如，您可能希望从 POS 执行另一个操作（如记录客户销售额），或推迟收货过帐。

选择 **暂停收货** 之后，单据状态将变为 **已暂停**。 因此，用户就会知道已为单据输入了值，但是尚未提交单据。 准备好恢复收货流程后，选择暂停的单据，然后选择 **订单详细信息**。 之前保存的所有 **立即收货** 数量将保留，并且可以从 **完整订单列表** 视图查看。

### <a name="review"></a>审核

在将最终承诺接收到 Commerce headquarters (HQ) 之前，您可以使用审核功能验证入站单据。 审核功能会提醒您可能导致处理失败的任何数据缺少或不正确的情况，并为您提供在提交接收请求之前更正问题的机会。 要在应用栏上启用 **审核** 功能，请通过 Commerce headquarters (HQ) 中的 **功能管理** 工作区启用 **在 POS 入站和出站库存操作中启用验证** 功能。

**审核** 功能可验证入站单据中的以下问题：

- **超收** – 立即接收数量大于订购数量。 此问题的严重性取决于 Commerce headquarters (HQ) 中的超交配置。
- **接收不足** – 立即接收数量小于订购数量。 此问题的严重性取决于 Commerce headquarters (HQ) 中的欠交配置。
- **序列号** – 未为在库存中登记需要序列号的序列化物料提供或验证序列号。
- **位置未设置** – 没有为不允许空白位置的位置控制物料指定位置。
- **删除的行** – 订单中有 POS 应用程序未知的 Commerce headquarters (HQ) 用户删除的行。

在 **Commerce 参数** > **库存** > **商店库存** 中将 **启用自动验证** 参数设置为 **是**，以在选择 **完成接收** 时自动执行验证。

### <a name="finish-receiving"></a>完成接收

输入产品的所有 **立即收货** 数量完毕后，必须选择应用程序栏中的 **完成收货** 以处理收据。

当用户填写采购订单收据时，系统将提示他们在 **收据编号** 字段中输入值（如果已配置此功能）。 此值通常等于供应商装箱单的标识。 **收据编号** 数据将存储在 Commerce Headquarters 中的物料收货日记帐内。 不会捕获转移单收据的收据编号。

如果使用异步单据处理，将通过异步单据框架提交收据。 过帐单据所用时间取决于单据的大小（行数）和服务器中出现的常规处理流量。 此流程通常以秒为单位计算。 如果单据过帐失败，将通过 **入站操作** 单据列表通知用户，此选项卡上的单据状态将更新为 **处理失败**。 然后，用户可在 POS 中选择失败单据，以便在 **详细信息** 窗格中查看错误消息和失败原因。 失败单据仍然未过帐，因此需要用户通过在 POS 中选择 **订单详细信息** 回到单据行。 然后，用户必须根据错误通过更正更新单据。 更正单据之后，用户可以通过在应用程序栏中选择 **完成履行** 来再次尝试处理该单据。

## <a name="create-an-inbound-transfer-order"></a>创建入站转移单

用户可从 POS 创建新的转移单单据。 若要开始执行此流程，请在主 **入站操作** 单据列表中时，在应用程序栏中选择 **新建**。 然后，系统将提示您选择将为商店位置提供库存的 **转移自** 仓库或商店。 值限制为商店的履行组配置中定义的选择。 在入站转移请求中，当前商店始终是转移单的 **转移至** 仓库。 不能更改该值。

可以根据需要在 **装运日期**、**接收日期** 和 **交货方式** 字段中输入值。 还可以添加将与转移单标题一起存储的注释，作为单据在 Commerce Headquarters 中的附件。

创建标题信息之后，可以向转移单添加产品。 若要开始添加物料和请求的数量，请选择 **添加产品**。 在 **详细信息** 窗格中，也可以向日记帐行添加行特定的注释。 这些注释将以行附件的形式存储。

在入站转移单中输入行之后，必须选择 **保存** 以在本地保存单据更改，或选择 **提交请求** 以将订单详细信息提交给 Commerce Headquarters 进行进一步的处理。 如果选择 **保存**，草稿单据将存储到渠道数据库中，而出站仓库不能运行单据，直到通过 **提交请求** 成功处理了该单据。 仅当尚未准备好将请求提交给 Commerce Headquarters 进行处理时，才应选择 **保存**。

如果单据保存在本地，可以在 **入站操作** 单据列表的 **草稿** 选项卡中找到。 单据为 **草稿** 状态时，可以通过选择 **编辑** 对其进行编辑。 可以根据需要更新、添加或删除行。 也可以通过选择 **草稿** 选项卡上的 **删除**，删除 **草稿** 状态的整个单据。

草稿单据成功提交到 Commerce Headquarters 之后，将在 **有效** 选项卡上显示，并且状态为 **已请求**。 此时，入站商店或仓库中的用户不再可以编辑请求的入站转移单单据。 只有出站仓库中的用户可以通过在 POS 应用程序中选择 **出站操作** 来编辑单据。 编辑锁定确保不会发生冲突，因为入站请求者更改转移单的同时，出站装运者正在主动为订单领料和装运。 如果在提交了转移单之后需要从入站商店或仓库进行更改，应联系并请求出站装运者输入更改。

单据为 **已请求** 状态之后，将在 **有效** 选项卡中显示。但是，还不能被入站商店或仓库接收。 出站仓库已装运部分或全部转移单之后，入站商店或仓库可以在 POS 中过帐收据。 当出站端处理转移单单据时，其状态将从 **已请求** 更新为 **已装运** 或 **已部分装运**。 单据为 **已装运** 或 **已部分装运** 状态之后，入站商店或仓库可以使用入站操作收货流程过帐其收据。

## <a name="related-topics"></a>相关主题

[POS 中的出站库存操作](pos-outbound-inventory-operation.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]