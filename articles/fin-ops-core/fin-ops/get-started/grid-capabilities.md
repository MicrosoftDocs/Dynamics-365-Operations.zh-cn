---
title: 网格功能
description: 本文介绍 grid 控件的几个强大功能。 必须启用新的网格功能才能访问这些功能。
author: jasongre
ms.date: 08/29/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: DefaultDashboard
audience: Application User, Developer, IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: jasongre
ms.search.validFrom: 2020-02-29
ms.dyn365.ops.version: Platform update 33
ms.openlocfilehash: 096f441d39dde0f322ed117ab35a6a4641a38a93
ms.sourcegitcommit: 1d5cebea3e05b6d758cd01225ae7f566e05698d2
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/02/2022
ms.locfileid: "9405457"
---
# <a name="grid-capabilities"></a>网格功能

[!include [banner](../includes/banner.md)]
[!include [preview banner](../includes/preview-banner.md)]

新的网格控件提供了多个有用而强大的功能，您可以用来提高用户生产率、构造更有趣的数据视图并获得有意义的数据见解。 本文将介绍以下功能： 

- 显示计算值 
- 先于系统键入
- 评估数学表达式 
- 为表格式数据分组（已使用 **在网格中分组** 功能单独启用）
- 锁定列（使用 **锁定网格中的列** 功能单独启用）
- 自动调整列宽
- 可扩展列

## <a name="showing-calculated-values"></a>显示计算值
在财务和运营应用中，用户可以查看网格中每个数值列的计算值。 网格底部的页脚部分显示这些计算值。

[![在网格中显示计算值。](./media/grids-aggregation.png)](./media/grids-aggregation.png)

在 10.0.29 之前的版本中，总计是唯一支持的计算值。 但是，从版本 10.0.29 开始，启用 **扩展网格合并功能** 后，用户可在以下四个计算值中进行选择：

- 最小值
- 最大值
- 总计
- 平均

单列只能显示一种计算值类型。 但是，网格中的每个列都可以配置为显示其他类型的计算值。

### <a name="showing-the-grid-footer"></a>显示网格页脚
下面是财务和运营应用中每个选项卡式网格底部的页脚区域。 此页脚可显示与网格中显示的数据有关的宝贵信息。 下面是这些信息的一些示例：

- 表中选定的行数（当选择多个记录时）
- 已配置数字列底部的计算值（例如总计）
- 数据集中的行数 

默认情况下，此页脚为隐藏状态，您可以将其打开。 要显示网格的页脚，选择网格标头中的 **网格选项** 按钮，然后选择 **显示页脚** 选项。 在为特定网格打开页脚后，该设置将被记住，直到用户选择隐藏页脚为止。 要隐藏页脚，在 **网格选项** 菜单上选择 **隐藏页脚**。

### <a name="specifying-columns-with-calculated-values"></a>指定具有计算值的列
当前，默认情况下，没有列会显示计算值。 而是将此设置视为一次性活动，类似于调整网格中列的宽度。 指定要查看某列的计算值后，该设置将在您下次访问页面时被记住。

有两种方法可以配置列以显示计算值：

- 在要查看其计算值的列中选择并按住（或右键单击）。 如果启用了 **扩展网格合并功能**，请选择 **查看列合计**，然后选择所需的计算值。 如果未启用该功能，请选择 **计算此列总计**。 此操作将导致发生三个事件：

    1. 网格页脚变得可见。 
    2. 您查看列的计算值的首选项已保存。 
    3. 将针对此列以及您之前配置为查看计算值的其他任何列启动所需计算。 何时需要显示计算值取决于数据集的大小。

- 页脚可见后，在要查看其计算值的列底部页脚区域中，选择 **显示总计**（如果启用了 **扩展网格合并功能**，则选择 **计算值**）。 如果没有配置的列，则该按钮将在所有数字列的页脚中可用。

    在至少将一列配置为显示计算值之后，**显示总计**（或 **选择计算值**）按钮将仅在悬停时或在焦点上可用。 选择此按钮这一操作仅保存有关在此列中查看计算值的首选项，因此将来访问此页面时间应用此首选项。 在页脚中，此状态由列中显示的破折号表示。 （请注意，如果数据集足够小，则将立即显示计算值。）

如果您出错，并且不想再查看特定列中的计算值，请在列中选择并按住（或右键单击），然后选择 **隐藏总计**（如果启用了 **扩展网格合并功能**，则选择 **查看列总计 \> 无**）。 或者，在该列的页脚中选择 **隐藏总计**（或 **隐藏计算值**）。 此首选项也将被保存以供将来访问该页面时使用。 

### <a name="calculating-aggregate-values"></a>计算聚合值
当您转到页脚可见且列已配置为显示计算值的页面时，这些值可能不会显示在页脚中。 此行为取决于页面上数据集的大小。 如果数据集足够小，则会自动显示计算值以及数据集中的行数。 如果您在配置的列下的页脚中有破折号，则说明数据集太大，系统无法立即显示计算值。 在这种情况下，计算值需要显式操作。 若要计算值，请在页脚中选择 **计算** 按钮。 或者，在不想查看其总计的列中选择并按住（或右键单击），然后选择 **计算此列总计**（如果启用了 **扩展网格合并功能**，则选择 **查看列总计**，然后选择所需的计算值）。

如果完成计算需要很长时间完成，可以随时选择 **取消** 来取消运算。 有时，数据集太大，无法计算聚合值（这是您的组织施加的一项限制）。 在这种情况下，将改为通知您，以便更详细地筛选您的数据。

> [!NOTE]
> 系统管理员可以通过调整 **客户端性能选项** 页面上的 **每个网格的最大本地记录数** 参数来修改可用于计算聚合值的记录数的限制。 默认值为 25,000 个记录。 管理员在调整此值时应该小心，因为值太大会耗尽用户计算机上的可用内存。 建议值不要超过 50,000 个记录。

在数据集中更新、删除或创建行时，将自动更新计算值。

## <a name="typing-ahead-of-the-system"></a>先于系统键入
在许多业务场景中，快速将数据输入系统的能力非常重要。 在引入新的网格控件之前，用户只能在当前行中更改数据。 因此，在他们对一行进行更改后，用户不能切换到其他行或创建新行，直到系统成功确认了当前行中的更改并且（在创建行的情况下）运行了所有与创建新行相关联的逻辑。 为了帮助减少用户等待这些运算完成的时间，并帮助提高用户的工作效率，新的网格调整了这些操作以使其实现异步。 在之前的行验证和行创建逻辑处于挂起状态时，用户可以创建新行或移动到其他行以进行更改。 

[![先于系统键入。](./media/gridFastEntry-07-25-2022.gif)](./media/gridFastEntry-07-25-2022.gif)

为了支持此新行为，当网格处于编辑模式时，一个新的行状态列已被添加到行选择列的右侧。 此列指示以下状态之一：

- **空白** – 没有状态图像指示行已被系统成功保存。
- **等待处理** – 此状态指示行中的更改尚未由服务器保存，但处于必须处理的更改队列中。 您必须等待所有待处理更改均得到处理，然后才能在网格外执行操作。 此外，这些行中的文本采用斜体来指示这些行处于未保存状态。 
- **无效状态** – 此状态指示在处理行期间触发了一些警告或消息，这可能阻止了系统将更改保存在该行中。 在旧网格中，如果保存操作失败，您将不得不返回该行来立即解决问题。 但是，在新网格中，将通知您遇到了验证问题，但是您可以决定希望何时解决行中的问题。 当您准备好解决问题时，可以手动将焦点移回该行。 或者，您可以选择 **解决此问题** 操作。 此操作将立即将焦点移至出现问题的行，并允许您在网格内部或外部进行编辑。 请注意，在解决此验证警告之前，将停止处理后续等待处理的行。 
- **暂停** – 此状态指示服务器的处理已暂停，因为对该行的验证触发了一个需要用户输入的弹出对话框。 由于用户可能正在其他行中输入数据，因此不会立即向该用户显示弹出对话框。 而是会在用户选择恢复处理时显示。 此状态伴随一个通知，通知用户相关情况。 通知包括一个将触发弹出对话框的 **恢复处理** 操作。

### <a name="differences-when-entering-data-ahead-of-the-system"></a>先于系统输入数据时的差异
当您在系统处理位置之前输入数据时，您可以预期数据输入体验会发生一些变化：

- 您将发现没有查找下拉列表，在移至同一行中的其他列后，将不会验证字段值，并且列最初未显示默认值。 当您先于系统创建或更新时，会发生此行为。 但是，在系统赶上您当前正在编辑的位置后，将恢复标准体验。 如果您对通常接收默认值的字段进行了更改，则您的更改会在服务器开始处理该行时覆盖默认字段值。
- 如果使用 **向下键** 创建新行，则网格中的所有列都将显示为可编辑。 默认情况下，焦点将放入新行中的第一列。 此列可能不是旧网格中接收初始焦点的同一列，或者不是选择 **新建** 按钮后接收焦点的同一列。 您的组织可以自定义系统并更改选择 **向下键** 时接收初始焦点的列。 有关详细信息，请参阅[使用向下键指定创建新行时接收初始焦点的列](#developer-specifying-the-column-that-receives-the-initial-focus-when-new-rows-are-created-by-using-the-down-arrow-key)部分。 无论如何，您都可以使用个性化设置来优化每个网格以进行数据录入。 具体来说，您可以重新排序字段，以便第一列是您要开始在其中输入数据的列。 通常，您可能还希望为数据录入对字段重新排序，以减少制表位并隐藏在此特定视图中录入数据所不需要的任何字段。

### <a name="pasting-from-excel"></a>从 Excel 粘贴
通过使用 **导出到 Excel** 机制，用户始终能够将财务和运营应用内网格中的数据导出到 Microsoft Excel。 但是，能够提前于系统输入数据的功能使新网格能够支持从 Excel 复制表并将其直接粘贴到财务和运营应用内的网格中。 从其发起粘贴操作的网格单元确定复制表开始粘贴的位置。 网格的内容将被复制表的内容覆盖，以下两种情况除外：

- 如果复制表中的列数超过网格中剩余的列数（从粘贴位置开始），将通知用户多余列已被忽略。 
- 如果复制表中的行数超过网格中的行数（从粘贴位置开始），现有单元将被粘贴的内容覆盖，复制表中多余的行将作为新行插入到网格底部。 

## <a name="evaluating-math-expressions"></a>评估数学表达式
随着生产力的迅速提高，用户可以在网格中的数值列内输入数学公式。 不必在系统外的应用内进行计算。 例如，如果输入 **=15\*4**，然后按 **Tab** 键离开字段，系统将计算该表达式，并保存该字段的值 **60**。

[![评估数学表达式。](./media/gridMathExpression-07-25-2022.gif)](./media/gridMathExpression-07-25-2022.gif)

要使系统将值识别为表达式，请将值以等号 (**=**) 开头。 有关受支持的运算符和语法的详细信息，请参阅[支持的数学符号](http://bugwheels94.github.io/math-expression-evaluator/#supported-maths-symbols)。

从版本 10.0.29 开始，在数值控件中计算数学表达式的功能得到了扩展，现在也可以在网格之外使用。

## <a name="grouping-tabular-data"></a>为表格式数据分组
业务用户通常需要执行专门的数据分析。 尽管可以通过将数据导出到 Microsoft Excel 并使用数据透视表来完成此分析，但依赖于新网格控件功能的 **网格中的分组** 功能允许用户在财务和运营应用中以有趣的方式组织其表格式数据。 因为此功能扩展 **计算值** 功能，所以 **分组** 允许您通过在组级别提供计算值（例如小计）来获得有意义的数据见解。

[![对网格中的数据进行分组。](./media/grids-groupingWithTotals.png)](./media/grids-groupingWithTotals.png)

要使用此功能，右键单击分组所基于的列，然后选择 **按此列分组**。 此操作将按所选列对数据进行排序，将新的 **分组依据** 列添加到网格的开头，并在每个组的开头插入“标题行”。 这些标题行提供有关每个组的以下信息：

- 组的数据值 
- 列名（在采用多级分组之后，此信息特别有用）
- 该组中的数据行数
- 任何已配置列的计算值（例如，如果该列配置为显示总计，则为小计）

启用[已保存的视图](saved-views.md)后，您可以在允许将查询保存到视图的页面上将组保存为视图的一部分。 例如，具有大视图选择器的那些项。 有关更多详细信息，请参阅[在视图之间进行切换](saved-views.md#switching-between-views)部分。 

### <a name="multiple-levels-of-grouping"></a>多层分组
按单列为数据分组之后，可以通过在所需列中选择 **按此列分组** 来按其他列为数据分组。 可以重复此过程，直到您具有 5 级嵌套分组（这是最大支持深度）为止。 此时，您将不再能够按其他列分组。

在任何时候，您都可以通过右键单击该列并选择 **取消分组** 来删除任何列上的分组。 您还可以通过依次选择 **网格选项** 和 **全部取消分组** 从所有列中删除分组。

### <a name="sorting-grouped-data"></a>对分组数据进行排序
按一个或多个列对数据进行分组后，您可以通过相应的列标题更改任何分组列的排序方向。 

如果对非分组列进行排序，则分组将保持不变。 根据所选列，数据会在每个组内进行排序。

### <a name="expanding-and-collapsing-groups"></a>展开和折叠组
数据的初始分组将扩展所有组。 可以通过折叠单个组来创建数据的汇总视图，也可以使用组展开和折叠功能帮助浏览数据。 若要展开或折叠组，请选择相应组标题行中的 V 形按钮 (>)。 请注意，单个组的展开/折叠状态 **不** 保存到个性化设置中。

### <a name="selecting-and-unselecting-rows-at-the-group-level"></a>在组级别选择和取消选择行
也可以按照通过选中网格中第一列顶部的复选框选择（或取消选择）网格中的所有行的相同方法，通过选中相应组标题行中的复选框快速选中（或取消选中）组中的所有行。 组标题行中的复选框始终反映该组中行的当前选择状态，无论是选中了所有行，未选中任何行，还是仅选中了部分行。

### <a name="hiding-column-names"></a>隐藏列名
对数据分组时，默认行为是在组标题行中显示列名。 您可以通过选择 **网格选项** > **隐藏组列名** 在组标题行中隐藏列名。

### <a name="grouping-on-date-and-time-columns"></a>日期和时间列分组
当您按“日期”或“日期时间”字段分组时，您可以选择按年、月或日分组。 相应标题行中的组“值”将匹配该字段的格式。 此外，对于日期/时间和时间字段，您可以按小时、分钟或秒分组。

> [!IMPORTANT]
> 在对日期或时间列的段进行分组后，用户当前无法添加分组列。

## <a name="freezing-columns"></a>锁定列
网格中的某些列对于上下文而言可能足够重要，您不希望它们滚动到视图之外。 相反，您可能希望这些列中的值始终可见。 **锁定网格中的列** 功能将为用户提供这种灵活性。 

[![锁定网格中的列。](./media/gridFreezingColumns-07-25-2022.gif)](./media/gridFreezingColumns-07-25-2022.gif)

要锁定列，右键单击列标题，然后选择 **锁定列**。 第一次完成此步骤时，所选列将成为第一列，不会再滚动到视图之外。 后续您锁定的所有列都将被添加到最后锁定的列的右侧。 您可以根据需要使用标准的“移动”功能对锁定列进行重新排序。 但是，锁定列无法移动，这样它们会出现在未锁定列集中。 同样，未锁定的列无法移动，这样它们会出现在锁定列集中。

要取消列的锁定，右键单击锁定列标题，然后选择 **取消锁定列**。 

请注意，新网格中的行选择和行状态列始终锁定为前两列。 因此，当这些列包含在网格中时，无论网格中的水平滚动位置如何，用户会始终看到它们。 这两列不能重新排序。

## <a name="autofit-column-width"></a>自动调整列宽
像在 Excel 中一样，用户可以强制根据列中当前显示的内容自动调整列的大小。 只需双击（或按两下）列中的大小调整手柄。 或者，将焦点放入列标题中，然后选择 **A** 键（用于自动调整）。

## <a name="frequently-asked-questions"></a>常见问题解答
### <a name="how-do-i-enable-the-new-grid-control-in-my-environment"></a>如何在我的环境中启用新的网格控件？ 

在任何环境中，**新建网格控件** 功能均可直接在“功能管理”中使用。 在功能管理中启用此功能后，所有后续用户会话都将使用新的网格控件。 

默认情况下，将在版本 10.0.21 中开始启用此功能。 目标是在 2022 年 10 月必须启用。

## <a name="developer-topics"></a>开发人员主题

### <a name="developer-opting-out-individual-pages-from-using-the-new-grid"></a>[开发人员] 让单个页面退出使用新网格 
如果您的组织发现使用新网格时存在一些问题的页面，可以使用 API 允许单个窗体使用旧版网格控件，同时仍然允许系统的其余部分使用新网格控件。 要让单个页面退出新网格，请在窗体的 `run()` 方法中添加以下 post `super()` 调用。

```this.forceLegacyGrid();```

此 API 最终将被弃用，以便允许删除旧网格控件。 但是，在宣布弃用后，它将至少可持续使用 12 个月。 如果有任何问题需要使用此 API，请向 Microsoft 报告。

#### <a name="forcing-a-page-to-use-the-new-grid-after-previously-opting-out-the-grid"></a>在之前选择退出网格后，强制页面使用新网格
如果您从使用新网格的过程中已选择退出单个页面，您可能需要稍后在解决基本问题后重新启用新网格。 要执行此操作，您只需删除 `forceLegacyGrid()` 调用即可。 除非发生以下任一情况，否则更改不会生效：

- **环境重新部署**：更新和重新部署环境后，系统会自动清除存储了已选择退出新网格 (FormControlReactGridState) 的页面的表。
- **手动清除表**：对于开发方案，您需要使用 SQL 清除 FormControlReactGridState 表，然后重新启动 AOS。 此操作组合将重置已选择退出新网格的页面缓存。

### <a name="developer-opting-individual-grids-out-of-the-typing-ahead-of-the-system-capability"></a>[开发人员] 选择将单个网格退出“先于系统键入”功能
已经出现了一些网格不适合使用 *先于系统键入* 功能的场景。 （例如，验证行时触发的某些代码会导致触发数据源研究，然后该研究可能会损坏现有行上未提交的编辑。）如果您的组织发现此类场景，可以使用 API，让开发人员选择将单个网格退出异步行验证，还原到旧版行为。

在网格中禁用异步行验证时，如果当前行出现验证问题时，用户无法创建新行或移至网格中的其他现有行。 此操作的一个副作用是，无法将表从 Excel 粘贴到财务和运营网格中。

要选择将单个网格退出异步行验证，在窗体的 `run()` 方法中在 `super()` 后面添加以下调用。

```<gridControl>.allowPreemptiveClient(false);```

> [!NOTE]
> - 此调用应仅在特殊情况下调用，它不应成为所有网格的常规选择。
> - 我们建议您不要在窗体加载后运行时切换此 API。

### <a name="developer-size-to-available-width-columns"></a>[开发人员]尺寸到可用宽度列
如果开发人员将新网格内的列的 **WidthMode** 属性设置为 **SizeToAvailable**，这些列的初始宽度会与将此属性设置为 **SizeToContent** 时的宽度相同。 不过，它们会拉伸以使用网格内任何可用的额外宽度。 如果将多个列的此属性设置为 **SizeToAvailable**，所有这些列将在网格内共享任何可用的额外宽度。 但是，如果用户手动调整这些列中一个列的大小，该列将变为静态。 它将保持该宽度，不会再拉伸，占用可用的额外网格宽度。

### <a name="developer-specifying-the-column-that-receives-the-initial-focus-when-new-rows-are-created-by-using-the-down-arrow-key"></a>[开发人员] 使用向下键指定创建新行时接收初始焦点的列
正如在 [先于系统输入数据时的差异](#differences-when-entering-data-ahead-of-the-system)部分中所讨论的那样，如果启用了“先于系统键入”功能，并且用户使用 **向下键** 创建新行，则默认行为是将焦点放在新行的第一列中。 此体验可能不同于旧网格中的体验，或者不同于选择 **新建** 按钮时的体验。

用户和组织可以创建为数据录入优化的已保存视图。 （例如，您可以重新排序列，以便第一列是要开始在其中输入数据的列。）此外，从版本 10.0.29 开始，组织可使用 **selectedControlOnCreate()** 方法调整此行为。 此方法允许开发人员使用 **向下键** 指定创建新行时接收初始焦点的列。 作为输入，此 API 采用与应接收初始焦点的列相对应的控件 ID。

### <a name="developer-handling-grids-with-non-react-extensible-controls"></a>[开发人员] 使用非 React 可扩展控件处理网格
加载网格时，如果系统遇到不基于 React 的可扩展控件，系统将强制旧网格呈现。 当用户第一次遇到这种情况时，将显示一条消息，指示页面需要刷新。 之后，此页面将自动加载旧网格，而不会向用户发出任何进一步的通知，直到下一次系统更新。 

要永久克服这种情况，可扩展控件作者可以创建控件的 React 版本来在网格中使用。  完成开发后，控件的 X++ 类可以使用 **FormReactControlAttribute** 属性进行修饰，来指定要为该控件加载的 React 包的位置。 示例请参见 `SegmentedEntryControl` 类。  

## <a name="known-issues"></a>已知问题
本节维护新网格控件的已知问题列表。

### <a name="open-issues"></a>未解决问题
- 启用 **新网格控件** 功能后，某些页面将继续使用现有的网格控件。 在以下情况下会发生这种情况：
 
    - [已解决] 页面上存在以多列呈现的卡列表。
        - 从版本 10.0.30 开始，**新建 grid 控件** 支持这种类型的卡列表。 可以删除出于此目的对 forceLegacyGrid() 进行的任何使用。 
    - [已解决] 页面上存在分组卡列表。
        - 从版本 10.0.30 开始，**新建 grid 控件** 支持分组卡列表。 可以删除出于此目的对 forceLegacyGrid() 进行的任何使用。 
    - [已解决] 具有非反应性可扩展控件的网格列。
        - 可扩展控件可以提供控件的 React 版本，该版本将在放置在网格中时加载，并调整控件定义以在网格中使用时加载此控件。 有关更多详细信息，请参阅相应的开发人员章节。 

    当用户第一次遇到这些情况之一时，将显示一条有关刷新页面的消息。 出现此消息后，页面将继续为所有用户使用现有网格，直到下一个产品版本更新。 将来的更新中会考虑更好地处理这些情况，以可以使用新网格。

- [KB 4582758] 将缩放从 100 更改为其他任何百分比时，记录将变得模糊

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

