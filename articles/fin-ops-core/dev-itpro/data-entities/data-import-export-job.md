---
title: 数据导入和导出作业概览
description: 使用数据管理工作区创建和管理数据导入和导出作业。
author: Sunil-Garg
ms.date: 11/02/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: sericks
ms.search.region: Global
ms.author: sunilg
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.openlocfilehash: 1cb38c812aed60bddadce25f66ec77f4e428be71
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/31/2021
ms.locfileid: "5750992"
---
# <a name="data-import-and-export-jobs-overview"></a><span data-ttu-id="83f5a-103">数据导入和导出作业概览</span><span class="sxs-lookup"><span data-stu-id="83f5a-103">Data import and export jobs overview</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="83f5a-104">要创建和管理数据导入和导出作业，请使用 **数据管理** 工作区。</span><span class="sxs-lookup"><span data-stu-id="83f5a-104">To create and manage data import and export jobs, you use the **Data management** workspace.</span></span> <span data-ttu-id="83f5a-105">默认情况下，数据导入和导出流程为目标数据库中的每个实体创建一个暂存表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-105">By default, the data import and export process creates a staging table for each entity in the target database.</span></span> <span data-ttu-id="83f5a-106">通过暂存表可以在移动数据之前验证、清理或转换数据。</span><span class="sxs-lookup"><span data-stu-id="83f5a-106">Staging tables let you verify, clean up, or convert data before you move it.</span></span>

> [!NOTE]
> <span data-ttu-id="83f5a-107">此主题假定您熟悉[数据实体](data-entities.md)。</span><span class="sxs-lookup"><span data-stu-id="83f5a-107">This topic assumes that you are familiar with [data entities](data-entities.md).</span></span>

## <a name="data-importexport-process"></a><span data-ttu-id="83f5a-108">数据导入/导出流程</span><span class="sxs-lookup"><span data-stu-id="83f5a-108">Data import/export process</span></span>
<span data-ttu-id="83f5a-109">以下是导入或导出数据的步骤。</span><span class="sxs-lookup"><span data-stu-id="83f5a-109">Here are the steps to import or export data.</span></span>

1. <span data-ttu-id="83f5a-110">在完成以下任务后创建导入或导出作业：</span><span class="sxs-lookup"><span data-stu-id="83f5a-110">Create an import or export job where you complete the following tasks:</span></span>

    - <span data-ttu-id="83f5a-111">定义项目类别。</span><span class="sxs-lookup"><span data-stu-id="83f5a-111">Define the project category.</span></span>
    - <span data-ttu-id="83f5a-112">确定要导入或导出的实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-112">Identify the entities to import or export.</span></span>
    - <span data-ttu-id="83f5a-113">设置作业的数据格式。</span><span class="sxs-lookup"><span data-stu-id="83f5a-113">Set the data format for the job.</span></span>
    - <span data-ttu-id="83f5a-114">给实体排序，以便以合理的顺序在逻辑组中处理这些实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-114">Sequence the entities, so that they are processed in logical groups and in an order that makes sense.</span></span>
    - <span data-ttu-id="83f5a-115">确定是否使用暂存表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-115">Determine whether to use staging tables.</span></span>

2. <span data-ttu-id="83f5a-116">验证源数据和目标数据是否正确映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-116">Validate that the source data and target data are mapped correctly.</span></span>
3. <span data-ttu-id="83f5a-117">验证您的导入或导出作业的安全性。</span><span class="sxs-lookup"><span data-stu-id="83f5a-117">Verify the security for your import or export job.</span></span>
4. <span data-ttu-id="83f5a-118">运行导入或导出作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-118">Run the import or export job.</span></span>
5. <span data-ttu-id="83f5a-119">查看作业历史纪录，验证作业是否按预期运行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-119">Validate that the job ran as expected by reviewing the job history.</span></span>
6. <span data-ttu-id="83f5a-120">清除暂存表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-120">Clean up the staging tables.</span></span>

<span data-ttu-id="83f5a-121">本主题的其余部分提供有关流程的每个步骤的详细信息。</span><span class="sxs-lookup"><span data-stu-id="83f5a-121">The remaining sections of this topic provide more details about each step of the process.</span></span>

> [!NOTE]
> <span data-ttu-id="83f5a-122">要刷新“数据导入/导出”窗体以查看最新进度，请使用窗体刷新图标。</span><span class="sxs-lookup"><span data-stu-id="83f5a-122">In order to refresh the Data import/export form to see the latest progress, use the form refresh icon.</span></span> <span data-ttu-id="83f5a-123">不建议执行浏览器级刷新，因为这将中断所有未批量运行的导入/导出作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-123">Browser level refresh is not recommended because it will interrupt any import/export jobs that are not run in batch.</span></span>

## <a name="create-an-import-or-export-job"></a><span data-ttu-id="83f5a-124">创建导入或导出作业</span><span class="sxs-lookup"><span data-stu-id="83f5a-124">Create an import or export job</span></span>
<span data-ttu-id="83f5a-125">可以一次性运行或分多次运行数据导入或导出作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-125">A data import or export job can be run one time or many times.</span></span>

### <a name="define-the-project-category"></a><span data-ttu-id="83f5a-126">定义项目类别</span><span class="sxs-lookup"><span data-stu-id="83f5a-126">Define the project category</span></span>
<span data-ttu-id="83f5a-127">我们建议您花时间为导入或导出作业选择合适的项目类别。</span><span class="sxs-lookup"><span data-stu-id="83f5a-127">We recommend that you take the time to select an appropriate project category for your import or export job.</span></span> <span data-ttu-id="83f5a-128">项目类别有助于管理相关作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-128">Project categories can help you manage related jobs.</span></span>

### <a name="identify-the-entities-to-import-or-export"></a><span data-ttu-id="83f5a-129">确定要导入或导出的实体</span><span class="sxs-lookup"><span data-stu-id="83f5a-129">Identify the entities to import or export</span></span>
<span data-ttu-id="83f5a-130">您可以将特定实体添加到导入或导出作业或选择一个要应用的模板。</span><span class="sxs-lookup"><span data-stu-id="83f5a-130">You can add specific entities to an import or export job or select a template to apply.</span></span> <span data-ttu-id="83f5a-131">模板使用一个实体列表填充一个作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-131">Templates fill a job with a list of entities.</span></span> <span data-ttu-id="83f5a-132">给作业命名并保存作业后，**应用模板** 选项可用。</span><span class="sxs-lookup"><span data-stu-id="83f5a-132">The **Apply template** option is available after you give the job a name and save the job.</span></span>

### <a name="set-the-data-format-for-the-job"></a><span data-ttu-id="83f5a-133">设置作业的数据格式</span><span class="sxs-lookup"><span data-stu-id="83f5a-133">Set the data format for the job</span></span>
<span data-ttu-id="83f5a-134">选择一个实体后，必须选择要导出或导入的数据的格式。</span><span class="sxs-lookup"><span data-stu-id="83f5a-134">When you select an entity, you must select the format of the data that will be exported or imported.</span></span> <span data-ttu-id="83f5a-135">使用 **数据源设置** 磁贴定义格式。</span><span class="sxs-lookup"><span data-stu-id="83f5a-135">You define formats by using the **Data sources setup** tile.</span></span> <span data-ttu-id="83f5a-136">源数据格式是 **类型**、**文件格式**、**行分隔符** 和 **列分隔符** 的组合。</span><span class="sxs-lookup"><span data-stu-id="83f5a-136">A source data format is a combination of **Type**, **File format**, **Row delimiter** and **Column delimiter**.</span></span> <span data-ttu-id="83f5a-137">还有其他属性，但以上属性则是需要了解的关键属性。</span><span class="sxs-lookup"><span data-stu-id="83f5a-137">There are also other attributes, but these are the key ones to understand.</span></span> <span data-ttu-id="83f5a-138">下表列出了有效组合。</span><span class="sxs-lookup"><span data-stu-id="83f5a-138">The following table lists the valid combinations.</span></span>

| <span data-ttu-id="83f5a-139">文件格式</span><span class="sxs-lookup"><span data-stu-id="83f5a-139">File Format</span></span>            | <span data-ttu-id="83f5a-140">行/列分隔符</span><span class="sxs-lookup"><span data-stu-id="83f5a-140">Row/Column delimiter</span></span>                       | <span data-ttu-id="83f5a-141">XML 样式</span><span class="sxs-lookup"><span data-stu-id="83f5a-141">XML Style</span></span>                 |
|------------------------|--------------------------------------------|---------------------------|
| <span data-ttu-id="83f5a-142">Excel</span><span class="sxs-lookup"><span data-stu-id="83f5a-142">Excel</span></span>                  | <span data-ttu-id="83f5a-143">Excel</span><span class="sxs-lookup"><span data-stu-id="83f5a-143">Excel</span></span>                                      | <span data-ttu-id="83f5a-144">\-NA-</span><span class="sxs-lookup"><span data-stu-id="83f5a-144">\-NA-</span></span>                     |
| <span data-ttu-id="83f5a-145">XML</span><span class="sxs-lookup"><span data-stu-id="83f5a-145">XML</span></span>                    | <span data-ttu-id="83f5a-146">\-NA-</span><span class="sxs-lookup"><span data-stu-id="83f5a-146">\-NA-</span></span>                                      | <span data-ttu-id="83f5a-147">XML 元素 XML 属性</span><span class="sxs-lookup"><span data-stu-id="83f5a-147">XML-Element XML-Attribute</span></span> |
| <span data-ttu-id="83f5a-148">分隔，固定宽度</span><span class="sxs-lookup"><span data-stu-id="83f5a-148">Delimited, fixed width</span></span> | <span data-ttu-id="83f5a-149">逗号、分号、制表符、竖线、冒号</span><span class="sxs-lookup"><span data-stu-id="83f5a-149">Comma, semicolon, tab, vertical bar, colon</span></span> | <span data-ttu-id="83f5a-150">\-NA-</span><span class="sxs-lookup"><span data-stu-id="83f5a-150">\-NA-</span></span>                     |

### <a name="sequence-the-entities"></a><span data-ttu-id="83f5a-151">给实体排序</span><span class="sxs-lookup"><span data-stu-id="83f5a-151">Sequence the entities</span></span>
<span data-ttu-id="83f5a-152">实体可以在数据模板或导入和导出作业中排序。</span><span class="sxs-lookup"><span data-stu-id="83f5a-152">Entities can be sequenced in a data template, or in import and export jobs.</span></span> <span data-ttu-id="83f5a-153">运行的作业包含多个数据实体时，必须确保数据实体的序列正确。</span><span class="sxs-lookup"><span data-stu-id="83f5a-153">When you run a job that contains more than one data entity, you must make sure that the data entities are correctly sequenced.</span></span> <span data-ttu-id="83f5a-154">给实体排序的主要目的是为了解决实体中的任何功能依赖项。</span><span class="sxs-lookup"><span data-stu-id="83f5a-154">You sequence entities primarily so that you can address any functional dependencies among entities.</span></span> <span data-ttu-id="83f5a-155">如果实体不具有任何功能依赖项，可以计划并行导入或导出。</span><span class="sxs-lookup"><span data-stu-id="83f5a-155">If entities don’t have any functional dependencies, they can be scheduled for parallel import or export.</span></span>

#### <a name="execution-units-levels-and-sequences"></a><span data-ttu-id="83f5a-156">执行单元、级别和序列</span><span class="sxs-lookup"><span data-stu-id="83f5a-156">Execution units, levels, and sequences</span></span>
<span data-ttu-id="83f5a-157">执行单元、执行单元中的级别以及实体序列有助于控制导出或导入数据的顺序。</span><span class="sxs-lookup"><span data-stu-id="83f5a-157">The execution unit, level in the execution unit, and sequence of an entity help control the order that the data is exported or imported in.</span></span>

- <span data-ttu-id="83f5a-158">不同执行单元中的实体并行处理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-158">Entities in different execution units are processed in parallel.</span></span>
- <span data-ttu-id="83f5a-159">在每个执行单元中，具有相同级别的实体并行处理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-159">In each execution unit, entities are processed in parallel if they have the same level.</span></span>
- <span data-ttu-id="83f5a-160">在每个级别中，根据实体在该级别中的序列号处理实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-160">In each level, entities are processed according to their sequence number in that level.</span></span>
- <span data-ttu-id="83f5a-161">处理完一个级别后，再处理下一个级别。</span><span class="sxs-lookup"><span data-stu-id="83f5a-161">After one level has been processed, the next level is processed.</span></span>

#### <a name="resequencing"></a><span data-ttu-id="83f5a-162">重新排序</span><span class="sxs-lookup"><span data-stu-id="83f5a-162">Resequencing</span></span>
<span data-ttu-id="83f5a-163">在以下情形中，您可能想要对实体重新排序：</span><span class="sxs-lookup"><span data-stu-id="83f5a-163">You might want to resequence your entities in the following situations:</span></span>

- <span data-ttu-id="83f5a-164">如果只有一个数据作业用于您的所有更改，可以使用重新排序选项来优化整个作业的执行时间。</span><span class="sxs-lookup"><span data-stu-id="83f5a-164">If only one data job is used for all your changes, you can use resequencing options to optimize the execution time for the full job.</span></span> <span data-ttu-id="83f5a-165">在这些情况下，您可以使用执行单元表示模块，用级别表示模块中的功能区域，用序列表示实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-165">In these cases, you can use the execution unit to represent the module, the level to represent the feature area in the module, and the sequence to represent the entity.</span></span> <span data-ttu-id="83f5a-166">使用此方法可以并行处理不同模块，但也仍然能在一个模块中按顺序处理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-166">By using this approach, you can work across modules in parallel, but you can still work in sequence in a module.</span></span> <span data-ttu-id="83f5a-167">为了帮助保证成功完成并行操作，必须考虑所有依赖项。</span><span class="sxs-lookup"><span data-stu-id="83f5a-167">To help guarantee that parallel operations succeed, you must consider all dependencies.</span></span>
- <span data-ttu-id="83f5a-168">如果使用多个数据作业（例如，一个模块使用一个作业），可以使用排序来影响实体的级别和顺序，以获得最佳执行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-168">If multiple data jobs are used (for example, one job for each module), you can use sequencing to affect the level and sequence of entities for optimal execution.</span></span>
- <span data-ttu-id="83f5a-169">如果没有任何依赖项，可以在不同执行单元对实体排序，以最大程度地进行优化。</span><span class="sxs-lookup"><span data-stu-id="83f5a-169">If there are no dependencies at all, you can sequence entities at different execution units for maximum optimization.</span></span>

<span data-ttu-id="83f5a-170">选择多个实体时，**重新排序** 菜单可用。</span><span class="sxs-lookup"><span data-stu-id="83f5a-170">The **Resequencing** menu is available when multiple entities are selected.</span></span> <span data-ttu-id="83f5a-171">可以基于执行单元、级别或顺序选项重新排序。</span><span class="sxs-lookup"><span data-stu-id="83f5a-171">You can resequence based on execution unit, level, or sequence options.</span></span> <span data-ttu-id="83f5a-172">可以设定增量，以对选定的实体重新排序。</span><span class="sxs-lookup"><span data-stu-id="83f5a-172">You can set an increment to resequence the entities that have been selected.</span></span> <span data-ttu-id="83f5a-173">为每个实体选择的单元、级别和/或序列号按指定增量进行更新。</span><span class="sxs-lookup"><span data-stu-id="83f5a-173">The unit, level, and/or sequence number that is selected for each entity is updated by the specified increment.</span></span>

#### <a name="sorting"></a><span data-ttu-id="83f5a-174">排序</span><span class="sxs-lookup"><span data-stu-id="83f5a-174">Sorting</span></span>
<span data-ttu-id="83f5a-175">用户可以使用 **排序依据** 选项按顺序查看实体列表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-175">Use can use the **Sort by** option to view the entity list in sequential order.</span></span>

### <a name="truncating"></a><span data-ttu-id="83f5a-176">截断</span><span class="sxs-lookup"><span data-stu-id="83f5a-176">Truncating</span></span>
<span data-ttu-id="83f5a-177">对于导入项目，可在导入前选择截断实体中的记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-177">For import projects, you can choose to truncate records in the entities prior to import.</span></span> <span data-ttu-id="83f5a-178">如果必须将记录导入一套干净的表中，这很有用。</span><span class="sxs-lookup"><span data-stu-id="83f5a-178">This is useful if your records must be imported into a clean set of tables.</span></span> <span data-ttu-id="83f5a-179">默认情况下，此设置已关闭。</span><span class="sxs-lookup"><span data-stu-id="83f5a-179">This setting is off by default.</span></span>

## <a name="validate-that-the-source-data-and-target-data-are-mapped-correctly"></a><span data-ttu-id="83f5a-180">验证源数据和目标数据是否正确映射</span><span class="sxs-lookup"><span data-stu-id="83f5a-180">Validate that the source data and target data are mapped correctly</span></span>
<span data-ttu-id="83f5a-181">映射是同时适用于导入和导出作业的一项功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-181">Mapping is a function that applies to both import and export jobs.</span></span>

- <span data-ttu-id="83f5a-182">在导入作业情况下，映射描述源文件中的哪些列成为暂存表中的列。</span><span class="sxs-lookup"><span data-stu-id="83f5a-182">In the context of an import job, mapping describes which columns in the source file become the columns in the staging table.</span></span> <span data-ttu-id="83f5a-183">因此，系统可以确定源文件中的哪些列数据必须复制到暂存表中的哪一列。</span><span class="sxs-lookup"><span data-stu-id="83f5a-183">Therefore, the system can determine which column data in the source file must be copied into which column of the staging table.</span></span>
- <span data-ttu-id="83f5a-184">在导出作业情况下，映射描述暂存表（即源）中的哪些列成为目标文件中的列。</span><span class="sxs-lookup"><span data-stu-id="83f5a-184">In the context of an export job, mapping describes which columns of the staging table (that is, the source) become the columns in the target file.</span></span>

<span data-ttu-id="83f5a-185">如果暂存表和文件中的列名称匹配，则系统自动基于名称建立映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-185">If the column names in the staging table and the file match, the system automatically establishes the mapping, based on the names.</span></span> <span data-ttu-id="83f5a-186">但是，如果名称有差异，则不会自动映射列。</span><span class="sxs-lookup"><span data-stu-id="83f5a-186">However, if the names differ, columns aren’t mapped automatically.</span></span> <span data-ttu-id="83f5a-187">在这些情况下，必须在数据作业中的实体上选择 **查看映射** 选项，以完成映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-187">In these cases, you must complete the mapping by selecting the **View map** option on the entity in the data job.</span></span>

<span data-ttu-id="83f5a-188">有两个映射视图：**映射可视化**，即默认视图，以及 **映射详细信息**。</span><span class="sxs-lookup"><span data-stu-id="83f5a-188">There are two mapping views: **Mapping visualization**, which is the default view, and **Mapping details**.</span></span> <span data-ttu-id="83f5a-189">红色星号 (\*) 标识实体中的任何必填字段。</span><span class="sxs-lookup"><span data-stu-id="83f5a-189">A red asterisk (\*) identifies any required fields in the entity.</span></span> <span data-ttu-id="83f5a-190">必须映射这些字段后才能处理实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-190">These fields must be mapped before you can work with the entity.</span></span> <span data-ttu-id="83f5a-191">处理实体时，可以按需要取消其他字段的映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-191">You can unmap other fields as you require when you work with the entity.</span></span> <span data-ttu-id="83f5a-192">要取消字段映射，选择 **实体** 列或 **源** 列中的字段，然后选择 **删除选择**。</span><span class="sxs-lookup"><span data-stu-id="83f5a-192">To unmap a field, select the field in either the **Entity** column or the **Source** column, and then select **Delete selection**.</span></span> <span data-ttu-id="83f5a-193">选择 **保存** 以保存更改，然后关闭页面以返回项目。</span><span class="sxs-lookup"><span data-stu-id="83f5a-193">Select **Save** to save your changes, and then close the page to return to the project.</span></span> <span data-ttu-id="83f5a-194">在导入后，您可以使用相同流程编辑来自源的字段映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-194">You can use the same process to edit the field mapping from source to staging after you import.</span></span>

<span data-ttu-id="83f5a-195">通过选择 **生成源映射** 可以在页面上生成映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-195">You can generate a mapping on the page by selecting **Generate source mapping**.</span></span> <span data-ttu-id="83f5a-196">生成的映射表现地类似于自动映射。</span><span class="sxs-lookup"><span data-stu-id="83f5a-196">A generated mapping behaves like an automatic mapping.</span></span> <span data-ttu-id="83f5a-197">因此，您必须手动映射所有未映射的字段。</span><span class="sxs-lookup"><span data-stu-id="83f5a-197">Therefore, you must manually map any unmapped fields.</span></span>

![数据映射](./media/dixf-map.png)

## <a name="verify-the-security-for-your-import-or-export-job"></a><span data-ttu-id="83f5a-199">验证您的导入或导出作业的安全性</span><span class="sxs-lookup"><span data-stu-id="83f5a-199">Verify the security for your import or export job</span></span>
<span data-ttu-id="83f5a-200">**数据管理** 工作区的访问权限可能受到限制，因此非管理员用户可能仅可访问特定的数据作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-200">Access to the **Data management** workspace can be restricted, so that non-administrator users can access only specific data jobs.</span></span> <span data-ttu-id="83f5a-201">对数据作业的访问权限暗示着对该作业的执行历史记录的完全访问权限和对暂存表的访问权限。</span><span class="sxs-lookup"><span data-stu-id="83f5a-201">Access to a data job implies full access to the execution history of that job and access to the staging tables.</span></span> <span data-ttu-id="83f5a-202">因此，您必须确保在创建数据作业时采取适当的访问权限控制。</span><span class="sxs-lookup"><span data-stu-id="83f5a-202">Therefore, you must make sure that appropriate access controls are in place when you create a data job.</span></span>

### <a name="secure-a-job-by-roles-and-users"></a><span data-ttu-id="83f5a-203">按角色和用户保护作业安全</span><span class="sxs-lookup"><span data-stu-id="83f5a-203">Secure a job by roles and users</span></span>
<span data-ttu-id="83f5a-204">使用 **适用的角色** 菜单将作业限制到一个或多个安全角色。</span><span class="sxs-lookup"><span data-stu-id="83f5a-204">Use the **Applicable roles** menu to restrict the job to one or more security roles.</span></span> <span data-ttu-id="83f5a-205">仅这些角色的用户具有该作业的访问权限。</span><span class="sxs-lookup"><span data-stu-id="83f5a-205">Only users in those roles will have access to the job.</span></span>

<span data-ttu-id="83f5a-206">您还可以将该作业限制到特定用户。</span><span class="sxs-lookup"><span data-stu-id="83f5a-206">You can also restrict a job to specific users.</span></span> <span data-ttu-id="83f5a-207">当您按用户而不是角色保护作业安全时，如果有多个用户分配到角色，则具有更多的控制性。</span><span class="sxs-lookup"><span data-stu-id="83f5a-207">When you secure a job by users instead of roles, there is more control if multiple users are assigned to a role.</span></span>

### <a name="secure-a-job-by-legal-entity"></a><span data-ttu-id="83f5a-208">通过法人保护作业安全</span><span class="sxs-lookup"><span data-stu-id="83f5a-208">Secure a job by legal entity</span></span>
<span data-ttu-id="83f5a-209">数据作业在性质上是全局的。</span><span class="sxs-lookup"><span data-stu-id="83f5a-209">Data jobs are global in nature.</span></span> <span data-ttu-id="83f5a-210">因此，如果在法人中创建和使用数据作业，该作业将在系统中的其他法人中可见。</span><span class="sxs-lookup"><span data-stu-id="83f5a-210">Therefore, if a data job was created and used in a legal entity, the job will be visible in other legal entities in the system.</span></span> <span data-ttu-id="83f5a-211">此默认行为可能在有些应用方案中优先。</span><span class="sxs-lookup"><span data-stu-id="83f5a-211">This default behavior might be preferred in some application scenarios.</span></span> <span data-ttu-id="83f5a-212">例如，使用数据实体导入发票的组织可能提供一个集中发票处理团队负责管理组织中的所有部门的发票错误。</span><span class="sxs-lookup"><span data-stu-id="83f5a-212">For example, an organization that imports invoices by using data entities might provide a centralized invoice processing team that is responsible for managing invoice errors for all divisions in the organization.</span></span> <span data-ttu-id="83f5a-213">在此方案中，它有助于集中发票处理团队获得所有法人的发票导入作业的访问权限。</span><span class="sxs-lookup"><span data-stu-id="83f5a-213">In this scenario, it’s useful for the centralized invoice processing team to have access to invoice import jobs from all legal entities.</span></span> <span data-ttu-id="83f5a-214">因此，从一个法人的角度看，默认行为满足要求。</span><span class="sxs-lookup"><span data-stu-id="83f5a-214">Therefore, the default behavior meets the requirement from a legal entity perspective.</span></span>

<span data-ttu-id="83f5a-215">但是，组织可能希望每个法人各有一个发票处理团队。</span><span class="sxs-lookup"><span data-stu-id="83f5a-215">However, an organization might want to have invoice processing teams per legal entity.</span></span> <span data-ttu-id="83f5a-216">在这种情况下，一个法人中的团队应仅具有它自己的法人的发票导入作业的访问权限。</span><span class="sxs-lookup"><span data-stu-id="83f5a-216">In this case, a team in a legal entity should have access only to the invoice import job in its own legal entity.</span></span> <span data-ttu-id="83f5a-217">为了满足此要求，您可以使用数据作业内的 **适用的法人** 菜单在数据作业上配置基于法人的访问权限控制。</span><span class="sxs-lookup"><span data-stu-id="83f5a-217">To meet this requirement, you can configure legal entity–based access control on the data jobs by using the **Applicable legal entities** menu inside the data job.</span></span> <span data-ttu-id="83f5a-218">配置完成后，用户仅可以看到他们当前分配的法人中可用的作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-218">After the configuration is done, users can see only jobs that are available in the legal entity that they are currently signed in to.</span></span> <span data-ttu-id="83f5a-219">若要查看其他法人的作业，用户必须切换到该法人。</span><span class="sxs-lookup"><span data-stu-id="83f5a-219">To see jobs from another legal entity, users must switch to that legal entity.</span></span>

<span data-ttu-id="83f5a-220">可同时按角色、用户和法人保护作业安全。</span><span class="sxs-lookup"><span data-stu-id="83f5a-220">A job can be secured by roles, users, and legal entity at the same time.</span></span>

## <a name="run-the-import-or-export-job"></a><span data-ttu-id="83f5a-221">运行导入或导出作业</span><span class="sxs-lookup"><span data-stu-id="83f5a-221">Run the import or export job</span></span>
<span data-ttu-id="83f5a-222">在定义作业后，您可以选择 **导入** 或 **导出** 按钮运行一次作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-222">You can run a job one time by selecting the **Import** or **Export** button after you define the job.</span></span> <span data-ttu-id="83f5a-223">若要设置重复执行的作业，请选择 **创建重复性数据作业**。</span><span class="sxs-lookup"><span data-stu-id="83f5a-223">To set up a recurring job, select **Create recurring data job**.</span></span>

> [!NOTE]
> <span data-ttu-id="83f5a-224">可通过选择 **导入** 或 **导出** 按钮运行导入或导出作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-224">An import or an export job can be run by selecting the **Import** or **Export** button.</span></span> <span data-ttu-id="83f5a-225">这将安排批处理作业仅运行一次。</span><span class="sxs-lookup"><span data-stu-id="83f5a-225">This will schedule a batch job to run only once.</span></span> <span data-ttu-id="83f5a-226">如果由于批处理服务上的负载而限制了批处理服务，则作业可能不会立即执行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-226">The job may not execute immediately if batch service is throttling due to the load on the batch service.</span></span> <span data-ttu-id="83f5a-227">也可以通过选择 **立即导入** 或 **立即导出** 同步运行作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-227">The jobs can also be run synchronously by selecting **Import now** or **Export now**.</span></span> <span data-ttu-id="83f5a-228">之间立即启动作业，因此在因为限制而无法启动时，批处理非常有用。</span><span class="sxs-lookup"><span data-stu-id="83f5a-228">This starts the job immediately and is useful if the batch does not start due to throttling.</span></span> <span data-ttu-id="83f5a-229">也可以作业安排在以后执行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-229">The jobs can also be scheduled to execute at a later time.</span></span> <span data-ttu-id="83f5a-230">这可以通过选择 **批量运行** 选项完成。</span><span class="sxs-lookup"><span data-stu-id="83f5a-230">This can be done by choosing the **Run in batch** option.</span></span> <span data-ttu-id="83f5a-231">批处理资源可能受到限制，因此可能无法立即启动批处理作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-231">Batch resources are subject to throttling, so the batch job might not start immediately.</span></span> <span data-ttu-id="83f5a-232">建议使用批处理选项，因为这还有助于处理需要导入或导出的大量数据。</span><span class="sxs-lookup"><span data-stu-id="83f5a-232">Using a batch is the recommended option because it will also help with large volumes of data that need to be imported or exported.</span></span> <span data-ttu-id="83f5a-233">可安排对特定批处理组运行批处理作业，这样就可以加强负载平衡角度的控制。</span><span class="sxs-lookup"><span data-stu-id="83f5a-233">Batch jobs can be scheduled to run on a specific batch group, which allows more control from a load balancing perspective.</span></span>

## <a name="validate-that-the-job-ran-as-expected"></a><span data-ttu-id="83f5a-234">验证该作业按预期运行</span><span class="sxs-lookup"><span data-stu-id="83f5a-234">Validate that the job ran as expected</span></span>
<span data-ttu-id="83f5a-235">作业历史记录可用于导入和导出作业的故障排除和调查。</span><span class="sxs-lookup"><span data-stu-id="83f5a-235">The job history is available for troubleshooting and investigation on both import and export jobs.</span></span> <span data-ttu-id="83f5a-236">历史作业运行按时间范围进行组织。</span><span class="sxs-lookup"><span data-stu-id="83f5a-236">Historical job runs are organized by time ranges.</span></span>

![作业历史记录范围](./media/dixf-job-history.md.png)

<span data-ttu-id="83f5a-238">每次作业运行提供以下详细信息：</span><span class="sxs-lookup"><span data-stu-id="83f5a-238">Each job run provides the following details:</span></span>

- <span data-ttu-id="83f5a-239">执行详细信息</span><span class="sxs-lookup"><span data-stu-id="83f5a-239">Execution details</span></span>
- <span data-ttu-id="83f5a-240">执行日志</span><span class="sxs-lookup"><span data-stu-id="83f5a-240">Execution log</span></span>

<span data-ttu-id="83f5a-241">执行详细信息显示作业处理的每个数据实体的状态。</span><span class="sxs-lookup"><span data-stu-id="83f5a-241">Execution details show the state of each data entity that the job processed.</span></span> <span data-ttu-id="83f5a-242">因此，您可以迅速找到以下信息：</span><span class="sxs-lookup"><span data-stu-id="83f5a-242">Therefore, you can quickly find the following information:</span></span>

- <span data-ttu-id="83f5a-243">处理了哪些实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-243">Which entities were processed.</span></span>
- <span data-ttu-id="83f5a-244">对于实体，处理成功的记录数量和处理失败的记录数量。</span><span class="sxs-lookup"><span data-stu-id="83f5a-244">For an entity, how many records were successfully processed, and how many failed.</span></span>
- <span data-ttu-id="83f5a-245">每个实体的暂存记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-245">The staging records for each entity.</span></span>

<span data-ttu-id="83f5a-246">您可以将暂存数据下载到一个文件用于导出作业，或将其下载为包用于导入和导出作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-246">You can download the staging data in a file for export jobs, or you can download it as a package for import and export jobs.</span></span>

<span data-ttu-id="83f5a-247">您还可以从执行详细信息打开执行日志。</span><span class="sxs-lookup"><span data-stu-id="83f5a-247">From the execution details, you can also open the execution log.</span></span>

## <a name="parallel-imports"></a><span data-ttu-id="83f5a-248">并行导入</span><span class="sxs-lookup"><span data-stu-id="83f5a-248">Parallel imports</span></span>
<span data-ttu-id="83f5a-249">为了加快数据导入，如果实体支持并行导入，可以启用导入文件的并行处理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-249">To speed up the import of data, parallel processing of importing a file can be enabled if the entity supports parallel imports.</span></span> <span data-ttu-id="83f5a-250">要为实体配置并行导入，必须遵循以下步骤。</span><span class="sxs-lookup"><span data-stu-id="83f5a-250">To configure the parallel import for an entity, the following steps must be followed.</span></span>

1. <span data-ttu-id="83f5a-251">转到 **系统管理 \> 工作区 \> 数据管理**。</span><span class="sxs-lookup"><span data-stu-id="83f5a-251">Go to **System administration \> Workspaces \> Data management**.</span></span>
2. <span data-ttu-id="83f5a-252">在 **导入/导出** 部分，选择 **框架参数** 磁贴打开 **数据导入/导出框架参数** 页。</span><span class="sxs-lookup"><span data-stu-id="83f5a-252">In the **Import / Export** section, select the **Framework parameters** tile to open the **Data import/export framework parameters** page.</span></span>
3. <span data-ttu-id="83f5a-253">在 **实体设定** 选项卡上，选择 **配置实体执行参数** 打开 **实体导入执行参数** 页。</span><span class="sxs-lookup"><span data-stu-id="83f5a-253">On the **Entity settings** tab, select **Configure entity execution parameters** to open the **Entity import execution parameters** page.</span></span>
4. <span data-ttu-id="83f5a-254">设置以下字段以为实体配置并行导入：</span><span class="sxs-lookup"><span data-stu-id="83f5a-254">Set the following fields to configure parallel import for an entity:</span></span>

    - <span data-ttu-id="83f5a-255">在 **实体** 字段中，选择相应实体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-255">In the **Entity** field, select the entity.</span></span>
    - <span data-ttu-id="83f5a-256">在 **导入阈值记录数** 字段中，输入要导入的阈值记录数。</span><span class="sxs-lookup"><span data-stu-id="83f5a-256">In the **Import threshold record count** field, enter the threshold record count for import.</span></span> <span data-ttu-id="83f5a-257">这确定线程要处理的记录数。</span><span class="sxs-lookup"><span data-stu-id="83f5a-257">This determines the record count to be processed by a thread.</span></span> <span data-ttu-id="83f5a-258">如果一个文件有 1 万条记录，记录数为 2500，任务数为 4，意味着每个线程将处理 2500 条记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-258">If a file has 10K records, a record count of 2500 with a task count of 4 will mean, each thread will process 2500 records.</span></span>
    - <span data-ttu-id="83f5a-259">在 **导入任务数** 字段中，输入导入任务的数量。</span><span class="sxs-lookup"><span data-stu-id="83f5a-259">In the **Import task count** field, enter the count of import tasks.</span></span> <span data-ttu-id="83f5a-260">不能超过在 **系统管理 \> 服务器配置** 中为批处理分配的最大批处理线程数。</span><span class="sxs-lookup"><span data-stu-id="83f5a-260">This must not exceed the max batch threads allocated for batch processing in **System administration \>Server configuration**.</span></span>

## <a name="clean-up-the-staging-tables"></a><span data-ttu-id="83f5a-261">清除暂存表</span><span class="sxs-lookup"><span data-stu-id="83f5a-261">Clean up the staging tables</span></span>
<span data-ttu-id="83f5a-262">从平台更新 29 开始，已弃用此功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-262">Starting in Platform update 29, this functionality has been deprecated.</span></span> <span data-ttu-id="83f5a-263">已被下面介绍的新作业历史记录清理功能版本取代。</span><span class="sxs-lookup"><span data-stu-id="83f5a-263">This is replaced by a new version of job history clean-up functionality explained below.</span></span>

<span data-ttu-id="83f5a-264">您可以使用 **数据管理** 工作区中的 **暂存清除** 功能清除暂存表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-264">You can clean up staging tables by using the **Staging clean up** feature in the **Data management** workspace.</span></span> <span data-ttu-id="83f5a-265">您可以使用以下选项选择从哪个暂存表删除哪些记录：</span><span class="sxs-lookup"><span data-stu-id="83f5a-265">You can use the following options to select which records should be deleted from which staging table:</span></span>

- <span data-ttu-id="83f5a-266">**实体** - 如果仅提供一个实体，则删除来自该实体暂存表的所有记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-266">**Entity** – If only an entity is provided, all records from that entity’s staging table are deleted.</span></span> <span data-ttu-id="83f5a-267">选择此选项以清除跨所有数据项目和所有作业的实体的所有数据。</span><span class="sxs-lookup"><span data-stu-id="83f5a-267">Select this option to clean up all the data for the entity across all data projects and all jobs.</span></span>
- <span data-ttu-id="83f5a-268">**作业 ID** - 如果仅提供一个作业 ID，则从相应的暂存表中删除选定作业中的所有实体的所有记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-268">**Job ID** – If only a job ID is provided, all records for all entities in the selected job are deleted from the appropriate staging tables.</span></span>
- <span data-ttu-id="83f5a-269">**数据项目** - 如果仅选择一个数据项目，则删除选定数据项目的所有实体和跨所有作业的所有记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-269">**Data projects** – If only a data project is selected, all records for all entities and across all jobs for the selected data project are deleted.</span></span>

<span data-ttu-id="83f5a-270">您还可以合并这些选项以进一步限制被删除的记录集。</span><span class="sxs-lookup"><span data-stu-id="83f5a-270">You can also combine the options to further restrict the record set that is deleted.</span></span>

## <a name="job-history-clean-up-available-in-platform-update-29-and-later"></a><span data-ttu-id="83f5a-271">作业历史记录清理（平台更新 29 及更高版本中提供）</span><span class="sxs-lookup"><span data-stu-id="83f5a-271">Job history clean up (available in Platform update 29 and later)</span></span>

<span data-ttu-id="83f5a-272">若要安排定期清理执行历史记录，必须使用数据管理中的作业历史记录清理功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-272">The job history clean-up functionality in data management must be used to schedule a periodic cleanup of the execution history.</span></span> <span data-ttu-id="83f5a-273">此功能取代了之前的暂存表清理功能，后者已被弃用。</span><span class="sxs-lookup"><span data-stu-id="83f5a-273">This functionality replaces the previous staging table clean-up functionality, which is now deprecated.</span></span> <span data-ttu-id="83f5a-274">清理过程将清理下面的表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-274">The following tables will be cleaned up by the clean-up process.</span></span>

-   <span data-ttu-id="83f5a-275">所有暂存表</span><span class="sxs-lookup"><span data-stu-id="83f5a-275">All staging tables</span></span>

-   <span data-ttu-id="83f5a-276">DMFSTAGINGVALIDATIONLOG</span><span class="sxs-lookup"><span data-stu-id="83f5a-276">DMFSTAGINGVALIDATIONLOG</span></span>

-   <span data-ttu-id="83f5a-277">DMFSTAGINGEXECUTIONERRORS</span><span class="sxs-lookup"><span data-stu-id="83f5a-277">DMFSTAGINGEXECUTIONERRORS</span></span>

-   <span data-ttu-id="83f5a-278">DMFSTAGINGLOGDETAIL</span><span class="sxs-lookup"><span data-stu-id="83f5a-278">DMFSTAGINGLOGDETAIL</span></span>

-   <span data-ttu-id="83f5a-279">DMFSTAGINGLOG</span><span class="sxs-lookup"><span data-stu-id="83f5a-279">DMFSTAGINGLOG</span></span>

-   <span data-ttu-id="83f5a-280">DMFDEFINITIONGROUPEXECUTIONHISTORY</span><span class="sxs-lookup"><span data-stu-id="83f5a-280">DMFDEFINITIONGROUPEXECUTIONHISTORY</span></span>

-   <span data-ttu-id="83f5a-281">DMFEXECUTION</span><span class="sxs-lookup"><span data-stu-id="83f5a-281">DMFEXECUTION</span></span>

-   <span data-ttu-id="83f5a-282">DMFDEFINITIONGROUPEXECUTION</span><span class="sxs-lookup"><span data-stu-id="83f5a-282">DMFDEFINITIONGROUPEXECUTION</span></span>

<span data-ttu-id="83f5a-283">**执行历史记录清理** 功能只有在功能管理中启用后，才能从 **数据管理 \> 作业历史记录清理** 访问。</span><span class="sxs-lookup"><span data-stu-id="83f5a-283">The **Execution history cleanup** feature must be enabled in feature management and then can be accessed from **Data management \> Job history cleanup**.</span></span>

### <a name="scheduling-parameters"></a><span data-ttu-id="83f5a-284">计划编制参数</span><span class="sxs-lookup"><span data-stu-id="83f5a-284">Scheduling parameters</span></span>

<span data-ttu-id="83f5a-285">计划清理过程时，必须指定以下参数以定义清理条件。</span><span class="sxs-lookup"><span data-stu-id="83f5a-285">When scheduling the clean-up process, the following parameters must be specified to define the clean-up criteria.</span></span>

-   <span data-ttu-id="83f5a-286">**历史记录的保留天数** – 此设置用于控制执行历史记录的保留量。</span><span class="sxs-lookup"><span data-stu-id="83f5a-286">**Number of days to retain history** – This setting is used to control the amount of execution history to be preserved.</span></span> <span data-ttu-id="83f5a-287">单位为天数。</span><span class="sxs-lookup"><span data-stu-id="83f5a-287">This is specified in number of days.</span></span> <span data-ttu-id="83f5a-288">如果计划的清理作业为重复批处理作业，则此设置的作用类似连续移动的窗口，在删除一些历史记录的同时，始终保留所指定天数的历史记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-288">When the clean-up job is scheduled as a recurring batch job, this setting will act like a continuously moving window thereby, always leaving the history for the specified number of days intact while deleting the rest.</span></span> <span data-ttu-id="83f5a-289">默认值为 7 天。</span><span class="sxs-lookup"><span data-stu-id="83f5a-289">The default is 7 days.</span></span>

-   <span data-ttu-id="83f5a-290">**作业的执行小时数** – 清理作业的总执行时间从数分钟到数小时不等，具体取决于要清理的历史记录量。</span><span class="sxs-lookup"><span data-stu-id="83f5a-290">**Number of hours to execute the job** – Depending on the amount of history to be cleaned up, the total execution time for the clean-up job can vary from a few minutes to a few hours.</span></span> <span data-ttu-id="83f5a-291">此参数必须设置为作业将执行的小时数。</span><span class="sxs-lookup"><span data-stu-id="83f5a-291">This parameter must be set to the number of hours that the job will execute.</span></span> <span data-ttu-id="83f5a-292">清理作业执行了指定的小时数后，该作业将退出并在下次运行时基于重复计划恢复清理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-292">After the clean-up job has executed for the specified number of hours, the job will exit and will resume the clean up the next time it is run based on the recurrence schedule.</span></span>

    <span data-ttu-id="83f5a-293">可以使用此设置指定最大执行时间，方法是为作业的必须运行小时数设置最大限额。</span><span class="sxs-lookup"><span data-stu-id="83f5a-293">A maximum execution time can be specified by setting a max limit on the number of hours the job must run using this setting.</span></span> <span data-ttu-id="83f5a-294">清理逻辑按照以时间排列的顺序一次检查一个作业执行 ID（最早历史记录最先检查），以清理关联的执行历史记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-294">The clean-up logic goes through one job execution ID at a time in a chronologically arranged sequence, with oldest being first for the cleanup of related execution history.</span></span> <span data-ttu-id="83f5a-295">如果剩余执行持续时间不超过指定持续时间的 10%，将停止选取新执行 ID 来进行清理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-295">It will stop picking up new execution ID’s for cleanup when the remaining execution duration is within the last 10% of the specified duration.</span></span> <span data-ttu-id="83f5a-296">在某些情况下，清理作业在指定的最大时间之后应该会继续进行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-296">In some cases, it will be expected that the clean-up job will continue beyond the specified max time.</span></span> <span data-ttu-id="83f5a-297">这很大程度上取决于达到 10% 这个阈值之前开始的当前执行 ID 待删除记录数。</span><span class="sxs-lookup"><span data-stu-id="83f5a-297">This will largely depend on the number of records to be deleted for the current execution ID that was started before the 10% threshold was reached.</span></span> <span data-ttu-id="83f5a-298">必须完成已开始的清理工作，以确保数据的完整性，这意味着虽然超过了指定的限额，仍将继续清理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-298">The cleanup that was started must be completed to ensure data integrity, which means that cleanup will continue despite exceeding the specified limit.</span></span> <span data-ttu-id="83f5a-299">完成此项清理后，将不选取新的执行 ID，而清理工作则完成。</span><span class="sxs-lookup"><span data-stu-id="83f5a-299">When this is complete, new execution ID’s are not picked up and the clean-up job completes.</span></span> <span data-ttu-id="83f5a-300">下次计划清理作业时，将选取因为执行时间不足导致未清理的剩余执行历史记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-300">The remaining execution history that was not cleaned up due to lack of enough execution time, will be picked up the next time the clean-up job is scheduled.</span></span> <span data-ttu-id="83f5a-301">此设置的默认值（也是最小值）设置为 2 小时。</span><span class="sxs-lookup"><span data-stu-id="83f5a-301">The default and minimum value for this setting is set to 2 hours.</span></span>

-   <span data-ttu-id="83f5a-302">**重复执行的批处理** – 清理作业可以作为一次性的手动执行来运行，也可以计划为批量的重复执行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-302">**Recurring batch** – The clean-up job can be run as a one-time, manual execution, or it can be also scheduled for recurring execution in batch.</span></span> <span data-ttu-id="83f5a-303">可以使用 **后台运行** 设置来计划批处理，这是设置的标准批处理。</span><span class="sxs-lookup"><span data-stu-id="83f5a-303">The batch can be scheduled using the **Run in background** settings, which is the standard batch set up.</span></span>

> [!NOTE]
> <span data-ttu-id="83f5a-304">如果无法完全清理暂存表中的记录，请确保将清理作业安排为重复运行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-304">If records in the staging tables are not cleaned up completely, ensure that the cleanup job is scheduled to run in recurrence.</span></span> <span data-ttu-id="83f5a-305">正如前面的说明，在执行任何清理时，作业能够清理的执行 ID 记录数量不超过提供的最大小时数内能够清理的数量。</span><span class="sxs-lookup"><span data-stu-id="83f5a-305">As explained above, in any clean up execution the job will only clean up as many execution ID's as is possible within the provided maximum hours.</span></span> <span data-ttu-id="83f5a-306">若要继续清理任何剩余暂存记录，必须将作业安排为定期运行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-306">In order to continue cleanup of any remaining staging records, the job must be scheduled to run periodically.</span></span>

## <a name="job-history-clean-up-and-archival-available-for-preview-in-platform-update-39-or-version-10015"></a><span data-ttu-id="83f5a-307">作业历史记录的清理和存档（平台更新 39 或版本 10.0.15 中可预览）</span><span class="sxs-lookup"><span data-stu-id="83f5a-307">Job history clean up and archival (available for preview in Platform update 39 or version 10.0.15)</span></span>
<span data-ttu-id="83f5a-308">作业历史记录清理和存档功能取代了以前版本的清理功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-308">The job history clean up and archival functionality replaces the previous versions of the clean up functionality.</span></span> <span data-ttu-id="83f5a-309">本节将解释这些新功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-309">This section will explain these new capabilities.</span></span>

<span data-ttu-id="83f5a-310">清除功能的主要变化之一是使用系统批处理作业来清除历史记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-310">One of the main changes to the clean up functionality is the use of system batch job for cleaning up the history.</span></span> <span data-ttu-id="83f5a-311">使用系统批处理作业允许 Finance and Operations 应用自动安排清理批处理作业，并在系统准备就绪时立即运行。</span><span class="sxs-lookup"><span data-stu-id="83f5a-311">The use of system batch job allows Finance and Operations apps to have the clean up batch job automatically scheduled and running as soon as the system is ready.</span></span> <span data-ttu-id="83f5a-312">不再需要手动安排批处理作业。</span><span class="sxs-lookup"><span data-stu-id="83f5a-312">It is no longer required to schedule the batch job manually.</span></span> <span data-ttu-id="83f5a-313">在此默认执行模式下，批处理作业将从午夜 12 点开始每小时执行一次，并将保留最近 7 天的执行历史记录。</span><span class="sxs-lookup"><span data-stu-id="83f5a-313">In this default execution mode, the batch job will execute every hour starting at 12 midnight and will retain the execution history for the most recent 7 days.</span></span> <span data-ttu-id="83f5a-314">清除的历史记录将存档，以备将来检索。</span><span class="sxs-lookup"><span data-stu-id="83f5a-314">The purged history is archived for future retrieval.</span></span>

> [!NOTE]
> <span data-ttu-id="83f5a-315">因为此功能处于预览版阶段，所以系统批处理作业将不会删除任何执行历史记录，除非通过外部测试版 DMFEnableExecutionHistoryCleanupSystemJob 启用。</span><span class="sxs-lookup"><span data-stu-id="83f5a-315">Because this functionality is in preview, the system batch job will not delete any execution history until it is enabled via the flight DMFEnableExecutionHistoryCleanupSystemJob.</span></span> <span data-ttu-id="83f5a-316">如果该功能在将来的版本中公开发布，则不需要此外部测试版，并且系统准备就绪后，系统批处理作业将根据上面定义的计划开始清除和存档。</span><span class="sxs-lookup"><span data-stu-id="83f5a-316">When the feature is generally available in a future release, this flight will not be required and the system batch job will start to purge and archive after the system is ready, based on the defined schedule as explained above.</span></span> 

> [!NOTE]
> <span data-ttu-id="83f5a-317">在将来的版本中，将从 Finance and Operations 应用中删除以前版本的清理功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-317">In a future release, the previous versions of the clean up functionality will be removed from Finance and Operations apps.</span></span>

<span data-ttu-id="83f5a-318">清除过程的第二个变化是所清除执行历史的存档。</span><span class="sxs-lookup"><span data-stu-id="83f5a-318">The second change in the clean up process is the archival of the purged execution history.</span></span> <span data-ttu-id="83f5a-319">清理作业会将已删除的记录归档到 DIXF 用于常规集成的 Blob 存储中。</span><span class="sxs-lookup"><span data-stu-id="83f5a-319">The clean up job will archive the deleted records to the blob storage that DIXF uses for regular integrations.</span></span> <span data-ttu-id="83f5a-320">归档的文件将采用 DIXF 软件包格式，并且在 blob 中保留 7 天，在此期间可供下载。</span><span class="sxs-lookup"><span data-stu-id="83f5a-320">The archived file will be in the DIXF package format and will be available for 7 days in the blob during which time it can be downloaded.</span></span> <span data-ttu-id="83f5a-321">可在参数中将归档文件的 7 天这一默认寿命更改为最大 90 天。</span><span class="sxs-lookup"><span data-stu-id="83f5a-321">The default longevity of 7 days for the archived file can be changed to a maximum of 90 days in the parameters.</span></span>

### <a name="changing-the-default-settings"></a><span data-ttu-id="83f5a-322">更改默认设置</span><span class="sxs-lookup"><span data-stu-id="83f5a-322">Changing the default settings</span></span>
<span data-ttu-id="83f5a-323">该功能当前处于预览版阶段，必须通过启用外部测试版 DMFEnableExecutionHistoryCleanupSystemJob 明确将其打开。</span><span class="sxs-lookup"><span data-stu-id="83f5a-323">This functionality is currently in preview and must be explicitly turned on by enabling the flight DMFEnableExecutionHistoryCleanupSystemJob.</span></span> <span data-ttu-id="83f5a-324">还必须在功能管理中开启暂存清理功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-324">The staging clean up feature must also be turned on in feature management.</span></span>

<span data-ttu-id="83f5a-325">要更改存档文件寿命的默认设置，请转到数据管理工作区，然后选择 **作业历史记录清理**。</span><span class="sxs-lookup"><span data-stu-id="83f5a-325">To change the default setting for the longevity of the archived file, go to the data management workspace and select **Job history cleanup**.</span></span> <span data-ttu-id="83f5a-326">将 **数据包在 blob 中的保留天数** 设置为 7 与 90（含）之间的值。</span><span class="sxs-lookup"><span data-stu-id="83f5a-326">Set **Days to retain package in blob** to a value between 7 and 90 (inclusive).</span></span> <span data-ttu-id="83f5a-327">此设置将对进行此更改之后创建的存档有效。</span><span class="sxs-lookup"><span data-stu-id="83f5a-327">This will take effect on the archives that are created after this change was made.</span></span>

### <a name="downloading-the-archived-package"></a><span data-ttu-id="83f5a-328">下载存档的数据包</span><span class="sxs-lookup"><span data-stu-id="83f5a-328">Downloading the archived package</span></span>
<span data-ttu-id="83f5a-329">该功能当前处于预览版阶段，必须通过启用外部测试版 DMFEnableExecutionHistoryCleanupSystemJob 明确将其打开。</span><span class="sxs-lookup"><span data-stu-id="83f5a-329">This functionality is currently in preview and must be explicitly turned on by enabling the flight DMFEnableExecutionHistoryCleanupSystemJob.</span></span> <span data-ttu-id="83f5a-330">还必须在功能管理中开启暂存清理功能。</span><span class="sxs-lookup"><span data-stu-id="83f5a-330">The staging clean up feature must also be turned on in feature management.</span></span>

<span data-ttu-id="83f5a-331">要下载存档的执行历史记录，请转到数据管理工作区，然后选择 **作业历史记录清理**。</span><span class="sxs-lookup"><span data-stu-id="83f5a-331">To download the archived execution history, go to the data management workspace and select **Job history cleanup**.</span></span> <span data-ttu-id="83f5a-332">选择 **软件包备份历史记录** 打开历史记录窗体。</span><span class="sxs-lookup"><span data-stu-id="83f5a-332">Select **Package backup history** to open the history form.</span></span> <span data-ttu-id="83f5a-333">此窗体显示所有已归档数据包的列表。</span><span class="sxs-lookup"><span data-stu-id="83f5a-333">This form shows the list of all archived packages.</span></span> <span data-ttu-id="83f5a-334">可通过选择 **下载数据包** 选择和下载存档。</span><span class="sxs-lookup"><span data-stu-id="83f5a-334">An archive can be selected and downloaded by selecting **Download package**.</span></span> <span data-ttu-id="83f5a-335">下载的数据包将采用 DIXF 数据包包格式，并且其中包含以下文件：</span><span class="sxs-lookup"><span data-stu-id="83f5a-335">The downloaded package will be in the DIXF package format and contain the following files:</span></span>

-   <span data-ttu-id="83f5a-336">实体暂存表文件</span><span class="sxs-lookup"><span data-stu-id="83f5a-336">The entity staging table file</span></span>
-   <span data-ttu-id="83f5a-337">DMFDEFINITIONGROUPEXECUTION</span><span class="sxs-lookup"><span data-stu-id="83f5a-337">DMFDEFINITIONGROUPEXECUTION</span></span>
-   <span data-ttu-id="83f5a-338">DMFDEFINITIONGROUPEXECUTIONHISTORY</span><span class="sxs-lookup"><span data-stu-id="83f5a-338">DMFDEFINITIONGROUPEXECUTIONHISTORY</span></span>
-   <span data-ttu-id="83f5a-339">DMFEXECUTION</span><span class="sxs-lookup"><span data-stu-id="83f5a-339">DMFEXECUTION</span></span>
-   <span data-ttu-id="83f5a-340">DMFSTAGINGEXECUTIONERRORS</span><span class="sxs-lookup"><span data-stu-id="83f5a-340">DMFSTAGINGEXECUTIONERRORS</span></span>
-   <span data-ttu-id="83f5a-341">DMFSTAGINGLOG</span><span class="sxs-lookup"><span data-stu-id="83f5a-341">DMFSTAGINGLOG</span></span>
-   <span data-ttu-id="83f5a-342">DMFSTAGINGLOGDETAILS</span><span class="sxs-lookup"><span data-stu-id="83f5a-342">DMFSTAGINGLOGDETAILS</span></span>
-   <span data-ttu-id="83f5a-343">DMFSTAGINGVALIDATIONLOG</span><span class="sxs-lookup"><span data-stu-id="83f5a-343">DMFSTAGINGVALIDATIONLOG</span></span>



[!INCLUDE[footer-include](../../../includes/footer-banner.md)]